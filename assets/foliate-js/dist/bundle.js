(()=>{"use strict";var e,t,n,i,r={113:(e,t,n)=>{n.r(t),n.d(t,{FixedLayout:()=>r});const i=e=>e?.split(/[,;\s]/)?.filter((e=>e))?.map((e=>e.split("=").map((e=>e.trim()))));class r extends HTMLElement{#e=this.attachShadow({mode:"closed"});#t=new ResizeObserver((()=>this.#n()));#i;#r=-1;defaultViewport;spread;#o=!1;#a;#s;#l;#c;constructor(){super();const e=new CSSStyleSheet;this.#e.adoptedStyleSheets=[e],e.replaceSync(":host {\n            width: 100%;\n            height: 100%;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }"),this.#t.observe(this)}async#d(e,{index:t,src:n}){const r=document.createElement("div"),o=document.createElement("iframe");return r.append(o),Object.assign(o.style,{border:"0",display:"none",overflow:"hidden"}),o.setAttribute("sandbox","allow-same-origin allow-scripts"),o.setAttribute("scrolling","no"),o.setAttribute("part","filter"),this.#e.append(r),n?new Promise((a=>{const s=()=>{o.removeEventListener("load",s);const n=o.contentDocument;n.position=e,this.dispatchEvent(new CustomEvent("load",{detail:{doc:n,index:t}}));const{width:l,height:c}=((e,t)=>{if("svg"===e.documentElement.localName){const[,,t,n]=e.documentElement.getAttribute("viewBox")?.split(/\s/)??[];return{width:t,height:n}}const n=i(e.querySelector('meta[name="viewport"]')?.getAttribute("content"));if(n)return Object.fromEntries(n);if("string"==typeof t)return i(t);if(t)return t;const r=e.querySelector("img");return r?{width:r.naturalWidth,height:r.naturalHeight}:(console.warn(new Error("Missing viewport properties")),{width:1e3,height:2e3})})(n,this.defaultViewport);a({element:r,iframe:o,width:parseFloat(l),height:parseFloat(c)})};o.addEventListener("load",s),o.src=n})):{blank:!0,element:r,iframe:o}}#n(e=this.#c){if(!e)return;const t=this.#a??{},n=this.#l??this.#s,i="left"===e?t:n,{width:r,height:o}=this.getBoundingClientRect(),a="both"!==this.spread&&"portrait"!==this.spread&&o>r;this.#o=a;const s=t.width??n.width,l=t.height??n.height,c=a||this.#l?Math.min(r/(i.width??s),o/(i.height??l)):Math.min(r/((t.width??s)+(n.width??s)),o/Math.max(t.height??l,n.height??l)),d=e=>{const{element:t,iframe:n,width:r,height:o,blank:d}=e;n.contentDocument.scale=c,Object.assign(n.style,{width:`${r}px`,height:`${o}px`,transform:`scale(${c})`,transformOrigin:"top left",display:d?"none":"block"}),Object.assign(t.style,{width:(r??s)*c+"px",height:(o??l)*c+"px",overflow:"hidden",display:"block"}),a&&e!==i&&(t.style.display="none")};this.#l?d(this.#l):(d(t),d(n))}async#h({left:e,right:t,center:n,side:i}){this.#e.replaceChildren(),this.#a=null,this.#s=null,this.#l=null,n?(this.#l=await this.#d("center",n),this.#c="center",this.#n()):(this.#a=await this.#d("left",e),this.#s=await this.#d("right",t),this.#c=this.#a.blank?"right":this.#s.blank?"left":i,this.#n())}#u(){if(!this.#l&&!this.#a?.blank)return this.#o&&"none"===this.#a?.element?.style?.display?(this.#s.element.style.display="none",this.#a.element.style.display="block",this.#c="left",!0):void 0}#f(){if(!this.#l&&!this.#s?.blank)return this.#o&&"none"===this.#s?.element?.style?.display?(this.#a.element.style.display="none",this.#s.element.style.display="block",this.#c="right",!0):void 0}open(e){this.book=e;const{rendition:t}=e;this.spread=t?.spread,this.defaultViewport=t?.viewport;const n="rtl"===e.dir,i=!n;this.rtl=n,this.#i="none"===t?.spread?e.sections.map((e=>({center:e}))):e.sections.reduce(((e,t)=>{const r=e[e.length-1],{linear:o,pageSpread:a}=t;if("no"===o)return e;const s=()=>{const t={};return e.push(t),t};return"center"===a?(r.left||r.right?s():r).center=t:"left"===a?(r.center||r.left||i?s():r).left=t:"right"===a?(r.center||r.right||n?s():r).right=t:i?r.center||r.right?s().left=t:r.left?r.right=t:r.left=t:r.center||r.left?s().right=t:r.right?r.left=t:r.right=t,e}),[{}])}get index(){const e=this.#i[this.#r],t=e?.center??("left"===this.side?e.left??e.right:e.right??e.left);return this.book.sections.indexOf(t)}#g(e){this.dispatchEvent(new CustomEvent("relocate",{detail:{reason:e,range:null,index:this.index,fraction:0,size:1}}))}getSpreadOf(e){const t=this.#i;for(let n=0;n<t.length;n++){const{left:i,right:r,center:o}=t[n];if(i===e)return{index:n,side:"left"};if(r===e)return{index:n,side:"right"};if(o===e)return{index:n,side:"center"}}}async goToSpread(e,t,n){if(e<0||e>this.#i.length-1)return;if(e===this.#r)return void this.#n(t);this.#r=e;const i=this.#i[e];if(i.center){const e=this.book.sections.indexOf(i.center),t=await(i.center?.load?.());await this.#h({center:{index:e,src:t}})}else{const e=this.book.sections.indexOf(i.left),n=this.book.sections.indexOf(i.right),r={index:e,src:await(i.left?.load?.())},o={index:n,src:await(i.right?.load?.())};await this.#h({left:r,right:o,side:t})}this.#g(n)}async select(e){await this.goTo(e)}async goTo(e){const{book:t}=this,n=await e,i=t.sections[n.index];if(!i)return;const{index:r,side:o}=this.getSpreadOf(i);await this.goToSpread(r,o)}async next(){if(!(this.rtl?this.#u():this.#f()))return this.goToSpread(this.#r+1,this.rtl?"right":"left","page");this.#g("page")}async prev(){if(!(this.rtl?this.#f():this.#u()))return this.goToSpread(this.#r-1,this.rtl?"left":"right","page");this.#g("page")}getContents(){return Array.from(this.#e.querySelectorAll("iframe"),(e=>({doc:e.contentDocument})))}destroy(){this.#t.unobserve(this)}}customElements.define("foliate-fxl",r)},196:(e,t,n)=>{n.d(t,{u:()=>s});const i=(e,t)=>{const n=[];for(let i=t.currentNode;i;i=t.nextNode()){const t=e.comparePoint(i,0);if(0===t)n.push(i);else if(t>0)break}return n},r=(e,t)=>{const n=[];for(let e=t.nextNode();e;e=t.nextNode())n.push(e);return n},o=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT|NodeFilter.SHOW_CDATA_SECTION,a=e=>{if(1===e.nodeType){const t=e.tagName.toLowerCase();return"script"===t||"style"===t?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_ACCEPT},s=function*(e,t){const n=e.commonAncestorContainer??e.body??e,s=document.createTreeWalker(n,o,{acceptNode:a}),l=(e.commonAncestorContainer?i:r)(e,s),c=l.map((e=>e.nodeValue)),d=(e,t,n,i)=>{const r=document.createRange();return r.setStart(l[e],t),r.setEnd(l[n],i),r};for(const e of t(c,d))yield e}},260:(e,t,n)=>{n.d(t,{BlobReader:()=>rt,BlobWriter:()=>ot,TextWriter:()=>at,ZipReader:()=>Bt,configure:()=>M});const i=-2,r=-3,o=-5,a=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],s=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],l=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],u=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function f(){let e,t,n,i,a,s;function l(e,t,l,c,d,h,u,f,g,p,m){let w,b,y,x,v,k,S,_,A,L,T,E,C,R,I;L=0,v=l;do{n[e[t+L]]++,L++,v--}while(0!==v);if(n[0]==l)return u[0]=-1,f[0]=0,0;for(_=f[0],k=1;k<=15&&0===n[k];k++);for(S=k,_<k&&(_=k),v=15;0!==v&&0===n[v];v--);for(y=v,_>v&&(_=v),f[0]=_,R=1<<k;k<v;k++,R<<=1)if((R-=n[k])<0)return r;if((R-=n[v])<0)return r;for(n[v]+=R,s[1]=k=0,L=1,C=2;0!=--v;)s[C]=k+=n[L],C++,L++;v=0,L=0;do{0!==(k=e[t+L])&&(m[s[k]++]=v),L++}while(++v<l);for(l=s[y],s[0]=v=0,L=0,x=-1,E=-_,a[0]=0,T=0,I=0;S<=y;S++)for(w=n[S];0!=w--;){for(;S>E+_;){if(x++,E+=_,I=y-E,I=I>_?_:I,(b=1<<(k=S-E))>w+1&&(b-=w+1,C=S,k<I))for(;++k<I&&!((b<<=1)<=n[++C]);)b-=n[C];if(I=1<<k,p[0]+I>1440)return r;a[x]=T=p[0],p[0]+=I,0!==x?(s[x]=v,i[0]=k,i[1]=_,k=v>>>E-_,i[2]=T-a[x-1]-k,g.set(i,3*(a[x-1]+k))):u[0]=T}for(i[1]=S-E,L>=l?i[0]=192:m[L]<c?(i[0]=m[L]<256?0:96,i[2]=m[L++]):(i[0]=h[m[L]-c]+16+64,i[2]=d[m[L++]-c]),b=1<<S-E,k=v>>>E;k<I;k+=b)g.set(i,3*(T+k));for(k=1<<S-1;v&k;k>>>=1)v^=k;for(v^=k,A=(1<<E)-1;(v&A)!=s[x];)x--,E-=_,A=(1<<E)-1}return 0!==R&&1!=y?o:0}function f(r){let o;for(e||(e=[],t=[],n=new Int32Array(16),i=[],a=new Int32Array(15),s=new Int32Array(16)),t.length<r&&(t=[]),o=0;o<r;o++)t[o]=0;for(o=0;o<16;o++)n[o]=0;for(o=0;o<3;o++)i[o]=0;a.set(n.subarray(0,15),0),s.set(n.subarray(0,16),0)}this.inflate_trees_bits=function(n,i,a,s,c){let d;return f(19),e[0]=0,d=l(n,0,19,19,null,null,a,i,s,e,t),d==r?c.msg="oversubscribed dynamic bit lengths tree":d!=o&&0!==i[0]||(c.msg="incomplete dynamic bit lengths tree",d=r),d},this.inflate_trees_dynamic=function(n,i,a,s,g,p,m,w,b){let y;return f(288),e[0]=0,y=l(a,0,n,257,c,d,p,s,w,e,t),0!=y||0===s[0]?(y==r?b.msg="oversubscribed literal/length tree":-4!=y&&(b.msg="incomplete literal/length tree",y=r),y):(f(288),y=l(a,n,i,0,h,u,m,g,w,e,t),0!=y||0===g[0]&&n>257?(y==r?b.msg="oversubscribed distance tree":y==o?(b.msg="incomplete distance tree",y=r):-4!=y&&(b.msg="empty distance tree with lengths",y=r),y):0)}}function g(){const e=this;let t,n,o,s,l=0,c=0,d=0,h=0,u=0,f=0,g=0,p=0,m=0,w=0;function b(e,t,n,i,o,s,l,c){let d,h,u,f,g,p,m,w,b,y,x,v,k,S,_,A;m=c.next_in_index,w=c.avail_in,g=l.bitb,p=l.bitk,b=l.write,y=b<l.read?l.read-b-1:l.end-b,x=a[e],v=a[t];do{for(;p<20;)w--,g|=(255&c.read_byte(m++))<<p,p+=8;if(d=g&x,h=n,u=i,A=3*(u+d),0!==(f=h[A]))for(;;){if(g>>=h[A+1],p-=h[A+1],16&f){for(f&=15,k=h[A+2]+(g&a[f]),g>>=f,p-=f;p<15;)w--,g|=(255&c.read_byte(m++))<<p,p+=8;for(d=g&v,h=o,u=s,A=3*(u+d),f=h[A];;){if(g>>=h[A+1],p-=h[A+1],16&f){for(f&=15;p<f;)w--,g|=(255&c.read_byte(m++))<<p,p+=8;if(S=h[A+2]+(g&a[f]),g>>=f,p-=f,y-=k,b>=S)_=b-S,b-_>0&&2>b-_?(l.win[b++]=l.win[_++],l.win[b++]=l.win[_++],k-=2):(l.win.set(l.win.subarray(_,_+2),b),b+=2,_+=2,k-=2);else{_=b-S;do{_+=l.end}while(_<0);if(f=l.end-_,k>f){if(k-=f,b-_>0&&f>b-_)do{l.win[b++]=l.win[_++]}while(0!=--f);else l.win.set(l.win.subarray(_,_+f),b),b+=f,_+=f,f=0;_=0}}if(b-_>0&&k>b-_)do{l.win[b++]=l.win[_++]}while(0!=--k);else l.win.set(l.win.subarray(_,_+k),b),b+=k,_+=k,k=0;break}if(64&f)return c.msg="invalid distance code",k=c.avail_in-w,k=p>>3<k?p>>3:k,w+=k,m-=k,p-=k<<3,l.bitb=g,l.bitk=p,c.avail_in=w,c.total_in+=m-c.next_in_index,c.next_in_index=m,l.write=b,r;d+=h[A+2],d+=g&a[f],A=3*(u+d),f=h[A]}break}if(64&f)return 32&f?(k=c.avail_in-w,k=p>>3<k?p>>3:k,w+=k,m-=k,p-=k<<3,l.bitb=g,l.bitk=p,c.avail_in=w,c.total_in+=m-c.next_in_index,c.next_in_index=m,l.write=b,1):(c.msg="invalid literal/length code",k=c.avail_in-w,k=p>>3<k?p>>3:k,w+=k,m-=k,p-=k<<3,l.bitb=g,l.bitk=p,c.avail_in=w,c.total_in+=m-c.next_in_index,c.next_in_index=m,l.write=b,r);if(d+=h[A+2],d+=g&a[f],A=3*(u+d),0===(f=h[A])){g>>=h[A+1],p-=h[A+1],l.win[b++]=h[A+2],y--;break}}else g>>=h[A+1],p-=h[A+1],l.win[b++]=h[A+2],y--}while(y>=258&&w>=10);return k=c.avail_in-w,k=p>>3<k?p>>3:k,w+=k,m-=k,p-=k<<3,l.bitb=g,l.bitk=p,c.avail_in=w,c.total_in+=m-c.next_in_index,c.next_in_index=m,l.write=b,0}e.init=function(e,i,r,a,l,c){t=0,g=e,p=i,o=r,m=a,s=l,w=c,n=null},e.proc=function(e,y,x){let v,k,S,_,A,L,T,E=0,C=0,R=0;for(R=y.next_in_index,_=y.avail_in,E=e.bitb,C=e.bitk,A=e.write,L=A<e.read?e.read-A-1:e.end-A;;)switch(t){case 0:if(L>=258&&_>=10&&(e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,x=b(g,p,o,m,s,w,e,y),R=y.next_in_index,_=y.avail_in,E=e.bitb,C=e.bitk,A=e.write,L=A<e.read?e.read-A-1:e.end-A,0!=x)){t=1==x?7:9;break}d=g,n=o,c=m,t=1;case 1:for(v=d;C<v;){if(0===_)return e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);x=0,_--,E|=(255&y.read_byte(R++))<<C,C+=8}if(k=3*(c+(E&a[v])),E>>>=n[k+1],C-=n[k+1],S=n[k],0===S){h=n[k+2],t=6;break}if(16&S){u=15&S,l=n[k+2],t=2;break}if(!(64&S)){d=S,c=k/3+n[k+2];break}if(32&S){t=7;break}return t=9,y.msg="invalid literal/length code",x=r,e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);case 2:for(v=u;C<v;){if(0===_)return e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);x=0,_--,E|=(255&y.read_byte(R++))<<C,C+=8}l+=E&a[v],E>>=v,C-=v,d=p,n=s,c=w,t=3;case 3:for(v=d;C<v;){if(0===_)return e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);x=0,_--,E|=(255&y.read_byte(R++))<<C,C+=8}if(k=3*(c+(E&a[v])),E>>=n[k+1],C-=n[k+1],S=n[k],16&S){u=15&S,f=n[k+2],t=4;break}if(!(64&S)){d=S,c=k/3+n[k+2];break}return t=9,y.msg="invalid distance code",x=r,e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);case 4:for(v=u;C<v;){if(0===_)return e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);x=0,_--,E|=(255&y.read_byte(R++))<<C,C+=8}f+=E&a[v],E>>=v,C-=v,t=5;case 5:for(T=A-f;T<0;)T+=e.end;for(;0!==l;){if(0===L&&(A==e.end&&0!==e.read&&(A=0,L=A<e.read?e.read-A-1:e.end-A),0===L&&(e.write=A,x=e.inflate_flush(y,x),A=e.write,L=A<e.read?e.read-A-1:e.end-A,A==e.end&&0!==e.read&&(A=0,L=A<e.read?e.read-A-1:e.end-A),0===L)))return e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);e.win[A++]=e.win[T++],L--,T==e.end&&(T=0),l--}t=0;break;case 6:if(0===L&&(A==e.end&&0!==e.read&&(A=0,L=A<e.read?e.read-A-1:e.end-A),0===L&&(e.write=A,x=e.inflate_flush(y,x),A=e.write,L=A<e.read?e.read-A-1:e.end-A,A==e.end&&0!==e.read&&(A=0,L=A<e.read?e.read-A-1:e.end-A),0===L)))return e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);x=0,e.win[A++]=h,L--,t=0;break;case 7:if(C>7&&(C-=8,_++,R--),e.write=A,x=e.inflate_flush(y,x),A=e.write,L=A<e.read?e.read-A-1:e.end-A,e.read!=e.write)return e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);t=8;case 8:return x=1,e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);case 9:return x=r,e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x);default:return x=i,e.bitb=E,e.bitk=C,y.avail_in=_,y.total_in+=R-y.next_in_index,y.next_in_index=R,e.write=A,e.inflate_flush(y,x)}},e.free=function(){}}f.inflate_trees_fixed=function(e,t,n,i){return e[0]=9,t[0]=5,n[0]=s,i[0]=l,0};const p=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function m(e,t){const n=this;let s,l=0,c=0,d=0,h=0;const u=[0],m=[0],w=new g;let b=0,y=new Int32Array(4320);const x=new f;n.bitk=0,n.bitb=0,n.win=new Uint8Array(t),n.end=t,n.read=0,n.write=0,n.reset=function(e,t){t&&(t[0]=0),6==l&&w.free(e),l=0,n.bitk=0,n.bitb=0,n.read=n.write=0},n.reset(e,null),n.inflate_flush=function(e,t){let i,r,a;return r=e.next_out_index,a=n.read,i=(a<=n.write?n.write:n.end)-a,i>e.avail_out&&(i=e.avail_out),0!==i&&t==o&&(t=0),e.avail_out-=i,e.total_out+=i,e.next_out.set(n.win.subarray(a,a+i),r),r+=i,a+=i,a==n.end&&(a=0,n.write==n.end&&(n.write=0),i=n.write-a,i>e.avail_out&&(i=e.avail_out),0!==i&&t==o&&(t=0),e.avail_out-=i,e.total_out+=i,e.next_out.set(n.win.subarray(a,a+i),r),r+=i,a+=i),e.next_out_index=r,n.read=a,t},n.proc=function(e,t){let o,g,v,k,S,_,A,L;for(k=e.next_in_index,S=e.avail_in,g=n.bitb,v=n.bitk,_=n.write,A=_<n.read?n.read-_-1:n.end-_;;){let T,E,C,R,I,M,z,O;switch(l){case 0:for(;v<3;){if(0===S)return n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);t=0,S--,g|=(255&e.read_byte(k++))<<v,v+=8}switch(o=7&g,b=1&o,o>>>1){case 0:g>>>=3,v-=3,o=7&v,g>>>=o,v-=o,l=1;break;case 1:T=[],E=[],C=[[]],R=[[]],f.inflate_trees_fixed(T,E,C,R),w.init(T[0],E[0],C[0],0,R[0],0),g>>>=3,v-=3,l=6;break;case 2:g>>>=3,v-=3,l=3;break;case 3:return g>>>=3,v-=3,l=9,e.msg="invalid block type",t=r,n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t)}break;case 1:for(;v<32;){if(0===S)return n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);t=0,S--,g|=(255&e.read_byte(k++))<<v,v+=8}if((~g>>>16&65535)!=(65535&g))return l=9,e.msg="invalid stored block lengths",t=r,n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);c=65535&g,g=v=0,l=0!==c?2:0!==b?7:0;break;case 2:if(0===S)return n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);if(0===A&&(_==n.end&&0!==n.read&&(_=0,A=_<n.read?n.read-_-1:n.end-_),0===A&&(n.write=_,t=n.inflate_flush(e,t),_=n.write,A=_<n.read?n.read-_-1:n.end-_,_==n.end&&0!==n.read&&(_=0,A=_<n.read?n.read-_-1:n.end-_),0===A)))return n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);if(t=0,o=c,o>S&&(o=S),o>A&&(o=A),n.win.set(e.read_buf(k,o),_),k+=o,S-=o,_+=o,A-=o,0!=(c-=o))break;l=0!==b?7:0;break;case 3:for(;v<14;){if(0===S)return n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);t=0,S--,g|=(255&e.read_byte(k++))<<v,v+=8}if(d=o=16383&g,(31&o)>29||(o>>5&31)>29)return l=9,e.msg="too many length or distance symbols",t=r,n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);if(o=258+(31&o)+(o>>5&31),!s||s.length<o)s=[];else for(L=0;L<o;L++)s[L]=0;g>>>=14,v-=14,h=0,l=4;case 4:for(;h<4+(d>>>10);){for(;v<3;){if(0===S)return n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);t=0,S--,g|=(255&e.read_byte(k++))<<v,v+=8}s[p[h++]]=7&g,g>>>=3,v-=3}for(;h<19;)s[p[h++]]=0;if(u[0]=7,o=x.inflate_trees_bits(s,u,m,y,e),0!=o)return(t=o)==r&&(s=null,l=9),n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);h=0,l=5;case 5:for(;o=d,!(h>=258+(31&o)+(o>>5&31));){let i,c;for(o=u[0];v<o;){if(0===S)return n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);t=0,S--,g|=(255&e.read_byte(k++))<<v,v+=8}if(o=y[3*(m[0]+(g&a[o]))+1],c=y[3*(m[0]+(g&a[o]))+2],c<16)g>>>=o,v-=o,s[h++]=c;else{for(L=18==c?7:c-14,i=18==c?11:3;v<o+L;){if(0===S)return n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);t=0,S--,g|=(255&e.read_byte(k++))<<v,v+=8}if(g>>>=o,v-=o,i+=g&a[L],g>>>=L,v-=L,L=h,o=d,L+i>258+(31&o)+(o>>5&31)||16==c&&L<1)return s=null,l=9,e.msg="invalid bit length repeat",t=r,n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);c=16==c?s[L-1]:0;do{s[L++]=c}while(0!=--i);h=L}}if(m[0]=-1,I=[],M=[],z=[],O=[],I[0]=9,M[0]=6,o=d,o=x.inflate_trees_dynamic(257+(31&o),1+(o>>5&31),s,I,M,z,O,y,e),0!=o)return o==r&&(s=null,l=9),t=o,n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);w.init(I[0],M[0],y,z[0],y,O[0]),l=6;case 6:if(n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,1!=(t=w.proc(n,e,t)))return n.inflate_flush(e,t);if(t=0,w.free(e),k=e.next_in_index,S=e.avail_in,g=n.bitb,v=n.bitk,_=n.write,A=_<n.read?n.read-_-1:n.end-_,0===b){l=0;break}l=7;case 7:if(n.write=_,t=n.inflate_flush(e,t),_=n.write,A=_<n.read?n.read-_-1:n.end-_,n.read!=n.write)return n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);l=8;case 8:return t=1,n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);case 9:return t=r,n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t);default:return t=i,n.bitb=g,n.bitk=v,e.avail_in=S,e.total_in+=k-e.next_in_index,e.next_in_index=k,n.write=_,n.inflate_flush(e,t)}}},n.free=function(e){n.reset(e,null),n.win=null,y=null},n.set_dictionary=function(e,t,i){n.win.set(e.subarray(t,t+i),0),n.read=n.write=i},n.sync_point=function(){return 1==l?1:0}}const w=13,b=[0,0,255,255];function y(){const e=this;function t(e){return e&&e.istate?(e.total_in=e.total_out=0,e.msg=null,e.istate.mode=7,e.istate.blocks.reset(e,null),0):i}e.mode=0,e.method=0,e.was=[0],e.need=0,e.marker=0,e.wbits=0,e.inflateEnd=function(t){return e.blocks&&e.blocks.free(t),e.blocks=null,0},e.inflateInit=function(n,r){return n.msg=null,e.blocks=null,r<8||r>15?(e.inflateEnd(n),i):(e.wbits=r,n.istate.blocks=new m(n,1<<r),t(n),0)},e.inflate=function(e,t){let n,a;if(!e||!e.istate||!e.next_in)return i;const s=e.istate;for(t=4==t?o:0,n=o;;)switch(s.mode){case 0:if(0===e.avail_in)return n;if(n=t,e.avail_in--,e.total_in++,8!=(15&(s.method=e.read_byte(e.next_in_index++)))){s.mode=w,e.msg="unknown compression method",s.marker=5;break}if(8+(s.method>>4)>s.wbits){s.mode=w,e.msg="invalid win size",s.marker=5;break}s.mode=1;case 1:if(0===e.avail_in)return n;if(n=t,e.avail_in--,e.total_in++,a=255&e.read_byte(e.next_in_index++),((s.method<<8)+a)%31!=0){s.mode=w,e.msg="incorrect header check",s.marker=5;break}if(!(32&a)){s.mode=7;break}s.mode=2;case 2:if(0===e.avail_in)return n;n=t,e.avail_in--,e.total_in++,s.need=(255&e.read_byte(e.next_in_index++))<<24&4278190080,s.mode=3;case 3:if(0===e.avail_in)return n;n=t,e.avail_in--,e.total_in++,s.need+=(255&e.read_byte(e.next_in_index++))<<16&16711680,s.mode=4;case 4:if(0===e.avail_in)return n;n=t,e.avail_in--,e.total_in++,s.need+=(255&e.read_byte(e.next_in_index++))<<8&65280,s.mode=5;case 5:return 0===e.avail_in?n:(n=t,e.avail_in--,e.total_in++,s.need+=255&e.read_byte(e.next_in_index++),s.mode=6,2);case 6:return s.mode=w,e.msg="need dictionary",s.marker=0,i;case 7:if(n=s.blocks.proc(e,n),n==r){s.mode=w,s.marker=0;break}if(0==n&&(n=t),1!=n)return n;n=t,s.blocks.reset(e,s.was),s.mode=12;case 12:return e.avail_in=0,1;case w:return r;default:return i}},e.inflateSetDictionary=function(e,t,n){let r=0,o=n;if(!e||!e.istate||6!=e.istate.mode)return i;const a=e.istate;return o>=1<<a.wbits&&(o=(1<<a.wbits)-1,r=n-o),a.blocks.set_dictionary(t,r,o),a.mode=7,0},e.inflateSync=function(e){let n,a,s,l,c;if(!e||!e.istate)return i;const d=e.istate;if(d.mode!=w&&(d.mode=w,d.marker=0),0===(n=e.avail_in))return o;for(a=e.next_in_index,s=d.marker;0!==n&&s<4;)e.read_byte(a)==b[s]?s++:s=0!==e.read_byte(a)?0:4-s,a++,n--;return e.total_in+=a-e.next_in_index,e.next_in_index=a,e.avail_in=n,d.marker=s,4!=s?r:(l=e.total_in,c=e.total_out,t(e),e.total_in=l,e.total_out=c,d.mode=7,0)},e.inflateSyncPoint=function(e){return e&&e.istate&&e.istate.blocks?e.istate.blocks.sync_point():i}}function x(){}x.prototype={inflateInit(e){const t=this;return t.istate=new y,e||(e=15),t.istate.inflateInit(t,e)},inflate(e){const t=this;return t.istate?t.istate.inflate(t,e):i},inflateEnd(){const e=this;if(!e.istate)return i;const t=e.istate.inflateEnd(e);return e.istate=null,t},inflateSync(){const e=this;return e.istate?e.istate.inflateSync(e):i},inflateSetDictionary(e,t){const n=this;return n.istate?n.istate.inflateSetDictionary(n,e,t):i},read_byte(e){return this.next_in[e]},read_buf(e,t){return this.next_in.subarray(e,e+t)}};const v=4294967295,k=65535,S=33639248,_=101075792,A=void 0,L="undefined",T="function";class E{constructor(e){return class extends TransformStream{constructor(t,n){const i=new e(n);super({transform(e,t){t.enqueue(i.append(e))},flush(e){const t=i.flush();t&&e.enqueue(t)}})}}}}let C=2;try{typeof navigator!=L&&navigator.hardwareConcurrency&&(C=navigator.hardwareConcurrency)}catch(e){}const R={chunkSize:524288,maxWorkers:C,terminateWorkerTimeout:5e3,useWebWorkers:!0,useCompressionStream:!0,workerScripts:A,CompressionStreamNative:typeof CompressionStream!=L&&CompressionStream,DecompressionStreamNative:typeof DecompressionStream!=L&&DecompressionStream},I=Object.assign({},R);function M(e){const{baseURL:t,chunkSize:n,maxWorkers:i,terminateWorkerTimeout:r,useCompressionStream:o,useWebWorkers:a,Deflate:s,Inflate:l,CompressionStream:c,DecompressionStream:d,workerScripts:h}=e;if(z("baseURL",t),z("chunkSize",n),z("maxWorkers",i),z("terminateWorkerTimeout",r),z("useCompressionStream",o),z("useWebWorkers",a),s&&(I.CompressionStream=new E(s)),l&&(I.DecompressionStream=new E(l)),z("CompressionStream",c),z("DecompressionStream",d),h!==A){const{deflate:e,inflate:t}=h;if((e||t)&&(I.workerScripts||(I.workerScripts={})),e){if(!Array.isArray(e))throw new Error("workerScripts.deflate must be an array");I.workerScripts.deflate=e}if(t){if(!Array.isArray(t))throw new Error("workerScripts.inflate must be an array");I.workerScripts.inflate=t}}}function z(e,t){t!==A&&(I[e]=t)}const O=[];for(let e=0;e<256;e++){let t=e;for(let e=0;e<8;e++)1&t?t=t>>>1^3988292384:t>>>=1;O[e]=t}class F{constructor(e){this.crc=e||-1}append(e){let t=0|this.crc;for(let n=0,i=0|e.length;n<i;n++)t=t>>>8^O[255&(t^e[n])];this.crc=t}get(){return~this.crc}}class B extends TransformStream{constructor(){let e;const t=new F;super({transform(e,n){t.append(e),n.enqueue(e)},flush(){const n=new Uint8Array(4);new DataView(n.buffer).setUint32(0,t.get()),e.value=n}}),e=this}}const N={concat(e,t){if(0===e.length||0===t.length)return e.concat(t);const n=e[e.length-1],i=N.getPartial(n);return 32===i?e.concat(t):N._shiftRight(t,i,0|n,e.slice(0,e.length-1))},bitLength(e){const t=e.length;if(0===t)return 0;const n=e[t-1];return 32*(t-1)+N.getPartial(n)},clamp(e,t){if(32*e.length<t)return e;const n=(e=e.slice(0,Math.ceil(t/32))).length;return t&=31,n>0&&t&&(e[n-1]=N.partial(t,e[n-1]&2147483648>>t-1,1)),e},partial:(e,t,n)=>32===e?t:(n?0|t:t<<32-e)+1099511627776*e,getPartial:e=>Math.round(e/1099511627776)||32,_shiftRight(e,t,n,i){for(void 0===i&&(i=[]);t>=32;t-=32)i.push(n),n=0;if(0===t)return i.concat(e);for(let r=0;r<e.length;r++)i.push(n|e[r]>>>t),n=e[r]<<32-t;const r=e.length?e[e.length-1]:0,o=N.getPartial(r);return i.push(N.partial(t+o&31,t+o>32?n:i.pop(),1)),i}},P={bytes:{fromBits(e){const t=N.bitLength(e)/8,n=new Uint8Array(t);let i;for(let r=0;r<t;r++)!(3&r)&&(i=e[r/4]),n[r]=i>>>24,i<<=8;return n},toBits(e){const t=[];let n,i=0;for(n=0;n<e.length;n++)i=i<<8|e[n],!(3&~n)&&(t.push(i),i=0);return 3&n&&t.push(N.partial(8*(3&n),i)),t}}},U=class{constructor(e){const t=this;t.blockSize=512,t._init=[1732584193,4023233417,2562383102,271733878,3285377520],t._key=[1518500249,1859775393,2400959708,3395469782],e?(t._h=e._h.slice(0),t._buffer=e._buffer.slice(0),t._length=e._length):t.reset()}reset(){const e=this;return e._h=e._init.slice(0),e._buffer=[],e._length=0,e}update(e){const t=this;"string"==typeof e&&(e=P.utf8String.toBits(e));const n=t._buffer=N.concat(t._buffer,e),i=t._length,r=t._length=i+N.bitLength(e);if(r>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");const o=new Uint32Array(n);let a=0;for(let e=t.blockSize+i-(t.blockSize+i&t.blockSize-1);e<=r;e+=t.blockSize)t._block(o.subarray(16*a,16*(a+1))),a+=1;return n.splice(0,16*a),t}finalize(){const e=this;let t=e._buffer;const n=e._h;t=N.concat(t,[N.partial(1,1)]);for(let e=t.length+2;15&e;e++)t.push(0);for(t.push(Math.floor(e._length/4294967296)),t.push(0|e._length);t.length;)e._block(t.splice(0,16));return e.reset(),n}_f(e,t,n,i){return e<=19?t&n|~t&i:e<=39?t^n^i:e<=59?t&n|t&i|n&i:e<=79?t^n^i:void 0}_S(e,t){return t<<e|t>>>32-e}_block(e){const t=this,n=t._h,i=Array(80);for(let t=0;t<16;t++)i[t]=e[t];let r=n[0],o=n[1],a=n[2],s=n[3],l=n[4];for(let e=0;e<=79;e++){e>=16&&(i[e]=t._S(1,i[e-3]^i[e-8]^i[e-14]^i[e-16]));const n=t._S(5,r)+t._f(e,o,a,s)+l+i[e]+t._key[Math.floor(e/20)]|0;l=s,s=a,a=t._S(30,o),o=r,r=n}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+a|0,n[3]=n[3]+s|0,n[4]=n[4]+l|0}},D={getRandomValues(e){const t=new Uint32Array(e.buffer),n=e=>{let t=987654321;const n=4294967295;return function(){return t=36969*(65535&t)+(t>>16)&n,(((t<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let i,r=0;r<e.length;r+=4){const e=n(4294967296*(i||Math.random()));i=987654071*e(),t[r/4]=4294967296*e()|0}return e}},$={importKey:e=>new $.hmacSha1(P.bytes.toBits(e)),pbkdf2(e,t,n,i){if(n=n||1e4,i<0||n<0)throw new Error("invalid params to pbkdf2");const r=1+(i>>5)<<2;let o,a,s,l,c;const d=new ArrayBuffer(r),h=new DataView(d);let u=0;const f=N;for(t=P.bytes.toBits(t),c=1;u<(r||1);c++){for(o=a=e.encrypt(f.concat(t,[c])),s=1;s<n;s++)for(a=e.encrypt(a),l=0;l<a.length;l++)o[l]^=a[l];for(s=0;u<(r||1)&&s<o.length;s++)h.setInt32(u,o[s]),u+=4}return d.slice(0,i/8)},hmacSha1:class{constructor(e){const t=this,n=t._hash=U,i=[[],[]];t._baseHash=[new n,new n];const r=t._baseHash[0].blockSize/32;e.length>r&&(e=(new n).update(e).finalize());for(let t=0;t<r;t++)i[0][t]=909522486^e[t],i[1][t]=1549556828^e[t];t._baseHash[0].update(i[0]),t._baseHash[1].update(i[1]),t._resultHash=new n(t._baseHash[0])}reset(){const e=this;e._resultHash=new e._hash(e._baseHash[0]),e._updated=!1}update(e){this._updated=!0,this._resultHash.update(e)}digest(){const e=this,t=e._resultHash.finalize(),n=new e._hash(e._baseHash[1]).update(t).finalize();return e.reset(),n}encrypt(e){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(e),this.digest(e)}}},W="undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues,j="Invalid password",H="Invalid signature",q="zipjs-abort-check-password";function V(e){return W?crypto.getRandomValues(e):D.getRandomValues(e)}const X=16,G={name:"PBKDF2"},K=Object.assign({hash:{name:"HMAC"}},G),J=Object.assign({iterations:1e3,hash:{name:"SHA-1"}},G),Z=["deriveBits"],Y=[8,12,16],Q=[16,24,32],ee=10,te=[0,0,0,0],ne="undefined",ie="function",re=typeof crypto!=ne,oe=re&&crypto.subtle,ae=re&&typeof oe!=ne,se=P.bytes,le=class{constructor(e){const t=this;t._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],t._tables[0][0][0]||t._precompute();const n=t._tables[0][4],i=t._tables[1],r=e.length;let o,a,s,l=1;if(4!==r&&6!==r&&8!==r)throw new Error("invalid aes key size");for(t._key=[a=e.slice(0),s=[]],o=r;o<4*r+28;o++){let e=a[o-1];(o%r==0||8===r&&o%r==4)&&(e=n[e>>>24]<<24^n[e>>16&255]<<16^n[e>>8&255]<<8^n[255&e],o%r==0&&(e=e<<8^e>>>24^l<<24,l=l<<1^283*(l>>7))),a[o]=a[o-r]^e}for(let e=0;o;e++,o--){const t=a[3&e?o:o-4];s[e]=o<=4||e<4?t:i[0][n[t>>>24]]^i[1][n[t>>16&255]]^i[2][n[t>>8&255]]^i[3][n[255&t]]}}encrypt(e){return this._crypt(e,0)}decrypt(e){return this._crypt(e,1)}_precompute(){const e=this._tables[0],t=this._tables[1],n=e[4],i=t[4],r=[],o=[];let a,s,l,c;for(let e=0;e<256;e++)o[(r[e]=e<<1^283*(e>>7))^e]=e;for(let d=a=0;!n[d];d^=s||1,a=o[a]||1){let o=a^a<<1^a<<2^a<<3^a<<4;o=o>>8^255&o^99,n[d]=o,i[o]=d,c=r[l=r[s=r[d]]];let h=16843009*c^65537*l^257*s^16843008*d,u=257*r[o]^16843008*o;for(let n=0;n<4;n++)e[n][d]=u=u<<24^u>>>8,t[n][o]=h=h<<24^h>>>8}for(let n=0;n<5;n++)e[n]=e[n].slice(0),t[n]=t[n].slice(0)}_crypt(e,t){if(4!==e.length)throw new Error("invalid aes block size");const n=this._key[t],i=n.length/4-2,r=[0,0,0,0],o=this._tables[t],a=o[0],s=o[1],l=o[2],c=o[3],d=o[4];let h,u,f,g=e[0]^n[0],p=e[t?3:1]^n[1],m=e[2]^n[2],w=e[t?1:3]^n[3],b=4;for(let e=0;e<i;e++)h=a[g>>>24]^s[p>>16&255]^l[m>>8&255]^c[255&w]^n[b],u=a[p>>>24]^s[m>>16&255]^l[w>>8&255]^c[255&g]^n[b+1],f=a[m>>>24]^s[w>>16&255]^l[g>>8&255]^c[255&p]^n[b+2],w=a[w>>>24]^s[g>>16&255]^l[p>>8&255]^c[255&m]^n[b+3],b+=4,g=h,p=u,m=f;for(let e=0;e<4;e++)r[t?3&-e:e]=d[g>>>24]<<24^d[p>>16&255]<<16^d[m>>8&255]<<8^d[255&w]^n[b++],h=g,g=p,p=m,m=w,w=h;return r}},ce=class{constructor(e,t){this._prf=e,this._initIv=t,this._iv=t}reset(){this._iv=this._initIv}update(e){return this.calculate(this._prf,e,this._iv)}incWord(e){if(255&~(e>>24))e+=1<<24;else{let t=e>>16&255,n=e>>8&255,i=255&e;255===t?(t=0,255===n?(n=0,255===i?i=0:++i):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=i}return e}incCounter(e){0===(e[0]=this.incWord(e[0]))&&(e[1]=this.incWord(e[1]))}calculate(e,t,n){let i;if(!(i=t.length))return[];const r=N.bitLength(t);for(let r=0;r<i;r+=4){this.incCounter(n);const i=e.encrypt(n);t[r]^=i[0],t[r+1]^=i[1],t[r+2]^=i[2],t[r+3]^=i[3]}return N.clamp(t,r)}},de=$.hmacSha1;let he=re&&ae&&typeof oe.importKey==ie,ue=re&&ae&&typeof oe.deriveBits==ie;class fe extends TransformStream{constructor({password:e,signed:t,encryptionStrength:n,checkPasswordOnly:i}){super({start(){Object.assign(this,{ready:new Promise((e=>this.resolveReady=e)),password:e,signed:t,strength:n-1,pending:new Uint8Array})},async transform(e,t){const n=this,{password:r,strength:o,resolveReady:a,ready:s}=n;r?(await async function(e,t,n,i){const r=await me(e,t,n,be(i,0,Y[t])),o=be(i,Y[t]);if(r[0]!=o[0]||r[1]!=o[1])throw new Error(j)}(n,o,r,be(e,0,Y[o]+2)),e=be(e,Y[o]+2),i?t.error(new Error(q)):a()):await s;const l=new Uint8Array(e.length-ee-(e.length-ee)%X);t.enqueue(pe(n,e,l,0,ee,!0))},async flush(e){const{signed:t,ctr:n,hmac:i,pending:r,ready:o}=this;if(i&&n){await o;const a=be(r,0,r.length-ee),s=be(r,r.length-ee);let l=new Uint8Array;if(a.length){const e=xe(se,a);i.update(e);const t=n.update(e);l=ye(se,t)}if(t){const e=be(ye(se,i.digest()),0,ee);for(let t=0;t<ee;t++)if(e[t]!=s[t])throw new Error(H)}e.enqueue(l)}}})}}class ge extends TransformStream{constructor({password:e,encryptionStrength:t}){let n;super({start(){Object.assign(this,{ready:new Promise((e=>this.resolveReady=e)),password:e,strength:t-1,pending:new Uint8Array})},async transform(e,t){const n=this,{password:i,strength:r,resolveReady:o,ready:a}=n;let s=new Uint8Array;i?(s=await async function(e,t,n){const i=V(new Uint8Array(Y[t]));return we(i,await me(e,t,n,i))}(n,r,i),o()):await a;const l=new Uint8Array(s.length+e.length-e.length%X);l.set(s,0),t.enqueue(pe(n,e,l,s.length,0))},async flush(e){const{ctr:t,hmac:i,pending:r,ready:o}=this;if(i&&t){await o;let a=new Uint8Array;if(r.length){const e=t.update(xe(se,r));i.update(e),a=ye(se,e)}n.signature=ye(se,i.digest()).slice(0,ee),e.enqueue(we(a,n.signature))}}}),n=this}}function pe(e,t,n,i,r,o){const{ctr:a,hmac:s,pending:l}=e,c=t.length-r;let d;for(l.length&&(t=we(l,t),n=function(e,t){if(t&&t>e.length){const n=e;(e=new Uint8Array(t)).set(n,0)}return e}(n,c-c%X)),d=0;d<=c-X;d+=X){const e=xe(se,be(t,d,d+X));o&&s.update(e);const r=a.update(e);o||s.update(r),n.set(ye(se,r),d+i)}return e.pending=be(t,d),n}async function me(e,t,n,i){e.password=null;const r=function(e){if("undefined"==typeof TextEncoder){e=unescape(encodeURIComponent(e));const t=new Uint8Array(e.length);for(let n=0;n<t.length;n++)t[n]=e.charCodeAt(n);return t}return(new TextEncoder).encode(e)}(n),o=await async function(e,t,n,i,r){if(!he)return $.importKey(t);try{return await oe.importKey("raw",t,n,!1,r)}catch(e){return he=!1,$.importKey(t)}}(0,r,K,0,Z),a=await async function(e,t,n){if(!ue)return $.pbkdf2(t,e.salt,J.iterations,n);try{return await oe.deriveBits(e,t,n)}catch(i){return ue=!1,$.pbkdf2(t,e.salt,J.iterations,n)}}(Object.assign({salt:i},J),o,8*(2*Q[t]+2)),s=new Uint8Array(a),l=xe(se,be(s,0,Q[t])),c=xe(se,be(s,Q[t],2*Q[t])),d=be(s,2*Q[t]);return Object.assign(e,{keys:{key:l,authentication:c,passwordVerification:d},ctr:new ce(new le(l),Array.from(te)),hmac:new de(c)}),d}function we(e,t){let n=e;return e.length+t.length&&(n=new Uint8Array(e.length+t.length),n.set(e,0),n.set(t,e.length)),n}function be(e,t,n){return e.subarray(t,n)}function ye(e,t){return e.fromBits(t)}function xe(e,t){return e.toBits(t)}class ve extends TransformStream{constructor({password:e,passwordVerification:t,checkPasswordOnly:n}){super({start(){Object.assign(this,{password:e,passwordVerification:t}),Ae(this,e)},transform(e,t){const i=this;if(i.password){const t=Se(i,e.subarray(0,12));if(i.password=null,t[11]!=i.passwordVerification)throw new Error(j);e=e.subarray(12)}n?t.error(new Error(q)):t.enqueue(Se(i,e))}})}}class ke extends TransformStream{constructor({password:e,passwordVerification:t}){super({start(){Object.assign(this,{password:e,passwordVerification:t}),Ae(this,e)},transform(e,t){const n=this;let i,r;if(n.password){n.password=null;const t=V(new Uint8Array(12));t[11]=n.passwordVerification,i=new Uint8Array(e.length+t.length),i.set(_e(n,t),0),r=12}else i=new Uint8Array(e.length),r=0;i.set(_e(n,e),r),t.enqueue(i)}})}}function Se(e,t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=Te(e)^t[i],Le(e,n[i]);return n}function _e(e,t){const n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=Te(e)^t[i],Le(e,t[i]);return n}function Ae(e,t){const n=[305419896,591751049,878082192];Object.assign(e,{keys:n,crcKey0:new F(n[0]),crcKey2:new F(n[2])});for(let n=0;n<t.length;n++)Le(e,t.charCodeAt(n))}function Le(e,t){let[n,i,r]=e.keys;e.crcKey0.append([t]),n=~e.crcKey0.get(),i=Ce(Math.imul(Ce(i+Ee(n)),134775813)+1),e.crcKey2.append([i>>>24]),r=~e.crcKey2.get(),e.keys=[n,i,r]}function Te(e){const t=2|e.keys[2];return Ee(Math.imul(t,1^t)>>>8)}function Ee(e){return 255&e}function Ce(e){return 4294967295&e}const Re="deflate-raw";class Ie extends TransformStream{constructor(e,{chunkSize:t,CompressionStream:n,CompressionStreamNative:i}){super({});const{compressed:r,encrypted:o,useCompressionStream:a,zipCrypto:s,signed:l,level:c}=e,d=this;let h,u,f=ze(super.readable);o&&!s||!l||(h=new B,f=Be(f,h)),r&&(f=Fe(f,a,{level:c,chunkSize:t},i,n)),o&&(s?f=Be(f,new ke(e)):(u=new ge(e),f=Be(f,u))),Oe(d,f,(()=>{let e;o&&!s&&(e=u.signature),o&&!s||!l||(e=new DataView(h.value.buffer).getUint32(0)),d.signature=e}))}}class Me extends TransformStream{constructor(e,{chunkSize:t,DecompressionStream:n,DecompressionStreamNative:i}){super({});const{zipCrypto:r,encrypted:o,signed:a,signature:s,compressed:l,useCompressionStream:c}=e;let d,h,u=ze(super.readable);o&&(r?u=Be(u,new ve(e)):(h=new fe(e),u=Be(u,h))),l&&(u=Fe(u,c,{chunkSize:t},i,n)),o&&!r||!a||(d=new B,u=Be(u,d)),Oe(this,u,(()=>{if((!o||r)&&a){const e=new DataView(d.value.buffer);if(s!=e.getUint32(0,!1))throw new Error(H)}}))}}function ze(e){return Be(e,new TransformStream({transform(e,t){e&&e.length&&t.enqueue(e)}}))}function Oe(e,t,n){t=Be(t,new TransformStream({flush:n})),Object.defineProperty(e,"readable",{get:()=>t})}function Fe(e,t,n,i,r){try{e=Be(e,new(t&&i?i:r)(Re,n))}catch(i){if(!t)throw i;e=Be(e,new r(Re,n))}return e}function Be(e,t){return e.pipeThrough(t)}const Ne="data",Pe="inflate";class Ue extends TransformStream{constructor(e,t){super({});const n=this,{codecType:i}=e;let r;i.startsWith("deflate")?r=Ie:i.startsWith(Pe)&&(r=Me);let o=0;const a=new r(e,t),s=super.readable,l=new TransformStream({transform(e,t){e&&e.length&&(o+=e.length,t.enqueue(e))},flush(){const{signature:e}=a;Object.assign(n,{signature:e,size:o})}});Object.defineProperty(n,"readable",{get:()=>s.pipeThrough(a).pipeThrough(l)})}}const De=typeof Worker!=L;class $e{constructor(e,{readable:t,writable:n},{options:i,config:r,streamOptions:o,useWebWorkers:a,transferStreams:s,scripts:l},c){const{signal:d}=o;return Object.assign(e,{busy:!0,readable:t.pipeThrough(new We(t,o,r),{signal:d}),writable:n,options:Object.assign({},i),scripts:l,transferStreams:s,terminate(){const{worker:t,busy:n}=e;t&&!n&&(t.terminate(),e.interface=null)},onTaskFinished(){e.busy=!1,c(e)}}),(a&&De?qe:He)(e,r)}}class We extends TransformStream{constructor(e,{onstart:t,onprogress:n,size:i,onend:r},{chunkSize:o}){let a=0;super({start(){t&&je(t,i)},async transform(e,t){a+=e.length,n&&await je(n,a,i),t.enqueue(e)},flush(){e.size=a,r&&je(r,a)}},{highWaterMark:1,size:()=>o})}}async function je(e,...t){try{await e(...t)}catch(e){}}function He(e,t){return{run:()=>async function({options:e,readable:t,writable:n,onTaskFinished:i},r){const o=new Ue(e,r);try{await t.pipeThrough(o).pipeTo(n,{preventClose:!0,preventAbort:!0});const{signature:e,size:i}=o;return{signature:e,size:i}}finally{i()}}(e,t)}}function qe(e,{baseURL:t,chunkSize:n}){return e.interface||Object.assign(e,{worker:Ge(e.scripts[0],t,e),interface:{run:()=>async function(e,t){let n,i;const r=new Promise(((e,t)=>{n=e,i=t}));Object.assign(e,{reader:null,writer:null,resolveResult:n,rejectResult:i,result:r});const{readable:o,options:a,scripts:s}=e,{writable:l,closed:c}=function(e){const t=e.getWriter();let n;const i=new Promise((e=>n=e)),r=new WritableStream({async write(e){await t.ready,await t.write(e)},close(){t.releaseLock(),n()},abort:e=>t.abort(e)});return{writable:r,closed:i}}(e.writable);Ke({type:"start",scripts:s.slice(1),options:a,config:t,readable:o,writable:l},e)||Object.assign(e,{reader:o.getReader(),writer:l.getWriter()});const d=await r;try{await l.getWriter().close()}catch(e){}return await c,d}(e,{chunkSize:n})}}),e.interface}let Ve=!0,Xe=!0;function Ge(e,t,n){const i={type:"module"};let r,o;typeof e==T&&(e=e());try{r=new URL(e,t)}catch(t){r=e}if(Ve)try{o=new Worker(r)}catch(e){Ve=!1,o=new Worker(r,i)}else o=new Worker(r,i);return o.addEventListener("message",(e=>async function({data:e},t){const{type:n,value:i,messageId:r,result:o,error:a}=e,{reader:s,writer:l,resolveResult:c,rejectResult:d,onTaskFinished:h}=t;try{if(a){const{message:e,stack:t,code:n,name:i}=a,r=new Error(e);Object.assign(r,{stack:t,code:n,name:i}),u(r)}else{if("pull"==n){const{value:e,done:n}=await s.read();Ke({type:Ne,value:e,done:n,messageId:r},t)}n==Ne&&(await l.ready,await l.write(new Uint8Array(i)),Ke({type:"ack",messageId:r},t)),"close"==n&&u(null,o)}}catch(a){u(a)}function u(e,t){e?d(e):c(t),l&&l.releaseLock(),h()}}(e,n))),o}function Ke(e,{worker:t,writer:n,onTaskFinished:i,transferStreams:r}){try{let{value:i,readable:o,writable:a}=e;const s=[];if(i&&(e.value=i.buffer,s.push(e.value)),r&&Xe?(o&&s.push(o),a&&s.push(a)):e.readable=e.writable=null,s.length)try{return t.postMessage(e,s),!0}catch(n){Xe=!1,e.readable=e.writable=null,t.postMessage(e)}else t.postMessage(e)}catch(e){throw n&&n.releaseLock(),i(),e}}let Je=[];const Ze=[];let Ye=0;function Qe(e){const{terminateTimeout:t}=e;t&&(clearTimeout(t),e.terminateTimeout=null)}const et=65536,tt="writable";class nt{constructor(){this.size=0}init(){this.initialized=!0}}class it extends nt{get readable(){const e=this,{chunkSize:t=et}=e,n=new ReadableStream({start(){this.chunkOffset=0},async pull(i){const{offset:r=0,size:o,diskNumberStart:a}=n,{chunkOffset:s}=this;i.enqueue(await ht(e,r+s,Math.min(t,o-s),a)),s+t>o?i.close():this.chunkOffset+=t}});return n}}class rt extends it{constructor(e){super(),Object.assign(this,{blob:e,size:e.size})}async readUint8Array(e,t){const n=this,i=e+t,r=e||i<n.size?n.blob.slice(e,i):n.blob;let o=await r.arrayBuffer();return o.byteLength>t&&(o=o.slice(e,i)),new Uint8Array(o)}}class ot extends nt{constructor(e){super();const t=new TransformStream,n=[];e&&n.push(["Content-Type",e]),Object.defineProperty(this,tt,{get:()=>t.writable}),this.blob=new Response(t.readable,{headers:n}).blob()}getData(){return this.blob}}class at extends ot{constructor(e){super(e),Object.assign(this,{encoding:e,utf8:!e||"utf-8"==e.toLowerCase()})}async getData(){const{encoding:e,utf8:t}=this,n=await super.getData();if(n.text&&t)return n.text();{const t=new FileReader;return new Promise(((i,r)=>{Object.assign(t,{onload:({target:e})=>i(e.result),onerror:()=>r(t.error)}),t.readAsText(n,e)}))}}}class st extends it{constructor(e){super(),this.readers=e}async init(){const e=this,{readers:t}=e;e.lastDiskNumber=0,e.lastDiskOffset=0,await Promise.all(t.map((async(n,i)=>{await n.init(),i!=t.length-1&&(e.lastDiskOffset+=n.size),e.size+=n.size}))),super.init()}async readUint8Array(e,t,n=0){const i=this,{readers:r}=this;let o,a=n;-1==a&&(a=r.length-1);let s=e;for(;s>=r[a].size;)s-=r[a].size,a++;const l=r[a],c=l.size;if(s+t<=c)o=await ht(l,s,t);else{const r=c-s;o=new Uint8Array(t),o.set(await ht(l,s,r)),o.set(await i.readUint8Array(e+r,t-r,n),r)}return i.lastDiskNumber=Math.max(a,i.lastDiskNumber),o}}class lt extends nt{constructor(e,t=4294967295){super();const n=this;let i,r,o;Object.assign(n,{diskNumber:0,diskOffset:0,size:0,maxSize:t,availableSize:t});const a=new WritableStream({async write(t){const{availableSize:a}=n;if(o)t.length>=a?(await s(t.slice(0,a)),await l(),n.diskOffset+=i.size,n.diskNumber++,o=null,await this.write(t.slice(a))):await s(t);else{const{value:a,done:s}=await e.next();if(s&&!a)throw new Error("Writer iterator completed too soon");i=a,i.size=0,i.maxSize&&(n.maxSize=i.maxSize),n.availableSize=n.maxSize,await ct(i),r=a.writable,o=r.getWriter(),await this.write(t)}},async close(){await o.ready,await l()}});async function s(e){const t=e.length;t&&(await o.ready,await o.write(e),i.size+=t,n.size+=t,n.availableSize-=t)}async function l(){r.size=i.size,await o.close()}Object.defineProperty(n,tt,{get:()=>a})}}async function ct(e,t){e.init&&!e.initialized&&await e.init(t)}function dt(e){return Array.isArray(e)&&(e=new st(e)),e instanceof ReadableStream&&(e={readable:e}),e}function ht(e,t,n,i){return e.readUint8Array(t,n,i)}const ut="\0☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■ ".split(""),ft=256==ut.length;function gt(e,t){return t&&"cp437"==t.trim().toLowerCase()?function(e){if(ft){let t="";for(let n=0;n<e.length;n++)t+=ut[e[n]];return t}return(new TextDecoder).decode(e)}(e):new TextDecoder(t).decode(e)}const pt="filename",mt="rawFilename",wt="comment",bt="rawComment",yt="uncompressedSize",xt="compressedSize",vt="offset",kt="diskNumberStart",St="lastModDate",_t="rawLastModDate",At="lastAccessDate",Lt="creationDate",Tt=[pt,mt,xt,yt,St,_t,wt,bt,At,Lt,vt,kt,kt,"internalFileAttribute","externalFileAttribute","msDosCompatible","zip64","directory","bitFlag","encrypted","signature","filenameUTF8","commentUTF8","compressionMethod","version","versionMadeBy","extraField","rawExtraField","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","extraFieldNTFS","extraFieldExtendedTimestamp"];class Et{constructor(e){Tt.forEach((t=>this[t]=e[t]))}}const Ct="File format is not recognized",Rt="Compression method not supported",It="Split zip file",Mt="utf-8",zt="cp437",Ot=[[yt,v],[xt,v],[vt,v],[kt,k]],Ft={[k]:{getValue:Vt,bytes:4},[v]:{getValue:Xt,bytes:8}};class Bt{constructor(e,t={}){Object.assign(this,{reader:dt(e),options:t,config:I})}async*getEntriesGenerator(e={}){const t=this;let{reader:n}=t;const{config:i}=t;if(await ct(n),n.size!==A&&n.readUint8Array||(n=new rt(await new Response(n.readable).blob()),await ct(n)),n.size<22)throw new Error(Ct);n.chunkSize=function(e){return Math.max(e.chunkSize,64)}(i);const r=await async function(e,t,n){const i=new Uint8Array(4);return function(e){e.setUint32(0,101010256,!0)}(Gt(i)),await r(22)||await r(Math.min(1048582,n));async function r(t){const r=n-t,o=await ht(e,r,t);for(let e=o.length-22;e>=0;e--)if(o[e]==i[0]&&o[e+1]==i[1]&&o[e+2]==i[2]&&o[e+3]==i[3])return{offset:r+e,buffer:o.slice(e,e+22).buffer}}}(n,0,n.size);if(!r)throw 134695760==Vt(Gt(await ht(n,0,4)))?new Error(It):new Error("End of central directory not found");const o=Gt(r);let a=Vt(o,12),s=Vt(o,16);const l=r.offset,c=qt(o,20),d=l+22+c;let h=qt(o,4);const u=n.lastDiskNumber||0;let f=qt(o,6),g=qt(o,8),p=0,m=0;if(s==v||a==v||g==k||f==k){const e=Gt(await ht(n,r.offset-20,20));if(117853008!=Vt(e,0))throw new Error("End of Zip64 central directory not found");s=Xt(e,8);let t=await ht(n,s,56,-1),i=Gt(t);const o=r.offset-20-56;if(Vt(i,0)!=_&&s!=o){const e=s;s=o,p=s-e,t=await ht(n,s,56,-1),i=Gt(t)}if(Vt(i,0)!=_)throw new Error("End of Zip64 central directory locator not found");h==k&&(h=Vt(i,16)),f==k&&(f=Vt(i,20)),g==k&&(g=Xt(i,32)),a==v&&(a=Xt(i,40)),s-=a}if(u!=h)throw new Error(It);if(s<0||s>=n.size)throw new Error(Ct);let w=0,b=await ht(n,s,a,f),y=Gt(b);if(a){const e=r.offset-a;if(Vt(y,w)!=S&&s!=e){const t=s;s=e,p=s-t,b=await ht(n,s,a,f),y=Gt(b)}}const x=r.offset-s-(n.lastDiskOffset||0);if(a!=x&&x>=0&&(a=x,b=await ht(n,s,a,f),y=Gt(b)),s<0||s>=n.size)throw new Error(Ct);const L=$t(t,e,"filenameEncoding"),T=$t(t,e,"commentEncoding");for(let r=0;r<g;r++){const o=new Nt(n,i,t.options);if(Vt(y,w)!=S)throw new Error("Central directory header not found");Pt(o,y,w+6);const a=Boolean(o.bitFlag.languageEncodingFlag),s=w+46,l=s+o.filenameLength,c=l+o.extraFieldLength,d=qt(y,w+4),h=!0,u=b.subarray(s,l),f=qt(y,w+32),x=c+f,v=b.subarray(c,x),k=a,_=a,A=h&&!(16&~Ht(y,w+38)),E=Vt(y,w+42)+p;Object.assign(o,{versionMadeBy:d,msDosCompatible:h,compressedSize:0,uncompressedSize:0,commentLength:f,directory:A,offset:E,diskNumberStart:qt(y,w+34),internalFileAttribute:qt(y,w+36),externalFileAttribute:Vt(y,w+38),rawFilename:u,filenameUTF8:k,commentUTF8:_,rawExtraField:b.subarray(l,c)});const[C,R]=await Promise.all([gt(u,k?Mt:L||zt),gt(v,_?Mt:T||zt)]);Object.assign(o,{rawComment:v,filename:C,comment:R,directory:A||C.endsWith("/")}),m=Math.max(E,m),await Ut(o,o,y,w+6);const I=new Et(o);I.getData=(e,t)=>o.getData(e,I,t),w=x;const{onprogress:M}=e;if(M)try{await M(r+1,g,new Et(o))}catch(e){}yield I}const E=$t(t,e,"extractPrependedData"),C=$t(t,e,"extractAppendedData");return E&&(t.prependedData=m>0?await ht(n,0,m):new Uint8Array),t.comment=c?await ht(n,l+22,c):new Uint8Array,C&&(t.appendedData=d<n.size?await ht(n,d,n.size-d):new Uint8Array),!0}async getEntries(e={}){const t=[];for await(const n of this.getEntriesGenerator(e))t.push(n);return t}async close(){}}class Nt{constructor(e,t,n){Object.assign(this,{reader:e,config:t,options:n})}async getData(e,t,n={}){const i=this,{reader:r,offset:o,diskNumberStart:a,extraFieldAES:s,compressionMethod:l,config:c,bitFlag:d,signature:h,rawLastModDate:u,uncompressedSize:f,compressedSize:g}=i,p=t.localDirectory={},m=Gt(await ht(r,o,30,a));let w=$t(i,n,"password");if(w=w&&w.length&&w,s&&99!=s.originalCompressionMethod)throw new Error(Rt);if(0!=l&&8!=l)throw new Error(Rt);if(67324752!=Vt(m,0))throw new Error("Local file header not found");Pt(p,m,4),p.rawExtraField=p.extraFieldLength?await ht(r,o+30+p.filenameLength,p.extraFieldLength,a):new Uint8Array,await Ut(i,p,m,4,!0),Object.assign(t,{lastAccessDate:p.lastAccessDate,creationDate:p.creationDate});const b=i.encrypted&&p.encrypted,y=b&&!s;if(b){if(!y&&s.strength===A)throw new Error("Encryption method not supported");if(!w)throw new Error("File contains encrypted entry")}const x=o+30+p.filenameLength+p.extraFieldLength,v=g,k=r.readable;Object.assign(k,{diskNumberStart:a,offset:x,size:v});const S=$t(i,n,"signal"),_=$t(i,n,"checkPasswordOnly");_&&(e=new WritableStream),e=function(e){e.writable===A&&typeof e.next==T&&(e=new lt(e)),e instanceof WritableStream&&(e={writable:e});const{writable:t}=e;return t.size===A&&(t.size=0),e instanceof lt||Object.assign(e,{diskNumber:0,diskOffset:0,availableSize:1/0,maxSize:1/0}),e}(e),await ct(e,f);const{writable:L}=e,{onstart:E,onprogress:C,onend:R}=n,I={options:{codecType:Pe,password:w,zipCrypto:y,encryptionStrength:s&&s.strength,signed:$t(i,n,"checkSignature"),passwordVerification:y&&(d.dataDescriptor?u>>>8&255:h>>>24&255),signature:h,compressed:0!=l,encrypted:b,useWebWorkers:$t(i,n,"useWebWorkers"),useCompressionStream:$t(i,n,"useCompressionStream"),transferStreams:$t(i,n,"transferStreams"),checkPasswordOnly:_},config:c,streamOptions:{signal:S,size:v,onstart:E,onprogress:C,onend:R}};let M=0;try{({outputSize:M}=await async function(e,t){const{options:n,config:i}=t,{transferStreams:r,useWebWorkers:o,useCompressionStream:a,codecType:s,compressed:l,signed:c,encrypted:d}=n,{workerScripts:h,maxWorkers:u,terminateWorkerTimeout:f}=i;t.transferStreams=r||r===A;const g=!(l||c||d||t.transferStreams);let p;t.useWebWorkers=!g&&(o||o===A&&i.useWebWorkers),t.scripts=t.useWebWorkers&&h?h[s]:[],n.useCompressionStream=a||a===A&&i.useCompressionStream;const m=Je.find((e=>!e.busy));if(m)Qe(m),p=new $e(m,e,t,w);else if(Je.length<u){const n={indexWorker:Ye};Ye++,Je.push(n),p=new $e(n,e,t,w)}else p=await new Promise((n=>Ze.push({resolve:n,stream:e,workerOptions:t})));return p.run();function w(e){if(Ze.length){const[{resolve:t,stream:n,workerOptions:i}]=Ze.splice(0,1);t(new $e(e,n,i,w))}else e.worker?(Qe(e),Number.isFinite(f)&&f>=0&&(e.terminateTimeout=setTimeout((()=>{Je=Je.filter((t=>t!=e)),e.terminate()}),f))):Je=Je.filter((t=>t!=e))}}({readable:k,writable:L},I))}catch(e){if(!_||e.message!=q)throw e}finally{const e=$t(i,n,"preventClose");L.size+=M,e||L.locked||await L.getWriter().close()}return _?void 0:e.getData?e.getData():L}}function Pt(e,t,n){const i=e.rawBitFlag=qt(t,n+2),r=!(1&~i),o=Vt(t,n+6);Object.assign(e,{encrypted:r,version:qt(t,n),bitFlag:{level:(6&i)>>1,dataDescriptor:!(8&~i),languageEncodingFlag:!(2048&~i)},rawLastModDate:o,lastModDate:Wt(o),filenameLength:qt(t,n+22),extraFieldLength:qt(t,n+24)})}async function Ut(e,t,n,i,r){const{rawExtraField:o}=t,a=t.extraField=new Map,s=Gt(new Uint8Array(o));let l=0;try{for(;l<o.length;){const e=qt(s,l),t=qt(s,l+2);a.set(e,{type:e,data:o.slice(l+4,l+4+t)}),l+=4+t}}catch(e){}const c=qt(n,i+4);Object.assign(t,{signature:Vt(n,i+10),uncompressedSize:Vt(n,i+18),compressedSize:Vt(n,i+14)});const d=a.get(1);d&&(function(e,t){t.zip64=!0;const n=Gt(e.data),i=Ot.filter((([e,n])=>t[e]==n));for(let r=0,o=0;r<i.length;r++){const[a,s]=i[r];if(t[a]==s){const i=Ft[s];t[a]=e[a]=i.getValue(n,o),o+=i.bytes}else if(e[a])throw new Error("Zip64 extra field not found")}}(d,t),t.extraFieldZip64=d);const h=a.get(28789);h&&(await Dt(h,pt,mt,t,e),t.extraFieldUnicodePath=h);const u=a.get(25461);u&&(await Dt(u,wt,bt,t,e),t.extraFieldUnicodeComment=u);const f=a.get(39169);f?(function(e,t,n){const i=Gt(e.data),r=Ht(i,4);Object.assign(e,{vendorVersion:Ht(i,0),vendorId:Ht(i,2),strength:r,originalCompressionMethod:n,compressionMethod:qt(i,5)}),t.compressionMethod=e.compressionMethod}(f,t,c),t.extraFieldAES=f):t.compressionMethod=c;const g=a.get(10);g&&(function(e,t){const n=Gt(e.data);let i,r=4;try{for(;r<e.data.length&&!i;){const t=qt(n,r),o=qt(n,r+2);1==t&&(i=e.data.slice(r+4,r+4+o)),r+=4+o}}catch(e){}try{if(i&&24==i.length){const n=Gt(i),r=n.getBigUint64(0,!0),o=n.getBigUint64(8,!0),a=n.getBigUint64(16,!0);Object.assign(e,{rawLastModDate:r,rawLastAccessDate:o,rawCreationDate:a});const s={lastModDate:jt(r),lastAccessDate:jt(o),creationDate:jt(a)};Object.assign(e,s),Object.assign(t,s)}}catch(e){}}(g,t),t.extraFieldNTFS=g);const p=a.get(21589);p&&(function(e,t,n){const i=Gt(e.data),r=Ht(i,0),o=[],a=[];n?(!(1&~r)&&(o.push(St),a.push(_t)),!(2&~r)&&(o.push(At),a.push("rawLastAccessDate")),!(4&~r)&&(o.push(Lt),a.push("rawCreationDate"))):e.data.length>=5&&(o.push(St),a.push(_t));let s=1;o.forEach(((n,r)=>{if(e.data.length>=s+4){const o=Vt(i,s);t[n]=e[n]=new Date(1e3*o);const l=a[r];e[l]=o}s+=4}))}(p,t,r),t.extraFieldExtendedTimestamp=p);const m=a.get(6534);m&&(t.extraFieldUSDZ=m)}async function Dt(e,t,n,i,r){const o=Gt(e.data),a=new F;a.append(r[n]);const s=Gt(new Uint8Array(4));s.setUint32(0,a.get(),!0);const l=Vt(o,1);Object.assign(e,{version:Ht(o,0),[t]:gt(e.data.subarray(5)),valid:!r.bitFlag.languageEncodingFlag&&l==Vt(s,0)}),e.valid&&(i[t]=e[t],i[t+"UTF8"]=!0)}function $t(e,t,n){return t[n]===A?e.options[n]:t[n]}function Wt(e){const t=(4294901760&e)>>16,n=65535&e;try{return new Date(1980+((65024&t)>>9),((480&t)>>5)-1,31&t,(63488&n)>>11,(2016&n)>>5,2*(31&n),0)}catch(e){}}function jt(e){return new Date(Number(e/BigInt(1e4)-BigInt(116444736e5)))}function Ht(e,t){return e.getUint8(t)}function qt(e,t){return e.getUint16(t,!0)}function Vt(e,t){return e.getUint32(t,!0)}function Xt(e,t){return Number(e.getBigUint64(t,!0))}function Gt(e){return new DataView(e.buffer)}M({Inflate:function(e){const t=new x,n=e&&e.chunkSize?Math.floor(2*e.chunkSize):131072,i=new Uint8Array(n);let r=!1;t.inflateInit(),t.next_out=i,this.append=function(e,a){const s=[];let l,c,d=0,h=0,u=0;if(0!==e.length){t.next_in_index=0,t.next_in=e,t.avail_in=e.length;do{if(t.next_out_index=0,t.avail_out=n,0!==t.avail_in||r||(t.next_in_index=0,r=!0),l=t.inflate(0),r&&l===o){if(0!==t.avail_in)throw new Error("inflating: bad input")}else if(0!==l&&1!==l)throw new Error("inflating: "+t.msg);if((r||1===l)&&t.avail_in===e.length)throw new Error("inflating: bad input");t.next_out_index&&(t.next_out_index===n?s.push(new Uint8Array(i)):s.push(i.subarray(0,t.next_out_index))),u+=t.next_out_index,a&&t.next_in_index>0&&t.next_in_index!=d&&(a(t.next_in_index),d=t.next_in_index)}while(t.avail_in>0||0===t.avail_out);return s.length>1?(c=new Uint8Array(u),s.forEach((function(e){c.set(e,h),h+=e.length}))):c=s[0]?new Uint8Array(s[0]):new Uint8Array,c}},this.flush=function(){t.inflateEnd()}}})},261:(e,t,n)=>{n.d(t,{F:()=>c});const i=e=>new Set(e?.getAttributeNS?.("http://www.idpf.org/2007/ops","type")?.split(" ")),r=e=>new Set(e?.getAttribute?.("role")?.split(" ")),o=e=>{const{verticalAlign:t}=getComputedStyle(e);return"super"===t||/^\d/.test(t)},a=["biblioref","glossref","noteref"],s=["doc-biblioref","doc-glossref","doc-noteref"],l="a, span, sup, sub, em, strong, i, b, small, big";class c extends EventTarget{detectFootnotes=!0;#p(e,{index:t,anchor:n},o){const a=document.createElement("foliate-view");return new Promise(((s,l)=>{a.addEventListener("load",(e=>{try{const{doc:t}=e.detail,l=n(t),c=(e=>{const t=i(e),n=r(e);return n.has("doc-biblioentry")||t.has("biblioentry")?"biblioentry":n.has("definition")||t.has("glossdef")?"definition":n.has("doc-endnote")||t.has("endnote")||t.has("rearnote")?"endnote":n.has("doc-footnote")||t.has("footnote")?"footnote":n.has("note")||t.has("note")?"note":null})(l),d=l?.matches?.("aside")&&"footnote"===c;if(l){const e=l.startContainer?l:t.createRange();l.startContainer||(l.matches("li, aside")?e.selectNodeContents(l):e.selectNode(l));const n=e.extractContents();t.body.replaceChildren(),t.body.appendChild(n)}const h={view:a,href:o,type:c,hidden:d,target:l};this.dispatchEvent(new CustomEvent("render",{detail:h})),s()}catch(e){l(e)}})),a.open(e).then((()=>this.dispatchEvent(new CustomEvent("before-render",{detail:{view:a}})))).then((()=>a.goTo(t))).catch(l)}))}handle(e,t){const{a:n,href:c}=t.detail,{yes:d,maybe:h}=(e=>{const t=i(e),n=r(e);return{yes:s.some((e=>n.has(e)))||a.some((e=>t.has(e))),maybe:()=>!t.has("backlink")&&!n.has("doc-backlink")&&(o(e)||1===e.children.length&&o(e.children[0])||o(e.parentElement))}})(n);return d?(t.preventDefault(),Promise.resolve(e.resolveHref(c)).then((t=>this.#p(e,t,c)))):this.detectFootnotes&&h()?(t.preventDefault(),Promise.resolve(e.resolveHref(c)).then((({index:t,anchor:n})=>{const i={index:t,anchor:e=>((e,t)=>{let n=t(e);const i=n;for(;n.matches(l);){const e=n.parentElement;if(!e)break;n=e}if(n===e.body){const e=i.nextElementSibling;if(e&&!e.matches(l))return e;throw new Error("Failed to extract footnote")}return n})(e,n)};return this.#p(e,i,c)}))):void 0}}},262:(e,t,n)=>{n.d(t,{searchMatcher:()=>o});const i=e=>e.replace(/\s+/g," "),r=(e,{startIndex:t,startOffset:n,endIndex:r,endOffset:o})=>{const a=e[t],s=e[r],l=a===s?a.slice(n,o):a.slice(n)+e.slice(a+1,s).join("")+s.slice(0,o),c=i(a.slice(0,n)).trimStart(),d=i(s.slice(o)).trimEnd(),h=c.length<50?"":"…",u=d.length<50?"":"…";return{pre:`${h}${c.slice(-50)}`,match:l,post:`${d.slice(0,50)}${u}`}},o=(e,t)=>{const{defalutLocale:n,matchCase:i,matchDiacritics:o,matchWholeWords:a}=t;return function*(t,s){const l=e(t,(function*(e,l){for(const c of((e,t,n)=>{const{granularity:i="grapheme",sensitivity:o="base"}=n;return Intl?.Segmenter&&("grapheme"!==i||"variant"!==o&&"accent"!==o)?function*(e,t,n={}){const{locales:i="en",granularity:o="word",sensitivity:a="base"}=n;let s,l;try{s=new Intl.Segmenter(i,{usage:"search",granularity:o}),l=new Intl.Collator(i,{sensitivity:a})}catch(e){console.warn(e),s=new Intl.Segmenter("en",{usage:"search",granularity:o}),l=new Intl.Collator("en",{sensitivity:a})}const c=Array.from(s.segment(t)).length,d=[];let h=0,u=s.segment(e[h])[Symbol.iterator]();e:for(;h<e.length;){for(;d.length<c;){const{done:t,value:n}=u.next();if(t){if(h++,h<e.length){u=s.segment(e[h])[Symbol.iterator]();continue}break e}const{index:i,segment:r}=n;/[^\p{Format}]/u.test(r)&&(/\s/u.test(r)?/\s/u.test(d[d.length-1]?.segment)||d.push({strIndex:h,index:i,segment:" "}):(n.strIndex=h,d.push(n)))}const n=d.map((e=>e.segment)).join("");if(0===l.compare(t,n)){const t=h,n=d[d.length-1],i=n.index+n.segment.length,o={startIndex:d[0].strIndex,startOffset:d[0].index,endIndex:t,endOffset:i};yield{range:o,excerpt:r(e,o)}}d.shift()}}(e,t,n):function*(e,t,n={}){const{locales:i="en",sensitivity:o}=n,a="variant"===o,s=e.join(""),l=a?s:s.toLocaleLowerCase(i),c=a?t:t.toLocaleLowerCase(i),d=c.length;let h=-1,u=-1,f=0;do{if(h=l.indexOf(c,h+1),h>-1){for(;f<=h;)f+=e[++u].length;const t=u,n=h-(f-e[u].length),i=h+d;for(;f<=i;)f+=e[++u].length;const o={startIndex:t,startOffset:n,endIndex:u,endOffset:i-(f-e[u].length)};yield{range:o,excerpt:r(e,o)}}}while(h>-1)}(e,t,n)})(e,s,{locales:t.body.lang||t.documentElement.lang||n||"en",granularity:a?"word":"grapheme",sensitivity:o&&i?"variant":o&&!i?"accent":!o&&i?"case":"base"})){const{startIndex:e,startOffset:t,endIndex:n,endOffset:i}=c.range;c.range=l(e,t,n,i),yield c}}));for(const e of l)yield e}}},339:(e,t,n)=>{n.d(t,{u:()=>r});const i=e=>document.createElementNS("http://www.w3.org/2000/svg",e);class r{#m=i("svg");#w=new Map;constructor(){Object.assign(this.#m.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none"})}get element(){return this.#m}add(e,t,n,i){this.#w.has(e)&&this.remove(e),"function"==typeof t&&(t=t(this.#m.getRootNode()));const r=t.getClientRects(),o=n(r,i);this.#m.append(o),this.#w.set(e,{range:t,draw:n,options:i,element:o,rects:r})}remove(e){this.#w.has(e)&&(this.#m.removeChild(this.#w.get(e).element),this.#w.delete(e))}redraw(){for(const e of this.#w.values()){const{range:t,draw:n,options:i,element:r}=e;this.#m.removeChild(r);const o=t.getClientRects(),a=n(o,i);this.#m.append(a),e.element=a,e.rects=o}}hitTest({x:e,y:t}){const n=Array.from(this.#w.entries());for(let i=n.length-1;i>=0;i--){const[r,o]=n[i];for(const{left:n,top:i,right:a,bottom:s}of o.rects)if(i<=t&&n<=e&&s>t&&a>e)return[r,o.range]}return[]}static underline(e,t={}){const{color:n="red",width:r=2,writingMode:o}=t,a=i("g");if(a.setAttribute("fill",n),"vertical-rl"===o||"vertical-lr"===o)for(const{right:t,top:n,height:o}of e){const e=i("rect");e.setAttribute("x",t-r),e.setAttribute("y",n),e.setAttribute("height",o),e.setAttribute("width",r),a.append(e)}else for(const{left:t,bottom:n,width:o}of e){const e=i("rect");e.setAttribute("x",t),e.setAttribute("y",n-r),e.setAttribute("height",r),e.setAttribute("width",o),a.append(e)}return a}static strikethrough(e,t={}){const{color:n="red",width:r=2,writingMode:o}=t,a=i("g");if(a.setAttribute("fill",n),"vertical-rl"===o||"vertical-lr"===o)for(const{right:t,left:n,top:o,height:s}of e){const e=i("rect");e.setAttribute("x",(t+n)/2),e.setAttribute("y",o),e.setAttribute("height",s),e.setAttribute("width",r),a.append(e)}else for(const{left:t,top:n,bottom:o,width:s}of e){const e=i("rect");e.setAttribute("x",t),e.setAttribute("y",(n+o)/2),e.setAttribute("height",r),e.setAttribute("width",s),a.append(e)}return a}static squiggly(e,t={}){const{color:n="red",width:r=2,writingMode:o}=t,a=i("g");a.setAttribute("fill","none"),a.setAttribute("stroke",n),a.setAttribute("stroke-width",r);const s=1.5*r;if("vertical-rl"===o||"vertical-lr"===o)for(const{right:t,top:n,height:r}of e){const e=i("path"),o=Math.round(r/s/1.5),l=r/o,c=Array.from({length:o},((e,t)=>`l${t%2?-s:s} ${l}`)).join("");e.setAttribute("d",`M${t} ${n}${c}`),a.append(e)}else for(const{left:t,bottom:n,width:r}of e){const e=i("path"),o=Math.round(r/s/1.5),l=r/o,c=Array.from({length:o},((e,t)=>`l${l} ${t%2?s:-s}`)).join("");e.setAttribute("d",`M${t} ${n}${c}`),a.append(e)}return a}static highlight(e,t={}){const{color:n="red"}=t,r=i("g");r.setAttribute("fill",n),r.style.opacity="var(--overlayer-highlight-opacity, .3)",r.style.mixBlendMode="var(--overlayer-highlight-blend-mode, normal)";for(const{left:t,top:n,height:o,width:a}of e){const e=i("rect");e.setAttribute("x",t),e.setAttribute("y",n),e.setAttribute("height",o),e.setAttribute("width",a),r.append(e)}return r}static outline(e,t={}){const{color:n="red",width:r=3,radius:o=3}=t,a=i("g");a.setAttribute("fill","none"),a.setAttribute("stroke",n),a.setAttribute("stroke-width",r);for(const{left:t,top:n,height:r,width:s}of e){const e=i("rect");e.setAttribute("x",t),e.setAttribute("y",n),e.setAttribute("height",r),e.setAttribute("width",s),e.setAttribute("rx",o),a.append(e)}return a}static copyImage([e],t={}){const{src:n}=t,r=i("image"),{left:o,top:a,height:s,width:l}=e;return r.setAttribute("href",n),r.setAttribute("x",o),r.setAttribute("y",a),r.setAttribute("height",s),r.setAttribute("width",l),r}}},354:(e,t,n)=>{n.d(t,{makePDF:()=>o});const i=async(e,t)=>{const n=e.getViewport({scale:1}),i=n.width/n.height,r=innerWidth/innerHeight,o=devicePixelRatio*(r/i),a=e.getViewport({scale:o}),s=document.createElement("canvas");s.height=a.height,s.width=a.width;const l=s.getContext("2d");await e.render({canvasContext:l,viewport:a}).promise;const c=await new Promise((e=>s.toBlob(e)));if(t)return c;const d=document.createElement("div");d.classList.add("textLayer"),await pdfjsLib.renderTextLayer({textContentSource:await e.getTextContent(),container:d,viewport:a}).promise;const h=document.createElement("div");h.classList.add("annotationLayer"),await new pdfjsLib.AnnotationLayer({page:e,viewport:a,div:h}).render({annotations:await e.getAnnotations(),linkService:{getDestinationHash:e=>JSON.stringify(e),addLinkAttributes:(e,t)=>e.href=t}});const u=URL.createObjectURL(c);return URL.createObjectURL(new Blob([`\n        <!DOCTYPE html>\n        <meta charset="utf-8">\n        <style>\n        :root {\n            --scale-factor: ${o};\n        }\n        html, body {\n            margin: 0;\n            padding: 0;\n        }\n        \n/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n:root {\n  --highlight-bg-color: rgb(180 0 170);\n  --highlight-selected-bg-color: rgb(0 100 0);\n}\n\n@media screen and (forced-colors: active) {\n  :root {\n    --highlight-bg-color: Highlight;\n    --highlight-selected-bg-color: ButtonText;\n  }\n}\n\n.textLayer {\n  position: absolute;\n  text-align: initial;\n  inset: 0;\n  overflow: hidden;\n  opacity: 0.25;\n  line-height: 1;\n  text-size-adjust: none;\n  forced-color-adjust: none;\n  transform-origin: 0 0;\n  z-index: 2;\n}\n\n.textLayer :is(span, br) {\n  color: transparent;\n  position: absolute;\n  white-space: pre;\n  cursor: text;\n  transform-origin: 0% 0%;\n}\n\n/* Only necessary in Google Chrome, see issue 14205, and most unfortunately\n * the problem doesn't show up in "text" reference tests. */\n/*#if !MOZCENTRAL*/\n.textLayer span.markedContent {\n  top: 0;\n  height: 0;\n}\n/*#endif*/\n\n.textLayer .highlight {\n  margin: -1px;\n  padding: 1px;\n  background-color: var(--highlight-bg-color);\n  border-radius: 4px;\n}\n\n.textLayer .highlight.appended {\n  position: initial;\n}\n\n.textLayer .highlight.begin {\n  border-radius: 4px 0 0 4px;\n}\n\n.textLayer .highlight.end {\n  border-radius: 0 4px 4px 0;\n}\n\n.textLayer .highlight.middle {\n  border-radius: 0;\n}\n\n.textLayer .highlight.selected {\n  background-color: var(--highlight-selected-bg-color);\n}\n\n.textLayer ::selection {\n  /*#if !MOZCENTRAL*/\n  background: blue;\n  /*#endif*/\n  background: AccentColor; /* stylelint-disable-line declaration-block-no-duplicate-properties */\n}\n\n/* Avoids https://github.com/mozilla/pdf.js/issues/13840 in Chrome */\n/*#if !MOZCENTRAL*/\n.textLayer br::selection {\n  background: transparent;\n}\n/*#endif*/\n\n.textLayer .endOfContent {\n  display: block;\n  position: absolute;\n  inset: 100% 0 0;\n  z-index: -1;\n  cursor: default;\n  user-select: none;\n}\n\n.textLayer .endOfContent.active {\n  top: 0;\n}\n\n        \n/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n:root {\n  --annotation-unfocused-field-background: url("data:image/svg+xml;charset=UTF-8,<svg width='1px' height='1px' xmlns='http://www.w3.org/2000/svg'><rect width='100%' height='100%' style='fill:rgba(0, 54, 255, 0.13);'/></svg>");\n  --input-focus-border-color: Highlight;\n  --input-focus-outline: 1px solid Canvas;\n  --input-unfocused-border-color: transparent;\n  --input-disabled-border-color: transparent;\n  --input-hover-border-color: black;\n  --link-outline: none;\n}\n\n@media screen and (forced-colors: active) {\n  :root {\n    --input-focus-border-color: CanvasText;\n    --input-unfocused-border-color: ActiveText;\n    --input-disabled-border-color: GrayText;\n    --input-hover-border-color: Highlight;\n    --link-outline: 1.5px solid LinkText;\n    --hcm-highligh-filter: invert(100%);\n  }\n  .annotationLayer .textWidgetAnnotation :is(input, textarea):required,\n  .annotationLayer .choiceWidgetAnnotation select:required,\n  .annotationLayer\n    .buttonWidgetAnnotation:is(.checkBox, .radioButton)\n    input:required {\n    outline: 1.5px solid selectedItem;\n  }\n\n  .annotationLayer .linkAnnotation:hover {\n    backdrop-filter: var(--hcm-highligh-filter);\n  }\n\n  .annotationLayer .linkAnnotation > a:hover {\n    opacity: 0 !important;\n    background: none !important;\n    box-shadow: none;\n  }\n\n  .annotationLayer .popupAnnotation .popup {\n    outline: calc(1.5px * var(--scale-factor)) solid CanvasText !important;\n    background-color: ButtonFace !important;\n    color: ButtonText !important;\n  }\n\n  .annotationLayer .highlightArea:hover::after {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    backdrop-filter: var(--hcm-highligh-filter);\n    content: "";\n    pointer-events: none;\n  }\n\n  .annotationLayer .popupAnnotation.focused .popup {\n    outline: calc(3px * var(--scale-factor)) solid Highlight !important;\n  }\n}\n\n.annotationLayer {\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  transform-origin: 0 0;\n  z-index: 3;\n}\n\n.annotationLayer[data-main-rotation="90"] .norotate {\n  transform: rotate(270deg) translateX(-100%);\n}\n.annotationLayer[data-main-rotation="180"] .norotate {\n  transform: rotate(180deg) translate(-100%, -100%);\n}\n.annotationLayer[data-main-rotation="270"] .norotate {\n  transform: rotate(90deg) translateY(-100%);\n}\n\n.annotationLayer canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n}\n\n.annotationLayer section {\n  position: absolute;\n  text-align: initial;\n  pointer-events: auto;\n  box-sizing: border-box;\n  transform-origin: 0 0;\n}\n\n.annotationLayer .linkAnnotation {\n  outline: var(--link-outline);\n}\n\n.annotationLayer :is(.linkAnnotation, .buttonWidgetAnnotation.pushButton) > a {\n  position: absolute;\n  font-size: 1em;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n\n.annotationLayer\n  :is(.linkAnnotation, .buttonWidgetAnnotation.pushButton):not(.hasBorder)\n  > a:hover {\n  opacity: 0.2;\n  background-color: rgb(255 255 0);\n  box-shadow: 0 2px 10px rgb(255 255 0);\n}\n\n.annotationLayer .linkAnnotation.hasBorder:hover {\n  background-color: rgb(255 255 0 / 0.2);\n}\n\n.annotationLayer .hasBorder {\n  background-size: 100% 100%;\n}\n\n.annotationLayer .textAnnotation img {\n  position: absolute;\n  cursor: pointer;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea),\n.annotationLayer .choiceWidgetAnnotation select,\n.annotationLayer .buttonWidgetAnnotation:is(.checkBox, .radioButton) input {\n  background-image: var(--annotation-unfocused-field-background);\n  border: 2px solid var(--input-unfocused-border-color);\n  box-sizing: border-box;\n  font: calc(9px * var(--scale-factor)) sans-serif;\n  height: 100%;\n  margin: 0;\n  vertical-align: top;\n  width: 100%;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea):required,\n.annotationLayer .choiceWidgetAnnotation select:required,\n.annotationLayer\n  .buttonWidgetAnnotation:is(.checkBox, .radioButton)\n  input:required {\n  outline: 1.5px solid red;\n}\n\n.annotationLayer .choiceWidgetAnnotation select option {\n  padding: 0;\n}\n\n.annotationLayer .buttonWidgetAnnotation.radioButton input {\n  border-radius: 50%;\n}\n\n.annotationLayer .textWidgetAnnotation textarea {\n  resize: none;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea)[disabled],\n.annotationLayer .choiceWidgetAnnotation select[disabled],\n.annotationLayer\n  .buttonWidgetAnnotation:is(.checkBox, .radioButton)\n  input[disabled] {\n  background: none;\n  border: 2px solid var(--input-disabled-border-color);\n  cursor: not-allowed;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea):hover,\n.annotationLayer .choiceWidgetAnnotation select:hover,\n.annotationLayer\n  .buttonWidgetAnnotation:is(.checkBox, .radioButton)\n  input:hover {\n  border: 2px solid var(--input-hover-border-color);\n}\n.annotationLayer .textWidgetAnnotation :is(input, textarea):hover,\n.annotationLayer .choiceWidgetAnnotation select:hover,\n.annotationLayer .buttonWidgetAnnotation.checkBox input:hover {\n  border-radius: 2px;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea):focus,\n.annotationLayer .choiceWidgetAnnotation select:focus {\n  background: none;\n  border: 2px solid var(--input-focus-border-color);\n  border-radius: 2px;\n  outline: var(--input-focus-outline);\n}\n\n.annotationLayer .buttonWidgetAnnotation:is(.checkBox, .radioButton) :focus {\n  background-image: none;\n  background-color: transparent;\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox :focus {\n  border: 2px solid var(--input-focus-border-color);\n  border-radius: 2px;\n  outline: var(--input-focus-outline);\n}\n\n.annotationLayer .buttonWidgetAnnotation.radioButton :focus {\n  border: 2px solid var(--input-focus-border-color);\n  outline: var(--input-focus-outline);\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::before,\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::after,\n.annotationLayer .buttonWidgetAnnotation.radioButton input:checked::before {\n  background-color: CanvasText;\n  content: "";\n  display: block;\n  position: absolute;\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::before,\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::after {\n  height: 80%;\n  left: 45%;\n  width: 1px;\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::before {\n  transform: rotate(45deg);\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::after {\n  transform: rotate(-45deg);\n}\n\n.annotationLayer .buttonWidgetAnnotation.radioButton input:checked::before {\n  border-radius: 50%;\n  height: 50%;\n  left: 30%;\n  top: 20%;\n  width: 50%;\n}\n\n.annotationLayer .textWidgetAnnotation input.comb {\n  font-family: monospace;\n  padding-left: 2px;\n  padding-right: 0;\n}\n\n.annotationLayer .textWidgetAnnotation input.comb:focus {\n  /*\n   * Letter spacing is placed on the right side of each character. Hence, the\n   * letter spacing of the last character may be placed outside the visible\n   * area, causing horizontal scrolling. We avoid this by extending the width\n   * when the element has focus and revert this when it loses focus.\n   */\n  width: 103%;\n}\n\n.annotationLayer .buttonWidgetAnnotation:is(.checkBox, .radioButton) input {\n  appearance: none;\n}\n\n.annotationLayer .fileAttachmentAnnotation .popupTriggerArea {\n  height: 100%;\n  width: 100%;\n}\n\n.annotationLayer .popupAnnotation {\n  position: absolute;\n  font-size: calc(9px * var(--scale-factor));\n  pointer-events: none;\n  width: max-content;\n  max-width: 45%;\n  height: auto;\n}\n\n.annotationLayer .popup {\n  background-color: rgb(255 255 153);\n  box-shadow: 0 calc(2px * var(--scale-factor)) calc(5px * var(--scale-factor))\n    rgb(136 136 136);\n  border-radius: calc(2px * var(--scale-factor));\n  outline: 1.5px solid rgb(255 255 74);\n  padding: calc(6px * var(--scale-factor));\n  cursor: pointer;\n  font: message-box;\n  white-space: normal;\n  word-wrap: break-word;\n  pointer-events: auto;\n}\n\n.annotationLayer .popupAnnotation.focused .popup {\n  outline-width: 3px;\n}\n\n.annotationLayer .popup * {\n  font-size: calc(9px * var(--scale-factor));\n}\n\n.annotationLayer .popup > .header {\n  display: inline-block;\n}\n\n.annotationLayer .popup > .header h1 {\n  display: inline;\n}\n\n.annotationLayer .popup > .header .popupDate {\n  display: inline-block;\n  margin-left: calc(5px * var(--scale-factor));\n  width: fit-content;\n}\n\n.annotationLayer .popupContent {\n  border-top: 1px solid rgb(51 51 51);\n  margin-top: calc(2px * var(--scale-factor));\n  padding-top: calc(2px * var(--scale-factor));\n}\n\n.annotationLayer .richText > * {\n  white-space: pre-wrap;\n  font-size: calc(9px * var(--scale-factor));\n}\n\n.annotationLayer .popupTriggerArea {\n  cursor: pointer;\n}\n\n.annotationLayer section svg {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n}\n\n.annotationLayer .annotationTextContent {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  color: transparent;\n  user-select: none;\n  pointer-events: none;\n}\n\n.annotationLayer .annotationTextContent span {\n  width: 100%;\n  display: inline-block;\n}\n\n.annotationLayer svg.quadrilateralsContainer {\n  contain: strict;\n  width: 0;\n  height: 0;\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: -1;\n}\n\n        </style>\n        <img src="${u}">\n        ${d.outerHTML}\n        ${h.outerHTML}\n    `],{type:"text/html"}))},r=e=>({label:e.title,href:JSON.stringify(e.dest),subitems:e.items.length?e.items.map(r):null}),o=async e=>{const t=new Uint8Array(await e.arrayBuffer()),n=await pdfjsLib.getDocument({data:t}).promise,o={rendition:{layout:"pre-paginated"}},a=(await n.getMetadata())?.info;o.metadata={title:a?.Title,author:a?.Author};const s=await n.getOutline();o.toc=s?.map(r);const l=new Map;return o.sections=Array.from({length:n.numPages}).map(((e,t)=>({id:t,load:async()=>{const e=l.get(t);if(e)return e;const r=await i(await n.getPage(t+1));return l.set(t,r),r},size:1e3}))),o.sections[0].pageSpread="right",o.isExternal=e=>/^\w+:/i.test(e),o.resolveHref=async e=>{const t=JSON.parse(e),i="string"==typeof t?await n.getDestination(t):t;return{index:await n.getPageIndex(i[0])}},o.splitTOCHref=async e=>{const t=JSON.parse(e),i="string"==typeof t?await n.getDestination(t):t;return[await n.getPageIndex(i[0]),null]},o.getTOCFragment=e=>e.documentElement,o.getCover=async()=>i(await n.getPage(1),!0),o}},406:(e,t,n)=>{n.d(t,{makeFB2:()=>m});const i=e=>e?e.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"",r=e=>i(e?.textContent),o={XLINK:"http://www.w3.org/1999/xlink",EPUB:"http://www.idpf.org/2007/ops"},a="application/xml",s="application/xhtml+xml",l={strong:["strong","self"],emphasis:["em","self"],style:["span","self"],a:"anchor",strikethrough:["s","self"],sub:["sub","self"],sup:["sup","self"],code:["code","self"],image:"image"},c={epigraph:["blockquote"],subtitle:["h2",l],"text-author":["p",l],date:["p",l],stanza:"stanza"},d={title:["header",{p:["h1",l],"empty-line":["br"]}],epigraph:["blockquote","self"],image:"image",annotation:["aside"],section:["section","self"],p:["p",l],poem:["blockquote",c],subtitle:["h2",l],cite:["blockquote","self"],"empty-line":["br"],table:["table",{tr:["tr",["align"]],th:["th",["colspan","rowspan","align","valign"]],td:["td",["colspan","rowspan","align","valign"]]}],"text-author":["p",l]};c.epigraph.push(d);const h={image:"image",title:["section",{p:["h1",l],"empty-line":["br"]}],epigraph:["section",d],section:["section",d]},u=e=>{const t=e.getAttributeNS(o.XLINK,"href"),[,n]=t.split("#"),i=e.getRootNode().getElementById(n);return i?`data:${i.getAttribute("content-type")};base64,${i.textContent}`:t};class f{constructor(e){this.fb2=e,this.doc=document.implementation.createDocument(o.XHTML,"html")}image(e){const t=this.doc.createElement("img");return t.alt=e.getAttribute("alt"),t.title=e.getAttribute("title"),t.setAttribute("src",u(e)),t}anchor(e){const t=this.convert(e,{a:["a",l]});return t.setAttribute("href",e.getAttributeNS(o.XLINK,"href")),"note"===e.getAttribute("type")&&t.setAttributeNS(o.EPUB,"epub:type","noteref"),t}stanza(e){const t=this.convert(e,{stanza:["p",{title:["header",{p:["strong",l],"empty-line":["br"]}],subtitle:["p",l]}]});for(const n of e.children)"v"===n.nodeName&&(t.append(this.doc.createTextNode(n.textContent)),t.append(this.doc.createElement("br")));return t}convert(e,t){if(3===e.nodeType)return this.doc.createTextNode(e.textContent);if(4===e.nodeType)return this.doc.createCDATASection(e.textContent);if(8===e.nodeType)return this.doc.createComment(e.textContent);const n=t?.[e.nodeName];if(!n)return null;if("string"==typeof n)return this[n](e);const[i,r]=n,o=this.doc.createElement(i);if(e.id&&(o.id=e.id),o.classList.add(e.nodeName),Array.isArray(r))for(const t of r)o.setAttribute(t,e.getAttribute(t));const a="self"===r?t:Array.isArray(r)?null:r;let s=e.firstChild;for(;s;){const e=this.convert(s,a);e&&o.append(e),s=s.nextSibling}return o}}const g=URL.createObjectURL(new Blob(['\n@namespace epub "http://www.idpf.org/2007/ops";\nbody > img, section > img {\n    display: block;\n    margin: auto;\n}\n.title h1 {\n    text-align: center;\n}\nbody > section > .title, body.notesBodyType > .title {\n    margin: 3em 0;\n}\nbody.notesBodyType > section .title h1 {\n    text-align: start;\n}\nbody.notesBodyType > section .title {\n    margin: 1em 0;\n}\np {\n    text-indent: 1em;\n    margin: 0;\n}\n:not(p) + p, p:first-child {\n    text-indent: 0;\n}\n.poem p {\n    text-indent: 0;\n    margin: 1em 0;\n}\n.text-author, .date {\n    text-align: end;\n}\n.text-author:before {\n    content: "—";\n}\ntable {\n    border-collapse: collapse;\n}\ntd, th {\n    padding: .25em;\n}\na[epub|type~="noteref"] {\n    font-size: .75em;\n    vertical-align: super;\n}\nbody:not(.notesBodyType) > .title, body:not(.notesBodyType) > .epigraph {\n    margin: 3em 0;\n}\n'],{type:"text/css"})),p="data-foliate-id",m=async e=>{const t={},n=await(async e=>{const t=await e.arrayBuffer(),n=new TextDecoder("utf-8").decode(t),i=new DOMParser,r=i.parseFromString(n,a),o=r.xmlEncoding||n.match(/^<\?xml\s+version\s*=\s*["']1.\d+"\s+encoding\s*=\s*["']([A-Za-z0-9._-]*)["']/)?.[1];if(o&&"utf-8"!==o.toLowerCase()){const e=new TextDecoder(o).decode(t);return i.parseFromString(e,a)}return r})(e),o=new f(n),l=e=>n.querySelector(e),c=e=>[...n.querySelectorAll(e)],m=e=>{const t=r(e.querySelector("nickname"));if(t)return t;const n=r(e.querySelector("first-name")),i=r(e.querySelector("middle-name")),o=r(e.querySelector("last-name"));return{name:[n,i,o].filter((e=>e)).join(" "),sortAs:o?[o,[n,i].filter((e=>e)).join(" ")].join(", "):null}},w=e=>e?.getAttribute("value")??r(e),b=l("title-info annotation");if(t.metadata={title:r(l("title-info book-title")),identifier:r(l("document-info id")),language:r(l("title-info lang")),author:c("title-info author").map(m),translator:c("title-info translator").map(m),producer:c("document-info author").map(m).concat(c("document-info program-used").map(r)),publisher:r(l("publish-info publisher")),published:w(l("title-info date")),modified:w(l("document-info date")),description:b?o.convert(b,{annotation:["div",d]}).innerHTML:null,subject:c("title-info genre").map(r)},l("coverpage image")){const e=u(l("coverpage image"));t.getCover=()=>fetch(e).then((e=>e.blob()))}else t.getCover=()=>null;const y=Array.from(n.querySelectorAll("body"),(e=>{const t=o.convert(e,{body:["body",h]});return[Array.from(t.children,(e=>{const t=[e,...e.querySelectorAll("[id]")].map((e=>e.id));return{el:e,ids:t}})),t]})),x=[],v=y[0][0].map((({el:e,ids:t})=>({ids:t,titles:Array.from(e.querySelectorAll(":scope > section > .title"),((e,t)=>(e.setAttribute(p,t),{title:r(e),index:t}))),el:e}))).concat(y.slice(1).map((([e,t])=>{const n=e.map((e=>e.ids)).flat();return t.classList.add("notesBodyType"),{ids:n,el:t,linear:"no"}}))).map((({ids:e,titles:t,el:n,linear:r})=>{const o=(a=n.outerHTML,`<?xml version="1.0" encoding="utf-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml">\n    <head><link href="${g}" rel="stylesheet" type="text/css"/></head>\n    <body>${a}</body>\n</html>`);var a;const l=new Blob([o],{type:s}),c=URL.createObjectURL(l);return x.push(c),{ids:e,title:i(n.querySelector(".title, .subtitle, p")?.textContent??(n.classList.contains("title")?n.textContent:"")),titles:t,load:()=>c,createDocument:()=>(new DOMParser).parseFromString(o,s),size:l.size-Array.from(n.querySelectorAll("[src]"),(e=>e.getAttribute("src")?.length??0)).reduce(((e,t)=>e+t),0),linear:r}})),k=new Map;return t.sections=v.map(((e,t)=>{const{ids:n,load:i,createDocument:r,size:o,linear:a}=e;for(const e of n)e&&k.set(e,t);return{id:t,load:i,createDocument:r,size:o,linear:a}})),t.toc=v.map((({title:e,titles:t},n)=>{const i=n.toString();return{label:e,href:i,subitems:t?.length?t.map((({title:e,index:t})=>({label:e,href:`${i}#${t}`}))):null}})).filter((e=>e)),t.resolveHref=e=>{const[t,n]=e.split("#");return t?{index:Number(t),anchor:e=>e.querySelector(`[${p}="${n}"]`)}:{index:k.get(n),anchor:e=>e.getElementById(n)}},t.splitTOCHref=e=>e?.split("#")?.map((e=>Number(e)))??[],t.getTOCFragment=(e,t)=>e.querySelector(`[${p}="${t}"]`),t.destroy=()=>{for(const e of x)URL.revokeObjectURL(e)},t}},467:(e,t,n)=>{n.d(t,{makeComicBook:()=>i});const i=({entries:e,loadBlob:t,getSize:n},i)=>{const r=new Map,o=new Map,a=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg",".jxl",".avif"],s=e.map((e=>e.filename)).filter((e=>a.some((t=>e.endsWith(t))))).sort();if(!s.length)throw new Error("No supported image files in archive");const l={getCover:()=>t(s[0])};return l.metadata={title:i.name},l.sections=s.map((e=>({id:e,load:()=>(async e=>{if(r.has(e))return r.get(e);const n=URL.createObjectURL(await t(e)),i=URL.createObjectURL(new Blob([`<img src="${n}">`],{type:"text/html"}));return o.set(e,[n,i]),r.set(e,i),i})(e),unload:()=>(e=>{o.get(e)?.forEach?.((e=>URL.revokeObjectURL(e))),o.delete(e),r.delete(e)})(e),size:n(e)}))),l.toc=s.map((e=>({label:e,href:e}))),l.rendition={layout:"pre-paginated"},l.resolveHref=e=>({index:l.sections.findIndex((t=>t.id===e))}),l.splitTOCHref=e=>[e,null],l.getTOCFragment=e=>e.documentElement,l.destroy=()=>{for(const e of o.values())for(const t of e)URL.revokeObjectURL(t)},l}},531:(e,t,n)=>{n.a(e,(async(e,t)=>{try{var i=n(619),r=n(261),o=n(339),a=e([i]);i=(a.then?(await a)():a)[0],console.log("book.js"),console.log("AnxUA",navigator.userAgent);const{configure:g,ZipReader:p,BlobReader:m,TextWriter:w,BlobWriter:b}=await Promise.resolve().then(n.bind(n,260)),{EPUB:y}=await Promise.resolve().then(n.bind(n,800));var s=!1;const x=e=>{const t=e=>{const{x:t,y:n}=e;return t>=0&&n>=0&&t<=window.innerWidth&&n<=window.innerHeight},n=(e,t,n=1,i=1)=>({left:n*t.left+e.left,right:n*t.right+e.left,top:i*t.top+e.top,bottom:i*t.bottom+e.top}),i=e.getRootNode?.()??e?.endContainer?.getRootNode?.(),r=i?.defaultView?.frameElement;let o=1,a=1;if(r){const e=getComputedStyle(r).transform.match(/matrix\((.+)\)/);e&&([o,,,a]=e[1].split(/\s*,\s*/).map(Number))}const s=r?.getBoundingClientRect()??{top:0,left:0},l=Array.from(e.getClientRects()),c=n(s,l[0],o,a),d=n(s,l[l.length-1],o,a),h=window.innerWidth,u=window.innerHeight,f={point:{x:(c.left+c.right)/2/h,y:c.top/u},dir:"up"},g={point:{x:(d.left+d.right)/2/h,y:d.bottom/u},dir:"down"},p=t(f.point),m=t(g.point);return p||m?p?m?f.point.y*u>u-g.point.y*u?f:g:f:g:{point:{x:0,y:0}}},v=e=>{if(!e?.rangeCount)return null;const t=e.getRangeAt(0);return t.collapsed?null:t},k=(e,t,n)=>{const i=t.getSelection(),r=v(i);if(!r)return;const o=x(r),a=e.getCFI(n,r);let s=i.toString();if(!s){const e=r.startContainer.ownerDocument.getSelection();e.removeAllRanges(),e.addRange(r),s=e.toString()}K({index:n,range:r,lang:"en-US",cfi:a,pos:o,text:s})},S=(e,t,n)=>{navigator.platform.includes("Win")||navigator.platform.includes("Mac")||navigator.platform.includes("iPhone")||navigator.platform.includes("iPad")?t.addEventListener("pointerup",(()=>k(e,t,n))):t.addEventListener("contextmenu",(()=>k(e,t,n))),e.isFixedLayout||(t.addEventListener("selectstart",(()=>{const t=e.shadowRoot.querySelector("foliate-paginator").shadowRoot.querySelector("#container");t&&(globalThis.originalScrollLeft=t.scrollLeft)})),t.addEventListener("selectionchange",(()=>{if("paginated"!==e.renderer.getAttribute("flow"))return;const{lastLocation:n}=e;if(!n)return;const i=v(t.getSelection());if(!i)return;globalThis.pageDebounceTimer&&(clearTimeout(globalThis.pageDebounceTimer),globalThis.pageDebounceTimer=null);const r=e.shadowRoot.querySelector("foliate-paginator").shadowRoot.querySelector("#container");if(i.compareBoundaryPoints(Range.END_TO_END,n.range)>=0)return void(globalThis.pageDebounceTimer=setTimeout((async()=>{await e.next(),globalThis.originalScrollLeft=r.scrollLeft,globalThis.pageDebounceTimer=null}),1e3));const o=()=>{const n=v(t.getSelection());n&&e.lastLocation&&e.lastLocation.range&&e.lastLocation.range.startContainer===n.endContainer&&(r.scrollLeft=globalThis.originalScrollLeft)};r.addEventListener("scroll",o),t.addEventListener("pointerup",(()=>{r.removeEventListener("scroll",o)}),{once:!0})})))},_=async e=>{const t=new Uint8Array(await e.slice(0,4).arrayBuffer());return 80===t[0]&&75===t[1]&&3===t[2]&&4===t[3]},A=async e=>{const t=new Uint8Array(await e.slice(0,5).arrayBuffer());return 37===t[0]&&80===t[1]&&68===t[2]&&70===t[3]&&45===t[4]},L=async e=>{g({useWebWorkers:!1});const t=new p(new m(e)),n=await t.getEntries(),i=new Map(n.map((e=>[e.filename,e]))),r=e=>(t,...n)=>i.has(t)?e(i.get(t),...n):null;return{entries:n,loadText:r((e=>e.getData(new w))),loadBlob:r(((e,t)=>e.getData(new b(t)))),getSize:e=>i.get(e)?.uncompressedSize??0}},T=async e=>e.isFile?e:(await Promise.all(Array.from(await new Promise(((t,n)=>e.createReader().readEntries((e=>t(e)),(e=>n(e))))),T))).flat(),E=async e=>{const t=await T(e),n=await Promise.all(t.map((e=>new Promise(((t,n)=>e.file((n=>t([n,e.fullPath])),(e=>n(e)))))))),i=new Map(n.map((([t,n])=>[n.replace(e.fullPath+"/",""),t]))),r=new TextDecoder;return{loadText:async e=>{return t=await(e=>i.get(e)?.arrayBuffer()??null)(e),t?r.decode(t):null;var t},loadBlob:e=>i.get(e),getSize:e=>i.get(e)?.size??0}},C=({name:e,type:t})=>"application/vnd.comicbook+zip"===t||e.endsWith(".cbz"),R=({name:e,type:t})=>"application/x-fictionbook+xml"===t||e.endsWith(".fb2"),I=({name:e,type:t})=>"application/x-zip-compressed-fb2"===t||e.endsWith(".fb2.zip")||e.endsWith(".fbz"),M=async e=>{let t;if(e.isDirectory){const i=await E(e),{EPUB:r}=await Promise.resolve().then(n.bind(n,800));t=await new r(i).init()}else{if(!e.size)throw new Error("File not found");if(await _(e)){const i=await L(e);if(C(e)){const{makeComicBook:r}=await Promise.resolve().then(n.bind(n,467));t=r(i,e)}else if(I(e)){const{makeFB2:e}=await Promise.resolve().then(n.bind(n,406)),{entries:r}=i,o=r.find((e=>e.filename.endsWith(".fb2"))),a=await i.loadBlob((o??r[0]).filename);t=await e(a)}else t=await new y(i).init()}else if(await A(e)){s=!0;const{makePDF:i}=await Promise.resolve().then(n.bind(n,354));t=await i(e)}else{const{isMOBI:i,MOBI:r}=await Promise.resolve().then(n.bind(n,759));if(await i(e)){const i=await Promise.resolve().then(n.bind(n,535));t=await new r({unzlib:i.unzlibSync}).open(e)}else if(R(e)){const{makeFB2:i}=await Promise.resolve().then(n.bind(n,406));t=await i(e)}}}if(!t)throw new Error("File type not supported");const i=document.createElement("foliate-view");return document.body.append(i),await i.open(t),i},z=({fontSize:e,fontName:t,fontPath:n,fontWeight:i,letterSpacing:r,spacing:o,textIndent:a,paragraphSpacing:s,fontColor:l,backgroundColor:c,justify:d,hyphenate:h,writingMode:u,backgroundImage:f,flow:g})=>`\n    @namespace epub "http://www.idpf.org/2007/ops";\n    @font-face {\n      font-family: ${t};\n      src: url('${n}');\n      font-display: swap;\n    }\n\n    html {\n        ${"auto"===u?"":`writing-mode: ${u} !important;`}\n        color: ${l} !important;\n        ${!f||g||"none"===f?"background: none !important;":`background-image: url('${f}') !important;\n    background-size: 100% 100% !important;\n    background-repeat: repeat !important;\n    background-attachment: scroll !important; \n    background-position: center center !important;\n    background-clip: content-box !important;`}\n        background-color: transparent !important;\n        letter-spacing: ${r}px;\n        font-size: ${e}em;\n    }\n\n    body {\n        background: none !important;\n        background-color: transparent;\n    }\n\n    img {\n        max-width: 100% !important;\n        object-fit: contain !important;\n        break-inside: avoid !important;\n        box-sizing: border-box !important;\n    }\n\n    a:link {\n        color:rgb(167, 96, 52) !important;\n    }\n\n    * {\n        line-height: ${o}em !important;\n        ${"book"===t?"":"system"===t?"font-family: system-ui !important;":`font-family: ${t} !important;`}\n    }\n\n    p, li, blockquote, dd, div, font {\n        color: ${l} !important;\n        // line-height: ${o} !important;\n        font-weight: ${i} !important;\n        padding-bottom: ${s}em !important;\n        text-align: ${d?"justify":"start"};\n        -webkit-hyphens: ${h?"auto":"manual"};\n        hyphens: ${h?"auto":"manual"};\n        -webkit-hyphenate-limit-before: 3;\n        -webkit-hyphenate-limit-after: 2;\n        -webkit-hyphenate-limit-lines: 2;\n        hanging-punctuation: allow-end last;\n        widows: 2;\n    }\n\n    p, li, blockquote, dd, font {\n        text-indent: ${a}em !important;\n    }\n    \n    p img {\n      margin-left: -${a}em;\n    }\n        \n    /* prevent the above from overriding the align attribute */\n    [align="left"] { text-align: left; }\n    [align="right"] { text-align: right; }\n    [align="center"] { text-align: center; }\n    [align="justify"] { text-align: justify; }\n\n    pre {\n        white-space: pre-wrap !important;\n    }\n    aside[epub|type~="endnote"],\n    aside[epub|type~="footnote"],\n    aside[epub|type~="note"],\n    aside[epub|type~="rearnote"] {\n        display: none;\n    }\n`,O=(e,t)=>{console.log("convertChinese",e);const n="皑蔼碍爱翱袄奥坝罢摆败颁办绊帮绑镑谤剥饱宝报鲍辈贝钡狈备惫绷笔毕毙闭边编贬变辩辫鳖瘪濒滨宾摈饼拨钵铂驳卜补参蚕残惭惨灿苍舱仓沧厕侧册测层诧搀掺蝉馋谗缠铲产阐颤场尝长偿肠厂畅钞车彻尘陈衬撑称惩诚骋痴迟驰耻齿炽冲虫宠畴踌筹绸丑橱厨锄雏础储触处传疮闯创锤纯绰辞词赐聪葱囱从丛凑窜错达带贷担单郸掸胆惮诞弹当挡党荡档捣岛祷导盗灯邓敌涤递缔点垫电淀钓调迭谍叠钉顶锭订东动栋冻斗犊独读赌镀锻断缎兑队对吨顿钝夺鹅额讹恶饿儿尔饵贰发罚阀珐矾钒烦范贩饭访纺飞废费纷坟奋愤粪丰枫锋风疯冯缝讽凤肤辐抚辅赋复负讣妇缚该钙盖干赶秆赣冈刚钢纲岗皋镐搁鸽阁铬个给龚宫巩贡钩沟构购够蛊顾剐关观馆惯贯广规硅归龟闺轨诡柜贵刽辊滚锅国过骇韩汉阂鹤贺横轰鸿红后壶护沪户哗华画划话怀坏欢环还缓换唤痪焕涣黄谎挥辉毁贿秽会烩汇讳诲绘荤浑伙获货祸击机积饥讥鸡绩缉极辑级挤几蓟剂济计记际继纪夹荚颊贾钾价驾歼监坚笺间艰缄茧检碱硷拣捡简俭减荐槛鉴践贱见键舰剑饯渐溅涧浆蒋桨奖讲酱胶浇骄娇搅铰矫侥脚饺缴绞轿较秸阶节茎惊经颈静镜径痉竞净纠厩旧驹举据锯惧剧鹃绢杰洁结诫届紧锦仅谨进晋烬尽劲荆觉决诀绝钧军骏开凯颗壳课垦恳抠库裤夸块侩宽矿旷况亏岿窥馈溃扩阔蜡腊莱来赖蓝栏拦篮阑兰澜谰揽览懒缆烂滥捞劳涝乐镭垒类泪篱离里鲤礼丽厉励砾历沥隶俩联莲连镰怜涟帘敛脸链恋炼练粮凉两辆谅疗辽镣猎临邻鳞凛赁龄铃凌灵岭领馏刘龙聋咙笼垄拢陇楼娄搂篓芦卢颅庐炉掳卤虏鲁赂禄录陆驴吕铝侣屡缕虑滤绿峦挛孪滦乱抡轮伦仑沦纶论萝罗逻锣箩骡骆络妈玛码蚂马骂吗买麦卖迈脉瞒馒蛮满谩猫锚铆贸么霉没镁门闷们锰梦谜弥觅绵缅庙灭悯闽鸣铭谬谋亩钠纳难挠脑恼闹馁腻撵捻酿鸟聂啮镊镍柠狞宁拧泞钮纽脓浓农疟诺欧鸥殴呕沤盘庞国爱赔喷鹏骗飘频贫苹凭评泼颇扑铺朴谱脐齐骑岂启气弃讫牵扦钎铅迁签谦钱钳潜浅谴堑枪呛墙蔷强抢锹桥乔侨翘窍窃钦亲轻氢倾顷请庆琼穷趋区躯驱龋颧权劝却鹊让饶扰绕热韧认纫荣绒软锐闰润洒萨鳃赛伞丧骚扫涩杀纱筛晒闪陕赡缮伤赏烧绍赊摄慑设绅审婶肾渗声绳胜圣师狮湿诗尸时蚀实识驶势释饰视试寿兽枢输书赎属术树竖数帅双谁税顺说硕烁丝饲耸怂颂讼诵擞苏诉肃虽绥岁孙损笋缩琐锁獭挞抬摊贪瘫滩坛谭谈叹汤烫涛绦腾誊锑题体屉条贴铁厅听烃铜统头图涂团颓蜕脱鸵驮驼椭洼袜弯湾顽万网韦违围为潍维苇伟伪纬谓卫温闻纹稳问瓮挝蜗涡窝呜钨乌诬无芜吴坞雾务误锡牺袭习铣戏细虾辖峡侠狭厦锨鲜纤咸贤衔闲显险现献县馅羡宪线厢镶乡详响项萧销晓啸蝎协挟携胁谐写泻谢锌衅兴汹锈绣虚嘘须许绪续轩悬选癣绚学勋询寻驯训讯逊压鸦鸭哑亚讶阉烟盐严颜阎艳厌砚彦谚验鸯杨扬疡阳痒养样瑶摇尧遥窑谣药爷页业叶医铱颐遗仪彝蚁艺亿忆义诣议谊译异绎荫阴银饮樱婴鹰应缨莹萤营荧蝇颖哟拥佣痈踊咏涌优忧邮铀犹游诱舆鱼渔娱与屿语吁御狱誉预驭鸳渊辕园员圆缘远愿约跃钥岳粤悦阅云郧匀陨运蕴酝晕韵杂灾载攒暂赞赃脏凿枣灶责择则泽贼赠扎札轧铡闸诈斋债毡盏斩辗崭栈战绽张涨帐账胀赵蛰辙锗这贞针侦诊镇阵挣睁狰帧郑证织职执纸挚掷帜质钟终种肿众诌轴皱昼骤猪诸诛烛瞩嘱贮铸筑驻专砖转赚桩庄装妆壮状锥赘坠缀谆浊兹资渍踪综总纵邹诅组钻致钟么为只凶准启板里雳余链泄",i="皚藹礙愛翺襖奧壩罷擺敗頒辦絆幫綁鎊謗剝飽寶報鮑輩貝鋇狽備憊繃筆畢斃閉邊編貶變辯辮鼈癟瀕濱賓擯餅撥缽鉑駁蔔補參蠶殘慚慘燦蒼艙倉滄廁側冊測層詫攙摻蟬饞讒纏鏟産闡顫場嘗長償腸廠暢鈔車徹塵陳襯撐稱懲誠騁癡遲馳恥齒熾沖蟲寵疇躊籌綢醜櫥廚鋤雛礎儲觸處傳瘡闖創錘純綽辭詞賜聰蔥囪從叢湊竄錯達帶貸擔單鄲撣膽憚誕彈當擋黨蕩檔搗島禱導盜燈鄧敵滌遞締點墊電澱釣調叠諜疊釘頂錠訂東動棟凍鬥犢獨讀賭鍍鍛斷緞兌隊對噸頓鈍奪鵝額訛惡餓兒爾餌貳發罰閥琺礬釩煩範販飯訪紡飛廢費紛墳奮憤糞豐楓鋒風瘋馮縫諷鳳膚輻撫輔賦複負訃婦縛該鈣蓋幹趕稈贛岡剛鋼綱崗臯鎬擱鴿閣鉻個給龔宮鞏貢鈎溝構購夠蠱顧剮關觀館慣貫廣規矽歸龜閨軌詭櫃貴劊輥滾鍋國過駭韓漢閡鶴賀橫轟鴻紅後壺護滬戶嘩華畫劃話懷壞歡環還緩換喚瘓煥渙黃謊揮輝毀賄穢會燴彙諱誨繪葷渾夥獲貨禍擊機積饑譏雞績緝極輯級擠幾薊劑濟計記際繼紀夾莢頰賈鉀價駕殲監堅箋間艱緘繭檢堿鹼揀撿簡儉減薦檻鑒踐賤見鍵艦劍餞漸濺澗漿蔣槳獎講醬膠澆驕嬌攪鉸矯僥腳餃繳絞轎較稭階節莖驚經頸靜鏡徑痙競淨糾廄舊駒舉據鋸懼劇鵑絹傑潔結誡屆緊錦僅謹進晉燼盡勁荊覺決訣絕鈞軍駿開凱顆殼課墾懇摳庫褲誇塊儈寬礦曠況虧巋窺饋潰擴闊蠟臘萊來賴藍欄攔籃闌蘭瀾讕攬覽懶纜爛濫撈勞澇樂鐳壘類淚籬離裏鯉禮麗厲勵礫曆瀝隸倆聯蓮連鐮憐漣簾斂臉鏈戀煉練糧涼兩輛諒療遼鐐獵臨鄰鱗凜賃齡鈴淩靈嶺領餾劉龍聾嚨籠壟攏隴樓婁摟簍蘆盧顱廬爐擄鹵虜魯賂祿錄陸驢呂鋁侶屢縷慮濾綠巒攣孿灤亂掄輪倫侖淪綸論蘿羅邏鑼籮騾駱絡媽瑪碼螞馬罵嗎買麥賣邁脈瞞饅蠻滿謾貓錨鉚貿麽黴沒鎂門悶們錳夢謎彌覓綿緬廟滅憫閩鳴銘謬謀畝鈉納難撓腦惱鬧餒膩攆撚釀鳥聶齧鑷鎳檸獰甯擰濘鈕紐膿濃農瘧諾歐鷗毆嘔漚盤龐國愛賠噴鵬騙飄頻貧蘋憑評潑頗撲鋪樸譜臍齊騎豈啓氣棄訖牽扡釺鉛遷簽謙錢鉗潛淺譴塹槍嗆牆薔強搶鍬橋喬僑翹竅竊欽親輕氫傾頃請慶瓊窮趨區軀驅齲顴權勸卻鵲讓饒擾繞熱韌認紉榮絨軟銳閏潤灑薩鰓賽傘喪騷掃澀殺紗篩曬閃陝贍繕傷賞燒紹賒攝懾設紳審嬸腎滲聲繩勝聖師獅濕詩屍時蝕實識駛勢釋飾視試壽獸樞輸書贖屬術樹豎數帥雙誰稅順說碩爍絲飼聳慫頌訟誦擻蘇訴肅雖綏歲孫損筍縮瑣鎖獺撻擡攤貪癱灘壇譚談歎湯燙濤縧騰謄銻題體屜條貼鐵廳聽烴銅統頭圖塗團頹蛻脫鴕馱駝橢窪襪彎灣頑萬網韋違圍爲濰維葦偉僞緯謂衛溫聞紋穩問甕撾蝸渦窩嗚鎢烏誣無蕪吳塢霧務誤錫犧襲習銑戲細蝦轄峽俠狹廈鍁鮮纖鹹賢銜閑顯險現獻縣餡羨憲線廂鑲鄉詳響項蕭銷曉嘯蠍協挾攜脅諧寫瀉謝鋅釁興洶鏽繡虛噓須許緒續軒懸選癬絢學勳詢尋馴訓訊遜壓鴉鴨啞亞訝閹煙鹽嚴顔閻豔厭硯彥諺驗鴦楊揚瘍陽癢養樣瑤搖堯遙窯謠藥爺頁業葉醫銥頤遺儀彜蟻藝億憶義詣議誼譯異繹蔭陰銀飲櫻嬰鷹應纓瑩螢營熒蠅穎喲擁傭癰踴詠湧優憂郵鈾猶遊誘輿魚漁娛與嶼語籲禦獄譽預馭鴛淵轅園員圓緣遠願約躍鑰嶽粵悅閱雲鄖勻隕運蘊醞暈韻雜災載攢暫贊贓髒鑿棗竈責擇則澤賊贈紮劄軋鍘閘詐齋債氈盞斬輾嶄棧戰綻張漲帳賬脹趙蟄轍鍺這貞針偵診鎮陣掙睜猙幀鄭證織職執紙摯擲幟質鍾終種腫衆謅軸皺晝驟豬諸誅燭矚囑貯鑄築駐專磚轉賺樁莊裝妝壯狀錐贅墜綴諄濁茲資漬蹤綜總縱鄒詛組鑽緻鐘麼為隻兇準啟闆裡靂餘鍊洩",r="s2t"===e?n:i,o="s2t"===e?i:n,a=(e,t,n)=>{e.nodeType===Node.TEXT_NODE?e.textContent=e.textContent.replace(/[\u4e00-\u9fa5]/g,(e=>n[t.indexOf(e)]??e)):e.childNodes.forEach((e=>a(e,t,n)))};t.body.childNodes.forEach((e=>{a(e,r,o)}))},F=e=>{},B=e=>{"none"!==f.convertChineseMode&&O(f.convertChineseMode,e),f.bionicReadingMode&&F(e)},N=document.getElementById("footnote-dialog");N.style.display="none",N.addEventListener("click",(()=>{N.style.display="none",$("onFootnoteClose")}));const P=e=>{clearSelection(),N.querySelector("main").replaceChildren(e),e.addEventListener("load",(t=>{const{doc:n,index:i}=t.detail;globalThis.footnoteSelection=()=>k(e,n,i),S(e,n,i),B(n),setTimeout((()=>{const e=document.getElementById("footnote-dialog");document.querySelector("#footnote-dialog > main > foliate-view").shadowRoot.querySelector("foliate-paginator").shadowRoot.querySelector("#container > div > iframe"),e.style.display="block"}),0)}));const{renderer:t}=e;t.setAttribute("flow","scrolled"),t.setAttribute("gap","5%"),t.setAttribute("top-margin","0px"),t.setAttribute("bottom-margin","0px");const n={fontSize:u.fontSize,fontName:u.fontName,fontPath:u.fontPath,letterSpacing:u.letterSpacing,spacing:u.spacing,textIndent:u.textIndent,fontColor:u.fontColor,backgroundColor:"transparent",justify:!0,hyphenate:!0};t.setStyles(z(n)),N.style.backgroundColor=u.backgroundColor.slice(0,7)+"33"};N.addEventListener("click",(e=>e.target===N?N.close():null));class U{annotations=new Map;annotationsByValue=new Map;#b=new r.F;#y;#r;#x;constructor(){this.#b.addEventListener("before-render",(e=>{const{view:t}=e.detail;this.setView(t),P(t)})),this.#b.addEventListener("render",(e=>{const{view:t}=e.detail;N.showModal()})),this.#x=null}async open(e,t){this.view=await M(e,t),c||(this.view.addEventListener("load",this.#v.bind(this)),this.view.addEventListener("relocate",this.#k.bind(this)),this.view.addEventListener("click-view",this.#S.bind(this)),W(),t||this.view.renderer.next(),this.setView(this.view),await this.view.init({lastLocation:t}))}setView(e){e.addEventListener("create-overlay",(e=>{const{index:t}=e.detail,n=this.annotations.get(t);if(n)for(const e of n)this.view.addAnnotation(e)})),e.addEventListener("draw-annotation",(e=>{const{draw:t,annotation:n}=e.detail,{color:i,type:r}=n;"highlight"===r?t(o.u.highlight,{color:i}):"underline"===r&&t(o.u.underline,{color:i})})),e.addEventListener("show-annotation",(e=>{const t=this.annotationsByValue.get(e.detail.value),n=x(e.detail.range);H({annotation:t,pos:n})})),e.addEventListener("external-link",(e=>{e.preventDefault(),V(e.detail)})),e.addEventListener("link",(e=>this.#b.handle(this.view.book,e)?.catch((t=>{console.warn(t),this.view.goTo(e.detail.href)})))),e.history.addEventListener("pushstate",(t=>{$("onPushState",{canGoBack:e.history.canGoBack,canGoForward:e.history.canGoForward})})),e.addEventListener("click-image",(async e=>{console.log("click-image",e.detail.img.src);const t=e.detail.img.src,n=await fetch(t).then((e=>e.blob())),i=await new Promise(((e,t)=>{const i=new FileReader;i.onloadend=()=>e(i.result),i.onerror=t,i.readAsDataURL(n)}));$("onImageClick",i)}))}renderAnnotation(){const e=allAnnotations??[];for(const t of e){const{value:e,type:n,color:i,note:r}=t,o={id:t.id,value:e,type:n,color:i,note:r};this.addAnnotation(o)}}showContextMenu(){return k(this.view,this.#y,this.#r)}addAnnotation(e){const{value:t}=e,n=(t.split("/")[2].split("!")[0]-2)/2,i=this.annotations.get(n);i?i.push(e):this.annotations.set(n,[e]),this.annotationsByValue.set(t,e),this.view.addAnnotation(e)}removeAnnotation(e){const t=this.annotationsByValue.get(e),{value:n}=t,i=(n.split("/")[2].split("!")[0]-2)/2,r=this.annotations.get(i);if(r){const e=r.findIndex((e=>e.id===t.id));-1!==e&&r.splice(e,1)}this.annotationsByValue.delete(n),this.view.addAnnotation(t,!0)}#v({detail:{doc:e,index:t}}){this.#y=e,this.#r=t,S(this.view,e,t),this.#_(),this.readingFeatures(f)}#k({detail:e}){const{cfi:t,fraction:n,location:i,tocItem:r,pageItem:o,chapterLocation:a}=e,s=o?`Page ${o.label}`:`Loc ${i.current}`;j({cfi:t,fraction:n,loc:s,tocItem:r,pageItem:o,location:i,chapterLocation:a})}#S({detail:{x:e,y:t}}){const n=e/window.innerWidth,i=t/window.innerHeight;q(n,i)}get index(){return this.#r}#_=()=>{this.#x=[];const e=document.createTreeWalker(this.#y.body,NodeFilter.SHOW_TEXT,null,!1);for(;e.nextNode();)this.#x.push(e.currentNode.textContent)};#A=()=>{const e=document.createTreeWalker(this.#y.body,NodeFilter.SHOW_TEXT,null,!1);let t,n=0;for(;t=e.nextNode();)t.textContent=this.#x[n++]};readingFeatures=()=>{this.#A(),B(this.#y)};getChapterContent=()=>this.#y.body.textContent;getPreviousContent=(e=2e3)=>{let t=this.view.lastLocation?.range?.endContainer?.parentElement;if(!t)return"";let n="";for(;n.length<e&&t;)n=t.textContent+n,t=t.previousSibling;return n};getSelection=()=>{const e=this.#y.getSelection();return v(e)}}const D=async(e,t)=>{const n=new U;globalThis.reader=n,await n.open(e,t),c?G():($("onLoadEnd"),X(),$("renderAnnotations"))},$=(e,t)=>{window.flutter_inappwebview.callHandler(e,t)},W=()=>{const e={scroll:!1,animated:!0};switch(u.pageTurnStyle){case"slide":e.scroll=!1,e.animated=!0;break;case"scroll":e.scroll=!0,e.animated=!0;break;case"noAnimation":e.scroll=!1,e.animated=!1}reader.view.renderer.setAttribute("flow",e.scroll?"scrolled":"paginated"),reader.view.renderer.setAttribute("top-margin",`${u.topMargin}px`),reader.view.renderer.setAttribute("bottom-margin",`${u.bottomMargin}px`),reader.view.renderer.setAttribute("gap",`${u.sideMargin}%`),reader.view.renderer.setAttribute("background-color",u.backgroundColor),reader.view.renderer.setAttribute("max-column-count",u.maxColumnCount),reader.view.renderer.setAttribute("bgimg-url",u.backgroundImage),e.animated?reader.view.renderer.setAttribute("animated","true"):reader.view.renderer.removeAttribute("animated");const t={fontSize:u.fontSize,fontName:u.fontName,fontPath:u.fontPath,fontWeight:u.fontWeight,letterSpacing:u.letterSpacing,spacing:u.spacing,paragraphSpacing:u.paragraphSpacing,textIndent:u.textIndent,fontColor:u.fontColor,backgroundColor:u.backgroundColor,justify:u.justify,hyphenate:u.hyphenate,writingMode:u.writingMode,backgroundImage:u.backgroundImage,flow:e.scroll};reader.view.renderer.setStyles?.(z(t))},j=e=>{const t=e.tocItem?.label,n=e.tocItem?.href,i=e.chapterLocation.total,r=e.chapterLocation.current,o=e.location.total,a=e.location.current,s=e.cfi,l=e.fraction;$("onRelocated",{chapterTitle:t,chapterHref:n,chapterTotalPages:i,chapterCurrentPage:r,bookTotalPages:o,bookCurrentPage:a,cfi:s,percentage:l})},H=e=>$("onAnnotationClick",e),q=(e,t)=>$("onClick",{x:e,y:t}),V=e=>console.log(e),X=()=>$("onSetToc",reader.view.book.toc),G=async()=>{const e=await reader.view.book.getCover();if(e){const t=new FileReader;t.readAsDataURL(e),t.onloadend=()=>{$("onMetadata",{...reader.view.book.metadata,cover:t.result})}}else $("onMetadata",{...reader.view.book.metadata,cover:null})};window.changeStyle=e=>{u={...u,...e},console.log("changeStyle",JSON.stringify(u)),W()},window.goToHref=e=>reader.view.goTo(e),window.goToCfi=e=>reader.view.goTo(e),window.goToPercent=e=>reader.view.goToFraction(e),window.nextPage=()=>reader.view.next(),window.prevPage=()=>reader.view.prev(),window.setScroll=()=>{u.scroll=!0,u.animated=!0,W()},window.setPaginated=()=>{u.scroll=!1,u.animated=!0,W()},window.setNoAnimation=()=>{u.scroll=!1,u.animated=!1,W()};const K=e=>{N.open||s?$("onSelectionEnd",{...e,footnote:!0}):$("onSelectionEnd",{...e,footnote:!1})};window.showContextMenu=()=>{N.open?footnoteSelection():reader.showContextMenu()},window.getSelection=()=>reader.getSelection(),window.clearSelection=()=>reader.view.deselect(),window.addAnnotation=e=>reader.addAnnotation(e),window.removeAnnotation=e=>reader.removeAnnotation(e),window.prevSection=()=>reader.view.renderer.prevSection(),window.nextSection=()=>reader.view.renderer.nextSection(),window.initTts=()=>reader.view.initTTS(),window.ttsStop=()=>reader.view.initTTS(!0),window.ttsHere=()=>(initTts(),reader.view.tts.from(reader.view.lastLocation.range)),window.ttsNextSection=async()=>(await nextSection(),initTts(),ttsNext()),window.ttsPrevSection=async e=>(await prevSection(),initTts(),e?reader.view.tts.end():ttsNext()),window.ttsNext=async()=>reader.view.tts.next(!0)||await ttsNextSection(),window.ttsPrev=()=>reader.view.tts.prev(!0)||ttsPrevSection(!0),window.ttsPrepare=()=>reader.view.tts.prepare(),window.clearSearch=()=>reader.view.clearSearch(),window.search=async(e,t)=>{null==t&&(t={scope:"book",matchCase:!1,matchDiacritics:!1,matchWholeWords:!1});const n=e.trim();if(!n)return;const i="section"===t.scope?reader.index:null;for await(const e of reader.view.search({...t,query:n,index:i}))$("onSearch","done"===e?{process:1}:"progress"in e?{process:e.progress}:e)},window.back=()=>reader.view.history.back(),window.forward=()=>reader.view.history.forward(),window.renderAnnotations=()=>reader.renderAnnotation(),window.theChapterContent=()=>reader.getChapterContent(),window.previousContent=(e=2e3)=>reader.getPreviousContent(e),window.isFootNoteOpen=()=>N.getAttribute("style").includes("display: block"),window.closeFootNote=()=>{N.style.display="none",$("onFootnoteClose")},window.readingFeatures=e=>{f={...f,...e},reader.readingFeatures()};var l=new URLSearchParams(window.location.search),c=JSON.parse(l.get("importing")),d=JSON.parse(l.get("url")),h=JSON.parse(l.get("initialCfi")),u=JSON.parse(l.get("style")),f=JSON.parse(l.get("readingRules"));fetch(d).then((e=>e.blob())).then((e=>D(new File([e],new URL(d,window.location.origin).pathname),h))).catch((e=>console.error(e))),t()}catch(e){t(e)}}),1)},535:(e,t,n)=>{n.r(t),n.d(t,{unzlibSync:()=>C});var i=Uint8Array,r=Uint16Array,o=Uint32Array,a=new i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(e,t){for(var n=new r(31),i=0;i<31;++i)n[i]=t+=1<<e[i-1];var a=new o(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)a[s]=s-n[i]<<5|i;return[n,a]},d=c(a,2),h=d[0],u=d[1];h[28]=258,u[258]=28;for(var f=c(s,0)[0],g=new r(32768),p=0;p<32768;++p){var m=(43690&p)>>>1|(21845&p)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,g[p]=((65280&m)>>>8|(255&m)<<8)>>>1}var w=function(e,t,n){for(var i=e.length,o=0,a=new r(t);o<i;++o)e[o]&&++a[e[o]-1];var s,l=new r(t);for(o=0;o<t;++o)l[o]=l[o-1]+a[o-1]<<1;if(n){s=new r(1<<t);var c=15-t;for(o=0;o<i;++o)if(e[o])for(var d=o<<4|e[o],h=t-e[o],u=l[e[o]-1]++<<h,f=u|(1<<h)-1;u<=f;++u)s[g[u]>>>c]=d}else for(s=new r(i),o=0;o<i;++o)e[o]&&(s[o]=g[l[e[o]-1]++]>>>15-e[o]);return s},b=new i(288);for(p=0;p<144;++p)b[p]=8;for(p=144;p<256;++p)b[p]=9;for(p=256;p<280;++p)b[p]=7;for(p=280;p<288;++p)b[p]=8;var y=new i(32);for(p=0;p<32;++p)y[p]=5;var x=w(b,9,1),v=w(y,5,1),k=function(e){for(var t=e[0],n=1;n<e.length;++n)e[n]>t&&(t=e[n]);return t},S=function(e,t,n){var i=t/8|0;return(e[i]|e[i+1]<<8)>>(7&t)&n},_=function(e,t){var n=t/8|0;return(e[n]|e[n+1]<<8|e[n+2]<<16)>>(7&t)},A=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],L=function(e,t,n){var i=new Error(t||A[e]);if(i.code=e,Error.captureStackTrace&&Error.captureStackTrace(i,L),!n)throw i;return i},T=function(e,t,n){var c=e.length;if(!c||n&&n.f&&!n.l)return t||new i(0);var d=!t||n,u=!n||n.i;n||(n={}),t||(t=new i(3*c));var g=function(e){var n=t.length;if(e>n){var r=new i(Math.max(2*n,e));r.set(t),t=r}},p=n.f||0,m=n.p||0,b=n.b||0,y=n.l,A=n.d,T=n.m,E=n.n,C=8*c;do{if(!y){p=S(e,m,1);var R=S(e,m+1,3);if(m+=3,!R){var I=e[(W=4+((m+7)/8|0))-4]|e[W-3]<<8,M=W+I;if(M>c){u&&L(0);break}d&&g(b+I),t.set(e.subarray(W,M),b),n.b=b+=I,n.p=m=8*M,n.f=p;continue}if(1==R)y=x,A=v,T=9,E=5;else if(2==R){var z=S(e,m,31)+257,O=S(e,m+10,15)+4,F=z+S(e,m+5,31)+1;m+=14;for(var B=new i(F),N=new i(19),P=0;P<O;++P)N[l[P]]=S(e,m+3*P,7);m+=3*O;var U=k(N),D=(1<<U)-1,$=w(N,U,1);for(P=0;P<F;){var W,j=$[S(e,m,D)];if(m+=15&j,(W=j>>>4)<16)B[P++]=W;else{var H=0,q=0;for(16==W?(q=3+S(e,m,3),m+=2,H=B[P-1]):17==W?(q=3+S(e,m,7),m+=3):18==W&&(q=11+S(e,m,127),m+=7);q--;)B[P++]=H}}var V=B.subarray(0,z),X=B.subarray(z);T=k(V),E=k(X),y=w(V,T,1),A=w(X,E,1)}else L(1);if(m>C){u&&L(0);break}}d&&g(b+131072);for(var G=(1<<T)-1,K=(1<<E)-1,J=m;;J=m){var Z=(H=y[_(e,m)&G])>>>4;if((m+=15&H)>C){u&&L(0);break}if(H||L(2),Z<256)t[b++]=Z;else{if(256==Z){J=m,y=null;break}var Y=Z-254;if(Z>264){var Q=a[P=Z-257];Y=S(e,m,(1<<Q)-1)+h[P],m+=Q}var ee=A[_(e,m)&K],te=ee>>>4;if(ee||L(3),m+=15&ee,X=f[te],te>3&&(Q=s[te],X+=_(e,m)&(1<<Q)-1,m+=Q),m>C){u&&L(0);break}d&&g(b+131072);for(var ne=b+Y;b<ne;b+=4)t[b]=t[b-X],t[b+1]=t[b+1-X],t[b+2]=t[b+2-X],t[b+3]=t[b+3-X];b=ne}}n.l=y,n.p=J,n.b=b,n.f=p,y&&(p=1,n.m=T,n.d=A,n.n=E)}while(!p);return b==t.length?t:function(e,t,n){(null==t||t<0)&&(t=0),(null==n||n>e.length)&&(n=e.length);var a=new(2==e.BYTES_PER_ELEMENT?r:4==e.BYTES_PER_ELEMENT?o:i)(n-t);return a.set(e.subarray(t,n)),a}(t,0,b)},E=new i(0);function C(e,t){return T(((8!=(15&(n=e)[0])||n[0]>>>4>7||(n[0]<<8|n[1])%31)&&L(6,"invalid zlib data"),32&n[1]&&L(6,"invalid zlib data: preset dictionaries not supported"),e.subarray(2,-4)),t);var n}var R="undefined"!=typeof TextDecoder&&new TextDecoder;try{R.decode(E,{stream:!0})}catch(i){}},587:(e,t,n)=>{n.r(t),n.d(t,{Paginator:()=>b});const i=e=>new Promise((t=>setTimeout(t,e))),r=(e,t,n,i=n)=>{const r=e.createRange();return r.setStart(t,n),r.setEnd(t,i),r},o=(e,t,n,i=0,a=t.nodeValue.length)=>{if(a-i==1)return n(r(e,t,i),r(e,t,a))<0?i:a;const s=Math.floor(i+(a-i)/2),l=n(r(e,t,i,s),r(e,t,s,a));return l<0?o(e,t,n,i,s):l>0?o(e,t,n,s,a):s},{SHOW_ELEMENT:a,SHOW_TEXT:s,SHOW_CDATA_SECTION:l,FILTER_ACCEPT:c,FILTER_REJECT:d,FILTER_SKIP:h}=NodeFilter,u=a|s|l,f=(e,t,n,i)=>{if(!e)return;const r=e.createTreeWalker(e.body,u,{acceptNode:r=>{const o=r.localName?.toLowerCase();if("script"===o||"style"===o)return d;if(1===r.nodeType){const{left:e,right:o}=i(r.getBoundingClientRect());if(o<t||e>n)return d;if(e>=t&&o<=n)return c}else{if(!r.nodeValue?.trim())return d;const o=e.createRange();o.selectNodeContents(r);const{left:a,right:s}=i(o.getBoundingClientRect());if(s>=t&&a<=n)return c}return h}}),a=[];for(let e=r.nextNode();e;e=r.nextNode())a.push(e);const s=a[0]??e.body,l=a[a.length-1]??s,f=1===s.nodeType?0:o(e,s,((e,n)=>{const r=i(e.getBoundingClientRect()),o=i(n.getBoundingClientRect());return r.right<t&&o.left>t?0:o.left>t?-1:1})),g=1===l.nodeType?0:o(e,l,((e,t)=>{const r=i(e.getBoundingClientRect()),o=i(t.getBoundingClientRect());return r.right<n&&o.left>n?0:o.left>n?-1:1})),p=e.createRange();return p.setStart(s,f),p.setEnd(l,g),p},g=e=>{let t;return t="none"===e?"none":`url(${e}) repeat scroll 50% 50% / 100% 100%`,t},p=(e,t)=>Array.from({length:e},(()=>{const e=document.createElement("div"),n=document.createElement("div");return e.append(n),n.setAttribute("part",t),e})),m=(e,t)=>{const{style:n}=e;for(const[e,i]of Object.entries(t))n.setProperty(e,i,"important")};class w{#t=new ResizeObserver((()=>this.expand()));#L=document.createElement("div");#T=document.createElement("iframe");#E=document.createRange();#C;#R=!1;#I=!1;#M=!0;#z;#O={};constructor({container:e,onExpand:t}){this.container=e,this.onExpand=t,this.#T.setAttribute("part","filter"),this.#L.append(this.#T),Object.assign(this.#L.style,{boxSizing:"content-box",position:"relative",overflow:"hidden",flex:"0 0 auto",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),Object.assign(this.#T.style,{overflow:"hidden",border:"0",display:"none",width:"100%",height:"100%"}),this.#T.setAttribute("sandbox","allow-same-origin allow-scripts"),this.#T.setAttribute("scrolling","no")}get element(){return this.#L}get document(){return this.#T.contentDocument}async load(e,t,n){if("string"!=typeof e)throw new Error(`${e} is not string`);return new Promise((i=>{this.#T.addEventListener("load",(()=>{const e=this.document;t?.(e),this.#T.style.display="block";const{vertical:r,rtl:o}=(e=>{const{defaultView:t}=e,{writingMode:n,direction:i}=t.getComputedStyle(e.body);return{vertical:"vertical-rl"===n||"vertical-lr"===n,rtl:"rtl"===e.body.dir||"rtl"===i||"rtl"===e.documentElement.dir}})(e);this.#T.style.display="none",this.#R=r,this.#I=o,this.#E.selectNodeContents(e.body);const a=n?.({vertical:r,rtl:o});this.#T.style.display="block",this.render(a),this.#t.observe(e.body),e.fonts.ready.then((()=>this.expand())),i()}),{once:!0}),this.#T.src=e}))}render(e){e&&(this.#M="scrolled"!==e.flow,this.#O=e,this.#M?this.columnize(e):this.scrolled(e))}scrolled({gap:e,columnWidth:t}){const n=this.#R,i=this.document;i&&(m(i.documentElement,{"box-sizing":"border-box",padding:n?`${e}px 0`:`0 ${e}px`,"column-width":"auto",height:"auto",width:"auto"}),m(i.body,{[n?"max-height":"max-width"]:`${t}px`,margin:"auto"}),this.setImageSize(),this.expand())}columnize({width:e,height:t,gap:n,columnWidth:i,topMargin:r,bottomMargin:o}){const a=this.#R;this.#z=a?t:e;const s=this.document,l=`${n/2}px ${r}px ${n/2}px ${o}px`,c=`${r}px ${n/2}px ${o}px ${n/2}px`;m(s.documentElement,{"box-sizing":"border-box","column-width":`${Math.trunc(i)}px`,"column-gap":`${n}px`,"column-fill":"auto",...a?{width:`${e}px`}:{height:`${t}px`},padding:a?l:c,overflow:"hidden","overflow-wrap":"break-word",position:"static",border:"0",margin:"0","max-height":"none","max-width":"none","min-height":"none","min-width":"none","-webkit-line-box-contain":"block glyphs replaced"}),m(s.body,{"max-height":"none","max-width":"none",margin:"0"}),this.setImageSize(),this.expand()}setImageSize(){const{width:e,height:t,margin:n}=this.#O,i=this.#R,r=this.document;for(const o of r.body.querySelectorAll("img, svg, video")){const{maxHeight:a,maxWidth:s}=r.defaultView.getComputedStyle(o);m(o,{"max-height":i?"none"!==a&&"0px"!==a?a:"100%":t-2*n+"px","max-width":i?e-2*n+"px":"none"!==s&&"0px"!==s?s:"100%","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"})}}expand(){const{documentElement:e}=this.document;if(this.#M){const t=this.#R?"height":"width",n=this.#R?"width":"height";this.#E.selectNodeContents(this.document.body);const i=this.#E.getBoundingClientRect(),r=e.getBoundingClientRect(),o=(this.#R?0:this.#I?r.right-i.right:i.left-r.left)+i[t],a=Math.ceil(o/this.#z)*this.#z;this.#L.style.padding="0",this.#T.style[t]=`${a}px`,this.#L.style[t]=`${a+2*this.#z}px`,this.#T.style[n]="100%",this.#L.style[n]="100%",e.style[t]=`${this.#z}px`,this.#C&&(this.#C.element.style.margin="0",this.#C.element.style.left=this.#R?"0":`${this.#z}px`,this.#C.element.style.top=this.#R?`${this.#z}px`:"0",this.#C.element.style[t]=`${a}px`,this.#C.redraw())}else{const t=this.#R?"width":"height",n=this.#R?"height":"width",i=e.getBoundingClientRect()[t],{margin:r}=this.#O,o=this.#R?`0 ${r}px`:`${r}px 0`;this.#L.style.padding=o,this.#T.style[t]=`${i}px`,this.#L.style[t]=`${i}px`,this.#T.style[n]="100%",this.#L.style[n]="100%",this.#C&&(this.#C.element.style.margin=o,this.#C.element.style.left="0",this.#C.element.style.top="0",this.#C.element.style[t]=`${i}px`,this.#C.redraw())}this.onExpand()}set overlayer(e){this.#C=e,this.#L.append(e.element)}get overlayer(){return this.#C}destroy(){this.document&&this.#t.unobserve(this.document.body)}}class b extends HTMLElement{static observedAttributes=["flow","gap","top-margin","bottom-margin","background-color","max-inline-size","max-block-size","max-column-count"];#e=this.attachShadow({mode:"open"});#t=new ResizeObserver((()=>this.render()));#F;#B;#N;#P;#R=!1;#I=!1;#U=0;#r=-1;#D=0;#$=!1;#W=!1;#j;#H=new WeakMap;#q=matchMedia("(prefers-color-scheme: dark)");#V;#X;#G;#K;constructor(){super(),this.#e.innerHTML='<style>\n        :host {\n            display: block;\n            container-type: size;\n        }\n        :host, #top {\n            box-sizing: border-box;\n            position: relative;\n            overflow: hidden;\n            width: 100%;\n            height: 100%;\n        }\n        #top {\n            height: 100%;\n            // --_gap: 7%;\n            background-color: var(--_background-color);\n            --_max-inline-size: 720px;\n            --_max-block-size: 1440px;\n            --_max-column-count: 2;\n            --_max-column-count-portrait: 1;\n            --_max-column-count-spread: var(--_max-column-count);\n            --_half-gap: calc(var(--_gap) / 2);\n            --_max-width: calc(var(--_max-inline-size) * var(--_max-column-count-spread));\n            --_max-height: var(--_max-block-size);\n            display: grid;\n            grid-template-columns:\n                minmax(var(--_half-gap), 1fr)\n                var(--_half-gap)\n                minmax(0, calc(var(--_max-width) - var(--_gap)))\n                var(--_half-gap)\n                minmax(var(--_half-gap), 1fr);\n            grid-template-rows:\n                var(--_top-margin)\n                1fr\n                var(--_bottom-margin);\n            &.vertical {\n                --_max-column-count-spread: var(--_max-column-count-portrait);\n                --_max-width: var(--_max-block-size);\n                --_max-height: calc(var(--_max-inline-size) * var(--_max-column-count-spread));\n            }\n            @container (orientation: portrait) {\n                & {\n                    --_max-column-count-spread: var(--_max-column-count-portrait);\n                }\n                &.vertical {\n                    --_max-column-count-spread: var(--_max-column-count);\n                }\n            }\n        }\n        #background {\n            grid-column: 1 / -1;\n            grid-row: 1 / -1;\n        }\n        #container {\n            grid-column: 1 / -1;\n            grid-row: 1 / -1;\n            overflow: hidden;\n            -ms-overflow-style: none;  /* Internet Explorer 10+ */\n            scrollbar-width: none;  /* Firefox */\n        }\n        #container::-webkit-scrollbar { \n            display: none;  /* Safari and Chrome */\n        }\n        :host([flow="scrolled"]) #container {\n            grid-column: 1 / -1;\n            grid-row: 2;\n            overflow: auto;\n        }\n        #header {\n            grid-column: 3 / 4;\n            grid-row: 1;\n        }\n        #footer {\n            grid-column: 3 / 4;\n            grid-row: 3;\n            align-self: end;\n        }\n        #header, #footer {\n            display: grid;\n            height: var(--_margin);\n        }\n        :is(#header, #footer) > * {\n            display: flex;\n            align-items: center;\n            min-width: 0;\n        }\n        :is(#header, #footer) > * > * {\n            width: 100%;\n            overflow: hidden;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            text-align: center;\n            font-size: .75em;\n            opacity: .6;\n        }\n        </style>\n        <div id="top">\n            <div id="background" part="filter"></div>\n            <div id="container"></div>\n        </div>\n        ',this.#F=this.#e.getElementById("top"),this.#B=this.#e.getElementById("background"),this.#N=this.#e.getElementById("container"),this.#t.observe(this.#N),this.#N.addEventListener("scroll",(e=>{let t;return(...n)=>{t&&clearTimeout(t),t=setTimeout((()=>{t=null,e(...n)}),50)}})((()=>{this.scrolled&&(this.#$?this.#$=!1:this.#J("scroll"))})));const e={passive:!1};this.addEventListener("touchstart",this.#Z.bind(this),e),this.addEventListener("touchmove",this.#Y.bind(this),e),this.addEventListener("touchend",this.#Q.bind(this)),this.addEventListener("load",(({detail:{doc:t}})=>{t.addEventListener("touchstart",this.#Z.bind(this),e),t.addEventListener("touchmove",this.#Y.bind(this),e),t.addEventListener("touchend",this.#Q.bind(this))})),this.#V=()=>{this.#P&&(this.#B.style.background=g(this.getAttribute("bgimg-url")))},this.#q.addEventListener("change",this.#V)}attributeChangedCallback(e,t,n){switch(e){case"flow":this.render();break;case"top-margin":case"max-block-size":case"background-color":this.#F.style.setProperty("--_"+e,n);break;case"bottom-margin":case"gap":case"max-column-count":case"max-inline-size":this.#F.style.setProperty("--_"+e,n),this.render()}}open(e){this.bookDir=e.dir,this.sections=e.sections}#ee(){return this.#P&&(this.#P.destroy(),this.#N.removeChild(this.#P.element)),this.#P=new w({container:this,onExpand:()=>this.scrollToAnchor(this.#D)}),this.#N.append(this.#P.element),this.#P}#te({vertical:e,rtl:t}){this.#R=e,this.#I=t,this.#F.classList.toggle("vertical",e),this.#B.style.background=g(this.getAttribute("bgimg-url"));const{width:n,height:i}=this.#N.getBoundingClientRect(),r=e?i:n,o=getComputedStyle(this.#F),a=parseFloat(o.getPropertyValue("--_max-inline-size")),s=parseInt(o.getPropertyValue("--_max-column-count")),l=parseFloat(o.getPropertyValue("--_top-margin"));this.#U=l;const c=parseFloat(o.getPropertyValue("--_gap"))/100,d=-c/(c-1)*r,h=parseFloat(o.getPropertyValue("--_top-margin")),u=parseFloat(o.getPropertyValue("--_bottom-margin")),f=this.getAttribute("flow");if("scrolled"===f){this.setAttribute("dir",e?"rtl":"ltr"),this.#F.style.padding="0";const t=a;return this.heads=null,this.feet=null,{flow:f,margin:l,gap:d,columnWidth:t,topMargin:h,bottomMargin:u}}const m=0==s?Math.min(2,Math.ceil(r/a)):s,w=r/m-d;this.setAttribute("dir",t?"rtl":"ltr");const b=e?Math.min(2,Math.ceil(n/a)):m,y=(this.bookDir,p(b,"head")),x=p(b,"foot");return this.heads=y.map((e=>e.children[0])),this.feet=x.map((e=>e.children[0])),{height:i,width:n,margin:l,gap:d,columnWidth:w,topMargin:h,bottomMargin:u}}render(){this.#P&&(this.#P.render(this.#te({vertical:this.#R,rtl:this.#I})),this.scrollToAnchor(this.#D))}get scrolled(){return"scrolled"===this.getAttribute("flow")}get scrollProp(){const{scrolled:e}=this;return this.#R?e?"scrollLeft":"scrollTop":e?"scrollTop":"scrollLeft"}get sideProp(){const{scrolled:e}=this;return this.#R?e?"width":"height":e?"height":"width"}get size(){return this.#N.getBoundingClientRect()[this.sideProp]}get viewSize(){return this.#P.element.getBoundingClientRect()[this.sideProp]}get start(){return Math.abs(this.#N[this.scrollProp])}get end(){return this.start+this.size}get page(){return Math.floor((this.start+this.end)/2/this.size)}get pages(){return Math.round(this.viewSize/this.size)}scrollBy(e,t){const n=this.#R?t:e,i=this.#N,{scrollProp:r}=this,[o,a,s]=this.#X,l=this.#I,c=l?o-s:o-a,d=l?o+a:o+s;i[r]=Math.max(c,Math.min(d,i[r]+n))}snap(e,t){const n=this.#R?t:e,[i,r,o]=this.#X,{start:a,end:s,pages:l,size:c}=this,d=Math.abs(i)-r,h=Math.abs(i)+o,u=n*(this.#I?-c:c),f=Math.floor(Math.max(d,Math.min(h,(a+s)/2+(isNaN(u)?0:u)))/c);this.#ne(f,"snap").then((()=>{const e=f<=0?-1:f>=l-1?1:null;if(e)return this.#ie({index:this.#re(e),anchor:e<0?()=>1:()=>0})}))}#Z(e){const t=e.changedTouches[0];this.#G={x:t?.screenX,y:t?.screenY,t:e.timeStamp,vx:0,xy:0}}#Y(e){if(window.getSelection()?.toString())return;const t=this.#G;t&&(t.pinched||(t.pinched=globalThis.visualViewport.scale>1,this.scrolled||t.pinched||(e.touches.length>1?this.#K&&e.preventDefault():(e.preventDefault(),t.animationFrameId||(t.animationFrameId=requestAnimationFrame((()=>{const n=e.changedTouches[0],i=n.screenX,r=n.screenY,o=t.x-i,a=t.y-r,s=e.timeStamp-t.t||16.7,l=.85*o,c=.85*a;t.x=i,t.y=r,t.t=e.timeStamp,t.vx=o/s,t.vy=a/s,this.#K=!0,this.scrollBy(l,c),t.animationFrameId=null})))))))}#Q(){this.#K=!1,this.scrolled||requestAnimationFrame((()=>{1===globalThis.visualViewport.scale&&this.snap(this.#G.vx,this.#G.vy)}))}#oe(){if(this.scrolled){const e=this.viewSize,t=this.#U;return this.#R?({left:n,right:i})=>({left:e-i-t,right:e-n-t}):({top:e,bottom:n})=>({left:e+t,right:n+t})}const e=this.pages*this.size;return this.#I?({left:t,right:n})=>({left:e-n,right:e-t}):this.#R?({top:e,bottom:t})=>({left:e,right:t}):e=>e}async#ae(e,t){if(this.scrolled){const n=this.#oe()(e).left-this.#U;return this.#se(n,t)}const n=this.#oe()(e).left+this.#U/2;return this.#ne(Math.floor(n/this.size)+(this.#I?-1:1),t)}async#se(e,t,n){const r=this.#N,{scrollProp:o,size:a}=this;if(Math.abs(r[o]-e)<1)return this.#X=[e,this.atStart?0:a,this.atEnd?0:a],void this.#J(t);if(this.scrolled&&this.#R&&(e=-e),("snap"===t||n)&&this.hasAttribute("animated")){const n=Math.abs(r[o]-e),u=300,f=Math.min(500,Math.max(200,u*(n/a))),g=e=>1-Math.pow(1-e,3);return this.#$=!0,(s=r[o],l=e,c=f,d=g,h=e=>r[o]=e,new Promise((e=>{let t;const n=i=>{t??=i;const r=Math.min(1,(i-t)/c);var o,a;h((o=s,a=l,d(r)*(a-o)+o)),r<1?requestAnimationFrame(n):e()};requestAnimationFrame(n)}))).then((()=>(r[o]=e,this.#X=[e,this.atStart?0:a,this.atEnd?0:a],i(10).then((()=>{this.#J(t)})))))}var s,l,c,d,h;r[o]=e,this.#X=[e,this.atStart?0:a,this.atEnd?0:a],this.#J(t)}async#ne(e,t,n){const i=this.size*(this.#I?-e:e);return this.#se(i,t,n)}async scrollToAnchor(e,t){this.#D=e;const n=(e=>{if(!e?.collapsed)return e;const{endOffset:t,endContainer:n}=e;if(1===n.nodeType)return n;if(t+1<n.length)e.setEnd(n,t+1);else{if(!(t>1))return n.parentNode;e.setStart(n,t-1)}return e})(e)?.getClientRects?.();if(n){const e=Array.from(n).find((e=>e.width>0&&e.height>0))||n[0];if(!e)return;return await this.#ae(e,"anchor"),void(t&&this.#le())}if(this.scrolled)return void await this.#se(e*this.viewSize,"anchor");const{pages:i}=this;if(!i)return;const r=i-2,o=Math.round(e*(r-1));await this.#ne(o+1,"anchor")}#le(){const{defaultView:e}=this.#P.document;if(this.#D.startContainer){const t=e.getSelection();t.removeAllRanges(),t.addRange(this.#D)}}#ce(){if(this.scrolled)return f(this.#P.document,this.start+this.#U,this.end-this.#U,this.#oe());const e=this.#I?-this.size:this.size;return f(this.#P.document,this.start-e,this.end-e,this.#oe())}#J(e){const t=this.#ce();"anchor"!==e?this.#D=t:this.#$=!0;const n={reason:e,range:t,index:this.#r};if(this.scrolled)n.fraction=this.start/this.viewSize;else if(this.pages>0){const{page:e,pages:t}=this;n.fraction=(e-1)/(t-2),n.size=1/(t-2)}this.dispatchEvent(new CustomEvent("relocate",{detail:n}))}async#de(e){const{index:t,src:n,anchor:i,onLoad:r,select:o}=await e;if(this.#r=t,n){const e=this.#ee(),i=e=>{if(e.head){const t=e.createElement("style");e.head.prepend(t);const n=e.createElement("style");e.head.append(n),this.#H.set(e,[t,n])}r?.({doc:e,index:t})},o=this.#te.bind(this);await e.load(n,i,o),this.dispatchEvent(new CustomEvent("create-overlayer",{detail:{doc:e.document,index:t,attach:t=>e.overlayer=t}})),this.#P=e}await this.scrollToAnchor(("function"==typeof i?i(this.#P.document):i)??0,o)}#he(e){return e>=0&&e<=this.sections.length-1}async#ie({index:e,anchor:t,select:n}){if(e===this.#r)await this.#de({index:e,anchor:t,select:n});else{const i=this.#r,r=e=>{this.sections[i]?.unload?.(),this.setStyles(this.#j),this.dispatchEvent(new CustomEvent("load",{detail:e}))};await this.#de(Promise.resolve(this.sections[e].load()).then((i=>({index:e,src:i,anchor:t,onLoad:r,select:n}))).catch((t=>(console.warn(t),console.warn(new Error(`Failed to load section ${e}`)),{}))))}}async goTo(e){if(this.#W)return;const t=await e;return this.#he(t.index)?this.#ie(t):void 0}#ue(e){if(!this.#P)return!0;if(this.scrolled)return!(this.start>0)||this.#se(Math.max(0,this.start-(e??this.size)),null,!0);if(this.atStart)return;const t=this.page-1;return this.#ne(t,"page",!0).then((()=>t<=0))}#fe(e){if(!this.#P)return!0;if(this.scrolled)return!(this.viewSize-this.end>2)||this.#se(Math.min(this.viewSize,e?this.start+e:this.end),null,!0);if(this.atEnd)return;const t=this.page+1,n=this.pages;return this.#ne(t,"page",!0).then((()=>t>=n-1))}get atStart(){return null==this.#re(-1)&&this.page<=1}get atEnd(){return null==this.#re(1)&&this.page>=this.pages-2}#re(e){for(let t=this.#r+e;this.#he(t);t+=e)if("no"!==this.sections[t]?.linear)return t}async#ge(e,t){this.#W=!0;const n=-1===e,r=await(n?this.#ue(t):this.#fe(t));r&&await this.#ie({index:this.#re(e),anchor:n?()=>1:()=>0}),!r&&this.hasAttribute("animated")||await i(100),this.#W=!1}prev(e){return this.#ge(-1,e)}next(e){return this.#ge(1,e)}prevSection(){return this.goTo({index:this.#re(-1)})}nextSection(){return this.goTo({index:this.#re(1)})}firstSection(){const e=this.sections.findIndex((e=>"no"!==e.linear));return this.goTo({index:e})}lastSection(){const e=this.sections.findLastIndex((e=>"no"!==e.linear));return this.goTo({index:e})}getContents(){return this.#P?[{index:this.#r,overlayer:this.#P.overlayer,doc:this.#P.document}]:[]}setStyles(e){this.#j=e;const t=this.#H.get(this.#P?.document);if(!t)return;const[n,i]=t;if(Array.isArray(e)){const[t,r]=e;n.textContent=t,i.textContent=r}else i.textContent=e;this.#B.style.background=g(this.getAttribute("bgimg-url")),this.#P?.document?.fonts?.ready?.then((()=>this.#P.expand()))}destroy(){this.#t.unobserve(this),this.#P.destroy(),this.#P=null,this.sections[this.#r]?.unload?.(),this.#q.removeEventListener("change",this.#V)}}customElements.define("foliate-paginator",b)},619:(e,t,n)=>{n.a(e,(async(e,t)=>{try{var i=n(986),r=n(949),o=n(339),a=n(196);const{TTS:e}=await Promise.resolve().then(n.bind(n,977)),s="foliate-search:";class l extends EventTarget{#pe=[];#r=-1;pushState(e){const t=this.#pe[this.#r];t===e||t?.fraction&&t.fraction===e.fraction||(this.#pe[++this.#r]=e,this.#pe.length=this.#r+1,this.dispatchEvent(new Event("index-change")),this.dispatchEvent(new CustomEvent("pushstate",{detail:e})))}replaceState(e){const t=this.#r;this.#pe[t]=e}back(){const e=this.#r;if(e<=0)return;const t={state:this.#pe[e-1]};this.#r=e-1,this.dispatchEvent(new CustomEvent("popstate",{detail:t})),this.dispatchEvent(new Event("index-change"))}forward(){const e=this.#r;if(e>=this.#pe.length-1)return;const t={state:this.#pe[e+1]};this.#r=e+1,this.dispatchEvent(new CustomEvent("popstate",{detail:t})),this.dispatchEvent(new Event("index-change"))}get canGoBack(){return this.#r>0}get canGoForward(){return this.#r<this.#pe.length-1}clear(){this.#pe=[],this.#r=-1}}const c=e=>{if(!e)return{};try{const t=Intl.getCanonicalLocales(e)[0]??"en",n=new Intl.Locale(t),i=["zh","ja","kr"].includes(n.language),r=(n.getTextInfo?.()??n.textInfo)?.direction;return{canonical:t,locale:n,isCJK:i,direction:r}}catch(e){return console.warn(e),{}}};class d extends HTMLElement{#e=this.attachShadow({mode:"open"});#me;#we;#be;#ye=new Map;#r;isFixedLayout=!1;lastLocation;history=new l;constructor(){super(),this.history.addEventListener("popstate",(({detail:e})=>{const t=this.resolveNavigation(e.state);this.renderer.goTo(t)}))}async open(e){if(this.book=e,this.language=c(e.metadata?.language),e.splitTOCHref&&e.getTOCFragment){const t=e.sections.map((e=>e.id));this.#me=new r.r(e.sections,1500,1600);const n=e.splitTOCHref.bind(e),i=e.getTOCFragment.bind(e);this.#we=new r.k,await this.#we.init({toc:e.toc??[],ids:t,splitHref:n,getFragment:i}),this.#be=new r.k,await this.#be.init({toc:e.pageList??[],ids:t,splitHref:n,getFragment:i})}if(this.isFixedLayout="pre-paginated"===this.book.rendition?.layout,this.isFixedLayout?(await Promise.resolve().then(n.bind(n,113)),this.renderer=document.createElement("foliate-fxl")):(await Promise.resolve().then(n.bind(n,587)),this.renderer=document.createElement("foliate-paginator")),this.renderer.setAttribute("exportparts","head,foot,filter"),this.renderer.addEventListener("load",(e=>this.#v(e.detail))),this.renderer.addEventListener("relocate",(e=>this.#k(e.detail))),this.renderer.addEventListener("create-overlayer",(e=>e.detail.attach(this.#xe(e.detail)))),this.renderer.open(e),this.#e.append(this.renderer),e.sections.some((e=>e.mediaOverlay))){e.media.activeClass||="-epub-media-overlay-active";const t=e.media.activeClass;let n;this.mediaOverlay=e.getMediaOverlay(),this.mediaOverlay.addEventListener("highlight",(e=>{const i=this.resolveNavigation(e.detail.text);this.renderer.goTo(i).then((()=>{const{doc:e}=this.renderer.getContents().find((e=>e.index=i.index)),r=i.anchor(e);r.classList.add(t),n=new WeakRef(r)}))})),this.mediaOverlay.addEventListener("unhighlight",(()=>{n?.deref()?.classList?.remove(t)}))}}close(){this.renderer?.destroy(),this.renderer?.remove(),this.#me=null,this.#we=null,this.#be=null,this.#ye=new Map,this.lastLocation=null,this.history.clear(),this.tts=null,this.mediaOverlay=null}goToTextStart(){return this.goTo(this.book.landmarks?.find((e=>e.type.includes("bodymatter")||e.type.includes("text")))?.href??this.book.sections.findIndex((e=>"no"!==e.linear)))}async init({lastLocation:e,showTextStart:t}){const n=e?this.resolveNavigation(e):null;n?(await this.renderer.goTo(n),this.history.pushState(e)):t?await this.goToTextStart():(this.history.pushState(0),await this.next())}#ve(e,t,n){return this.dispatchEvent(new CustomEvent(e,{detail:t,cancelable:n}))}#k({reason:e,range:t,index:n,fraction:i,size:r}){this.#r=n;const o=this.#me?.getProgress(n,i,r)??{},a=this.#we?.getProgress(n,t),s=this.#be?.getProgress(n,t),l=this.getCFI(n,t),c=this.renderer.pages?this.renderer.pages-2:o.section.total,d={current:this.renderer.page??o.section.current,total:c};this.lastLocation={...o,tocItem:a,pageItem:s,cfi:l,range:t,chapterLocation:d},"snap"!==e&&"page"!==e&&"scroll"!==e||this.history.replaceState(l),this.#ve("relocate",this.lastLocation)}#v({doc:e,index:t}){e.documentElement.lang||=this.language.canonical??"",this.language.isCJK||(e.documentElement.dir||=this.language.direction??""),this.#ke(e,t),this.#Se(e),this.#_e(e),this.#ve("load",{doc:e,index:t})}#ke(e,t){const{book:n}=this,i=n.sections[t];for(const t of e.querySelectorAll("a[href]"))t.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation();const r=t.getAttribute("href"),o=i?.resolveHref?.(r)??r;n?.isExternal?.(o)?Promise.resolve(this.#ve("external-link",{a:t,href:o},!0)).then((e=>e?globalThis.open(o,"_blank"):null)).catch((e=>console.error(e))):Promise.resolve(this.#ve("link",{a:t,href:o},!0)).then((e=>e?this.goTo(o):null)).catch((e=>console.error(e)))}))}#_e(e){for(const t of e.querySelectorAll("img"))t.closest("a[href]")||t.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.#ve("click-image",{img:t})}))}#Se(e){e.addEventListener("click",(t=>{if(window.isFootNoteOpen())return void window.closeFootNote();if("Range"===e.getSelection().type)return;const n=e.position,i=e.scale;let{clientX:r,clientY:o}=t;const a=this.renderer.getAttribute("top-margin").match(/\d+/)[0];if(o+=parseInt(a),n){r*=i,o*=i;const t=e.documentElement.getBoundingClientRect().width*i;return"right"===n&&t<2.2*window.innerWidth&&(r+=.5*window.innerWidth),void this.#ve("click-view",{x:r,y:o})}"scrollLeft"==this.renderer.scrollProp?r-=this.renderer.start-this.renderer.size:o-=this.renderer.start,this.#ve("click-view",{x:r,y:o})})),this.renderer.addEventListener("click",(e=>{const{clientX:t,clientY:n}=e;for(;t>window.innerWidth;)t-=window.innerWidth;this.#ve("click-view",{x:t,y:n})}))}async addAnnotation(e,t){const{value:n}=e;if(n.startsWith(s)){const e=n.replace(s,""),{index:i,anchor:r}=await this.resolveNavigation(e),a=this.#Ae(i);if(a){const{overlayer:e,doc:i}=a;if(t)return void e.remove(n);const s=i?r(i):r;e.add(n,s,o.u.outline,{color:"#39c5bbaa"})}return}const{index:i,anchor:r}=await this.resolveNavigation(n),a=this.#Ae(i);if(a){const{overlayer:i,doc:o}=a;if(i.remove(n),!t){const t=o?r(o):r,a=(e,r)=>i.add(n,t,e,r);this.#ve("draw-annotation",{draw:a,annotation:e,doc:o,range:t})}}return{index:i,label:this.#we.getProgress(i)?.label??""}}deleteAnnotation(e){return this.addAnnotation(e,!0)}#Ae(e){return this.renderer.getContents().find((t=>t.index===e&&t.overlayer))}#xe({doc:e,index:t}){const n=new o.u;e.addEventListener("click",(e=>{const[i,r]=n.hitTest(e);i&&!i.startsWith(s)&&(e.preventDefault(),e.stopPropagation(),this.#ve("show-annotation",{value:i,index:t,range:r}))}),!0);const i=this.#ye.get(t);if(i)for(const e of i)this.addAnnotation(e);return this.#ve("create-overlay",{index:t}),n}async showAnnotation(e){const{value:t}=e,n=await this.goTo(t);if(n){const{index:e,anchor:i}=n,{doc:r}=this.#Ae(e),o=i(r);this.#ve("show-annotation",{value:t,index:e,range:o})}}getCFI(e,t){const n=this.book.sections[e].cfi??i.EL.fromIndex(e);return t?i.RK(n,i.yT(t)):n}resolveCFI(e){if(this.book.resolveCFI)return this.book.resolveCFI(e);{const t=i.qg(e);return{index:i.EL.toIndex((t.parent??t).shift()),anchor:e=>i.Xp(e,t)}}}resolveNavigation(e){try{if("number"==typeof e)return{index:e};if("number"==typeof e.fraction){const[t,n]=this.#me.getSection(e.fraction);return{index:t,anchor:n}}return i.Lu.test(e)?this.resolveCFI(e):this.book.resolveHref(e)}catch(t){console.error(t),console.error(`Could not resolve target ${e}`)}}async goTo(e){const t=this.resolveNavigation(e);try{return await this.renderer.goTo(t),this.history.pushState(e),t}catch(t){console.error(t),console.error(`Could not go to ${e}`)}}async goToFraction(e){const[t,n]=this.#me.getSection(e);await this.renderer.goTo({index:t,anchor:n}),this.history.pushState({fraction:e})}async select(e){try{const t=await this.resolveNavigation(e);await this.renderer.goTo({...t,select:!0}),this.history.pushState(e)}catch(t){console.error(t),console.error(`Could not go to ${e}`)}}deselect(){for(const{doc:e}of this.renderer.getContents())e.defaultView.getSelection().removeAllRanges()}getSectionFractions(){return(this.#me?.sectionFractions??[]).map((e=>e+Number.EPSILON))}getProgressOf(e,t){const n=this.#we?.getProgress(e,t),i=this.#be?.getProgress(e,t);return{tocItem:n,pageItem:i}}async getTOCItemOf(e){try{const{index:t,anchor:n}=await this.resolveNavigation(e),i=await this.book.sections[t].createDocument(),r=n(i),o=r instanceof Range,a=o?r:i.createRange();return o||a.selectNodeContents(r),this.#we.getProgress(t,a)}catch(t){console.error(t),console.error(`Could not get ${e}`)}}async prev(e){await this.renderer.prev(e)}async next(e){await this.renderer.next(e)}goLeft(){return"rtl"===this.book.dir?this.next():this.prev()}goRight(){return"rtl"===this.book.dir?this.prev():this.next()}async*#Le(e,t,n){const i=await this.book.sections[n].createDocument();for(const{range:r,excerpt:o}of e(i,t))yield{cfi:this.getCFI(n,r),excerpt:o}}async*#Te(e,t){const{sections:n}=this.book;for(const[i,{createDocument:r}]of n.entries()){if(!r)continue;const o=await r(),a=Array.from(e(o,t),(({range:e,excerpt:t})=>({cfi:this.getCFI(i,e),excerpt:t}))),s=(i+1)/n.length;yield{progress:s},a.length&&(yield{index:i,subitems:a})}}async*search(e){console.log("search",e),this.clearSearch();const{searchMatcher:t}=await Promise.resolve().then(n.bind(n,262)),{query:i,index:r}=e,o=t(a.u,{defaultLocale:this.language,...e}),l=null!=r?this.#Le(o,i,r):this.#Te(o,i),c=[];this.#ye.set(r,c);for await(const e of l)if(e.subitems){const t=e.subitems.map((({cfi:e})=>({value:s+e})));this.#ye.set(e.index,t);for(const e of t)this.addAnnotation(e);yield{label:this.#we.getProgress(e.index)?.label??"",subitems:e.subitems}}else{if(e.cfi){const t={value:s+e.cfi};c.push(t),this.addAnnotation(t)}yield e}yield"done"}clearSearch(){for(const e of this.#ye.values())for(const t of e)this.deleteAnnotation(t);this.#ye.clear()}oldValue=null;initTTS(t){if(t)return this.#Ae(this.#r)?.overlayer.remove(this.oldValue);const n=this.renderer.getContents()[0].doc;this.tts&&this.tts.doc===n||(this.tts=new e(n,a.u,(e=>{const t=this.#Ae(this.#r);if(t){const{overlayer:n}=t;this.oldValue&&n.remove(this.oldValue);const i=this.getCFI(this.#r,e);n.add(i,e,o.u.squiggly,{color:"#39c5bb"}),this.oldValue=i}this.renderer.scrollToAnchor(e)})))}startMediaOverlay(){const{index:e}=this.renderer.getContents()[0];return this.mediaOverlay.start(e)}}customElements.define("foliate-view",d),t()}catch(e){t(e)}}),1)},759:(e,t,n)=>{n.d(t,{MOBI:()=>F,isMOBI:()=>z});const i=e=>{if(!e)return"";const t=document.createElement("textarea");return t.innerHTML=e,t.value},r={XML:"application/xml",XHTML:"application/xhtml+xml",HTML:"text/html",CSS:"text/css",SVG:"image/svg+xml"},o={name:[0,32,"string"],type:[60,4,"string"],creator:[64,4,"string"],numRecords:[76,2,"uint"]},a={compression:[0,2,"uint"],numTextRecords:[8,2,"uint"],recordSize:[10,2,"uint"],encryption:[12,2,"uint"]},s={magic:[16,4,"string"],length:[20,4,"uint"],type:[24,4,"uint"],encoding:[28,4,"uint"],uid:[32,4,"uint"],version:[36,4,"uint"],titleOffset:[84,4,"uint"],titleLength:[88,4,"uint"],localeRegion:[94,1,"uint"],localeLanguage:[95,1,"uint"],resourceStart:[108,4,"uint"],huffcdic:[112,4,"uint"],numHuffcdic:[116,4,"uint"],exthFlag:[128,4,"uint"],trailingFlags:[240,4,"uint"],indx:[244,4,"uint"]},l={resourceStart:[108,4,"uint"],fdst:[192,4,"uint"],numFdst:[196,4,"uint"],frag:[248,4,"uint"],skel:[252,4,"uint"],guide:[260,4,"uint"]},c={magic:[0,4,"string"],length:[4,4,"uint"],count:[8,4,"uint"]},d={magic:[0,4,"string"],length:[4,4,"uint"],type:[8,4,"uint"],idxt:[20,4,"uint"],numRecords:[24,4,"uint"],encoding:[28,4,"uint"],language:[32,4,"uint"],total:[36,4,"uint"],ordt:[40,4,"uint"],ligt:[44,4,"uint"],numLigt:[48,4,"uint"],numCncx:[52,4,"uint"]},h={magic:[0,4,"string"],length:[4,4,"uint"],numControlBytes:[8,4,"uint"]},u={magic:[0,4,"string"],offset1:[8,4,"uint"],offset2:[12,4,"uint"]},f={magic:[0,4,"string"],length:[4,4,"uint"],numEntries:[8,4,"uint"],codeLength:[12,4,"uint"]},g={magic:[0,4,"string"],numEntries:[8,4,"uint"]},p={flags:[8,4,"uint"],dataStart:[12,4,"uint"],keyLength:[16,4,"uint"],keyStart:[20,4,"uint"]},m={1252:"windows-1252",65001:"utf-8"},w={100:["creator","string",!0],101:["publisher"],103:["description"],104:["isbn"],105:["subject","string",!0],106:["date"],108:["contributor","string",!0],109:["rights"],110:["subjectCode","string",!0],112:["source","string",!0],113:["asin"],121:["boundary","uint"],122:["fixedLayout"],125:["numResources","uint"],126:["originalResolution"],127:["zeroGutter"],128:["zeroMargin"],129:["coverURI"],132:["regionMagnification"],201:["coverOffset","uint"],202:["thumbnailOffset","uint"],503:["title"],524:["language","string",!0],527:["pageProgressionDirection"]},b={1:["ar","ar-SA","ar-IQ","ar-EG","ar-LY","ar-DZ","ar-MA","ar-TN","ar-OM","ar-YE","ar-SY","ar-JO","ar-LB","ar-KW","ar-AE","ar-BH","ar-QA"],2:["bg"],3:["ca"],4:["zh","zh-TW","zh-CN","zh-HK","zh-SG"],5:["cs"],6:["da"],7:["de","de-DE","de-CH","de-AT","de-LU","de-LI"],8:["el"],9:["en","en-US","en-GB","en-AU","en-CA","en-NZ","en-IE","en-ZA","en-JM",null,"en-BZ","en-TT","en-ZW","en-PH"],10:["es","es-ES","es-MX",null,"es-GT","es-CR","es-PA","es-DO","es-VE","es-CO","es-PE","es-AR","es-EC","es-CL","es-UY","es-PY","es-BO","es-SV","es-HN","es-NI","es-PR"],11:["fi"],12:["fr","fr-FR","fr-BE","fr-CA","fr-CH","fr-LU","fr-MC"],13:["he"],14:["hu"],15:["is"],16:["it","it-IT","it-CH"],17:["ja"],18:["ko"],19:["nl","nl-NL","nl-BE"],20:["no","nb","nn"],21:["pl"],22:["pt","pt-BR","pt-PT"],23:["rm"],24:["ro"],25:["ru"],26:["hr",null,"sr"],27:["sk"],28:["sq"],29:["sv","sv-SE","sv-FI"],30:["th"],31:["tr"],32:["ur"],33:["id"],34:["uk"],35:["be"],36:["sl"],37:["et"],38:["lv"],39:["lt"],41:["fa"],42:["vi"],43:["hy"],44:["az"],45:["eu"],46:["hsb"],47:["mk"],48:["st"],49:["ts"],50:["tn"],52:["xh"],53:["zu"],54:["af"],55:["ka"],56:["fo"],57:["hi"],58:["mt"],59:["se"],62:["ms"],63:["kk"],65:["sw"],67:["uz",null,"uz-UZ"],68:["tt"],69:["bn"],70:["pa"],71:["gu"],72:["or"],73:["ta"],74:["te"],75:["kn"],76:["ml"],77:["as"],78:["mr"],79:["sa"],82:["cy","cy-GB"],83:["gl","gl-ES"],87:["kok"],97:["ne"],98:["fy"]},y=(e,t)=>{const n=new e.constructor(e.length+t.length);return n.set(e),n.set(t,e.length),n},x=(e,t,n)=>{const i=new e.constructor(e.length+t.length+n.length);return i.set(e),i.set(t,e.length),i.set(n,e.length+t.length),i},v=new TextDecoder,k=e=>v.decode(e),S=e=>{if(!e)return;const t=e.byteLength,n=4===t?"getUint32":2===t?"getUint16":"getUint8";return new DataView(e)[n](0)},_=(e,t)=>Object.fromEntries(Array.from(Object.entries(e)).map((([e,[n,i,r]])=>[e,("string"===r?k:S)(t.slice(n,n+i))]))),A=e=>new TextDecoder(m[e]),L=(e,t=0)=>{let n=0,i=0;for(const r of e.subarray(t,t+4))if(n=n<<7|(127&r)>>>0,i++,128&r)break;return{value:n,length:i}},T=e=>{let t=0;for(const n of e.subarray(-4))128&n&&(t=0),t=t<<7|127&n;return t},E=e=>{let t=0;for(;e>0;e>>=1)1&~e||t++;return t},C=e=>{let t=0;for(;!(1&e);)e>>=1,t++;return t},R=e=>{let t=[];for(let n=0;n<e.length;n++){const i=e[n];if(0===i)t.push(0);else if(i<=8)for(const r of e.subarray(n+1,(n+=i)+1))t.push(r);else if(i<=127)t.push(i);else if(i<=191){const r=i<<8|e[1+n++],o=(16383&r)>>>3,a=3+(7&r);for(let e=0;e<a;e++)t.push(t[t.length-o])}else t.push(32,128^i)}return Uint8Array.from(t)},I=(e,t)=>{const n=t+32,i=n>>3;let r=0n;for(let n=t>>3;n<=i;n++)r=r<<8n|BigInt(e[n]??0);return r>>8n-BigInt(7&n)&0xffffffffn},M=async(e,t)=>{const n=await t(e),i=_(d,n);if("INDX"!==i.magic)throw new Error("Invalid INDX record");const r=A(i.encoding),o=n.slice(i.length),a=_(h,o);if("TAGX"!==a.magic)throw new Error("Invalid TAGX section");const s=(a.length-12)/4,l=Array.from({length:s},((e,t)=>new Uint8Array(o.slice(12+4*t,12+4*t+4)))),c={};let u=0;for(let n=0;n<i.numCncx;n++){const o=await t(e+i.numRecords+n+1),a=new Uint8Array(o);for(let e=0;e<a.byteLength;){const t=e,{value:n,length:i}=L(a,e);e+=i;const s=o.slice(e,e+n);e+=n,c[u+t]=r.decode(s)}u+=65536}const f=[];for(let n=0;n<i.numRecords;n++){const i=await t(e+1+n),r=new Uint8Array(i),o=_(d,i);if("INDX"!==o.magic)throw new Error("Invalid INDX record");for(let e=0;e<o.numRecords;e++){const t=o.idxt+4+2*e,n=S(i.slice(t,t+2)),s=S(i.slice(n,n+1)),c=k(i.slice(n+1,n+1+s)),d=[],h=n+1+s;let u=0,g=h+a.numControlBytes;for(const[e,t,n,o]of l){if(1&o){u++;continue}const a=h+u,s=S(i.slice(a,a+1))&n;if(s===n)if(E(n)>1){const{value:n,length:i}=L(r,g);d.push([e,null,n,t]),g+=i}else d.push([e,1,null,t]);else d.push([e,s>>C(n),null,t])}const p={};for(const[e,t,n,i]of d){const o=[];if(null!=t)for(let e=0;e<t*i;e++){const{value:e,length:t}=L(r,g);o.push(e),g+=t}else{let e=0;for(;e<n;){const{value:t,length:n}=L(r,g);o.push(t),g+=n,e+=n}}p[e]=o}f.push({name:c,tagMap:p})}}return{table:f,cncx:c}},z=async e=>"BOOKMOBI"===k(await e.slice(60,68).arrayBuffer());class O{#Ee;#Ce;pdb;async open(e){this.#Ee=e;const t=_(o,await e.slice(0,78).arrayBuffer());this.pdb=t;const n=await e.slice(78,78+8*t.numRecords).arrayBuffer();this.#Ce=Array.from({length:t.numRecords},((e,t)=>S(n.slice(8*t,8*t+4)))).map(((e,t,n)=>[e,n[t+1]]))}loadRecord(e){const t=this.#Ce[e];if(!t)throw new RangeError("Record index out of bounds");return this.#Ee.slice(...t).arrayBuffer()}async loadMagic(e){const t=this.#Ce[e][0];return k(await this.#Ee.slice(t,t+4).arrayBuffer())}}class F extends O{#Re=0;#Ie;#Me;#ze;#Oe;#Fe;constructor({unzlib:e}){super(),this.unzlib=e}async open(e){await super.open(e),this.headers=this.#Be(await super.loadRecord(0)),this.#Ie=this.headers.mobi.resourceStart;let t=this.headers.mobi.version>=8;if(!t){const e=this.headers.exth?.boundary;if(e<4294967295)try{this.headers=this.#Be(await super.loadRecord(e)),this.#Re=e,t=!0}catch(e){console.warn(e),console.warn("Failed to open KF8; falling back to MOBI")}}return await this.#Ne(),t?new q(this).init():new P(this).init()}#Be(e){const t=_(a,e),n=_(s,e);if("MOBI"!==n.magic)throw new Error("Missing MOBI header");const{titleOffset:i,titleLength:r,localeLanguage:o,localeRegion:d}=n;n.title=e.slice(i,i+r);const h=b[o];n.language=h?.[d>>2]??h?.[0];const u=64&n.exthFlag?((e,t)=>{const{magic:n,count:i}=_(c,e);if("EXTH"!==n)throw new Error("Invalid EXTH header");const r=A(t),o={};let a=12;for(let t=0;t<i;t++){const t=S(e.slice(a,a+4)),n=S(e.slice(a+4,a+8));if(t in w){const[i,s,l]=w[t],c=e.slice(a+8,a+n),d="uint"===s?S(c):r.decode(c);l?(o[i]??=[],o[i].push(d)):o[i]=d}a+=n}return o})(e.slice(n.length+16),n.encoding):null;return{palmdoc:t,mobi:n,exth:u,kf8:n.version>=8?_(l,e):null}}async#Ne(){const{palmdoc:e,mobi:t}=this.headers;this.#Me=A(t.encoding),this.#ze=new TextEncoder;const{compression:n}=e;if(this.#Oe=1===n?e=>e:2===n?R:17480===n?await(async(e,t)=>{const n=await t(e.huffcdic),{magic:i,offset1:r,offset2:o}=_(u,n);if("HUFF"!==i)throw new Error("Invalid HUFF record");const a=Array.from({length:256},((e,t)=>r+4*t)).map((e=>S(n.slice(e,e+4)))).map((e=>[128&e,31&e,e>>>8])),s=[null].concat(Array.from({length:32},((e,t)=>o+8*t)).map((e=>[S(n.slice(e,e+4)),S(n.slice(e+4,e+8))]))),l=[];for(let n=1;n<e.numHuffcdic;n++){const i=await t(e.huffcdic+n),r=_(f,i);if("CDIC"!==r.magic)throw new Error("Invalid CDIC record");const o=Math.min(1<<r.codeLength,r.numEntries-l.length),a=i.slice(r.length);for(let e=0;e<o;e++){const t=S(a.slice(2*e,2*e+2)),n=S(a.slice(t,t+2)),i=32767&n,r=32768&n,o=new Uint8Array(a.slice(t+2,t+2+i));l.push([o,r])}}const c=e=>{let t=new Uint8Array;const n=8*e.byteLength;for(let i=0;i<n;){const r=Number(I(e,i));let[o,d,h]=a[r>>>24];if(!o){for(;r>>>32-d<s[d][0];)d+=1;h=s[d][1]}if((i+=d)>n)break;const u=h-(r>>>32-d);let[f,g]=l[u];g||(f=c(f),l[u]=[f,!0]),t=y(t,f)}return t};return c})(t,this.loadRecord.bind(this)):null,!this.#Oe)throw new Error("Unknown compression type");const{trailingFlags:i}=t,r=1&i,o=E(i>>>1);this.#Fe=e=>{for(let t=0;t<o;t++){const t=T(e);e=e.subarray(0,-t)}if(r){const t=1+(3&e[e.length-1]);e=e.subarray(0,-t)}return e}}decode(...e){return this.#Me.decode(...e)}encode(...e){return this.#ze.encode(...e)}loadRecord(e){return super.loadRecord(this.#Re+e)}loadMagic(e){return super.loadMagic(this.#Re+e)}loadText(e){return this.loadRecord(e+1).then((e=>new Uint8Array(e))).then(this.#Fe).then(this.#Oe)}async loadResource(e){const t=await super.loadRecord(this.#Ie+e),n=k(t.slice(0,4));return"FONT"===n?(async(e,t)=>{const{flags:n,dataStart:i,keyLength:r,keyStart:o}=_(p,e),a=new Uint8Array(e.slice(i));if(2&n){const t=16===r?1024:1040,n=new Uint8Array(e.slice(o,o+r)),i=Math.min(t,a.length);for(var s=0;s<i;s++)a[s]=a[s]^n[s%n.length]}if(1&n)try{return await t(a)}catch(e){console.warn(e),console.warn("Failed to decompress font")}return a})(t,this.unzlib):"VIDE"===n||"AUDI"===n?t.slice(12):t}getNCX(){const e=this.headers.mobi.indx;if(e<4294967295)return(async(e,t)=>{const{table:n,cncx:i}=await M(e,t),r=n.map((({tagMap:e},t)=>({index:t,offset:e[1]?.[0],size:e[2]?.[0],label:i[e[3]]??"",headingLevel:e[4]?.[0],pos:e[6],parent:e[21]?.[0],firstChild:e[22]?.[0],lastChild:e[23]?.[0]}))),o=e=>(null==e.firstChild||(e.children=r.filter((t=>t.parent===e.index)).map(o)),e);return r.filter((e=>0===e.headingLevel)).map(o)})(e,this.loadRecord.bind(this))}getMetadata(){const{mobi:e,exth:t}=this.headers;return{identifier:e.uid.toString(),title:i(t?.title||this.decode(e.title)),author:t?.creator?.map(i),publisher:i(t?.publisher),language:t?.language??e.language,published:t?.date,description:i(t?.description),subject:t?.subject?.map(i),rights:i(t?.rights),contributor:t?.contributor}}async getCover(){const{exth:e}=this.headers,t=e?.coverOffset<4294967295?e?.coverOffset:e?.thumbnailOffset<4294967295?e?.thumbnailOffset:null;if(null!=t){const e=await this.loadResource(t);return new Blob([e])}}}const B=/<\s*(?:mbp:)?pagebreak[^>]*>/gi,N=/<[^<>]+filepos=['"]{0,1}(\d+)[^<>]*>/gi;class P{parser=new DOMParser;serializer=new XMLSerializer;#Pe=new Map;#Ue=new Map;#De=new Map;#$e;#We=[];#je=r.HTML;constructor(e){this.mobi=e}async init(){let e=new Uint8Array;for(let t=0;t<this.mobi.headers.palmdoc.numTextRecords;t++)e=y(e,await this.mobi.loadText(t));const t=Array.from(new Uint8Array(e),(e=>String.fromCharCode(e))).join("");this.#$e=[0].concat(Array.from(t.matchAll(B),(e=>e.index))).map(((e,n,i)=>t.slice(e,i[n+1]))).map((e=>Uint8Array.from(e,(e=>e.charCodeAt(0))))).map((e=>({book:this,raw:e}))).reduce(((e,t)=>{const n=e[e.length-1];return t.start=n?.end??0,t.end=t.start+t.raw.byteLength,e.concat(t)}),[]),this.sections=this.#$e.map(((e,t)=>({id:t,load:()=>this.loadSection(e),createDocument:()=>this.createDocument(e),size:e.end-e.start})));try{this.landmarks=await this.getGuide();const e=this.landmarks.find((({type:e})=>e?.includes("toc")))?.href;if(e){const{index:t}=this.resolveHref(e),n=await this.sections[t].createDocument();let i,r=0,o=0;const a=new Map,s=new Map;this.toc=Array.from(n.querySelectorAll("a[filepos]")).reduce(((e,t)=>{const n=(e=>{let t=0;for(;e;){const n=e.parentElement;if(n){const e=n.tagName.toLowerCase();"p"===e?t+=1.5:"blockquote"===e&&(t+=2)}e=n}return t})(t),l={label:t.innerText?.trim()??"",href:`filepos:${t.getAttribute("filepos")}`},c=n>o?r+1:n===o?r:a.get(n)??Math.max(0,r-1);if(c>r)i?(i.subitems??=[],i.subitems.push(l),s.set(c,i)):e.push(l);else{const t=s.get(c);t?t.subitems.push(l):e.push(l)}return i=l,r=c,o=n,a.set(n,c),e}),[])}}catch(e){console.warn(e)}return this.#We=[...new Set(Array.from(t.matchAll(N),(e=>e[1])))].map((e=>({filepos:e,number:Number(e)}))).sort(((e,t)=>e.number-t.number)),this.metadata=this.mobi.getMetadata(),this.getCover=this.mobi.getCover.bind(this.mobi),this}async getGuide(){const e=await this.createDocument(this.#$e[0]);return Array.from(e.getElementsByTagName("reference"),(e=>({label:e.getAttribute("title"),type:e.getAttribute("type")?.split(/\s/),href:`filepos:${e.getAttribute("filepos")}`})))}async loadResource(e){if(this.#Pe.has(e))return this.#Pe.get(e);const t=await this.mobi.loadResource(e),n=URL.createObjectURL(new Blob([t]));return this.#Pe.set(e,n),n}async loadRecindex(e){return this.loadResource(Number(e)-1)}async replaceResources(e){for(const t of e.querySelectorAll("img[recindex]")){const e=t.getAttribute("recindex");try{t.src=await this.loadRecindex(e)}catch{console.warn(`Failed to load image ${e}`)}}for(const t of e.querySelectorAll("[mediarecindex]")){const e=t.getAttribute("mediarecindex"),n=t.getAttribute("recindex");try{t.src=await this.loadRecindex(e),n&&(t.poster=await this.loadRecindex(n))}catch{console.warn(`Failed to load media ${e}`)}}for(const t of e.querySelectorAll("[filepos]")){const e=t.getAttribute("filepos");t.href=`filepos:${e}`}}async loadText(e){if(this.#Ue.has(e))return this.#Ue.get(e);const{raw:t}=e,n=this.#We.filter((({number:t})=>t>=e.start&&t<e.end)).map((t=>({...t,offset:t.number-e.start})));let i=t;n.length&&(i=t.subarray(0,n[0].offset),n.forEach((({filepos:e,offset:r},o)=>{const a=n[o+1],s=this.mobi.encode(`<a id="filepos${e}"></a>`);i=x(i,s,t.subarray(r,a?.offset))})));const r=this.mobi.decode(i).replaceAll(B,"");return this.#Ue.set(e,r),r}async createDocument(e){const t=await this.loadText(e);return this.parser.parseFromString(t,this.#je)}async loadSection(e){if(this.#De.has(e))return this.#De.get(e);const t=await this.createDocument(e),n=t.createElement("style");t.head.append(n),n.append(t.createTextNode("blockquote {\n            margin-block-start: 0;\n            margin-block-end: 0;\n            margin-inline-start: 1em;\n            margin-inline-end: 0;\n        }")),await this.replaceResources(t);const i=this.serializer.serializeToString(t),r=URL.createObjectURL(new Blob([i],{type:this.#je}));return this.#De.set(e,r),r}resolveHref(e){const t=e.match(/filepos:(.*)/)[1],n=Number(t);return{index:this.#$e.findIndex((e=>e.end>n)),anchor:e=>e.getElementById(`filepos${t}`)}}splitTOCHref(e){const t=e.match(/filepos:(.*)/)[1],n=Number(t);return[this.#$e.findIndex((e=>e.end>n)),`filepos${t}`]}getTOCFragment(e,t){return e.getElementById(t)}isExternal(e){return/^(?!blob|filepos)\w+:/i.test(e)}destroy(){for(const e of this.#Pe.values())URL.revokeObjectURL(e);for(const e of this.#De.values())URL.revokeObjectURL(e)}}const U=/kindle:(flow|embed):(\w+)(?:\?mime=(\w+\/[-+.\w]+))?/,D=/kindle:pos:fid:(\w+):off:(\w+)/,$=e=>{const[t,n]=e.match(D).slice(1);return{fid:parseInt(t,32),off:parseInt(n,32)}},W=(e=0,t=0)=>`kindle:pos:fid:${e.toString(32).toUpperCase().padStart(4,"0")}:off:${t.toString(32).toUpperCase().padStart(10,"0")}`,j=e=>{const t=e.match(/\s(id|name|aid)\s*=\s*['"]([^'"]*)['"]/i);if(!t)return;const[,n,i]=t;return`[${n}="${CSS.escape(i)}"]`},H=e=>{for(const t of e){if("page-spread-left"===t||"rendition:page-spread-left"===t)return"left";if("page-spread-right"===t||"rendition:page-spread-right"===t)return"right";if("rendition:page-spread-center"===t)return"center"}};class q{parser=new DOMParser;serializer=new XMLSerializer;#De=new Map;#He=new Map;#qe=new Map;#Ve={};#$e;#Xe;#Ge=new Uint8Array;#Ke=new Uint8Array;#Je=-1;#Ze=-1;#je=r.XHTML;#Ye=new Map;constructor(e){this.mobi=e}async init(){const e=this.mobi.loadRecord.bind(this.mobi),{kf8:t}=this.mobi.headers;try{const n=await e(t.fdst),i=_(g,n);if("FDST"!==i.magic)throw new Error("Missing FDST record");const r=Array.from({length:i.numEntries},((e,t)=>12+8*t)).map((e=>[S(n.slice(e,e+4)),S(n.slice(e+4,e+8))]));this.#Ve.fdstTable=r,this.#Xe=r[r.length-1][1]}catch{}const n=(await M(t.skel,e)).table.map((({name:e,tagMap:t},n)=>({index:n,name:e,numFrag:t[1][0],offset:t[6][0],length:t[6][1]}))),o=await M(t.frag,e),a=o.table.map((({name:e,tagMap:t})=>({insertOffset:parseInt(e),selector:o.cncx[t[2][0]],index:t[4][0],offset:t[6][0],length:t[6][1]})));this.#Ve.skelTable=n,this.#Ve.fragTable=a,this.#$e=n.reduce(((e,t)=>{const n=e[e.length-1],i=n?.fragEnd??0,r=i+t.numFrag,o=a.slice(i,r),s=t.length+o.map((e=>e.length)).reduce(((e,t)=>e+t)),l=(n?.totalLength??0)+s;return e.concat({skel:t,frags:o,fragEnd:r,length:s,totalLength:l})}),[]);const s=await this.getResourcesByMagic(["RESC","PAGE"]),l=new Map;if(s.RESC){const e=await this.mobi.loadRecord(s.RESC),t=this.mobi.decode(e.slice(16)).replace(/\0/g,""),n=t.search(/\?>/),i=`<package>${t.slice(n)}</package>`,o=this.parser.parseFromString(i,r.XML);for(const e of o.querySelectorAll("spine > itemref")){const t=parseInt(e.getAttribute("skelid"));l.set(t,H(e.getAttribute("properties")?.split(" ")??[]))}}this.sections=this.#$e.map(((e,t)=>e.frags.length?{id:t,load:()=>this.loadSection(e),createDocument:()=>this.createDocument(e),size:e.length,pageSpread:l.get(t)}:{linear:"no"}));try{const e=await this.mobi.getNCX(),t=({label:e,pos:n,children:r})=>{const[o,a]=n,s=W(o,a),l=this.#He.get(o);return l?l.push(a):this.#He.set(o,[a]),{label:i(e),href:s,subitems:r?.map(t)}};this.toc=e?.map(t),this.landmarks=await this.getGuide()}catch(e){console.warn(e)}const{exth:c}=this.mobi.headers;return this.dir=c.pageProgressionDirection,this.rendition={layout:"true"===c.fixedLayout?"pre-paginated":"reflowable",viewport:Object.fromEntries(c.originalResolution?.split("x")?.slice(0,2)?.map(((e,t)=>[t?"height":"width",e]))??[])},this.metadata=this.mobi.getMetadata(),this.getCover=this.mobi.getCover.bind(this.mobi),this}async getResourcesByMagic(e){const t={},n=this.mobi.headers.kf8.resourceStart,i=this.mobi.pdb.numRecords;for(let r=n;r<i;r++)try{const n=await this.mobi.loadMagic(r),i=e.find((e=>e===n));i&&(t[i]=r)}catch{}return t}async getGuide(){const e=this.mobi.headers.kf8.guide;if(e<4294967295){const t=this.mobi.loadRecord.bind(this.mobi),{table:n,cncx:i}=await M(e,t);return n.map((({name:e,tagMap:t})=>({label:i[t[1][0]]??"",type:e?.split(/\s/),href:W(t[6]?.[0]??t[3]?.[0])})))}}async loadResourceBlob(e){const{resourceType:t,id:n,type:i}=(e=>{const[t,n,i]=e.match(U).slice(1);return{resourceType:t,id:parseInt(n,32),type:i}})(e),o="flow"===t?await this.loadFlow(n):await this.mobi.loadResource(n-1),a=[r.XHTML,r.HTML,r.CSS,r.SVG].includes(i)?await this.replaceResources(this.mobi.decode(o)):o,s=i===r.SVG?this.parser.parseFromString(a,i):null;return[new Blob([a],{type:i}),s?.getElementsByTagNameNS("http://www.w3.org/2000/svg","image")?.length?s.documentElement:null]}async loadResource(e){if(this.#De.has(e))return this.#De.get(e);const[t,n]=await this.loadResourceBlob(e),i=n?e:URL.createObjectURL(t);return n&&this.#Ye.set(i,n),this.#De.set(e,i),i}replaceResources(e){return(async(e,t,n)=>{const i=[];e.replace(t,((...e)=>(i.push(e),null)));const r=[];for(const e of i)r.push(await n(...e));return e.replace(t,(()=>r.shift()))})(e,new RegExp(U,"g"),this.loadResource.bind(this))}async loadRaw(e,t){const n=t-this.#Ge.length,i=null==this.#Xe?1/0:this.#Xe-this.#Ke.length-e;if(n<0||n<i){for(;this.#Ge.length<t;){const e=++this.#Je,t=await this.mobi.loadText(e);this.#Ge=y(this.#Ge,t)}return this.#Ge.slice(e,t)}for(;this.#Xe-this.#Ke.length>e;){const e=this.mobi.headers.palmdoc.numTextRecords-1-++this.#Ze,t=await this.mobi.loadText(e);this.#Ke=y(t,this.#Ke)}const r=this.#Xe-this.#Ke.length;return this.#Ke.slice(e-r,t-r)}loadFlow(e){if(e<4294967295)return this.loadRaw(...this.#Ve.fdstTable[e])}async loadText(e){const{skel:t,frags:n,length:i}=e,r=await this.loadRaw(t.offset,t.offset+i);let o=r.slice(0,t.length);for(const e of n){const n=e.insertOffset-t.offset,i=t.length+e.offset,a=r.slice(i,i+e.length);o=x(o.slice(0,n),a,o.slice(n));const s=this.#He.get(e.index);if(s)for(const t of s){const n=this.mobi.decode(a).slice(t),i=j(n);this.#Qe(e.index,t,i)}}return this.mobi.decode(o)}async createDocument(e){const t=await this.loadText(e);return this.parser.parseFromString(t,this.#je)}async loadSection(e){if(this.#De.has(e))return this.#De.get(e);const t=await this.loadText(e),n=await this.replaceResources(t);let i=this.parser.parseFromString(n,this.#je);!i.querySelector("parsererror")&&i.documentElement?.namespaceURI||(this.#je=r.HTML,i=this.parser.parseFromString(n,this.#je));for(const[e,t]of this.#Ye)for(const n of i.querySelectorAll(`img[src="${e}"]`))n.replaceWith(t);const o=URL.createObjectURL(new Blob([this.serializer.serializeToString(i)],{type:this.#je}));return this.#De.set(e,o),o}getIndexByFID(e){return this.#$e.findIndex((t=>t.frags.some((t=>t.index===e))))}#Qe(e,t,n){const i=this.#qe.get(e);if(i)i.set(t,n);else{const i=new Map;this.#qe.set(e,i),i.set(t,n)}}async resolveHref(e){const{fid:t,off:n}=$(e),i=this.getIndexByFID(t);if(i<0)return;const r=this.#qe.get(t)?.get(n);if(r)return{index:i,anchor:e=>e.querySelector(r)};const{skel:o,frags:a}=this.#$e[i],s=a.find((e=>e.index===t)),l=o.offset+o.length+s.offset,c=await this.loadRaw(l,l+s.length),d=this.mobi.decode(c).slice(n),h=j(d);return this.#Qe(t,n,h),{index:i,anchor:e=>e.querySelector(h)}}splitTOCHref(e){const t=$(e);return[this.getIndexByFID(t.fid),t]}getTOCFragment(e,{fid:t,off:n}){const i=this.#qe.get(t)?.get(n);return e.querySelector(i)}isExternal(e){return/^(?!blob|kindle)\w+:/i.test(e)}destroy(){for(const e of this.#De.values())URL.revokeObjectURL(e)}}},800:(e,t,n)=>{n.d(t,{EPUB:()=>F});var i=n(986);const r="http://www.idpf.org/2007/opf",o="http://www.idpf.org/2007/ops",a="http://purl.org/dc/elements/1.1/",s="http://www.w3.org/2001/04/xmlenc#",l="http://www.w3.org/1999/xlink",c={XML:"application/xml",NCX:"application/x-dtbncx+xml",XHTML:"application/xhtml+xml",HTML:"text/html",CSS:"text/css",SVG:"image/svg+xml",JS:/\/(x-)?(javascript|ecmascript)/},d=e=>e.toLowerCase().replace(/[-:](.)/g,((e,t)=>t.toUpperCase())),h=(e,t,n)=>n?n=>n.getAttribute(e)?.split(/\s/)?.includes(t):"function"==typeof t?n=>t(n.getAttribute(e)):n=>n.getAttribute(e)===t,u=(...e)=>t=>t?Object.fromEntries(e.map((e=>[d(e),t.getAttribute(e)]))):null,f=e=>{return t=e?.textContent,t?t.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"";var t},g=(e,t)=>{const n=e.lookupNamespaceURI(null)===t||e.lookupPrefix(t),i=n?(e,n)=>e=>e.namespaceURI===t&&e.localName===n:(e,t)=>e=>e.localName===t;return{$:(e,t)=>[...e.children].find(i(e,t)),$$:(e,t)=>[...e.children].filter(i(e,t)),$$$:n?(e,n)=>[...e.getElementsByTagNameNS(t,n)]:(e,t)=>[...e.getElementsByTagName(t)]}},p=(e,t)=>{try{if(t.includes(":"))return new URL(e,t);const n="https://invalid.invalid/",i=new URL(e,n+t);return i.search="",decodeURI(i.href.replace(n,""))}catch(t){return console.warn(t),e}},m=e=>/^(?!blob)\w+:/i.test(e),w=async(e,t,n)=>{const i=[];e.replace(t,((...e)=>(i.push(e),null)));const r=[];for(const e of i)r.push(await n(...e));return e.replace(t,(()=>r.shift()))},b=e=>e.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),y={attrs:["dir","xml:lang"]},x={name:"alternate-script",many:!0,...y,props:["file-as"]},v={many:!0,...y,props:[{name:"role",many:!0,attrs:["scheme"]},"file-as",x],setLegacyAttrs:(e,t)=>{if(!e.role?.length){const n=t.getAttributeNS(r,"role");n&&(e.role=[{value:n}])}e.fileAs??=t.getAttributeNS(r,"file-as")}},k=[{name:"title",many:!0,...y,props:["title-type","display-seq","file-as",x]},{name:"identifier",many:!0,props:[{name:"identifier-type",attrs:["scheme"]}],setLegacyAttrs:(e,t)=>{if(!e.identifierType){const n=t.getAttributeNS(r,"scheme");n&&(e.identifierType={value:n})}}},{name:"language",many:!0},{name:"creator",...v},{name:"contributor",...v},{name:"publisher",...y,props:["file-as",x]},{name:"description",...y,props:[x]},{name:"rights",...y,props:[x]},{name:"date"},{name:"dcterms:modified",type:"meta"},{name:"subject",many:!0,...y,props:["term","authority",x],setLegacyAttrs:(e,t)=>{e.term??=t.getAttributeNS(r,"term"),e.authority??=t.getAttributeNS(r,"authority")}},{name:"source",many:!0},{name:"belongs-to-collection",type:"meta",many:!0,...y,props:["collection-type","group-position","dcterms:identifier","file-as",x,{name:"belongs-to-collection",recursive:!0}]}],S=(e,t=e=>e)=>{const{$:n,$$:i,$$$:r}=g(e,"http://www.w3.org/1999/xhtml"),a=(e,r)=>e?i(e,"li").map((e=>i=>{const r=n(i,"a")??n(i,"span"),s=n(i,"ol"),l=(e=>e?decodeURI(t(e)):null)(r?.getAttribute("href")),c={label:f(r)||r?.getAttribute("title"),href:l,subitems:a(s)};return e&&(c.type=r?.getAttributeNS(o,"type")?.split(/\s/)),c})(r)):null,s=(e,t)=>a(n(e,"ol"),t),l=r(e,"nav");let c=null,d=null,h=null,u=[];for(const e of l){const t=e.getAttributeNS(o,"type")?.split(/\s/)??[];t.includes("toc")?c??=s(e):t.includes("page-list")?d??=s(e):t.includes("landmarks")?h??=s(e,!0):u.push({label:f(e.firstElementChild),type:t,list:s(e)})}return{toc:c,pageList:d,landmarks:h,others:u}},_=e=>{if(!e)return;const t=e.split(":").map((e=>parseFloat(e)));if(3===t.length){const[e,n,i]=t;return 60*e*60+60*n+i}if(2===t.length){const[e,n]=t;return 60*e+n}const[n,i]=e.split(/(?=[^\d.])/);return parseFloat(n)*("h"===i?3600:"min"===i?60:"ms"===i?.001:1)};class A extends EventTarget{#et;#tt;#nt;#it;#rt;#ot;#at=1;#st=1;constructor(e,t){super(),this.book=e,this.loadXML=t}async#lt(e){if(this.#tt===e)return;const t=await this.loadXML(e.href),n=t=>t?p(t,e.href):null,{$:i,$$$:r}=g(t,"http://www.w3.org/ns/SMIL");this.#it=-1,this.#rt=-1,this.#et=r(t,"par").reduce(((e,t)=>{const r=n(i(t,"text")?.getAttribute("src")),o=i(t,"audio");if(!r||!o)return e;const a=n(o.getAttribute("src")),s=_(o.getAttribute("clipBegin")),l=_(o.getAttribute("clipEnd")),c=e.at(-1);return c?.src===a?c.items.push({text:r,begin:s,end:l}):e.push({src:a,items:[{text:r,begin:s,end:l}]}),e}),[]),this.#tt=e}get#ct(){return this.#et[this.#it]}get#dt(){return this.#ct?.items?.[this.#rt]}#ht(e){console.error(e),this.dispatchEvent(new CustomEvent("error",{detail:e}))}#ut(){this.dispatchEvent(new CustomEvent("highlight",{detail:this.#dt}))}#ft(){this.dispatchEvent(new CustomEvent("unhighlight",{detail:this.#dt}))}async#gt(e,t){this.#ot&&(this.#ot.pause(),URL.revokeObjectURL(this.#ot.src),this.#ot=null),this.#it=e,this.#rt=t;const n=this.#ct?.src;if(!n||!this.#dt)return this.start(this.#nt+1);const i=URL.createObjectURL(await this.book.loadBlob(n)),r=new Audio(i);this.#ot=r,r.addEventListener("timeupdate",(()=>{if(r.paused)return;const e=r.currentTime,{items:t}=this.#ct;if(e>this.#dt?.end&&(this.#ft(),this.#rt===t.length-1))return void this.#gt(this.#it+1,0).catch((e=>this.#ht(e)));const n=this.#rt;for(;t[this.#rt+1]?.begin<=e;)this.#rt++;this.#rt!==n&&this.#ut()})),r.addEventListener("error",(()=>this.#ht(new Error(`Failed to load ${n}`)))),r.addEventListener("playing",(()=>this.#ut())),r.addEventListener("pause",(()=>this.#ft())),r.addEventListener("ended",(()=>{this.#ft(),URL.revokeObjectURL(i),this.#ot=null,this.#gt(e+1,0).catch((e=>this.#ht(e)))})),r.addEventListener("canplaythrough",(()=>{r.currentTime=this.#dt.begin??0,r.volume=this.#at,r.playbackRate=this.#st,r.play().catch((e=>this.#ht(e)))}))}async start(e,t=()=>!0){this.#ot?.pause();const n=this.book.sections[e],i=n?.id;if(!i)return;const{mediaOverlay:r}=n;if(!r)return this.start(e+1);this.#nt=e,await this.#lt(r);for(let e=0;e<this.#et.length;e++){const{items:n}=this.#et[e];for(let r=0;r<n.length;r++)if(n[r].text.split("#")[0]===i&&t(n[r],r,n))return this.#gt(e,r).catch((e=>this.#ht(e)))}}pause(){this.#ot?.pause()}resume(){this.#ot?.play().catch((e=>this.#ht(e)))}prev(){this.#rt>0?this.#gt(this.#it,this.#rt-1):this.#it>0?this.#gt(this.#it-1,this.#et[this.#it-1].items.length-1):this.#nt>0&&this.start(this.#nt-1,((e,t,n)=>t===n.length-1))}next(){this.#gt(this.#it,this.#rt+1)}setVolume(e){this.#at=e,this.#ot&&(this.#ot.volume=e)}setRate(e){this.#st=e,this.#ot&&(this.#ot.playbackRate=e)}}const L=/([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/,T=e=>f(e.getElementById(e.documentElement.getAttribute("unique-identifier"))??e.getElementsByTagNameNS(a,"identifier")[0]),E=async(e,t,n)=>{const i=new Uint8Array(await n.slice(0,t).arrayBuffer());t=Math.min(t,i.length);for(var r=0;r<t;r++)i[r]=i[r]^e[r%e.length];return new Blob([i,n.slice(t)],{type:n.type})},C=async e=>{const t=(new TextEncoder).encode(e),n=await globalThis.crypto.subtle.digest("SHA-1",t);return new Uint8Array(n)},R=(e=C)=>({"http://www.idpf.org/2008/embedding":{key:t=>e(T(t).replaceAll(/[\u0020\u0009\u000d\u000a]/g,"")),decode:(e,t)=>E(e,1040,t)},"http://ns.adobe.com/pdf/enc#RC":{key:e=>{const t=(e=>{for(const t of e.getElementsByTagNameNS(a,"identifier")){const[e]=f(t).split(":").slice(-1);if(L.test(e))return e}return""})(e).replaceAll("-","");return Uint8Array.from({length:16},((e,n)=>parseInt(t.slice(2*n,2*n+2),16)))},decode:(e,t)=>E(e,1024,t)}});class I{#pt=new Map;#mt=new Map;#wt;constructor(e){this.#wt=e}async init(e,t){if(!e)return;const n=Array.from(e.getElementsByTagNameNS(s,"EncryptedData"),(e=>({algorithm:e.getElementsByTagNameNS(s,"EncryptionMethod")[0]?.getAttribute("Algorithm"),uri:e.getElementsByTagNameNS(s,"CipherReference")[0]?.getAttribute("URI")})));for(const{algorithm:e,uri:i}of n){if(!this.#mt.has(e)){const n=this.#wt[e];if(!n){console.warn("Unknown encryption algorithm");continue}const i=await n.key(t);this.#mt.set(e,(e=>n.decode(i,e)))}this.#pt.set(i,e)}}getDecoder(e){return this.#mt.get(this.#pt.get(e))??(e=>e)}}class M{constructor({opf:e,resolveHref:t}){this.opf=e;const{$:n,$$:o,$$$:a}=g(e,r),s=n(e.documentElement,"manifest"),l=n(e.documentElement,"spine"),d=o(l,"itemref");this.manifest=o(s,"item").map(u("href","id","media-type","properties","media-overlay")).map((e=>(e.href=t(e.href),e.properties=e.properties?.split(/\s/),e))),this.spine=d.map(u("idref","id","linear","properties")).map((e=>(e.properties=e.properties?.split(/\s/),e))),this.pageProgressionDirection=l.getAttribute("page-progression-direction"),this.navPath=this.getItemByProperty("nav")?.href,this.ncxPath=(this.getItemByID(l.getAttribute("toc"))??this.manifest.find((e=>e.mediaType===c.NCX)))?.href;const f=n(e.documentElement,"guide");f&&(this.guide=o(f,"reference").map(u("type","title","href")).map((({type:e,title:n,href:i})=>({label:n,type:e.split(/\s/),href:t(i)})))),this.cover=this.getItemByProperty("cover-image")??this.getItemByID(a(e,"meta").find(h("name","cover"))?.getAttribute("content"))??this.getItemByHref(this.guide?.find((e=>e.type.includes("cover")))?.href),this.cfis=i.ob(d)}getItemByID(e){return this.manifest.find((t=>t.id===e))}getItemByHref(e){return this.manifest.find((t=>t.href===e))}getItemByProperty(e){return this.manifest.find((t=>t.properties?.includes(e)))}resolveCFI(e){const t=i.qg(e),n=(t.parent??t).shift();let r=i.wT(this.opf,n);r&&"idref"!==r.nodeName&&(n[n.length-1].id=null,r=i.wT(this.opf,n));const o=r?.getAttribute("idref");return{index:this.spine.findIndex((e=>e.idref===o)),anchor:e=>i.Xp(e,t)}}}class z{#De=new Map;#bt=new Map;#yt=new Map;allowScript=!1;constructor({loadText:e,loadBlob:t,resources:n}){this.loadText=e,this.loadBlob=t,this.manifest=n.manifest,this.assets=n.manifest}createURL(e,t,n,i){if(!t)return"";const r=URL.createObjectURL(new Blob([t],{type:n}));if(this.#De.set(e,r),this.#yt.set(e,1),i){const t=this.#bt.get(i);t?t.push(e):this.#bt.set(i,[e])}return r}ref(e,t){const n=this.#bt.get(t);return n?.includes(e)||(this.#yt.set(e,this.#yt.get(e)+1),n?n.push(e):this.#bt.set(t,[e])),this.#De.get(e)}unref(e){if(!this.#yt.has(e))return;const t=this.#yt.get(e)-1;if(t<1){URL.revokeObjectURL(this.#De.get(e)),this.#De.delete(e),this.#yt.delete(e);const t=this.#bt.get(e);if(t)for(;t.length;)this.unref(t.pop());this.#bt.delete(e)}else this.#yt.set(e,t)}async loadItem(e,t=[]){if(!e)return null;const{href:n,mediaType:i}=e,r=c.JS.test(e.mediaType);if(r&&!this.allowScript)return null;const o=t[t.length-1];return this.#De.has(n)?this.ref(n,o):(r||[c.XHTML,c.HTML,c.CSS,c.SVG].includes(i))&&t.every((e=>e!==n))?this.loadReplaced(e,t):this.createURL(n,await this.loadBlob(n),i,o)}async loadHref(e,t,n=[]){if(m(e))return e;const i=p(e,t),r=this.manifest.find((e=>e.href===i));return r?this.loadItem(r,n.concat(t)):e}async loadReplaced(e,t=[]){const{href:n,mediaType:i}=e,r=t[t.length-1],o=await this.loadText(n);if(!o)return null;if([c.XHTML,c.HTML,c.SVG].includes(i)){let a=(new DOMParser).parseFromString(o,i);if(i!==c.XHTML||!a.querySelector("parsererror")&&a.documentElement?.namespaceURI||(console.warn(a.querySelector("parsererror")?.innerText??"Invalid XHTML"),e.mediaType=c.HTML,a=(new DOMParser).parseFromString(o,e.mediaType)),[c.XHTML,c.SVG].includes(e.mediaType)){let e=a.firstChild;for(;e instanceof ProcessingInstruction;){if(e.data){const i=await w(e.data,/(?:^|\s*)(href\s*=\s*['"])([^'"]*)(['"])/i,((e,i,r,o)=>this.loadHref(r,n,t).then((e=>`${i}${e}${o}`))));e.replaceWith(a.createProcessingInstruction(e.target,i))}e=e.nextSibling}}const s=async(e,i)=>e.setAttribute(i,await this.loadHref(e.getAttribute(i),n,t));for(const e of a.querySelectorAll("link[href]"))await s(e,"href");for(const e of a.querySelectorAll("[src]"))await s(e,"src");for(const e of a.querySelectorAll("[poster]"))await s(e,"poster");for(const e of a.querySelectorAll("object[data]"))await s(e,"data");for(const e of a.querySelectorAll("[*|href]:not([href])"))e.setAttributeNS(l,"href",await this.loadHref(e.getAttributeNS(l,"href"),n,t));for(const e of a.querySelectorAll("style"))e.textContent&&(e.textContent=await this.replaceCSS(e.textContent,n,t));for(const e of a.querySelectorAll("[style]"))e.setAttribute("style",await this.replaceCSS(e.getAttribute("style"),n,t));const d=(new XMLSerializer).serializeToString(a);return this.createURL(n,d,e.mediaType,r)}const a=i===c.CSS?await this.replaceCSS(o,n,t):await this.replaceString(o,n,t);return this.createURL(n,a,i,r)}async replaceCSS(e,t,n=[]){const i=await w(e,/url\(\s*["']?([^'"\n]*?)\s*["']?\s*\)/gi,((e,i)=>this.loadHref(i,t,n).then((e=>`url("${e}")`)))),r=await w(i,/@import\s*["']([^"'\n]*?)["']/gi,((e,i)=>this.loadHref(i,t,n).then((e=>`@import "${e}"`)))),o=window?.innerWidth??800,a=window?.innerHeight??600;return r.replace(/([{\s;])-epub-/gi,"$1").replace(/(\d*\.?\d+)vw/gi,((e,t)=>parseFloat(t)*o/100+"px")).replace(/(\d*\.?\d+)vh/gi,((e,t)=>parseFloat(t)*a/100+"px")).replace(/page-break-(after|before|inside)\s*:/gi,((e,t)=>`-webkit-column-break-${t}:`)).replace(/break-(after|before|inside)\s*:\s*(avoid-)?page/gi,((e,t,n)=>`break-${t}: ${n??""}column`)).replace(/(\d*\.?\d+)px/gi,((e,t)=>parseFloat(t)/16+"em"))}replaceString(e,t,n=[]){const i=new Map,r=this.assets.map((e=>{if(e.href===t)return;const n=((e,t)=>{if(!e)return t;const n=e.replace(/\/$/,"").split("/"),i=t.replace(/\/$/,"").split("/"),r=(n.length>i.length?n:i).findIndex(((e,t)=>n[t]!==i[t]));return r<0?"":Array(n.length-r).fill("..").concat(i.slice(r)).join("/")})((e=>e.slice(0,e.lastIndexOf("/")+1))(t),e.href),r=encodeURI(n),o="/"+e.href,a=encodeURI(o),s=new Set([n,r,o,a]);for(const t of s)i.set(t,e);return Array.from(s)})).flat().filter((e=>e));if(!r.length)return e;const o=new RegExp(r.map(b).join("|"),"g");return w(e,o,(async e=>this.loadItem(i.get(e.replace(/^\//,"")),n.concat(t))))}unloadItem(e){this.unref(e?.href)}destroy(){for(const e of this.#De.values())URL.revokeObjectURL(e)}}const O=e=>{for(const t of e){if("page-spread-left"===t||"rendition:page-spread-left"===t)return"left";if("page-spread-right"===t||"rendition:page-spread-right"===t)return"right";if("rendition:page-spread-center"===t)return"center"}};class F{parser=new DOMParser;#xt;#vt;constructor({loadText:e,loadBlob:t,getSize:n,sha1:i}){this.loadText=e,this.loadBlob=t,this.getSize=n,this.#vt=new I(R(i))}async#kt(e){const t=await this.loadText(e);if(!t)return null;const n=this.parser.parseFromString(t,c.XML);if(n.querySelector("parsererror"))throw new Error(`XML parsing error: ${e}\n${n.querySelector("parsererror").innerText}`);return n}async init(){const e=await this.#kt("META-INF/container.xml");if(!e)throw new Error("Failed to load container file");const t=Array.from(e.getElementsByTagNameNS("urn:oasis:names:tc:opendocument:xmlns:container","rootfile"),u("full-path","media-type")).filter((e=>"application/oebps-package+xml"===e.mediaType));if(!t.length)throw new Error("No package document defined in container");const n=t[0].fullPath,i=await this.#kt(n);if(!i)throw new Error("Failed to load package document");const o=await this.#kt("META-INF/encryption.xml");await this.#vt.init(o,i),this.resources=new M({opf:i,resolveHref:e=>p(e,n)}),this.#xt=new z({loadText:this.loadText,loadBlob:e=>Promise.resolve(this.loadBlob(e)).then(this.#vt.getDecoder(e)),resources:this.resources}),this.sections=this.resources.spine.map(((e,t)=>{const{idref:n,linear:i,properties:r=[]}=e,o=this.resources.getItemByID(n);return o?{id:o.href,load:()=>this.#xt.loadItem(o),unload:()=>this.#xt.unloadItem(o),createDocument:()=>this.loadDocument(o),size:this.getSize(o.href),cfi:this.resources.cfis[t],linear:i,pageSpread:O(r),resolveHref:e=>p(e,o.href),mediaOverlay:o.mediaOverlay?this.resources.getItemByID(o.mediaOverlay):null}:(console.warn(`Could not find item with ID "${n}" in manifest`),null)})).filter((e=>e));const{navPath:s,ncxPath:l}=this.resources;if(s)try{const e=e=>p(e,s),t=S(await this.#kt(s),e);this.toc=t.toc,this.pageList=t.pageList,this.landmarks=t.landmarks}catch(e){console.warn(e)}if(!this.toc&&l)try{const e=e=>p(e,l),t=((e,t=e=>e)=>{const{$:n,$$:i}=g(e,"http://www.daisy.org/z3986/2005/ncx/"),r=e=>{const o=n(e,"navLabel"),a=n(e,"content"),s=f(o),l=(e=>e?decodeURI(t(e)):null)(a.getAttribute("src"));if("navPoint"===e.localName){const t=i(e,"navPoint");return{label:s,href:l,subitems:t.length?t.map(r):null}}return{label:s,href:l}},o=(e,t)=>i(e,t).map(r),a=(t,i)=>{const r=n(e.documentElement,t);return r?o(r,i):null};return{toc:a("navMap","navPoint"),pageList:a("pageList","pageTarget"),others:i(e.documentElement,"navList").map((e=>({label:f(n(e,"navLabel")),list:o(e,"navTarget")})))}})(await this.#kt(l),e);this.toc=t.toc,this.pageList=t.pageList}catch(e){console.warn(e)}this.landmarks??=this.resources.guide;const{metadata:c,rendition:m,media:w}=(e=>{const{$:t,$$:n}=g(e,r),i=t(e.documentElement,"metadata"),o=Array.from(i.children),s=(e,t)=>{if(!t)return null;const{props:n=[],attrs:i=[]}=e,r=f(t);if(!n.length&&!i.length)return r;const a=t.getAttribute("id"),l=a?o.filter(h("refines","#"+a)):[],c=Object.fromEntries([["value",r]].concat(n.map((t=>{const{many:n,recursive:i}=t,r="string"==typeof t?t:t.name,o=h("property",r),a=i?e:t;return[d(r),n?l.filter(o).map((e=>s(a,e))):s(a,l.find(o))]}))).concat(i.map((e=>[d(e),t.getAttribute(e)]))));return e.setLegacyAttrs?.(c,t),c},l=o.filter(h("refines",null)),c=Object.fromEntries(k.map((e=>{const{type:t,name:n,many:i}=e,o="meta"===t?e=>e.namespaceURI===r&&e.getAttribute("property")===n:e=>e.namespaceURI===a&&e.localName===n;return[d(n),i?l.filter(o).map((t=>s(e,t))):s(e,l.find(o))]}))),u=n(i,"meta"),p=e=>u.filter(h("property",(t=>t?.startsWith(e)))).map((t=>[t.getAttribute("property").replace(e,""),t])),m=Object.fromEntries(p("rendition:").map((([e,t])=>[e,f(t)]))),w={narrator:[],duration:{}};for(const[e,t]of p("media:")){const n=f(t);"duration"===e?w.duration[t.getAttribute("refines")?.split("#")?.[1]??""]=_(n):"active-class"===e?w.activeClass=n:"narrator"===e?w.narrator.push(n):"playback-active-class"===e&&(w.playbackActiveClass=n)}return{metadata:c,rendition:m,media:w}})(i);this.rendition=m,this.media=w,this.dir=this.resources.pageProgressionDirection;const b=(y=await this.#kt("META-INF/com.apple.ibooks.display-options.xml")??await this.#kt("META-INF/com.kobobooks.display-options.xml"))?{fixedLayout:f(y.querySelector('option[name="fixed-layout"]')),openToSpread:f(y.querySelector('option[name="open-to-spread"]'))}:null;var y;b&&("true"===b.fixedLayout&&(this.rendition.layout??="pre-paginated"),"false"===b.openToSpread&&(this.sections.find((e=>"no"!==e.linear)).pageSpread??="rtl"===this.dir?"left":"right")),this.parsedMetadata=c;const x=c?.title?.[0];this.metadata={title:x?.value,subtitle:c?.title?.find((e=>"subtitle"===e.titleType))?.value,sortAs:x?.fileAs,language:c?.language,identifier:T(i),description:c?.description?.value,publisher:c?.publisher?.value,published:c?.date,modified:c?.dctermsModified,subject:c?.subject?.filter((({value:e,term:t})=>e||t))?.map((({value:e,term:t,authority:n})=>({name:e,code:t,scheme:n}))),rights:c?.rights?.value};const v={art:"artist",aut:"author",bkp:"producer",clr:"colorist",edt:"editor",ill:"illustrator",nrt:"narrator",trl:"translator",pbl:"publisher"},A=e=>t=>{const n=[...new Set(t.role?.map((({value:t,scheme:n})=>(n&&"marc:relators"!==n?null:v[t])??e)))],i={name:t.value,sortAs:t.fileAs};return[n?.length?n:[e],i]};return c?.creator?.map(A("author"))?.concat(c?.contributor?.map?.(A("contributor")))?.forEach((([e,t])=>e.forEach((e=>{this.metadata[e]?this.metadata[e].push(t):this.metadata[e]=[t]})))),this}async loadDocument(e){const t=await this.loadText(e.href);return this.parser.parseFromString(t,e.mediaType)}getMediaOverlay(){return new A(this,this.#kt.bind(this))}resolveCFI(e){return this.resources.resolveCFI(e)}resolveHref(e){const[t,n]=e.split("#"),i=this.resources.getItemByHref(decodeURI(t));return i?{index:this.resources.spine.findIndex((({idref:e})=>e===i.id)),anchor:n?e=>((e,t)=>e.getElementById(t)??e.querySelector(`[name="${CSS.escape(t)}"]`))(e,n):()=>0}:null}splitTOCHref(e){return e?.split("#")??[]}getTOCFragment(e,t){return e.getElementById(t)??e.querySelector(`[name="${CSS.escape(t)}"]`)}isExternal(e){return m(e)}async getCover(){const e=this.resources?.cover;return e?.href?new Blob([await this.loadBlob(e.href)],{type:e.mediaType}):null}async getCalibreBookmarks(){const e=await this.loadText("META-INF/calibre_bookmarks.txt");if(e?.startsWith("encoding=json+base64:")){const t=atob(e.slice(21));return JSON.parse(t)}}destroy(){this.#xt?.destroy()}}},949:(e,t,n)=>{n.d(t,{k:()=>r,r:()=>o});const i=e=>e.map((e=>e.subitems?.length?[e,i(e.subitems)].flat():e)).flat();class r{async init({toc:e,ids:t,splitHref:n,getFragment:r}){(e=>{let t=0;const n=e=>{if(e.id=t++,e.subitems)for(const t of e.subitems)n(t)};for(const t of e)n(t)})(e);const o=i(e),a=new Map;for(const[e,t]of o.entries()){const[i,r]=await n(t?.href)??[],s={fragment:r,item:t};a.has(i)?a.get(i).items.push(s):a.set(i,{prev:o[e-1],items:[s]})}const s=new Map;for(const[e,n]of t.entries())a.has(n)?s.set(n,a.get(n)):s.set(n,s.get(t[e-1]));this.ids=t,this.map=s,this.getFragment=r}getProgress(e,t){if(!this.ids)return;const n=this.ids[e],i=this.map.get(n);if(!i)return null;const{prev:r,items:o}=i;if(!o)return r;if(!t||1===o.length&&!o[0].fragment)return o[0].item;const a=t.startContainer.getRootNode();for(const[e,{fragment:n}]of o.entries()){const i=this.getFragment(a,n);if(i&&t.comparePoint(i,0)>0)return o[e-1]?.item??r}return o[o.length-1].item}}class o{constructor(e,t,n){this.sizes=e.map((e=>"no"!=e.linear&&e.size>0?e.size:0)),this.sizePerLoc=t,this.sizePerTimeUnit=n,this.sizeTotal=this.sizes.reduce(((e,t)=>e+t),0),this.sectionFractions=this.#St()}#St(){const{sizeTotal:e}=this,t=[0];let n=0;for(const i of this.sizes)t.push((n+=i)/e);return t}getProgress(e,t,n=0){const{sizes:i,sizePerLoc:r,sizePerTimeUnit:o,sizeTotal:a}=this,s=i[e]??0,l=i.slice(0,e).reduce(((e,t)=>e+t),0)+t*s,c=l+n*s,d=a-l,h=(1-t)*s;return{fraction:c/a,section:{current:e,total:i.length},location:{current:Math.floor(l/r),next:Math.floor(c/r),total:Math.ceil(a/r)},time:{section:h/o,total:d/o}}}getSection(e){if(e<=0)return[0,0];if(e>=1)return[this.sizes.length-1,1];e+=Number.EPSILON;const{sizeTotal:t}=this;let n=this.sectionFractions.findIndex((t=>t>e))-1;if(n<0)return[0,0];for(;!this.sizes[n];)n++;return[n,(e-this.sectionFractions[n])/(this.sizes[n]/t)]}}},977:(e,t,n)=>{function i(e){return e.collapsed||""===e.toString().trim()}n.d(t,{TTS:()=>o}),new Set(["article","aside","audio","blockquote","caption","details","dialog","div","dl","dt","dd","figure","footer","form","figcaption","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","math","nav","ol","p","pre","section","tr"]);class r{#pe=[];#_t;#r=-1;#At;constructor(e,t=e=>e){this.#_t=e,this.#At=t}current(){if(this.#pe[this.#r])return this.#At(this.#pe[this.#r])}first(){if(this.#pe[0])return this.#r=0,this.#At(this.#pe[0])}last(){for(const e of this.#_t)this.#pe.push(e);const e=this.#pe.length-1;if(this.#pe[e])return this.#r=e,this.#At(this.#pe[e])}prev(){const e=this.#r-1;if(this.#pe[e])return this.#r=e,this.#At(this.#pe[e])}next(){const e=this.#r+1;if(this.#pe[e])return this.#r=e,this.#At(this.#pe[e]);for(;;){const{done:t,value:n}=this.#_t.next();if(t)break;if(this.#pe.push(n),this.#pe[e])return this.#r=e,this.#At(this.#pe[e])}}prepare(){const e=this.#r+1;if(this.#pe[e])return this.#At(this.#pe[e]);for(;;){const{done:t,value:n}=this.#_t.next();if(t)break;if(this.#pe.push(n),this.#pe[e])return this.#At(this.#pe[e])}}find(e){const t=this.#pe.findIndex((t=>e(t)));if(t>-1)return this.#r=t,this.#At(this.#pe[t]);for(;;){const{done:t,value:n}=this.#_t.next();if(t)break;if(this.#pe.push(n),e(n))return this.#r=this.#pe.length-1,this.#At(n)}}}class o{#Lt;#Tt;constructor(e,t,n){this.doc=e,this.highlight=n,this.#Lt=new r(function*(e){const t=e.createTreeWalker(e.body,NodeFilter.SHOW_TEXT);let n=null;for(let r=t.nextNode();r;r=t.nextNode()){let t;const o=/[.!?。！？]["'“”‘’]?/g;for(;null!==(t=o.exec(r.textContent));)e.createRange(),n&&(n.setEnd(r,t.index+t[0].length),i(n)||(yield n)),n=e.createRange(),n.setStart(r,t.index+t[0].length);n&&(n.setEnd(r,r.textContent.length),i(n)||(yield n)),n=e.createRange(),n.setStart(r,r.textContent.length)}}(e),(e=>[e.toString(),e]))}#Et(e,t){if(!e)return"";if(!t)return e;const n=document.createElement("div");n.innerHTML=e;let i=t(n)?.previousSibling;for(;i;){const e=i.previousSibling??i.parentNode?.previousSibling;i.parentNode.removeChild(i),i=e}return n.textContent}start(){this.#Tt=null;const[e,t]=this.#Lt.first()??[];return e?(this.highlight(t.cloneRange()),this.#Et(e)):this.next()}end(){this.#Tt=null;const[e,t]=this.#Lt.last()??[];return e?(this.highlight(t.cloneRange()),this.#Et(e)):this.next()}resume(){const[e]=this.#Lt.current()??[];return e?this.#Et(e):this.next()}prev(e){this.#Tt=null;const[t,n]=this.#Lt.prev()??[];return e&&n&&this.highlight(n.cloneRange()),this.#Et(t)}next(e){this.#Tt=null;const[t,n]=this.#Lt.next()??[];return e&&n&&this.highlight(n.cloneRange()),this.#Et(t)}prepare(){const[e]=this.#Lt.prepare()??[];return this.#Et(e)}from(e){this.#Tt=null;const[t,n]=this.#Lt.find((t=>e.compareBoundaryPoints(Range.END_TO_START,t)<=0));return n&&this.highlight(n.cloneRange()),this.#Et(t)}}},986:(e,t,n)=>{n.d(t,{EL:()=>E,Lu:()=>o,RK:()=>l,Xp:()=>A,ob:()=>L,qg:()=>f,wT:()=>T,yT:()=>_});const i=(e,t)=>[-1,...t,e.length].reduce((({xs:t,a:n},i)=>({xs:t?.concat([e.slice(n+1,i)])??[],a:i})),{}).xs,r=/\d/,o=/^epubcfi\((.*)\)$/,a=e=>e.replace(/[\^[\](),;=]/g,"^$&"),s=e=>o.test(e)?e:`epubcfi(${e})`,l=(c=(...e)=>e.join("!"),(...e)=>`epubcfi(${c(...e.map((e=>e.match(o)?.[1]??e)))})`);var c;const d=(e,t)=>((e,t)=>e.map(((e,n,i)=>t(e)?n:null)).filter((e=>null!=e)))(e,(([e])=>e===t)),h=e=>{const t=[];let n;for(const[i,r]of e){if("/"===i)t.push({index:r});else{const e=t[t.length-1];if(":"===i)e.offset=r;else if("~"===i)e.temporal=r;else if("@"===i)e.spatial=(e.spatial??[]).concat(r);else if(";s"===i)e.side=r;else if("["===i){if("/"!==n||!r){e.text=(e.text??[]).concat(r);continue}e.id=r}}n=i}return t},u=e=>i(e,d(e,"!")).map(h),f=e=>{const t=(e=>{const t=[];let n,i,o="";const a=e=>(t.push(e),n=null,o=""),s=e=>(o+=e,i=!1);for(const t of Array.from(e.trim()).concat(""))if("^"!==t||i){if("!"===n)a(["!"]);else if(","===n)a([","]);else if("/"===n||":"===n){if(r.test(t)){s(t);continue}a([n,parseInt(o)])}else if("~"===n){if(r.test(t)||"."===t){s(t);continue}a(["~",parseFloat(o)])}else if("@"===n){if(":"===t){a(["@",parseFloat(o)]),n="@";continue}if(r.test(t)||"."===t){s(t);continue}a(["@",parseFloat(o)])}else{if("["===n){";"!==t||i?","!==t||i?"]"!==t||i?s(t):a(["[",o]):(a(["[",o]),n="["):(a(["[",o]),n=";");continue}if(n?.startsWith(";")){"="!==t||i?";"!==t||i?"]"!==t||i?s(t):a([n,o]):(a([n,o]),n=";"):(n=`;${o}`,o="");continue}}"/"!==t&&":"!==t&&"~"!==t&&"@"!==t&&"["!==t&&"!"!==t&&","!==t||(n=t)}else i=!0;return t})((n=e,n.match(o)?.[1]??n));var n;const a=d(t,",");if(!a.length)return u(t);const[s,l,c]=i(t,a).map(u);return{parent:s,start:l,end:c}},g=({index:e,id:t,offset:n,temporal:i,spatial:r,text:o,side:s})=>{const l=s?`;s=${s}`:"";return`/${e}`+(t?`[${a(t)}${l}]`:"")+(null!=n&&e%2?`:${n}`:"")+(i?`~${i}`:"")+(r?`@${r.join(":")}`:"")+(o||!t&&s?"["+(o?.map(a)?.join(",")??"")+l+"]":"")},p=e=>e.parent?[e.parent,e.start,e.end].map(p).join(","):e.map((e=>e.map(g).join(""))).join("!"),m=e=>s(p(e)),w=(e,t)=>{return"string"==typeof e?m(w(f(e),t)):e.parent?(n=e.parent,i=e[t?"end":"start"],n.slice(0,-1).concat([n[n.length-1].concat(i[0])]).concat(i.slice(1))):e;var n,i},b=({nodeType:e})=>3===e||4===e,y=({nodeType:e})=>1===e,x=(e,t)=>{const n=Array.from(e.childNodes).filter((e=>b(e)||y(e)));return t?n.map((e=>{const n=t(e);return n===NodeFilter.FILTER_REJECT?null:n===NodeFilter.FILTER_SKIP?x(e,t):e})).flat().filter((e=>e)):n},v=(e,t)=>{const n=x(e,t).reduce(((e,t)=>{let n=e[e.length-1];return n?b(t)?Array.isArray(n)?n.push(t):b(n)?e[e.length-1]=[n,t]:e.push(t):y(n)?e.push(null,t):e.push(t):e.push(t),e}),[]);return y(n[0])&&n.unshift("first"),y(n[n.length-1])&&n.push("last"),n.unshift("before"),n.push("after"),n},k=(e,t,n)=>{const{id:i}=t[t.length-1];if(i){const t=e.ownerDocument.getElementById(i);if(t)return{node:t,offset:0}}for(const{index:i}of t){const t=e?v(e,n)[i]:null;if("first"===t)return{node:e.firstChild??e};if("last"===t)return{node:e.lastChild??e};if("before"===t)return{node:e,before:!0};if("after"===t)return{node:e,after:!0};e=t}const{offset:r}=t[t.length-1];if(!Array.isArray(e))return{node:e,offset:r};let o=0;for(const t of e){const{length:e}=t.nodeValue;if(o+e>=r)return{node:t,offset:r-o};o+=e}},S=(e,t,n)=>{const{parentNode:i,id:r}=e,o=v(i,n),a=o.findIndex((t=>Array.isArray(t)?t.some((t=>t===e)):t===e)),s=o[a];if(Array.isArray(s)){let n=0;for(const i of s){if(i===e){n+=t;break}n+=i.nodeValue.length}t=n}const l={id:r,index:a,offset:t};return(i!==e.ownerDocument.documentElement?S(i,null,n).concat(l):[l]).filter((e=>-1!==e.index))},_=(e,t)=>{const{startContainer:n,startOffset:i,endContainer:r,endOffset:o}=e,a=S(n,i,t);if(e.collapsed)return m([a]);return((e,t)=>{"string"==typeof e&&(e=f(e)),"string"==typeof t&&(t=f(t)),e=w(e),t=w(t,!0);const n=e[e.length-1],i=t[t.length-1],r=[],o=[],a=[];let s=!0;const l=Math.max(n.length,i.length);for(let e=0;e<l;e++){const t=n[e],l=i[e];s&&=t?.index===l?.index&&!t?.offset&&!l?.offset,s?r.push(t):(t&&o.push(t),l&&a.push(l))}const c=e.slice(0,-1).concat([r]);return m({parent:c,start:[o],end:[a]})})([a],[S(r,o,t)])},A=(e,t,n)=>{const i=w(t),r=w(t,!0),o=e.documentElement,a=k(o,i[0],n),s=k(o,r[0],n),l=e.createRange();return a.before?l.setStartBefore(a.node):a.after?l.setStartAfter(a.node):l.setStart(a.node,a.offset),s.before?l.setEndBefore(s.node):s.after?l.setEndAfter(s.node):l.setEnd(s.node,s.offset),l},L=e=>{const t=[],{parentNode:n}=e[0],i=S(n);for(const[r,o]of v(n).entries()){const n=e[t.length];o===n&&t.push(m([i.concat({id:n.id,index:r})]))}return t},T=(e,t)=>k(e.documentElement,w(t)).node,E={fromIndex:e=>s("/6/"+2*(e+1)),toIndex:e=>e?.at(-1).index/2-1}}},o={};function a(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}};return r[e](n,n.exports,a),n.exports}e="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",t="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},a.a=(r,o,a)=>{var s;a&&((s=[]).d=-1);var l,c,d,h=new Set,u=r.exports,f=new Promise(((e,t)=>{d=t,c=e}));f[t]=u,f[e]=e=>(s&&e(s),h.forEach(e),f.catch((e=>{}))),r.exports=f,o((r=>{var o;l=(r=>r.map((r=>{if(null!==r&&"object"==typeof r){if(r[e])return r;if(r.then){var o=[];o.d=0,r.then((e=>{a[t]=e,i(o)}),(e=>{a[n]=e,i(o)}));var a={};return a[e]=e=>e(o),a}}var s={};return s[e]=e=>{},s[t]=r,s})))(r);var a=()=>l.map((e=>{if(e[n])throw e[n];return e[t]})),c=new Promise((t=>{(o=()=>t(a)).r=0;var n=e=>e!==s&&!h.has(e)&&(h.add(e),e&&!e.d&&(o.r++,e.push(o)));l.map((t=>t[e](n)))}));return o.r?c:a()}),(e=>(e?d(f[n]=e):c(u),i(s)))),s&&s.d<0&&(s.d=0)},a.d=(e,t)=>{for(var n in t)a.o(t,n)&&!a.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},a.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),a.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a(531)})();