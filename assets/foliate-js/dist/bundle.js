(()=>{"use strict";var t,e,n,i,r={113:(t,e,n)=>{n.r(e),n.d(e,{FixedLayout:()=>r});const i=t=>t?.split(/[,;\s]/)?.filter((t=>t))?.map((t=>t.split("=").map((t=>t.trim()))));class r extends HTMLElement{#t=this.attachShadow({mode:"closed"});#e=new ResizeObserver((()=>this.#n()));#i;#r=-1;defaultViewport;spread;#o=!1;#a;#s;#l;#c;constructor(){super();const t=new CSSStyleSheet;this.#t.adoptedStyleSheets=[t],t.replaceSync(":host {\n            width: 100%;\n            height: 100%;\n            display: flex;\n            justify-content: center;\n            align-items: center;\n        }"),this.#e.observe(this)}async#d(t,{index:e,src:n}){const r=document.createElement("div"),o=document.createElement("iframe");return r.append(o),Object.assign(o.style,{border:"0",display:"none",overflow:"hidden"}),o.setAttribute("sandbox","allow-same-origin allow-scripts"),o.setAttribute("scrolling","no"),o.setAttribute("part","filter"),this.#t.append(r),n?new Promise((a=>{const s=()=>{o.removeEventListener("load",s);const n=o.contentDocument;n.position=t,this.dispatchEvent(new CustomEvent("load",{detail:{doc:n,index:e}}));const{width:l,height:c}=((t,e)=>{if("svg"===t.documentElement.localName){const[,,e,n]=t.documentElement.getAttribute("viewBox")?.split(/\s/)??[];return{width:e,height:n}}const n=i(t.querySelector('meta[name="viewport"]')?.getAttribute("content"));if(n)return Object.fromEntries(n);if("string"==typeof e)return i(e);if(e)return e;const r=t.querySelector("img");return r?{width:r.naturalWidth,height:r.naturalHeight}:(console.warn(new Error("Missing viewport properties")),{width:1e3,height:2e3})})(n,this.defaultViewport);a({element:r,iframe:o,width:parseFloat(l),height:parseFloat(c)})};o.addEventListener("load",s),o.src=n})):{blank:!0,element:r,iframe:o}}#n(t=this.#c){if(!t)return;const e=this.#a??{},n=this.#l??this.#s,i="left"===t?e:n,{width:r,height:o}=this.getBoundingClientRect(),a="both"!==this.spread&&"portrait"!==this.spread&&o>r;this.#o=a;const s=e.width??n.width,l=e.height??n.height,c=a||this.#l?Math.min(r/(i.width??s),o/(i.height??l)):Math.min(r/((e.width??s)+(n.width??s)),o/Math.max(e.height??l,n.height??l)),d=t=>{const{element:e,iframe:n,width:r,height:o,blank:d}=t;n.contentDocument.scale=c,Object.assign(n.style,{width:`${r}px`,height:`${o}px`,transform:`scale(${c})`,transformOrigin:"top left",display:d?"none":"block"}),Object.assign(e.style,{width:(r??s)*c+"px",height:(o??l)*c+"px",overflow:"hidden",display:"block"}),a&&t!==i&&(e.style.display="none")};this.#l?d(this.#l):(d(e),d(n))}async#h({left:t,right:e,center:n,side:i}){this.#t.replaceChildren(),this.#a=null,this.#s=null,this.#l=null,n?(this.#l=await this.#d("center",n),this.#c="center",this.#n()):(this.#a=await this.#d("left",t),this.#s=await this.#d("right",e),this.#c=this.#a.blank?"right":this.#s.blank?"left":i,this.#n())}#u(){if(!this.#l&&!this.#a?.blank)return this.#o&&"none"===this.#a?.element?.style?.display?(this.#s.element.style.display="none",this.#a.element.style.display="block",this.#c="left",!0):void 0}#f(){if(!this.#l&&!this.#s?.blank)return this.#o&&"none"===this.#s?.element?.style?.display?(this.#a.element.style.display="none",this.#s.element.style.display="block",this.#c="right",!0):void 0}open(t){this.book=t;const{rendition:e}=t;this.spread=e?.spread,this.defaultViewport=e?.viewport;const n="rtl"===t.dir,i=!n;this.rtl=n,this.#i="none"===e?.spread?t.sections.map((t=>({center:t}))):t.sections.reduce(((t,e)=>{const r=t[t.length-1],{linear:o,pageSpread:a}=e;if("no"===o)return t;const s=()=>{const e={};return t.push(e),e};return"center"===a?(r.left||r.right?s():r).center=e:"left"===a?(r.center||r.left||i?s():r).left=e:"right"===a?(r.center||r.right||n?s():r).right=e:i?r.center||r.right?s().left=e:r.left?r.right=e:r.left=e:r.center||r.left?s().right=e:r.right?r.left=e:r.right=e,t}),[{}])}get index(){const t=this.#i[this.#r],e=t?.center??("left"===this.side?t.left??t.right:t.right??t.left);return this.book.sections.indexOf(e)}#p(t){this.dispatchEvent(new CustomEvent("relocate",{detail:{reason:t,range:null,index:this.index,fraction:0,size:1}}))}getSpreadOf(t){const e=this.#i;for(let n=0;n<e.length;n++){const{left:i,right:r,center:o}=e[n];if(i===t)return{index:n,side:"left"};if(r===t)return{index:n,side:"right"};if(o===t)return{index:n,side:"center"}}}async goToSpread(t,e,n){if(t<0||t>this.#i.length-1)return;if(t===this.#r)return void this.#n(e);this.#r=t;const i=this.#i[t];if(i.center){const t=this.book.sections.indexOf(i.center),e=await(i.center?.load?.());await this.#h({center:{index:t,src:e}})}else{const t=this.book.sections.indexOf(i.left),n=this.book.sections.indexOf(i.right),r={index:t,src:await(i.left?.load?.())},o={index:n,src:await(i.right?.load?.())};await this.#h({left:r,right:o,side:e})}this.#p(n)}async select(t){await this.goTo(t)}async goTo(t){const{book:e}=this,n=await t,i=e.sections[n.index];if(!i)return;const{index:r,side:o}=this.getSpreadOf(i);await this.goToSpread(r,o)}async next(){if(!(this.rtl?this.#u():this.#f()))return this.goToSpread(this.#r+1,this.rtl?"right":"left","page");this.#p("page")}async prev(){if(!(this.rtl?this.#f():this.#u()))return this.goToSpread(this.#r-1,this.rtl?"left":"right","page");this.#p("page")}getContents(){return Array.from(this.#t.querySelectorAll("iframe"),(t=>({doc:t.contentDocument})))}destroy(){this.#e.unobserve(this)}}customElements.define("foliate-fxl",r)},196:(t,e,n)=>{n.d(e,{u:()=>s});const i=(t,e)=>{const n=[];for(let i=e.currentNode;i;i=e.nextNode()){const e=t.comparePoint(i,0);if(0===e)n.push(i);else if(e>0)break}return n},r=(t,e)=>{const n=[];for(let t=e.nextNode();t;t=e.nextNode())n.push(t);return n},o=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT|NodeFilter.SHOW_CDATA_SECTION,a=t=>{if(1===t.nodeType){const e=t.tagName.toLowerCase();return"script"===e||"style"===e?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_ACCEPT},s=function*(t,e){const n=t.commonAncestorContainer??t.body??t,s=document.createTreeWalker(n,o,{acceptNode:a}),l=(t.commonAncestorContainer?i:r)(t,s),c=l.map((t=>t.nodeValue)),d=(t,e,n,i)=>{const r=document.createRange();return r.setStart(l[t],e),r.setEnd(l[n],i),r};for(const t of e(c,d))yield t}},260:(t,e,n)=>{n.d(e,{BlobReader:()=>re,BlobWriter:()=>oe,TextWriter:()=>ae,ZipReader:()=>Fe,configure:()=>M});const i=-2,r=-3,o=-5,a=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],s=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],l=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],c=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],d=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],h=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],u=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13];function f(){let t,e,n,i,a,s;function l(t,e,l,c,d,h,u,f,p,g,m){let w,b,y,x,v,k,S,_,A,T,L,E,C,I,R;T=0,v=l;do{n[t[e+T]]++,T++,v--}while(0!==v);if(n[0]==l)return u[0]=-1,f[0]=0,0;for(_=f[0],k=1;k<=15&&0===n[k];k++);for(S=k,_<k&&(_=k),v=15;0!==v&&0===n[v];v--);for(y=v,_>v&&(_=v),f[0]=_,I=1<<k;k<v;k++,I<<=1)if((I-=n[k])<0)return r;if((I-=n[v])<0)return r;for(n[v]+=I,s[1]=k=0,T=1,C=2;0!=--v;)s[C]=k+=n[T],C++,T++;v=0,T=0;do{0!==(k=t[e+T])&&(m[s[k]++]=v),T++}while(++v<l);for(l=s[y],s[0]=v=0,T=0,x=-1,E=-_,a[0]=0,L=0,R=0;S<=y;S++)for(w=n[S];0!=w--;){for(;S>E+_;){if(x++,E+=_,R=y-E,R=R>_?_:R,(b=1<<(k=S-E))>w+1&&(b-=w+1,C=S,k<R))for(;++k<R&&!((b<<=1)<=n[++C]);)b-=n[C];if(R=1<<k,g[0]+R>1440)return r;a[x]=L=g[0],g[0]+=R,0!==x?(s[x]=v,i[0]=k,i[1]=_,k=v>>>E-_,i[2]=L-a[x-1]-k,p.set(i,3*(a[x-1]+k))):u[0]=L}for(i[1]=S-E,T>=l?i[0]=192:m[T]<c?(i[0]=m[T]<256?0:96,i[2]=m[T++]):(i[0]=h[m[T]-c]+16+64,i[2]=d[m[T++]-c]),b=1<<S-E,k=v>>>E;k<R;k+=b)p.set(i,3*(L+k));for(k=1<<S-1;v&k;k>>>=1)v^=k;for(v^=k,A=(1<<E)-1;(v&A)!=s[x];)x--,E-=_,A=(1<<E)-1}return 0!==I&&1!=y?o:0}function f(r){let o;for(t||(t=[],e=[],n=new Int32Array(16),i=[],a=new Int32Array(15),s=new Int32Array(16)),e.length<r&&(e=[]),o=0;o<r;o++)e[o]=0;for(o=0;o<16;o++)n[o]=0;for(o=0;o<3;o++)i[o]=0;a.set(n.subarray(0,15),0),s.set(n.subarray(0,16),0)}this.inflate_trees_bits=function(n,i,a,s,c){let d;return f(19),t[0]=0,d=l(n,0,19,19,null,null,a,i,s,t,e),d==r?c.msg="oversubscribed dynamic bit lengths tree":d!=o&&0!==i[0]||(c.msg="incomplete dynamic bit lengths tree",d=r),d},this.inflate_trees_dynamic=function(n,i,a,s,p,g,m,w,b){let y;return f(288),t[0]=0,y=l(a,0,n,257,c,d,g,s,w,t,e),0!=y||0===s[0]?(y==r?b.msg="oversubscribed literal/length tree":-4!=y&&(b.msg="incomplete literal/length tree",y=r),y):(f(288),y=l(a,n,i,0,h,u,m,p,w,t,e),0!=y||0===p[0]&&n>257?(y==r?b.msg="oversubscribed distance tree":y==o?(b.msg="incomplete distance tree",y=r):-4!=y&&(b.msg="empty distance tree with lengths",y=r),y):0)}}function p(){const t=this;let e,n,o,s,l=0,c=0,d=0,h=0,u=0,f=0,p=0,g=0,m=0,w=0;function b(t,e,n,i,o,s,l,c){let d,h,u,f,p,g,m,w,b,y,x,v,k,S,_,A;m=c.next_in_index,w=c.avail_in,p=l.bitb,g=l.bitk,b=l.write,y=b<l.read?l.read-b-1:l.end-b,x=a[t],v=a[e];do{for(;g<20;)w--,p|=(255&c.read_byte(m++))<<g,g+=8;if(d=p&x,h=n,u=i,A=3*(u+d),0!==(f=h[A]))for(;;){if(p>>=h[A+1],g-=h[A+1],16&f){for(f&=15,k=h[A+2]+(p&a[f]),p>>=f,g-=f;g<15;)w--,p|=(255&c.read_byte(m++))<<g,g+=8;for(d=p&v,h=o,u=s,A=3*(u+d),f=h[A];;){if(p>>=h[A+1],g-=h[A+1],16&f){for(f&=15;g<f;)w--,p|=(255&c.read_byte(m++))<<g,g+=8;if(S=h[A+2]+(p&a[f]),p>>=f,g-=f,y-=k,b>=S)_=b-S,b-_>0&&2>b-_?(l.win[b++]=l.win[_++],l.win[b++]=l.win[_++],k-=2):(l.win.set(l.win.subarray(_,_+2),b),b+=2,_+=2,k-=2);else{_=b-S;do{_+=l.end}while(_<0);if(f=l.end-_,k>f){if(k-=f,b-_>0&&f>b-_)do{l.win[b++]=l.win[_++]}while(0!=--f);else l.win.set(l.win.subarray(_,_+f),b),b+=f,_+=f,f=0;_=0}}if(b-_>0&&k>b-_)do{l.win[b++]=l.win[_++]}while(0!=--k);else l.win.set(l.win.subarray(_,_+k),b),b+=k,_+=k,k=0;break}if(64&f)return c.msg="invalid distance code",k=c.avail_in-w,k=g>>3<k?g>>3:k,w+=k,m-=k,g-=k<<3,l.bitb=p,l.bitk=g,c.avail_in=w,c.total_in+=m-c.next_in_index,c.next_in_index=m,l.write=b,r;d+=h[A+2],d+=p&a[f],A=3*(u+d),f=h[A]}break}if(64&f)return 32&f?(k=c.avail_in-w,k=g>>3<k?g>>3:k,w+=k,m-=k,g-=k<<3,l.bitb=p,l.bitk=g,c.avail_in=w,c.total_in+=m-c.next_in_index,c.next_in_index=m,l.write=b,1):(c.msg="invalid literal/length code",k=c.avail_in-w,k=g>>3<k?g>>3:k,w+=k,m-=k,g-=k<<3,l.bitb=p,l.bitk=g,c.avail_in=w,c.total_in+=m-c.next_in_index,c.next_in_index=m,l.write=b,r);if(d+=h[A+2],d+=p&a[f],A=3*(u+d),0===(f=h[A])){p>>=h[A+1],g-=h[A+1],l.win[b++]=h[A+2],y--;break}}else p>>=h[A+1],g-=h[A+1],l.win[b++]=h[A+2],y--}while(y>=258&&w>=10);return k=c.avail_in-w,k=g>>3<k?g>>3:k,w+=k,m-=k,g-=k<<3,l.bitb=p,l.bitk=g,c.avail_in=w,c.total_in+=m-c.next_in_index,c.next_in_index=m,l.write=b,0}t.init=function(t,i,r,a,l,c){e=0,p=t,g=i,o=r,m=a,s=l,w=c,n=null},t.proc=function(t,y,x){let v,k,S,_,A,T,L,E=0,C=0,I=0;for(I=y.next_in_index,_=y.avail_in,E=t.bitb,C=t.bitk,A=t.write,T=A<t.read?t.read-A-1:t.end-A;;)switch(e){case 0:if(T>=258&&_>=10&&(t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,x=b(p,g,o,m,s,w,t,y),I=y.next_in_index,_=y.avail_in,E=t.bitb,C=t.bitk,A=t.write,T=A<t.read?t.read-A-1:t.end-A,0!=x)){e=1==x?7:9;break}d=p,n=o,c=m,e=1;case 1:for(v=d;C<v;){if(0===_)return t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);x=0,_--,E|=(255&y.read_byte(I++))<<C,C+=8}if(k=3*(c+(E&a[v])),E>>>=n[k+1],C-=n[k+1],S=n[k],0===S){h=n[k+2],e=6;break}if(16&S){u=15&S,l=n[k+2],e=2;break}if(!(64&S)){d=S,c=k/3+n[k+2];break}if(32&S){e=7;break}return e=9,y.msg="invalid literal/length code",x=r,t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);case 2:for(v=u;C<v;){if(0===_)return t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);x=0,_--,E|=(255&y.read_byte(I++))<<C,C+=8}l+=E&a[v],E>>=v,C-=v,d=g,n=s,c=w,e=3;case 3:for(v=d;C<v;){if(0===_)return t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);x=0,_--,E|=(255&y.read_byte(I++))<<C,C+=8}if(k=3*(c+(E&a[v])),E>>=n[k+1],C-=n[k+1],S=n[k],16&S){u=15&S,f=n[k+2],e=4;break}if(!(64&S)){d=S,c=k/3+n[k+2];break}return e=9,y.msg="invalid distance code",x=r,t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);case 4:for(v=u;C<v;){if(0===_)return t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);x=0,_--,E|=(255&y.read_byte(I++))<<C,C+=8}f+=E&a[v],E>>=v,C-=v,e=5;case 5:for(L=A-f;L<0;)L+=t.end;for(;0!==l;){if(0===T&&(A==t.end&&0!==t.read&&(A=0,T=A<t.read?t.read-A-1:t.end-A),0===T&&(t.write=A,x=t.inflate_flush(y,x),A=t.write,T=A<t.read?t.read-A-1:t.end-A,A==t.end&&0!==t.read&&(A=0,T=A<t.read?t.read-A-1:t.end-A),0===T)))return t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);t.win[A++]=t.win[L++],T--,L==t.end&&(L=0),l--}e=0;break;case 6:if(0===T&&(A==t.end&&0!==t.read&&(A=0,T=A<t.read?t.read-A-1:t.end-A),0===T&&(t.write=A,x=t.inflate_flush(y,x),A=t.write,T=A<t.read?t.read-A-1:t.end-A,A==t.end&&0!==t.read&&(A=0,T=A<t.read?t.read-A-1:t.end-A),0===T)))return t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);x=0,t.win[A++]=h,T--,e=0;break;case 7:if(C>7&&(C-=8,_++,I--),t.write=A,x=t.inflate_flush(y,x),A=t.write,T=A<t.read?t.read-A-1:t.end-A,t.read!=t.write)return t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);e=8;case 8:return x=1,t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);case 9:return x=r,t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x);default:return x=i,t.bitb=E,t.bitk=C,y.avail_in=_,y.total_in+=I-y.next_in_index,y.next_in_index=I,t.write=A,t.inflate_flush(y,x)}},t.free=function(){}}f.inflate_trees_fixed=function(t,e,n,i){return t[0]=9,e[0]=5,n[0]=s,i[0]=l,0};const g=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function m(t,e){const n=this;let s,l=0,c=0,d=0,h=0;const u=[0],m=[0],w=new p;let b=0,y=new Int32Array(4320);const x=new f;n.bitk=0,n.bitb=0,n.win=new Uint8Array(e),n.end=e,n.read=0,n.write=0,n.reset=function(t,e){e&&(e[0]=0),6==l&&w.free(t),l=0,n.bitk=0,n.bitb=0,n.read=n.write=0},n.reset(t,null),n.inflate_flush=function(t,e){let i,r,a;return r=t.next_out_index,a=n.read,i=(a<=n.write?n.write:n.end)-a,i>t.avail_out&&(i=t.avail_out),0!==i&&e==o&&(e=0),t.avail_out-=i,t.total_out+=i,t.next_out.set(n.win.subarray(a,a+i),r),r+=i,a+=i,a==n.end&&(a=0,n.write==n.end&&(n.write=0),i=n.write-a,i>t.avail_out&&(i=t.avail_out),0!==i&&e==o&&(e=0),t.avail_out-=i,t.total_out+=i,t.next_out.set(n.win.subarray(a,a+i),r),r+=i,a+=i),t.next_out_index=r,n.read=a,e},n.proc=function(t,e){let o,p,v,k,S,_,A,T;for(k=t.next_in_index,S=t.avail_in,p=n.bitb,v=n.bitk,_=n.write,A=_<n.read?n.read-_-1:n.end-_;;){let L,E,C,I,R,M,z,O;switch(l){case 0:for(;v<3;){if(0===S)return n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);e=0,S--,p|=(255&t.read_byte(k++))<<v,v+=8}switch(o=7&p,b=1&o,o>>>1){case 0:p>>>=3,v-=3,o=7&v,p>>>=o,v-=o,l=1;break;case 1:L=[],E=[],C=[[]],I=[[]],f.inflate_trees_fixed(L,E,C,I),w.init(L[0],E[0],C[0],0,I[0],0),p>>>=3,v-=3,l=6;break;case 2:p>>>=3,v-=3,l=3;break;case 3:return p>>>=3,v-=3,l=9,t.msg="invalid block type",e=r,n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e)}break;case 1:for(;v<32;){if(0===S)return n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);e=0,S--,p|=(255&t.read_byte(k++))<<v,v+=8}if((~p>>>16&65535)!=(65535&p))return l=9,t.msg="invalid stored block lengths",e=r,n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);c=65535&p,p=v=0,l=0!==c?2:0!==b?7:0;break;case 2:if(0===S)return n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);if(0===A&&(_==n.end&&0!==n.read&&(_=0,A=_<n.read?n.read-_-1:n.end-_),0===A&&(n.write=_,e=n.inflate_flush(t,e),_=n.write,A=_<n.read?n.read-_-1:n.end-_,_==n.end&&0!==n.read&&(_=0,A=_<n.read?n.read-_-1:n.end-_),0===A)))return n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);if(e=0,o=c,o>S&&(o=S),o>A&&(o=A),n.win.set(t.read_buf(k,o),_),k+=o,S-=o,_+=o,A-=o,0!=(c-=o))break;l=0!==b?7:0;break;case 3:for(;v<14;){if(0===S)return n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);e=0,S--,p|=(255&t.read_byte(k++))<<v,v+=8}if(d=o=16383&p,(31&o)>29||(o>>5&31)>29)return l=9,t.msg="too many length or distance symbols",e=r,n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);if(o=258+(31&o)+(o>>5&31),!s||s.length<o)s=[];else for(T=0;T<o;T++)s[T]=0;p>>>=14,v-=14,h=0,l=4;case 4:for(;h<4+(d>>>10);){for(;v<3;){if(0===S)return n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);e=0,S--,p|=(255&t.read_byte(k++))<<v,v+=8}s[g[h++]]=7&p,p>>>=3,v-=3}for(;h<19;)s[g[h++]]=0;if(u[0]=7,o=x.inflate_trees_bits(s,u,m,y,t),0!=o)return(e=o)==r&&(s=null,l=9),n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);h=0,l=5;case 5:for(;o=d,!(h>=258+(31&o)+(o>>5&31));){let i,c;for(o=u[0];v<o;){if(0===S)return n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);e=0,S--,p|=(255&t.read_byte(k++))<<v,v+=8}if(o=y[3*(m[0]+(p&a[o]))+1],c=y[3*(m[0]+(p&a[o]))+2],c<16)p>>>=o,v-=o,s[h++]=c;else{for(T=18==c?7:c-14,i=18==c?11:3;v<o+T;){if(0===S)return n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);e=0,S--,p|=(255&t.read_byte(k++))<<v,v+=8}if(p>>>=o,v-=o,i+=p&a[T],p>>>=T,v-=T,T=h,o=d,T+i>258+(31&o)+(o>>5&31)||16==c&&T<1)return s=null,l=9,t.msg="invalid bit length repeat",e=r,n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);c=16==c?s[T-1]:0;do{s[T++]=c}while(0!=--i);h=T}}if(m[0]=-1,R=[],M=[],z=[],O=[],R[0]=9,M[0]=6,o=d,o=x.inflate_trees_dynamic(257+(31&o),1+(o>>5&31),s,R,M,z,O,y,t),0!=o)return o==r&&(s=null,l=9),e=o,n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);w.init(R[0],M[0],y,z[0],y,O[0]),l=6;case 6:if(n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,1!=(e=w.proc(n,t,e)))return n.inflate_flush(t,e);if(e=0,w.free(t),k=t.next_in_index,S=t.avail_in,p=n.bitb,v=n.bitk,_=n.write,A=_<n.read?n.read-_-1:n.end-_,0===b){l=0;break}l=7;case 7:if(n.write=_,e=n.inflate_flush(t,e),_=n.write,A=_<n.read?n.read-_-1:n.end-_,n.read!=n.write)return n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);l=8;case 8:return e=1,n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);case 9:return e=r,n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e);default:return e=i,n.bitb=p,n.bitk=v,t.avail_in=S,t.total_in+=k-t.next_in_index,t.next_in_index=k,n.write=_,n.inflate_flush(t,e)}}},n.free=function(t){n.reset(t,null),n.win=null,y=null},n.set_dictionary=function(t,e,i){n.win.set(t.subarray(e,e+i),0),n.read=n.write=i},n.sync_point=function(){return 1==l?1:0}}const w=13,b=[0,0,255,255];function y(){const t=this;function e(t){return t&&t.istate?(t.total_in=t.total_out=0,t.msg=null,t.istate.mode=7,t.istate.blocks.reset(t,null),0):i}t.mode=0,t.method=0,t.was=[0],t.need=0,t.marker=0,t.wbits=0,t.inflateEnd=function(e){return t.blocks&&t.blocks.free(e),t.blocks=null,0},t.inflateInit=function(n,r){return n.msg=null,t.blocks=null,r<8||r>15?(t.inflateEnd(n),i):(t.wbits=r,n.istate.blocks=new m(n,1<<r),e(n),0)},t.inflate=function(t,e){let n,a;if(!t||!t.istate||!t.next_in)return i;const s=t.istate;for(e=4==e?o:0,n=o;;)switch(s.mode){case 0:if(0===t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,8!=(15&(s.method=t.read_byte(t.next_in_index++)))){s.mode=w,t.msg="unknown compression method",s.marker=5;break}if(8+(s.method>>4)>s.wbits){s.mode=w,t.msg="invalid win size",s.marker=5;break}s.mode=1;case 1:if(0===t.avail_in)return n;if(n=e,t.avail_in--,t.total_in++,a=255&t.read_byte(t.next_in_index++),((s.method<<8)+a)%31!=0){s.mode=w,t.msg="incorrect header check",s.marker=5;break}if(!(32&a)){s.mode=7;break}s.mode=2;case 2:if(0===t.avail_in)return n;n=e,t.avail_in--,t.total_in++,s.need=(255&t.read_byte(t.next_in_index++))<<24&4278190080,s.mode=3;case 3:if(0===t.avail_in)return n;n=e,t.avail_in--,t.total_in++,s.need+=(255&t.read_byte(t.next_in_index++))<<16&16711680,s.mode=4;case 4:if(0===t.avail_in)return n;n=e,t.avail_in--,t.total_in++,s.need+=(255&t.read_byte(t.next_in_index++))<<8&65280,s.mode=5;case 5:return 0===t.avail_in?n:(n=e,t.avail_in--,t.total_in++,s.need+=255&t.read_byte(t.next_in_index++),s.mode=6,2);case 6:return s.mode=w,t.msg="need dictionary",s.marker=0,i;case 7:if(n=s.blocks.proc(t,n),n==r){s.mode=w,s.marker=0;break}if(0==n&&(n=e),1!=n)return n;n=e,s.blocks.reset(t,s.was),s.mode=12;case 12:return t.avail_in=0,1;case w:return r;default:return i}},t.inflateSetDictionary=function(t,e,n){let r=0,o=n;if(!t||!t.istate||6!=t.istate.mode)return i;const a=t.istate;return o>=1<<a.wbits&&(o=(1<<a.wbits)-1,r=n-o),a.blocks.set_dictionary(e,r,o),a.mode=7,0},t.inflateSync=function(t){let n,a,s,l,c;if(!t||!t.istate)return i;const d=t.istate;if(d.mode!=w&&(d.mode=w,d.marker=0),0===(n=t.avail_in))return o;for(a=t.next_in_index,s=d.marker;0!==n&&s<4;)t.read_byte(a)==b[s]?s++:s=0!==t.read_byte(a)?0:4-s,a++,n--;return t.total_in+=a-t.next_in_index,t.next_in_index=a,t.avail_in=n,d.marker=s,4!=s?r:(l=t.total_in,c=t.total_out,e(t),t.total_in=l,t.total_out=c,d.mode=7,0)},t.inflateSyncPoint=function(t){return t&&t.istate&&t.istate.blocks?t.istate.blocks.sync_point():i}}function x(){}x.prototype={inflateInit(t){const e=this;return e.istate=new y,t||(t=15),e.istate.inflateInit(e,t)},inflate(t){const e=this;return e.istate?e.istate.inflate(e,t):i},inflateEnd(){const t=this;if(!t.istate)return i;const e=t.istate.inflateEnd(t);return t.istate=null,e},inflateSync(){const t=this;return t.istate?t.istate.inflateSync(t):i},inflateSetDictionary(t,e){const n=this;return n.istate?n.istate.inflateSetDictionary(n,t,e):i},read_byte(t){return this.next_in[t]},read_buf(t,e){return this.next_in.subarray(t,t+e)}};const v=4294967295,k=65535,S=33639248,_=101075792,A=void 0,T="undefined",L="function";class E{constructor(t){return class extends TransformStream{constructor(e,n){const i=new t(n);super({transform(t,e){e.enqueue(i.append(t))},flush(t){const e=i.flush();e&&t.enqueue(e)}})}}}}let C=2;try{typeof navigator!=T&&navigator.hardwareConcurrency&&(C=navigator.hardwareConcurrency)}catch(t){}const I={chunkSize:524288,maxWorkers:C,terminateWorkerTimeout:5e3,useWebWorkers:!0,useCompressionStream:!0,workerScripts:A,CompressionStreamNative:typeof CompressionStream!=T&&CompressionStream,DecompressionStreamNative:typeof DecompressionStream!=T&&DecompressionStream},R=Object.assign({},I);function M(t){const{baseURL:e,chunkSize:n,maxWorkers:i,terminateWorkerTimeout:r,useCompressionStream:o,useWebWorkers:a,Deflate:s,Inflate:l,CompressionStream:c,DecompressionStream:d,workerScripts:h}=t;if(z("baseURL",e),z("chunkSize",n),z("maxWorkers",i),z("terminateWorkerTimeout",r),z("useCompressionStream",o),z("useWebWorkers",a),s&&(R.CompressionStream=new E(s)),l&&(R.DecompressionStream=new E(l)),z("CompressionStream",c),z("DecompressionStream",d),h!==A){const{deflate:t,inflate:e}=h;if((t||e)&&(R.workerScripts||(R.workerScripts={})),t){if(!Array.isArray(t))throw new Error("workerScripts.deflate must be an array");R.workerScripts.deflate=t}if(e){if(!Array.isArray(e))throw new Error("workerScripts.inflate must be an array");R.workerScripts.inflate=e}}}function z(t,e){e!==A&&(R[t]=e)}const O=[];for(let t=0;t<256;t++){let e=t;for(let t=0;t<8;t++)1&e?e=e>>>1^3988292384:e>>>=1;O[t]=e}class B{constructor(t){this.crc=t||-1}append(t){let e=0|this.crc;for(let n=0,i=0|t.length;n<i;n++)e=e>>>8^O[255&(e^t[n])];this.crc=e}get(){return~this.crc}}class F extends TransformStream{constructor(){let t;const e=new B;super({transform(t,n){e.append(t),n.enqueue(t)},flush(){const n=new Uint8Array(4);new DataView(n.buffer).setUint32(0,e.get()),t.value=n}}),t=this}}const P={concat(t,e){if(0===t.length||0===e.length)return t.concat(e);const n=t[t.length-1],i=P.getPartial(n);return 32===i?t.concat(e):P._shiftRight(e,i,0|n,t.slice(0,t.length-1))},bitLength(t){const e=t.length;if(0===e)return 0;const n=t[e-1];return 32*(e-1)+P.getPartial(n)},clamp(t,e){if(32*t.length<e)return t;const n=(t=t.slice(0,Math.ceil(e/32))).length;return e&=31,n>0&&e&&(t[n-1]=P.partial(e,t[n-1]&2147483648>>e-1,1)),t},partial:(t,e,n)=>32===t?e:(n?0|e:e<<32-t)+1099511627776*t,getPartial:t=>Math.round(t/1099511627776)||32,_shiftRight(t,e,n,i){for(void 0===i&&(i=[]);e>=32;e-=32)i.push(n),n=0;if(0===e)return i.concat(t);for(let r=0;r<t.length;r++)i.push(n|t[r]>>>e),n=t[r]<<32-e;const r=t.length?t[t.length-1]:0,o=P.getPartial(r);return i.push(P.partial(e+o&31,e+o>32?n:i.pop(),1)),i}},N={bytes:{fromBits(t){const e=P.bitLength(t)/8,n=new Uint8Array(e);let i;for(let r=0;r<e;r++)!(3&r)&&(i=t[r/4]),n[r]=i>>>24,i<<=8;return n},toBits(t){const e=[];let n,i=0;for(n=0;n<t.length;n++)i=i<<8|t[n],!(3&~n)&&(e.push(i),i=0);return 3&n&&e.push(P.partial(8*(3&n),i)),e}}},U=class{constructor(t){const e=this;e.blockSize=512,e._init=[1732584193,4023233417,2562383102,271733878,3285377520],e._key=[1518500249,1859775393,2400959708,3395469782],t?(e._h=t._h.slice(0),e._buffer=t._buffer.slice(0),e._length=t._length):e.reset()}reset(){const t=this;return t._h=t._init.slice(0),t._buffer=[],t._length=0,t}update(t){const e=this;"string"==typeof t&&(t=N.utf8String.toBits(t));const n=e._buffer=P.concat(e._buffer,t),i=e._length,r=e._length=i+P.bitLength(t);if(r>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");const o=new Uint32Array(n);let a=0;for(let t=e.blockSize+i-(e.blockSize+i&e.blockSize-1);t<=r;t+=e.blockSize)e._block(o.subarray(16*a,16*(a+1))),a+=1;return n.splice(0,16*a),e}finalize(){const t=this;let e=t._buffer;const n=t._h;e=P.concat(e,[P.partial(1,1)]);for(let t=e.length+2;15&t;t++)e.push(0);for(e.push(Math.floor(t._length/4294967296)),e.push(0|t._length);e.length;)t._block(e.splice(0,16));return t.reset(),n}_f(t,e,n,i){return t<=19?e&n|~e&i:t<=39?e^n^i:t<=59?e&n|e&i|n&i:t<=79?e^n^i:void 0}_S(t,e){return e<<t|e>>>32-t}_block(t){const e=this,n=e._h,i=Array(80);for(let e=0;e<16;e++)i[e]=t[e];let r=n[0],o=n[1],a=n[2],s=n[3],l=n[4];for(let t=0;t<=79;t++){t>=16&&(i[t]=e._S(1,i[t-3]^i[t-8]^i[t-14]^i[t-16]));const n=e._S(5,r)+e._f(t,o,a,s)+l+i[t]+e._key[Math.floor(t/20)]|0;l=s,s=a,a=e._S(30,o),o=r,r=n}n[0]=n[0]+r|0,n[1]=n[1]+o|0,n[2]=n[2]+a|0,n[3]=n[3]+s|0,n[4]=n[4]+l|0}},D={getRandomValues(t){const e=new Uint32Array(t.buffer),n=t=>{let e=987654321;const n=4294967295;return function(){return e=36969*(65535&e)+(e>>16)&n,(((e<<16)+(t=18e3*(65535&t)+(t>>16)&n)&n)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let i,r=0;r<t.length;r+=4){const t=n(4294967296*(i||Math.random()));i=987654071*t(),e[r/4]=4294967296*t()|0}return t}},$={importKey:t=>new $.hmacSha1(N.bytes.toBits(t)),pbkdf2(t,e,n,i){if(n=n||1e4,i<0||n<0)throw new Error("invalid params to pbkdf2");const r=1+(i>>5)<<2;let o,a,s,l,c;const d=new ArrayBuffer(r),h=new DataView(d);let u=0;const f=P;for(e=N.bytes.toBits(e),c=1;u<(r||1);c++){for(o=a=t.encrypt(f.concat(e,[c])),s=1;s<n;s++)for(a=t.encrypt(a),l=0;l<a.length;l++)o[l]^=a[l];for(s=0;u<(r||1)&&s<o.length;s++)h.setInt32(u,o[s]),u+=4}return d.slice(0,i/8)},hmacSha1:class{constructor(t){const e=this,n=e._hash=U,i=[[],[]];e._baseHash=[new n,new n];const r=e._baseHash[0].blockSize/32;t.length>r&&(t=(new n).update(t).finalize());for(let e=0;e<r;e++)i[0][e]=909522486^t[e],i[1][e]=1549556828^t[e];e._baseHash[0].update(i[0]),e._baseHash[1].update(i[1]),e._resultHash=new n(e._baseHash[0])}reset(){const t=this;t._resultHash=new t._hash(t._baseHash[0]),t._updated=!1}update(t){this._updated=!0,this._resultHash.update(t)}digest(){const t=this,e=t._resultHash.finalize(),n=new t._hash(t._baseHash[1]).update(e).finalize();return t.reset(),n}encrypt(t){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(t),this.digest(t)}}},W="undefined"!=typeof crypto&&"function"==typeof crypto.getRandomValues,j="Invalid password",H="Invalid signature",q="zipjs-abort-check-password";function V(t){return W?crypto.getRandomValues(t):D.getRandomValues(t)}const X=16,G={name:"PBKDF2"},K=Object.assign({hash:{name:"HMAC"}},G),Y=Object.assign({iterations:1e3,hash:{name:"SHA-1"}},G),J=["deriveBits"],Z=[8,12,16],Q=[16,24,32],tt=10,et=[0,0,0,0],nt="undefined",it="function",rt=typeof crypto!=nt,ot=rt&&crypto.subtle,at=rt&&typeof ot!=nt,st=N.bytes,lt=class{constructor(t){const e=this;e._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],e._tables[0][0][0]||e._precompute();const n=e._tables[0][4],i=e._tables[1],r=t.length;let o,a,s,l=1;if(4!==r&&6!==r&&8!==r)throw new Error("invalid aes key size");for(e._key=[a=t.slice(0),s=[]],o=r;o<4*r+28;o++){let t=a[o-1];(o%r==0||8===r&&o%r==4)&&(t=n[t>>>24]<<24^n[t>>16&255]<<16^n[t>>8&255]<<8^n[255&t],o%r==0&&(t=t<<8^t>>>24^l<<24,l=l<<1^283*(l>>7))),a[o]=a[o-r]^t}for(let t=0;o;t++,o--){const e=a[3&t?o:o-4];s[t]=o<=4||t<4?e:i[0][n[e>>>24]]^i[1][n[e>>16&255]]^i[2][n[e>>8&255]]^i[3][n[255&e]]}}encrypt(t){return this._crypt(t,0)}decrypt(t){return this._crypt(t,1)}_precompute(){const t=this._tables[0],e=this._tables[1],n=t[4],i=e[4],r=[],o=[];let a,s,l,c;for(let t=0;t<256;t++)o[(r[t]=t<<1^283*(t>>7))^t]=t;for(let d=a=0;!n[d];d^=s||1,a=o[a]||1){let o=a^a<<1^a<<2^a<<3^a<<4;o=o>>8^255&o^99,n[d]=o,i[o]=d,c=r[l=r[s=r[d]]];let h=16843009*c^65537*l^257*s^16843008*d,u=257*r[o]^16843008*o;for(let n=0;n<4;n++)t[n][d]=u=u<<24^u>>>8,e[n][o]=h=h<<24^h>>>8}for(let n=0;n<5;n++)t[n]=t[n].slice(0),e[n]=e[n].slice(0)}_crypt(t,e){if(4!==t.length)throw new Error("invalid aes block size");const n=this._key[e],i=n.length/4-2,r=[0,0,0,0],o=this._tables[e],a=o[0],s=o[1],l=o[2],c=o[3],d=o[4];let h,u,f,p=t[0]^n[0],g=t[e?3:1]^n[1],m=t[2]^n[2],w=t[e?1:3]^n[3],b=4;for(let t=0;t<i;t++)h=a[p>>>24]^s[g>>16&255]^l[m>>8&255]^c[255&w]^n[b],u=a[g>>>24]^s[m>>16&255]^l[w>>8&255]^c[255&p]^n[b+1],f=a[m>>>24]^s[w>>16&255]^l[p>>8&255]^c[255&g]^n[b+2],w=a[w>>>24]^s[p>>16&255]^l[g>>8&255]^c[255&m]^n[b+3],b+=4,p=h,g=u,m=f;for(let t=0;t<4;t++)r[e?3&-t:t]=d[p>>>24]<<24^d[g>>16&255]<<16^d[m>>8&255]<<8^d[255&w]^n[b++],h=p,p=g,g=m,m=w,w=h;return r}},ct=class{constructor(t,e){this._prf=t,this._initIv=e,this._iv=e}reset(){this._iv=this._initIv}update(t){return this.calculate(this._prf,t,this._iv)}incWord(t){if(255&~(t>>24))t+=1<<24;else{let e=t>>16&255,n=t>>8&255,i=255&t;255===e?(e=0,255===n?(n=0,255===i?i=0:++i):++n):++e,t=0,t+=e<<16,t+=n<<8,t+=i}return t}incCounter(t){0===(t[0]=this.incWord(t[0]))&&(t[1]=this.incWord(t[1]))}calculate(t,e,n){let i;if(!(i=e.length))return[];const r=P.bitLength(e);for(let r=0;r<i;r+=4){this.incCounter(n);const i=t.encrypt(n);e[r]^=i[0],e[r+1]^=i[1],e[r+2]^=i[2],e[r+3]^=i[3]}return P.clamp(e,r)}},dt=$.hmacSha1;let ht=rt&&at&&typeof ot.importKey==it,ut=rt&&at&&typeof ot.deriveBits==it;class ft extends TransformStream{constructor({password:t,signed:e,encryptionStrength:n,checkPasswordOnly:i}){super({start(){Object.assign(this,{ready:new Promise((t=>this.resolveReady=t)),password:t,signed:e,strength:n-1,pending:new Uint8Array})},async transform(t,e){const n=this,{password:r,strength:o,resolveReady:a,ready:s}=n;r?(await async function(t,e,n,i){const r=await mt(t,e,n,bt(i,0,Z[e])),o=bt(i,Z[e]);if(r[0]!=o[0]||r[1]!=o[1])throw new Error(j)}(n,o,r,bt(t,0,Z[o]+2)),t=bt(t,Z[o]+2),i?e.error(new Error(q)):a()):await s;const l=new Uint8Array(t.length-tt-(t.length-tt)%X);e.enqueue(gt(n,t,l,0,tt,!0))},async flush(t){const{signed:e,ctr:n,hmac:i,pending:r,ready:o}=this;if(i&&n){await o;const a=bt(r,0,r.length-tt),s=bt(r,r.length-tt);let l=new Uint8Array;if(a.length){const t=xt(st,a);i.update(t);const e=n.update(t);l=yt(st,e)}if(e){const t=bt(yt(st,i.digest()),0,tt);for(let e=0;e<tt;e++)if(t[e]!=s[e])throw new Error(H)}t.enqueue(l)}}})}}class pt extends TransformStream{constructor({password:t,encryptionStrength:e}){let n;super({start(){Object.assign(this,{ready:new Promise((t=>this.resolveReady=t)),password:t,strength:e-1,pending:new Uint8Array})},async transform(t,e){const n=this,{password:i,strength:r,resolveReady:o,ready:a}=n;let s=new Uint8Array;i?(s=await async function(t,e,n){const i=V(new Uint8Array(Z[e]));return wt(i,await mt(t,e,n,i))}(n,r,i),o()):await a;const l=new Uint8Array(s.length+t.length-t.length%X);l.set(s,0),e.enqueue(gt(n,t,l,s.length,0))},async flush(t){const{ctr:e,hmac:i,pending:r,ready:o}=this;if(i&&e){await o;let a=new Uint8Array;if(r.length){const t=e.update(xt(st,r));i.update(t),a=yt(st,t)}n.signature=yt(st,i.digest()).slice(0,tt),t.enqueue(wt(a,n.signature))}}}),n=this}}function gt(t,e,n,i,r,o){const{ctr:a,hmac:s,pending:l}=t,c=e.length-r;let d;for(l.length&&(e=wt(l,e),n=function(t,e){if(e&&e>t.length){const n=t;(t=new Uint8Array(e)).set(n,0)}return t}(n,c-c%X)),d=0;d<=c-X;d+=X){const t=xt(st,bt(e,d,d+X));o&&s.update(t);const r=a.update(t);o||s.update(r),n.set(yt(st,r),d+i)}return t.pending=bt(e,d),n}async function mt(t,e,n,i){t.password=null;const r=function(t){if("undefined"==typeof TextEncoder){t=unescape(encodeURIComponent(t));const e=new Uint8Array(t.length);for(let n=0;n<e.length;n++)e[n]=t.charCodeAt(n);return e}return(new TextEncoder).encode(t)}(n),o=await async function(t,e,n,i,r){if(!ht)return $.importKey(e);try{return await ot.importKey("raw",e,n,!1,r)}catch(t){return ht=!1,$.importKey(e)}}(0,r,K,0,J),a=await async function(t,e,n){if(!ut)return $.pbkdf2(e,t.salt,Y.iterations,n);try{return await ot.deriveBits(t,e,n)}catch(i){return ut=!1,$.pbkdf2(e,t.salt,Y.iterations,n)}}(Object.assign({salt:i},Y),o,8*(2*Q[e]+2)),s=new Uint8Array(a),l=xt(st,bt(s,0,Q[e])),c=xt(st,bt(s,Q[e],2*Q[e])),d=bt(s,2*Q[e]);return Object.assign(t,{keys:{key:l,authentication:c,passwordVerification:d},ctr:new ct(new lt(l),Array.from(et)),hmac:new dt(c)}),d}function wt(t,e){let n=t;return t.length+e.length&&(n=new Uint8Array(t.length+e.length),n.set(t,0),n.set(e,t.length)),n}function bt(t,e,n){return t.subarray(e,n)}function yt(t,e){return t.fromBits(e)}function xt(t,e){return t.toBits(e)}class vt extends TransformStream{constructor({password:t,passwordVerification:e,checkPasswordOnly:n}){super({start(){Object.assign(this,{password:t,passwordVerification:e}),At(this,t)},transform(t,e){const i=this;if(i.password){const e=St(i,t.subarray(0,12));if(i.password=null,e[11]!=i.passwordVerification)throw new Error(j);t=t.subarray(12)}n?e.error(new Error(q)):e.enqueue(St(i,t))}})}}class kt extends TransformStream{constructor({password:t,passwordVerification:e}){super({start(){Object.assign(this,{password:t,passwordVerification:e}),At(this,t)},transform(t,e){const n=this;let i,r;if(n.password){n.password=null;const e=V(new Uint8Array(12));e[11]=n.passwordVerification,i=new Uint8Array(t.length+e.length),i.set(_t(n,e),0),r=12}else i=new Uint8Array(t.length),r=0;i.set(_t(n,t),r),e.enqueue(i)}})}}function St(t,e){const n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=Lt(t)^e[i],Tt(t,n[i]);return n}function _t(t,e){const n=new Uint8Array(e.length);for(let i=0;i<e.length;i++)n[i]=Lt(t)^e[i],Tt(t,e[i]);return n}function At(t,e){const n=[305419896,591751049,878082192];Object.assign(t,{keys:n,crcKey0:new B(n[0]),crcKey2:new B(n[2])});for(let n=0;n<e.length;n++)Tt(t,e.charCodeAt(n))}function Tt(t,e){let[n,i,r]=t.keys;t.crcKey0.append([e]),n=~t.crcKey0.get(),i=Ct(Math.imul(Ct(i+Et(n)),134775813)+1),t.crcKey2.append([i>>>24]),r=~t.crcKey2.get(),t.keys=[n,i,r]}function Lt(t){const e=2|t.keys[2];return Et(Math.imul(e,1^e)>>>8)}function Et(t){return 255&t}function Ct(t){return 4294967295&t}const It="deflate-raw";class Rt extends TransformStream{constructor(t,{chunkSize:e,CompressionStream:n,CompressionStreamNative:i}){super({});const{compressed:r,encrypted:o,useCompressionStream:a,zipCrypto:s,signed:l,level:c}=t,d=this;let h,u,f=zt(super.readable);o&&!s||!l||(h=new F,f=Ft(f,h)),r&&(f=Bt(f,a,{level:c,chunkSize:e},i,n)),o&&(s?f=Ft(f,new kt(t)):(u=new pt(t),f=Ft(f,u))),Ot(d,f,(()=>{let t;o&&!s&&(t=u.signature),o&&!s||!l||(t=new DataView(h.value.buffer).getUint32(0)),d.signature=t}))}}class Mt extends TransformStream{constructor(t,{chunkSize:e,DecompressionStream:n,DecompressionStreamNative:i}){super({});const{zipCrypto:r,encrypted:o,signed:a,signature:s,compressed:l,useCompressionStream:c}=t;let d,h,u=zt(super.readable);o&&(r?u=Ft(u,new vt(t)):(h=new ft(t),u=Ft(u,h))),l&&(u=Bt(u,c,{chunkSize:e},i,n)),o&&!r||!a||(d=new F,u=Ft(u,d)),Ot(this,u,(()=>{if((!o||r)&&a){const t=new DataView(d.value.buffer);if(s!=t.getUint32(0,!1))throw new Error(H)}}))}}function zt(t){return Ft(t,new TransformStream({transform(t,e){t&&t.length&&e.enqueue(t)}}))}function Ot(t,e,n){e=Ft(e,new TransformStream({flush:n})),Object.defineProperty(t,"readable",{get:()=>e})}function Bt(t,e,n,i,r){try{t=Ft(t,new(e&&i?i:r)(It,n))}catch(i){if(!e)throw i;t=Ft(t,new r(It,n))}return t}function Ft(t,e){return t.pipeThrough(e)}const Pt="data",Nt="inflate";class Ut extends TransformStream{constructor(t,e){super({});const n=this,{codecType:i}=t;let r;i.startsWith("deflate")?r=Rt:i.startsWith(Nt)&&(r=Mt);let o=0;const a=new r(t,e),s=super.readable,l=new TransformStream({transform(t,e){t&&t.length&&(o+=t.length,e.enqueue(t))},flush(){const{signature:t}=a;Object.assign(n,{signature:t,size:o})}});Object.defineProperty(n,"readable",{get:()=>s.pipeThrough(a).pipeThrough(l)})}}const Dt=typeof Worker!=T;class $t{constructor(t,{readable:e,writable:n},{options:i,config:r,streamOptions:o,useWebWorkers:a,transferStreams:s,scripts:l},c){const{signal:d}=o;return Object.assign(t,{busy:!0,readable:e.pipeThrough(new Wt(e,o,r),{signal:d}),writable:n,options:Object.assign({},i),scripts:l,transferStreams:s,terminate(){const{worker:e,busy:n}=t;e&&!n&&(e.terminate(),t.interface=null)},onTaskFinished(){t.busy=!1,c(t)}}),(a&&Dt?qt:Ht)(t,r)}}class Wt extends TransformStream{constructor(t,{onstart:e,onprogress:n,size:i,onend:r},{chunkSize:o}){let a=0;super({start(){e&&jt(e,i)},async transform(t,e){a+=t.length,n&&await jt(n,a,i),e.enqueue(t)},flush(){t.size=a,r&&jt(r,a)}},{highWaterMark:1,size:()=>o})}}async function jt(t,...e){try{await t(...e)}catch(t){}}function Ht(t,e){return{run:()=>async function({options:t,readable:e,writable:n,onTaskFinished:i},r){const o=new Ut(t,r);try{await e.pipeThrough(o).pipeTo(n,{preventClose:!0,preventAbort:!0});const{signature:t,size:i}=o;return{signature:t,size:i}}finally{i()}}(t,e)}}function qt(t,{baseURL:e,chunkSize:n}){return t.interface||Object.assign(t,{worker:Gt(t.scripts[0],e,t),interface:{run:()=>async function(t,e){let n,i;const r=new Promise(((t,e)=>{n=t,i=e}));Object.assign(t,{reader:null,writer:null,resolveResult:n,rejectResult:i,result:r});const{readable:o,options:a,scripts:s}=t,{writable:l,closed:c}=function(t){const e=t.getWriter();let n;const i=new Promise((t=>n=t)),r=new WritableStream({async write(t){await e.ready,await e.write(t)},close(){e.releaseLock(),n()},abort:t=>e.abort(t)});return{writable:r,closed:i}}(t.writable);Kt({type:"start",scripts:s.slice(1),options:a,config:e,readable:o,writable:l},t)||Object.assign(t,{reader:o.getReader(),writer:l.getWriter()});const d=await r;try{await l.getWriter().close()}catch(t){}return await c,d}(t,{chunkSize:n})}}),t.interface}let Vt=!0,Xt=!0;function Gt(t,e,n){const i={type:"module"};let r,o;typeof t==L&&(t=t());try{r=new URL(t,e)}catch(e){r=t}if(Vt)try{o=new Worker(r)}catch(t){Vt=!1,o=new Worker(r,i)}else o=new Worker(r,i);return o.addEventListener("message",(t=>async function({data:t},e){const{type:n,value:i,messageId:r,result:o,error:a}=t,{reader:s,writer:l,resolveResult:c,rejectResult:d,onTaskFinished:h}=e;try{if(a){const{message:t,stack:e,code:n,name:i}=a,r=new Error(t);Object.assign(r,{stack:e,code:n,name:i}),u(r)}else{if("pull"==n){const{value:t,done:n}=await s.read();Kt({type:Pt,value:t,done:n,messageId:r},e)}n==Pt&&(await l.ready,await l.write(new Uint8Array(i)),Kt({type:"ack",messageId:r},e)),"close"==n&&u(null,o)}}catch(a){u(a)}function u(t,e){t?d(t):c(e),l&&l.releaseLock(),h()}}(t,n))),o}function Kt(t,{worker:e,writer:n,onTaskFinished:i,transferStreams:r}){try{let{value:i,readable:o,writable:a}=t;const s=[];if(i&&(t.value=i.buffer,s.push(t.value)),r&&Xt?(o&&s.push(o),a&&s.push(a)):t.readable=t.writable=null,s.length)try{return e.postMessage(t,s),!0}catch(n){Xt=!1,t.readable=t.writable=null,e.postMessage(t)}else e.postMessage(t)}catch(t){throw n&&n.releaseLock(),i(),t}}let Yt=[];const Jt=[];let Zt=0;function Qt(t){const{terminateTimeout:e}=t;e&&(clearTimeout(e),t.terminateTimeout=null)}const te=65536,ee="writable";class ne{constructor(){this.size=0}init(){this.initialized=!0}}class ie extends ne{get readable(){const t=this,{chunkSize:e=te}=t,n=new ReadableStream({start(){this.chunkOffset=0},async pull(i){const{offset:r=0,size:o,diskNumberStart:a}=n,{chunkOffset:s}=this;i.enqueue(await he(t,r+s,Math.min(e,o-s),a)),s+e>o?i.close():this.chunkOffset+=e}});return n}}class re extends ie{constructor(t){super(),Object.assign(this,{blob:t,size:t.size})}async readUint8Array(t,e){const n=this,i=t+e,r=t||i<n.size?n.blob.slice(t,i):n.blob;let o=await r.arrayBuffer();return o.byteLength>e&&(o=o.slice(t,i)),new Uint8Array(o)}}class oe extends ne{constructor(t){super();const e=new TransformStream,n=[];t&&n.push(["Content-Type",t]),Object.defineProperty(this,ee,{get:()=>e.writable}),this.blob=new Response(e.readable,{headers:n}).blob()}getData(){return this.blob}}class ae extends oe{constructor(t){super(t),Object.assign(this,{encoding:t,utf8:!t||"utf-8"==t.toLowerCase()})}async getData(){const{encoding:t,utf8:e}=this,n=await super.getData();if(n.text&&e)return n.text();{const e=new FileReader;return new Promise(((i,r)=>{Object.assign(e,{onload:({target:t})=>i(t.result),onerror:()=>r(e.error)}),e.readAsText(n,t)}))}}}class se extends ie{constructor(t){super(),this.readers=t}async init(){const t=this,{readers:e}=t;t.lastDiskNumber=0,t.lastDiskOffset=0,await Promise.all(e.map((async(n,i)=>{await n.init(),i!=e.length-1&&(t.lastDiskOffset+=n.size),t.size+=n.size}))),super.init()}async readUint8Array(t,e,n=0){const i=this,{readers:r}=this;let o,a=n;-1==a&&(a=r.length-1);let s=t;for(;s>=r[a].size;)s-=r[a].size,a++;const l=r[a],c=l.size;if(s+e<=c)o=await he(l,s,e);else{const r=c-s;o=new Uint8Array(e),o.set(await he(l,s,r)),o.set(await i.readUint8Array(t+r,e-r,n),r)}return i.lastDiskNumber=Math.max(a,i.lastDiskNumber),o}}class le extends ne{constructor(t,e=4294967295){super();const n=this;let i,r,o;Object.assign(n,{diskNumber:0,diskOffset:0,size:0,maxSize:e,availableSize:e});const a=new WritableStream({async write(e){const{availableSize:a}=n;if(o)e.length>=a?(await s(e.slice(0,a)),await l(),n.diskOffset+=i.size,n.diskNumber++,o=null,await this.write(e.slice(a))):await s(e);else{const{value:a,done:s}=await t.next();if(s&&!a)throw new Error("Writer iterator completed too soon");i=a,i.size=0,i.maxSize&&(n.maxSize=i.maxSize),n.availableSize=n.maxSize,await ce(i),r=a.writable,o=r.getWriter(),await this.write(e)}},async close(){await o.ready,await l()}});async function s(t){const e=t.length;e&&(await o.ready,await o.write(t),i.size+=e,n.size+=e,n.availableSize-=e)}async function l(){r.size=i.size,await o.close()}Object.defineProperty(n,ee,{get:()=>a})}}async function ce(t,e){t.init&&!t.initialized&&await t.init(e)}function de(t){return Array.isArray(t)&&(t=new se(t)),t instanceof ReadableStream&&(t={readable:t}),t}function he(t,e,n,i){return t.readUint8Array(e,n,i)}const ue="\0☺☻♥♦♣♠•◘○◙♂♀♪♫☼►◄↕‼¶§▬↨↑↓→←∟↔▲▼ !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~⌂ÇüéâäàåçêëèïîìÄÅÉæÆôöòûùÿÖÜ¢£¥₧ƒáíóúñÑªº¿⌐¬½¼¡«»░▒▓│┤╡╢╖╕╣║╗╝╜╛┐└┴┬├─┼╞╟╚╔╩╦╠═╬╧╨╤╥╙╘╒╓╫╪┘┌█▄▌▐▀αßΓπΣσµτΦΘΩδ∞φε∩≡±≥≤⌠⌡÷≈°∙·√ⁿ²■ ".split(""),fe=256==ue.length;function pe(t,e){return e&&"cp437"==e.trim().toLowerCase()?function(t){if(fe){let e="";for(let n=0;n<t.length;n++)e+=ue[t[n]];return e}return(new TextDecoder).decode(t)}(t):new TextDecoder(e).decode(t)}const ge="filename",me="rawFilename",we="comment",be="rawComment",ye="uncompressedSize",xe="compressedSize",ve="offset",ke="diskNumberStart",Se="lastModDate",_e="rawLastModDate",Ae="lastAccessDate",Te="creationDate",Le=[ge,me,xe,ye,Se,_e,we,be,Ae,Te,ve,ke,ke,"internalFileAttribute","externalFileAttribute","msDosCompatible","zip64","directory","bitFlag","encrypted","signature","filenameUTF8","commentUTF8","compressionMethod","version","versionMadeBy","extraField","rawExtraField","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","extraFieldNTFS","extraFieldExtendedTimestamp"];class Ee{constructor(t){Le.forEach((e=>this[e]=t[e]))}}const Ce="File format is not recognized",Ie="Compression method not supported",Re="Split zip file",Me="utf-8",ze="cp437",Oe=[[ye,v],[xe,v],[ve,v],[ke,k]],Be={[k]:{getValue:Ve,bytes:4},[v]:{getValue:Xe,bytes:8}};class Fe{constructor(t,e={}){Object.assign(this,{reader:de(t),options:e,config:R})}async*getEntriesGenerator(t={}){const e=this;let{reader:n}=e;const{config:i}=e;if(await ce(n),n.size!==A&&n.readUint8Array||(n=new re(await new Response(n.readable).blob()),await ce(n)),n.size<22)throw new Error(Ce);n.chunkSize=function(t){return Math.max(t.chunkSize,64)}(i);const r=await async function(t,e,n){const i=new Uint8Array(4);return function(t){t.setUint32(0,101010256,!0)}(Ge(i)),await r(22)||await r(Math.min(1048582,n));async function r(e){const r=n-e,o=await he(t,r,e);for(let t=o.length-22;t>=0;t--)if(o[t]==i[0]&&o[t+1]==i[1]&&o[t+2]==i[2]&&o[t+3]==i[3])return{offset:r+t,buffer:o.slice(t,t+22).buffer}}}(n,0,n.size);if(!r)throw 134695760==Ve(Ge(await he(n,0,4)))?new Error(Re):new Error("End of central directory not found");const o=Ge(r);let a=Ve(o,12),s=Ve(o,16);const l=r.offset,c=qe(o,20),d=l+22+c;let h=qe(o,4);const u=n.lastDiskNumber||0;let f=qe(o,6),p=qe(o,8),g=0,m=0;if(s==v||a==v||p==k||f==k){const t=Ge(await he(n,r.offset-20,20));if(117853008!=Ve(t,0))throw new Error("End of Zip64 central directory not found");s=Xe(t,8);let e=await he(n,s,56,-1),i=Ge(e);const o=r.offset-20-56;if(Ve(i,0)!=_&&s!=o){const t=s;s=o,g=s-t,e=await he(n,s,56,-1),i=Ge(e)}if(Ve(i,0)!=_)throw new Error("End of Zip64 central directory locator not found");h==k&&(h=Ve(i,16)),f==k&&(f=Ve(i,20)),p==k&&(p=Xe(i,32)),a==v&&(a=Xe(i,40)),s-=a}if(u!=h)throw new Error(Re);if(s<0||s>=n.size)throw new Error(Ce);let w=0,b=await he(n,s,a,f),y=Ge(b);if(a){const t=r.offset-a;if(Ve(y,w)!=S&&s!=t){const e=s;s=t,g=s-e,b=await he(n,s,a,f),y=Ge(b)}}const x=r.offset-s-(n.lastDiskOffset||0);if(a!=x&&x>=0&&(a=x,b=await he(n,s,a,f),y=Ge(b)),s<0||s>=n.size)throw new Error(Ce);const T=$e(e,t,"filenameEncoding"),L=$e(e,t,"commentEncoding");for(let r=0;r<p;r++){const o=new Pe(n,i,e.options);if(Ve(y,w)!=S)throw new Error("Central directory header not found");Ne(o,y,w+6);const a=Boolean(o.bitFlag.languageEncodingFlag),s=w+46,l=s+o.filenameLength,c=l+o.extraFieldLength,d=qe(y,w+4),h=!0,u=b.subarray(s,l),f=qe(y,w+32),x=c+f,v=b.subarray(c,x),k=a,_=a,A=h&&!(16&~He(y,w+38)),E=Ve(y,w+42)+g;Object.assign(o,{versionMadeBy:d,msDosCompatible:h,compressedSize:0,uncompressedSize:0,commentLength:f,directory:A,offset:E,diskNumberStart:qe(y,w+34),internalFileAttribute:qe(y,w+36),externalFileAttribute:Ve(y,w+38),rawFilename:u,filenameUTF8:k,commentUTF8:_,rawExtraField:b.subarray(l,c)});const[C,I]=await Promise.all([pe(u,k?Me:T||ze),pe(v,_?Me:L||ze)]);Object.assign(o,{rawComment:v,filename:C,comment:I,directory:A||C.endsWith("/")}),m=Math.max(E,m),await Ue(o,o,y,w+6);const R=new Ee(o);R.getData=(t,e)=>o.getData(t,R,e),w=x;const{onprogress:M}=t;if(M)try{await M(r+1,p,new Ee(o))}catch(t){}yield R}const E=$e(e,t,"extractPrependedData"),C=$e(e,t,"extractAppendedData");return E&&(e.prependedData=m>0?await he(n,0,m):new Uint8Array),e.comment=c?await he(n,l+22,c):new Uint8Array,C&&(e.appendedData=d<n.size?await he(n,d,n.size-d):new Uint8Array),!0}async getEntries(t={}){const e=[];for await(const n of this.getEntriesGenerator(t))e.push(n);return e}async close(){}}class Pe{constructor(t,e,n){Object.assign(this,{reader:t,config:e,options:n})}async getData(t,e,n={}){const i=this,{reader:r,offset:o,diskNumberStart:a,extraFieldAES:s,compressionMethod:l,config:c,bitFlag:d,signature:h,rawLastModDate:u,uncompressedSize:f,compressedSize:p}=i,g=e.localDirectory={},m=Ge(await he(r,o,30,a));let w=$e(i,n,"password");if(w=w&&w.length&&w,s&&99!=s.originalCompressionMethod)throw new Error(Ie);if(0!=l&&8!=l)throw new Error(Ie);if(67324752!=Ve(m,0))throw new Error("Local file header not found");Ne(g,m,4),g.rawExtraField=g.extraFieldLength?await he(r,o+30+g.filenameLength,g.extraFieldLength,a):new Uint8Array,await Ue(i,g,m,4,!0),Object.assign(e,{lastAccessDate:g.lastAccessDate,creationDate:g.creationDate});const b=i.encrypted&&g.encrypted,y=b&&!s;if(b){if(!y&&s.strength===A)throw new Error("Encryption method not supported");if(!w)throw new Error("File contains encrypted entry")}const x=o+30+g.filenameLength+g.extraFieldLength,v=p,k=r.readable;Object.assign(k,{diskNumberStart:a,offset:x,size:v});const S=$e(i,n,"signal"),_=$e(i,n,"checkPasswordOnly");_&&(t=new WritableStream),t=function(t){t.writable===A&&typeof t.next==L&&(t=new le(t)),t instanceof WritableStream&&(t={writable:t});const{writable:e}=t;return e.size===A&&(e.size=0),t instanceof le||Object.assign(t,{diskNumber:0,diskOffset:0,availableSize:1/0,maxSize:1/0}),t}(t),await ce(t,f);const{writable:T}=t,{onstart:E,onprogress:C,onend:I}=n,R={options:{codecType:Nt,password:w,zipCrypto:y,encryptionStrength:s&&s.strength,signed:$e(i,n,"checkSignature"),passwordVerification:y&&(d.dataDescriptor?u>>>8&255:h>>>24&255),signature:h,compressed:0!=l,encrypted:b,useWebWorkers:$e(i,n,"useWebWorkers"),useCompressionStream:$e(i,n,"useCompressionStream"),transferStreams:$e(i,n,"transferStreams"),checkPasswordOnly:_},config:c,streamOptions:{signal:S,size:v,onstart:E,onprogress:C,onend:I}};let M=0;try{({outputSize:M}=await async function(t,e){const{options:n,config:i}=e,{transferStreams:r,useWebWorkers:o,useCompressionStream:a,codecType:s,compressed:l,signed:c,encrypted:d}=n,{workerScripts:h,maxWorkers:u,terminateWorkerTimeout:f}=i;e.transferStreams=r||r===A;const p=!(l||c||d||e.transferStreams);let g;e.useWebWorkers=!p&&(o||o===A&&i.useWebWorkers),e.scripts=e.useWebWorkers&&h?h[s]:[],n.useCompressionStream=a||a===A&&i.useCompressionStream;const m=Yt.find((t=>!t.busy));if(m)Qt(m),g=new $t(m,t,e,w);else if(Yt.length<u){const n={indexWorker:Zt};Zt++,Yt.push(n),g=new $t(n,t,e,w)}else g=await new Promise((n=>Jt.push({resolve:n,stream:t,workerOptions:e})));return g.run();function w(t){if(Jt.length){const[{resolve:e,stream:n,workerOptions:i}]=Jt.splice(0,1);e(new $t(t,n,i,w))}else t.worker?(Qt(t),Number.isFinite(f)&&f>=0&&(t.terminateTimeout=setTimeout((()=>{Yt=Yt.filter((e=>e!=t)),t.terminate()}),f))):Yt=Yt.filter((e=>e!=t))}}({readable:k,writable:T},R))}catch(t){if(!_||t.message!=q)throw t}finally{const t=$e(i,n,"preventClose");T.size+=M,t||T.locked||await T.getWriter().close()}return _?void 0:t.getData?t.getData():T}}function Ne(t,e,n){const i=t.rawBitFlag=qe(e,n+2),r=!(1&~i),o=Ve(e,n+6);Object.assign(t,{encrypted:r,version:qe(e,n),bitFlag:{level:(6&i)>>1,dataDescriptor:!(8&~i),languageEncodingFlag:!(2048&~i)},rawLastModDate:o,lastModDate:We(o),filenameLength:qe(e,n+22),extraFieldLength:qe(e,n+24)})}async function Ue(t,e,n,i,r){const{rawExtraField:o}=e,a=e.extraField=new Map,s=Ge(new Uint8Array(o));let l=0;try{for(;l<o.length;){const t=qe(s,l),e=qe(s,l+2);a.set(t,{type:t,data:o.slice(l+4,l+4+e)}),l+=4+e}}catch(t){}const c=qe(n,i+4);Object.assign(e,{signature:Ve(n,i+10),uncompressedSize:Ve(n,i+18),compressedSize:Ve(n,i+14)});const d=a.get(1);d&&(function(t,e){e.zip64=!0;const n=Ge(t.data),i=Oe.filter((([t,n])=>e[t]==n));for(let r=0,o=0;r<i.length;r++){const[a,s]=i[r];if(e[a]==s){const i=Be[s];e[a]=t[a]=i.getValue(n,o),o+=i.bytes}else if(t[a])throw new Error("Zip64 extra field not found")}}(d,e),e.extraFieldZip64=d);const h=a.get(28789);h&&(await De(h,ge,me,e,t),e.extraFieldUnicodePath=h);const u=a.get(25461);u&&(await De(u,we,be,e,t),e.extraFieldUnicodeComment=u);const f=a.get(39169);f?(function(t,e,n){const i=Ge(t.data),r=He(i,4);Object.assign(t,{vendorVersion:He(i,0),vendorId:He(i,2),strength:r,originalCompressionMethod:n,compressionMethod:qe(i,5)}),e.compressionMethod=t.compressionMethod}(f,e,c),e.extraFieldAES=f):e.compressionMethod=c;const p=a.get(10);p&&(function(t,e){const n=Ge(t.data);let i,r=4;try{for(;r<t.data.length&&!i;){const e=qe(n,r),o=qe(n,r+2);1==e&&(i=t.data.slice(r+4,r+4+o)),r+=4+o}}catch(t){}try{if(i&&24==i.length){const n=Ge(i),r=n.getBigUint64(0,!0),o=n.getBigUint64(8,!0),a=n.getBigUint64(16,!0);Object.assign(t,{rawLastModDate:r,rawLastAccessDate:o,rawCreationDate:a});const s={lastModDate:je(r),lastAccessDate:je(o),creationDate:je(a)};Object.assign(t,s),Object.assign(e,s)}}catch(t){}}(p,e),e.extraFieldNTFS=p);const g=a.get(21589);g&&(function(t,e,n){const i=Ge(t.data),r=He(i,0),o=[],a=[];n?(!(1&~r)&&(o.push(Se),a.push(_e)),!(2&~r)&&(o.push(Ae),a.push("rawLastAccessDate")),!(4&~r)&&(o.push(Te),a.push("rawCreationDate"))):t.data.length>=5&&(o.push(Se),a.push(_e));let s=1;o.forEach(((n,r)=>{if(t.data.length>=s+4){const o=Ve(i,s);e[n]=t[n]=new Date(1e3*o);const l=a[r];t[l]=o}s+=4}))}(g,e,r),e.extraFieldExtendedTimestamp=g);const m=a.get(6534);m&&(e.extraFieldUSDZ=m)}async function De(t,e,n,i,r){const o=Ge(t.data),a=new B;a.append(r[n]);const s=Ge(new Uint8Array(4));s.setUint32(0,a.get(),!0);const l=Ve(o,1);Object.assign(t,{version:He(o,0),[e]:pe(t.data.subarray(5)),valid:!r.bitFlag.languageEncodingFlag&&l==Ve(s,0)}),t.valid&&(i[e]=t[e],i[e+"UTF8"]=!0)}function $e(t,e,n){return e[n]===A?t.options[n]:e[n]}function We(t){const e=(4294901760&t)>>16,n=65535&t;try{return new Date(1980+((65024&e)>>9),((480&e)>>5)-1,31&e,(63488&n)>>11,(2016&n)>>5,2*(31&n),0)}catch(t){}}function je(t){return new Date(Number(t/BigInt(1e4)-BigInt(116444736e5)))}function He(t,e){return t.getUint8(e)}function qe(t,e){return t.getUint16(e,!0)}function Ve(t,e){return t.getUint32(e,!0)}function Xe(t,e){return Number(t.getBigUint64(e,!0))}function Ge(t){return new DataView(t.buffer)}M({Inflate:function(t){const e=new x,n=t&&t.chunkSize?Math.floor(2*t.chunkSize):131072,i=new Uint8Array(n);let r=!1;e.inflateInit(),e.next_out=i,this.append=function(t,a){const s=[];let l,c,d=0,h=0,u=0;if(0!==t.length){e.next_in_index=0,e.next_in=t,e.avail_in=t.length;do{if(e.next_out_index=0,e.avail_out=n,0!==e.avail_in||r||(e.next_in_index=0,r=!0),l=e.inflate(0),r&&l===o){if(0!==e.avail_in)throw new Error("inflating: bad input")}else if(0!==l&&1!==l)throw new Error("inflating: "+e.msg);if((r||1===l)&&e.avail_in===t.length)throw new Error("inflating: bad input");e.next_out_index&&(e.next_out_index===n?s.push(new Uint8Array(i)):s.push(i.subarray(0,e.next_out_index))),u+=e.next_out_index,a&&e.next_in_index>0&&e.next_in_index!=d&&(a(e.next_in_index),d=e.next_in_index)}while(e.avail_in>0||0===e.avail_out);return s.length>1?(c=new Uint8Array(u),s.forEach((function(t){c.set(t,h),h+=t.length}))):c=s[0]?new Uint8Array(s[0]):new Uint8Array,c}},this.flush=function(){e.inflateEnd()}}})},261:(t,e,n)=>{n.d(e,{F:()=>c});const i=t=>new Set(t?.getAttributeNS?.("http://www.idpf.org/2007/ops","type")?.split(" ")),r=t=>new Set(t?.getAttribute?.("role")?.split(" ")),o=t=>{const{verticalAlign:e}=getComputedStyle(t);return"super"===e||/^\d/.test(e)},a=["biblioref","glossref","noteref"],s=["doc-biblioref","doc-glossref","doc-noteref"],l="a, span, sup, sub, em, strong, i, b, small, big";class c extends EventTarget{detectFootnotes=!0;#g(t,{index:e,anchor:n},o){const a=document.createElement("foliate-view");return new Promise(((s,l)=>{a.addEventListener("load",(t=>{try{const{doc:e}=t.detail,l=n(e),c=(t=>{const e=i(t),n=r(t);return n.has("doc-biblioentry")||e.has("biblioentry")?"biblioentry":n.has("definition")||e.has("glossdef")?"definition":n.has("doc-endnote")||e.has("endnote")||e.has("rearnote")?"endnote":n.has("doc-footnote")||e.has("footnote")?"footnote":n.has("note")||e.has("note")?"note":null})(l),d=l?.matches?.("aside")&&"footnote"===c;if(l){const t=l.startContainer?l:e.createRange();l.startContainer||(l.matches("li, aside")?t.selectNodeContents(l):t.selectNode(l));const n=t.extractContents();e.body.replaceChildren(),e.body.appendChild(n)}const h={view:a,href:o,type:c,hidden:d,target:l};this.dispatchEvent(new CustomEvent("render",{detail:h})),s()}catch(t){l(t)}})),a.open(t).then((()=>this.dispatchEvent(new CustomEvent("before-render",{detail:{view:a}})))).then((()=>a.goTo(e))).catch(l)}))}handle(t,e){const{a:n,href:c}=e.detail,{yes:d,maybe:h}=(t=>{const e=i(t),n=r(t);return{yes:s.some((t=>n.has(t)))||a.some((t=>e.has(t))),maybe:()=>!e.has("backlink")&&!n.has("doc-backlink")&&(o(t)||1===t.children.length&&o(t.children[0])||o(t.parentElement))}})(n);return d?(e.preventDefault(),Promise.resolve(t.resolveHref(c)).then((e=>this.#g(t,e,c)))):this.detectFootnotes&&h()?(e.preventDefault(),Promise.resolve(t.resolveHref(c)).then((({index:e,anchor:n})=>{const i={index:e,anchor:t=>((t,e)=>{let n=e(t);const i=n;for(;n.matches(l);){const t=n.parentElement;if(!t)break;n=t}if(n===t.body){const t=i.nextElementSibling;if(t&&!t.matches(l))return t;throw new Error("Failed to extract footnote")}return n})(t,n)};return this.#g(t,i,c)}))):void 0}}},262:(t,e,n)=>{n.d(e,{searchMatcher:()=>o});const i=t=>t.replace(/\s+/g," "),r=(t,{startIndex:e,startOffset:n,endIndex:r,endOffset:o})=>{const a=t[e],s=t[r],l=a===s?a.slice(n,o):a.slice(n)+t.slice(a+1,s).join("")+s.slice(0,o),c=i(a.slice(0,n)).trimStart(),d=i(s.slice(o)).trimEnd(),h=c.length<50?"":"…",u=d.length<50?"":"…";return{pre:`${h}${c.slice(-50)}`,match:l,post:`${d.slice(0,50)}${u}`}},o=(t,e)=>{const{defalutLocale:n,matchCase:i,matchDiacritics:o,matchWholeWords:a}=e;return function*(e,s){const l=t(e,(function*(t,l){for(const c of((t,e,n)=>{const{granularity:i="grapheme",sensitivity:o="base"}=n;return Intl?.Segmenter&&("grapheme"!==i||"variant"!==o&&"accent"!==o)?function*(t,e,n={}){const{locales:i="en",granularity:o="word",sensitivity:a="base"}=n;let s,l;try{s=new Intl.Segmenter(i,{usage:"search",granularity:o}),l=new Intl.Collator(i,{sensitivity:a})}catch(t){console.warn(t),s=new Intl.Segmenter("en",{usage:"search",granularity:o}),l=new Intl.Collator("en",{sensitivity:a})}const c=Array.from(s.segment(e)).length,d=[];let h=0,u=s.segment(t[h])[Symbol.iterator]();t:for(;h<t.length;){for(;d.length<c;){const{done:e,value:n}=u.next();if(e){if(h++,h<t.length){u=s.segment(t[h])[Symbol.iterator]();continue}break t}const{index:i,segment:r}=n;/[^\p{Format}]/u.test(r)&&(/\s/u.test(r)?/\s/u.test(d[d.length-1]?.segment)||d.push({strIndex:h,index:i,segment:" "}):(n.strIndex=h,d.push(n)))}const n=d.map((t=>t.segment)).join("");if(0===l.compare(e,n)){const e=h,n=d[d.length-1],i=n.index+n.segment.length,o={startIndex:d[0].strIndex,startOffset:d[0].index,endIndex:e,endOffset:i};yield{range:o,excerpt:r(t,o)}}d.shift()}}(t,e,n):function*(t,e,n={}){const{locales:i="en",sensitivity:o}=n,a="variant"===o,s=t.join(""),l=a?s:s.toLocaleLowerCase(i),c=a?e:e.toLocaleLowerCase(i),d=c.length;let h=-1,u=-1,f=0;do{if(h=l.indexOf(c,h+1),h>-1){for(;f<=h;)f+=t[++u].length;const e=u,n=h-(f-t[u].length),i=h+d;for(;f<=i;)f+=t[++u].length;const o={startIndex:e,startOffset:n,endIndex:u,endOffset:i-(f-t[u].length)};yield{range:o,excerpt:r(t,o)}}}while(h>-1)}(t,e,n)})(t,s,{locales:e.body.lang||e.documentElement.lang||n||"en",granularity:a?"word":"grapheme",sensitivity:o&&i?"variant":o&&!i?"accent":!o&&i?"case":"base"})){const{startIndex:t,startOffset:e,endIndex:n,endOffset:i}=c.range;c.range=l(t,e,n,i),yield c}}));for(const t of l)yield t}}},339:(t,e,n)=>{n.d(e,{u:()=>r});const i=t=>document.createElementNS("http://www.w3.org/2000/svg",t);class r{#m=i("svg");#w=new Map;constructor(){Object.assign(this.#m.style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none"})}get element(){return this.#m}add(t,e,n,i){this.#w.has(t)&&this.remove(t),"function"==typeof e&&(e=e(this.#m.getRootNode()));const r=e.getClientRects(),o=n(r,i);this.#m.append(o),this.#w.set(t,{range:e,draw:n,options:i,element:o,rects:r})}remove(t){this.#w.has(t)&&(this.#m.removeChild(this.#w.get(t).element),this.#w.delete(t))}redraw(){for(const t of this.#w.values()){const{range:e,draw:n,options:i,element:r}=t;this.#m.removeChild(r);const o=e.getClientRects(),a=n(o,i);this.#m.append(a),t.element=a,t.rects=o}}hitTest({x:t,y:e}){const n=Array.from(this.#w.entries());for(let i=n.length-1;i>=0;i--){const[r,o]=n[i];for(const{left:n,top:i,right:a,bottom:s}of o.rects)if(i<=e&&n<=t&&s>e&&a>t)return[r,o.range]}return[]}static underline(t,e={}){const{color:n="red",width:r=2,writingMode:o}=e,a=i("g");if(a.setAttribute("fill",n),"vertical-rl"===o||"vertical-lr"===o)for(const{right:e,top:n,height:o}of t){const t=i("rect");t.setAttribute("x",e-r),t.setAttribute("y",n),t.setAttribute("height",o),t.setAttribute("width",r),a.append(t)}else for(const{left:e,bottom:n,width:o}of t){const t=i("rect");t.setAttribute("x",e),t.setAttribute("y",n-r),t.setAttribute("height",r),t.setAttribute("width",o),a.append(t)}return a}static strikethrough(t,e={}){const{color:n="red",width:r=2,writingMode:o}=e,a=i("g");if(a.setAttribute("fill",n),"vertical-rl"===o||"vertical-lr"===o)for(const{right:e,left:n,top:o,height:s}of t){const t=i("rect");t.setAttribute("x",(e+n)/2),t.setAttribute("y",o),t.setAttribute("height",s),t.setAttribute("width",r),a.append(t)}else for(const{left:e,top:n,bottom:o,width:s}of t){const t=i("rect");t.setAttribute("x",e),t.setAttribute("y",(n+o)/2),t.setAttribute("height",r),t.setAttribute("width",s),a.append(t)}return a}static squiggly(t,e={}){const{color:n="red",width:r=2,writingMode:o}=e,a=i("g");a.setAttribute("fill","none"),a.setAttribute("stroke",n),a.setAttribute("stroke-width",r);const s=1.5*r;if("vertical-rl"===o||"vertical-lr"===o)for(const{right:e,top:n,height:r}of t){const t=i("path"),o=Math.round(r/s/1.5),l=r/o,c=Array.from({length:o},((t,e)=>`l${e%2?-s:s} ${l}`)).join("");t.setAttribute("d",`M${e} ${n}${c}`),a.append(t)}else for(const{left:e,bottom:n,width:r}of t){const t=i("path"),o=Math.round(r/s/1.5),l=r/o,c=Array.from({length:o},((t,e)=>`l${l} ${e%2?s:-s}`)).join("");t.setAttribute("d",`M${e} ${n}${c}`),a.append(t)}return a}static highlight(t,e={}){const{color:n="red"}=e,r=i("g");r.setAttribute("fill",n),r.style.opacity="var(--overlayer-highlight-opacity, .3)",r.style.mixBlendMode="var(--overlayer-highlight-blend-mode, normal)";for(const{left:e,top:n,height:o,width:a}of t){const t=i("rect");t.setAttribute("x",e),t.setAttribute("y",n),t.setAttribute("height",o),t.setAttribute("width",a),r.append(t)}return r}static outline(t,e={}){const{color:n="red",width:r=3,radius:o=3}=e,a=i("g");a.setAttribute("fill","none"),a.setAttribute("stroke",n),a.setAttribute("stroke-width",r);for(const{left:e,top:n,height:r,width:s}of t){const t=i("rect");t.setAttribute("x",e),t.setAttribute("y",n),t.setAttribute("height",r),t.setAttribute("width",s),t.setAttribute("rx",o),a.append(t)}return a}static copyImage([t],e={}){const{src:n}=e,r=i("image"),{left:o,top:a,height:s,width:l}=t;return r.setAttribute("href",n),r.setAttribute("x",o),r.setAttribute("y",a),r.setAttribute("height",s),r.setAttribute("width",l),r}}},354:(t,e,n)=>{n.d(e,{makePDF:()=>o});const i=async(t,e)=>{const n=t.getViewport({scale:1}),i=n.width/n.height,r=innerWidth/innerHeight,o=devicePixelRatio*(r/i),a=t.getViewport({scale:o}),s=document.createElement("canvas");s.height=a.height,s.width=a.width;const l=s.getContext("2d");await t.render({canvasContext:l,viewport:a}).promise;const c=await new Promise((t=>s.toBlob(t)));if(e)return c;const d=document.createElement("div");d.classList.add("textLayer"),await pdfjsLib.renderTextLayer({textContentSource:await t.getTextContent(),container:d,viewport:a}).promise;const h=document.createElement("div");h.classList.add("annotationLayer"),await new pdfjsLib.AnnotationLayer({page:t,viewport:a,div:h}).render({annotations:await t.getAnnotations(),linkService:{getDestinationHash:t=>JSON.stringify(t),addLinkAttributes:(t,e)=>t.href=e}});const u=URL.createObjectURL(c);return URL.createObjectURL(new Blob([`\n        <!DOCTYPE html>\n        <meta charset="utf-8">\n        <style>\n        :root {\n            --scale-factor: ${o};\n        }\n        html, body {\n            margin: 0;\n            padding: 0;\n        }\n        \n/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n:root {\n  --highlight-bg-color: rgb(180 0 170);\n  --highlight-selected-bg-color: rgb(0 100 0);\n}\n\n@media screen and (forced-colors: active) {\n  :root {\n    --highlight-bg-color: Highlight;\n    --highlight-selected-bg-color: ButtonText;\n  }\n}\n\n.textLayer {\n  position: absolute;\n  text-align: initial;\n  inset: 0;\n  overflow: hidden;\n  opacity: 0.25;\n  line-height: 1;\n  text-size-adjust: none;\n  forced-color-adjust: none;\n  transform-origin: 0 0;\n  z-index: 2;\n}\n\n.textLayer :is(span, br) {\n  color: transparent;\n  position: absolute;\n  white-space: pre;\n  cursor: text;\n  transform-origin: 0% 0%;\n}\n\n/* Only necessary in Google Chrome, see issue 14205, and most unfortunately\n * the problem doesn't show up in "text" reference tests. */\n/*#if !MOZCENTRAL*/\n.textLayer span.markedContent {\n  top: 0;\n  height: 0;\n}\n/*#endif*/\n\n.textLayer .highlight {\n  margin: -1px;\n  padding: 1px;\n  background-color: var(--highlight-bg-color);\n  border-radius: 4px;\n}\n\n.textLayer .highlight.appended {\n  position: initial;\n}\n\n.textLayer .highlight.begin {\n  border-radius: 4px 0 0 4px;\n}\n\n.textLayer .highlight.end {\n  border-radius: 0 4px 4px 0;\n}\n\n.textLayer .highlight.middle {\n  border-radius: 0;\n}\n\n.textLayer .highlight.selected {\n  background-color: var(--highlight-selected-bg-color);\n}\n\n.textLayer ::selection {\n  /*#if !MOZCENTRAL*/\n  background: blue;\n  /*#endif*/\n  background: AccentColor; /* stylelint-disable-line declaration-block-no-duplicate-properties */\n}\n\n/* Avoids https://github.com/mozilla/pdf.js/issues/13840 in Chrome */\n/*#if !MOZCENTRAL*/\n.textLayer br::selection {\n  background: transparent;\n}\n/*#endif*/\n\n.textLayer .endOfContent {\n  display: block;\n  position: absolute;\n  inset: 100% 0 0;\n  z-index: -1;\n  cursor: default;\n  user-select: none;\n}\n\n.textLayer .endOfContent.active {\n  top: 0;\n}\n\n        \n/* Copyright 2014 Mozilla Foundation\n *\n * Licensed under the Apache License, Version 2.0 (the "License");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an "AS IS" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n:root {\n  --annotation-unfocused-field-background: url("data:image/svg+xml;charset=UTF-8,<svg width='1px' height='1px' xmlns='http://www.w3.org/2000/svg'><rect width='100%' height='100%' style='fill:rgba(0, 54, 255, 0.13);'/></svg>");\n  --input-focus-border-color: Highlight;\n  --input-focus-outline: 1px solid Canvas;\n  --input-unfocused-border-color: transparent;\n  --input-disabled-border-color: transparent;\n  --input-hover-border-color: black;\n  --link-outline: none;\n}\n\n@media screen and (forced-colors: active) {\n  :root {\n    --input-focus-border-color: CanvasText;\n    --input-unfocused-border-color: ActiveText;\n    --input-disabled-border-color: GrayText;\n    --input-hover-border-color: Highlight;\n    --link-outline: 1.5px solid LinkText;\n    --hcm-highligh-filter: invert(100%);\n  }\n  .annotationLayer .textWidgetAnnotation :is(input, textarea):required,\n  .annotationLayer .choiceWidgetAnnotation select:required,\n  .annotationLayer\n    .buttonWidgetAnnotation:is(.checkBox, .radioButton)\n    input:required {\n    outline: 1.5px solid selectedItem;\n  }\n\n  .annotationLayer .linkAnnotation:hover {\n    backdrop-filter: var(--hcm-highligh-filter);\n  }\n\n  .annotationLayer .linkAnnotation > a:hover {\n    opacity: 0 !important;\n    background: none !important;\n    box-shadow: none;\n  }\n\n  .annotationLayer .popupAnnotation .popup {\n    outline: calc(1.5px * var(--scale-factor)) solid CanvasText !important;\n    background-color: ButtonFace !important;\n    color: ButtonText !important;\n  }\n\n  .annotationLayer .highlightArea:hover::after {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    backdrop-filter: var(--hcm-highligh-filter);\n    content: "";\n    pointer-events: none;\n  }\n\n  .annotationLayer .popupAnnotation.focused .popup {\n    outline: calc(3px * var(--scale-factor)) solid Highlight !important;\n  }\n}\n\n.annotationLayer {\n  position: absolute;\n  top: 0;\n  left: 0;\n  pointer-events: none;\n  transform-origin: 0 0;\n  z-index: 3;\n}\n\n.annotationLayer[data-main-rotation="90"] .norotate {\n  transform: rotate(270deg) translateX(-100%);\n}\n.annotationLayer[data-main-rotation="180"] .norotate {\n  transform: rotate(180deg) translate(-100%, -100%);\n}\n.annotationLayer[data-main-rotation="270"] .norotate {\n  transform: rotate(90deg) translateY(-100%);\n}\n\n.annotationLayer canvas {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  pointer-events: none;\n}\n\n.annotationLayer section {\n  position: absolute;\n  text-align: initial;\n  pointer-events: auto;\n  box-sizing: border-box;\n  transform-origin: 0 0;\n}\n\n.annotationLayer .linkAnnotation {\n  outline: var(--link-outline);\n}\n\n.annotationLayer :is(.linkAnnotation, .buttonWidgetAnnotation.pushButton) > a {\n  position: absolute;\n  font-size: 1em;\n  top: 0;\n  left: 0;\n  width: 100%;\n  height: 100%;\n}\n\n.annotationLayer\n  :is(.linkAnnotation, .buttonWidgetAnnotation.pushButton):not(.hasBorder)\n  > a:hover {\n  opacity: 0.2;\n  background-color: rgb(255 255 0);\n  box-shadow: 0 2px 10px rgb(255 255 0);\n}\n\n.annotationLayer .linkAnnotation.hasBorder:hover {\n  background-color: rgb(255 255 0 / 0.2);\n}\n\n.annotationLayer .hasBorder {\n  background-size: 100% 100%;\n}\n\n.annotationLayer .textAnnotation img {\n  position: absolute;\n  cursor: pointer;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea),\n.annotationLayer .choiceWidgetAnnotation select,\n.annotationLayer .buttonWidgetAnnotation:is(.checkBox, .radioButton) input {\n  background-image: var(--annotation-unfocused-field-background);\n  border: 2px solid var(--input-unfocused-border-color);\n  box-sizing: border-box;\n  font: calc(9px * var(--scale-factor)) sans-serif;\n  height: 100%;\n  margin: 0;\n  vertical-align: top;\n  width: 100%;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea):required,\n.annotationLayer .choiceWidgetAnnotation select:required,\n.annotationLayer\n  .buttonWidgetAnnotation:is(.checkBox, .radioButton)\n  input:required {\n  outline: 1.5px solid red;\n}\n\n.annotationLayer .choiceWidgetAnnotation select option {\n  padding: 0;\n}\n\n.annotationLayer .buttonWidgetAnnotation.radioButton input {\n  border-radius: 50%;\n}\n\n.annotationLayer .textWidgetAnnotation textarea {\n  resize: none;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea)[disabled],\n.annotationLayer .choiceWidgetAnnotation select[disabled],\n.annotationLayer\n  .buttonWidgetAnnotation:is(.checkBox, .radioButton)\n  input[disabled] {\n  background: none;\n  border: 2px solid var(--input-disabled-border-color);\n  cursor: not-allowed;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea):hover,\n.annotationLayer .choiceWidgetAnnotation select:hover,\n.annotationLayer\n  .buttonWidgetAnnotation:is(.checkBox, .radioButton)\n  input:hover {\n  border: 2px solid var(--input-hover-border-color);\n}\n.annotationLayer .textWidgetAnnotation :is(input, textarea):hover,\n.annotationLayer .choiceWidgetAnnotation select:hover,\n.annotationLayer .buttonWidgetAnnotation.checkBox input:hover {\n  border-radius: 2px;\n}\n\n.annotationLayer .textWidgetAnnotation :is(input, textarea):focus,\n.annotationLayer .choiceWidgetAnnotation select:focus {\n  background: none;\n  border: 2px solid var(--input-focus-border-color);\n  border-radius: 2px;\n  outline: var(--input-focus-outline);\n}\n\n.annotationLayer .buttonWidgetAnnotation:is(.checkBox, .radioButton) :focus {\n  background-image: none;\n  background-color: transparent;\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox :focus {\n  border: 2px solid var(--input-focus-border-color);\n  border-radius: 2px;\n  outline: var(--input-focus-outline);\n}\n\n.annotationLayer .buttonWidgetAnnotation.radioButton :focus {\n  border: 2px solid var(--input-focus-border-color);\n  outline: var(--input-focus-outline);\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::before,\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::after,\n.annotationLayer .buttonWidgetAnnotation.radioButton input:checked::before {\n  background-color: CanvasText;\n  content: "";\n  display: block;\n  position: absolute;\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::before,\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::after {\n  height: 80%;\n  left: 45%;\n  width: 1px;\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::before {\n  transform: rotate(45deg);\n}\n\n.annotationLayer .buttonWidgetAnnotation.checkBox input:checked::after {\n  transform: rotate(-45deg);\n}\n\n.annotationLayer .buttonWidgetAnnotation.radioButton input:checked::before {\n  border-radius: 50%;\n  height: 50%;\n  left: 30%;\n  top: 20%;\n  width: 50%;\n}\n\n.annotationLayer .textWidgetAnnotation input.comb {\n  font-family: monospace;\n  padding-left: 2px;\n  padding-right: 0;\n}\n\n.annotationLayer .textWidgetAnnotation input.comb:focus {\n  /*\n   * Letter spacing is placed on the right side of each character. Hence, the\n   * letter spacing of the last character may be placed outside the visible\n   * area, causing horizontal scrolling. We avoid this by extending the width\n   * when the element has focus and revert this when it loses focus.\n   */\n  width: 103%;\n}\n\n.annotationLayer .buttonWidgetAnnotation:is(.checkBox, .radioButton) input {\n  appearance: none;\n}\n\n.annotationLayer .fileAttachmentAnnotation .popupTriggerArea {\n  height: 100%;\n  width: 100%;\n}\n\n.annotationLayer .popupAnnotation {\n  position: absolute;\n  font-size: calc(9px * var(--scale-factor));\n  pointer-events: none;\n  width: max-content;\n  max-width: 45%;\n  height: auto;\n}\n\n.annotationLayer .popup {\n  background-color: rgb(255 255 153);\n  box-shadow: 0 calc(2px * var(--scale-factor)) calc(5px * var(--scale-factor))\n    rgb(136 136 136);\n  border-radius: calc(2px * var(--scale-factor));\n  outline: 1.5px solid rgb(255 255 74);\n  padding: calc(6px * var(--scale-factor));\n  cursor: pointer;\n  font: message-box;\n  white-space: normal;\n  word-wrap: break-word;\n  pointer-events: auto;\n}\n\n.annotationLayer .popupAnnotation.focused .popup {\n  outline-width: 3px;\n}\n\n.annotationLayer .popup * {\n  font-size: calc(9px * var(--scale-factor));\n}\n\n.annotationLayer .popup > .header {\n  display: inline-block;\n}\n\n.annotationLayer .popup > .header h1 {\n  display: inline;\n}\n\n.annotationLayer .popup > .header .popupDate {\n  display: inline-block;\n  margin-left: calc(5px * var(--scale-factor));\n  width: fit-content;\n}\n\n.annotationLayer .popupContent {\n  border-top: 1px solid rgb(51 51 51);\n  margin-top: calc(2px * var(--scale-factor));\n  padding-top: calc(2px * var(--scale-factor));\n}\n\n.annotationLayer .richText > * {\n  white-space: pre-wrap;\n  font-size: calc(9px * var(--scale-factor));\n}\n\n.annotationLayer .popupTriggerArea {\n  cursor: pointer;\n}\n\n.annotationLayer section svg {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  top: 0;\n  left: 0;\n}\n\n.annotationLayer .annotationTextContent {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  opacity: 0;\n  color: transparent;\n  user-select: none;\n  pointer-events: none;\n}\n\n.annotationLayer .annotationTextContent span {\n  width: 100%;\n  display: inline-block;\n}\n\n.annotationLayer svg.quadrilateralsContainer {\n  contain: strict;\n  width: 0;\n  height: 0;\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: -1;\n}\n\n        </style>\n        <img src="${u}">\n        ${d.outerHTML}\n        ${h.outerHTML}\n    `],{type:"text/html"}))},r=t=>({label:t.title,href:JSON.stringify(t.dest),subitems:t.items.length?t.items.map(r):null}),o=async t=>{const e=new Uint8Array(await t.arrayBuffer()),n=await pdfjsLib.getDocument({data:e}).promise,o={rendition:{layout:"pre-paginated"}},a=(await n.getMetadata())?.info;o.metadata={title:a?.Title,author:a?.Author};const s=await n.getOutline();o.toc=s?.map(r);const l=new Map;return o.sections=Array.from({length:n.numPages}).map(((t,e)=>({id:e,load:async()=>{const t=l.get(e);if(t)return t;const r=await i(await n.getPage(e+1));return l.set(e,r),r},size:1e3}))),o.sections[0].pageSpread="right",o.isExternal=t=>/^\w+:/i.test(t),o.resolveHref=async t=>{const e=JSON.parse(t),i="string"==typeof e?await n.getDestination(e):e;return{index:await n.getPageIndex(i[0])}},o.splitTOCHref=async t=>{const e=JSON.parse(t),i="string"==typeof e?await n.getDestination(e):e;return[await n.getPageIndex(i[0]),null]},o.getTOCFragment=t=>t.documentElement,o.getCover=async()=>i(await n.getPage(1),!0),o}},406:(t,e,n)=>{n.d(e,{makeFB2:()=>m});const i=t=>t?t.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"",r=t=>i(t?.textContent),o={XLINK:"http://www.w3.org/1999/xlink",EPUB:"http://www.idpf.org/2007/ops"},a="application/xml",s="application/xhtml+xml",l={strong:["strong","self"],emphasis:["em","self"],style:["span","self"],a:"anchor",strikethrough:["s","self"],sub:["sub","self"],sup:["sup","self"],code:["code","self"],image:"image"},c={epigraph:["blockquote"],subtitle:["h2",l],"text-author":["p",l],date:["p",l],stanza:"stanza"},d={title:["header",{p:["h1",l],"empty-line":["br"]}],epigraph:["blockquote","self"],image:"image",annotation:["aside"],section:["section","self"],p:["p",l],poem:["blockquote",c],subtitle:["h2",l],cite:["blockquote","self"],"empty-line":["br"],table:["table",{tr:["tr",["align"]],th:["th",["colspan","rowspan","align","valign"]],td:["td",["colspan","rowspan","align","valign"]]}],"text-author":["p",l]};c.epigraph.push(d);const h={image:"image",title:["section",{p:["h1",l],"empty-line":["br"]}],epigraph:["section",d],section:["section",d]},u=t=>{const e=t.getAttributeNS(o.XLINK,"href"),[,n]=e.split("#"),i=t.getRootNode().getElementById(n);return i?`data:${i.getAttribute("content-type")};base64,${i.textContent}`:e};class f{constructor(t){this.fb2=t,this.doc=document.implementation.createDocument(o.XHTML,"html")}image(t){const e=this.doc.createElement("img");return e.alt=t.getAttribute("alt"),e.title=t.getAttribute("title"),e.setAttribute("src",u(t)),e}anchor(t){const e=this.convert(t,{a:["a",l]});return e.setAttribute("href",t.getAttributeNS(o.XLINK,"href")),"note"===t.getAttribute("type")&&e.setAttributeNS(o.EPUB,"epub:type","noteref"),e}stanza(t){const e=this.convert(t,{stanza:["p",{title:["header",{p:["strong",l],"empty-line":["br"]}],subtitle:["p",l]}]});for(const n of t.children)"v"===n.nodeName&&(e.append(this.doc.createTextNode(n.textContent)),e.append(this.doc.createElement("br")));return e}convert(t,e){if(3===t.nodeType)return this.doc.createTextNode(t.textContent);if(4===t.nodeType)return this.doc.createCDATASection(t.textContent);if(8===t.nodeType)return this.doc.createComment(t.textContent);const n=e?.[t.nodeName];if(!n)return null;if("string"==typeof n)return this[n](t);const[i,r]=n,o=this.doc.createElement(i);if(t.id&&(o.id=t.id),o.classList.add(t.nodeName),Array.isArray(r))for(const e of r)o.setAttribute(e,t.getAttribute(e));const a="self"===r?e:Array.isArray(r)?null:r;let s=t.firstChild;for(;s;){const t=this.convert(s,a);t&&o.append(t),s=s.nextSibling}return o}}const p=URL.createObjectURL(new Blob(['\n@namespace epub "http://www.idpf.org/2007/ops";\nbody > img, section > img {\n    display: block;\n    margin: auto;\n}\n.title h1 {\n    text-align: center;\n}\nbody > section > .title, body.notesBodyType > .title {\n    margin: 3em 0;\n}\nbody.notesBodyType > section .title h1 {\n    text-align: start;\n}\nbody.notesBodyType > section .title {\n    margin: 1em 0;\n}\np {\n    text-indent: 1em;\n    margin: 0;\n}\n:not(p) + p, p:first-child {\n    text-indent: 0;\n}\n.poem p {\n    text-indent: 0;\n    margin: 1em 0;\n}\n.text-author, .date {\n    text-align: end;\n}\n.text-author:before {\n    content: "—";\n}\ntable {\n    border-collapse: collapse;\n}\ntd, th {\n    padding: .25em;\n}\na[epub|type~="noteref"] {\n    font-size: .75em;\n    vertical-align: super;\n}\nbody:not(.notesBodyType) > .title, body:not(.notesBodyType) > .epigraph {\n    margin: 3em 0;\n}\n'],{type:"text/css"})),g="data-foliate-id",m=async t=>{const e={},n=await(async t=>{const e=await t.arrayBuffer(),n=new TextDecoder("utf-8").decode(e),i=new DOMParser,r=i.parseFromString(n,a),o=r.xmlEncoding||n.match(/^<\?xml\s+version\s*=\s*["']1.\d+"\s+encoding\s*=\s*["']([A-Za-z0-9._-]*)["']/)?.[1];if(o&&"utf-8"!==o.toLowerCase()){const t=new TextDecoder(o).decode(e);return i.parseFromString(t,a)}return r})(t),o=new f(n),l=t=>n.querySelector(t),c=t=>[...n.querySelectorAll(t)],m=t=>{const e=r(t.querySelector("nickname"));if(e)return e;const n=r(t.querySelector("first-name")),i=r(t.querySelector("middle-name")),o=r(t.querySelector("last-name"));return{name:[n,i,o].filter((t=>t)).join(" "),sortAs:o?[o,[n,i].filter((t=>t)).join(" ")].join(", "):null}},w=t=>t?.getAttribute("value")??r(t),b=l("title-info annotation");if(e.metadata={title:r(l("title-info book-title")),identifier:r(l("document-info id")),language:r(l("title-info lang")),author:c("title-info author").map(m),translator:c("title-info translator").map(m),producer:c("document-info author").map(m).concat(c("document-info program-used").map(r)),publisher:r(l("publish-info publisher")),published:w(l("title-info date")),modified:w(l("document-info date")),description:b?o.convert(b,{annotation:["div",d]}).innerHTML:null,subject:c("title-info genre").map(r)},l("coverpage image")){const t=u(l("coverpage image"));e.getCover=()=>fetch(t).then((t=>t.blob()))}else e.getCover=()=>null;const y=Array.from(n.querySelectorAll("body"),(t=>{const e=o.convert(t,{body:["body",h]});return[Array.from(e.children,(t=>{const e=[t,...t.querySelectorAll("[id]")].map((t=>t.id));return{el:t,ids:e}})),e]})),x=[],v=y[0][0].map((({el:t,ids:e})=>({ids:e,titles:Array.from(t.querySelectorAll(":scope > section > .title"),((t,e)=>(t.setAttribute(g,e),{title:r(t),index:e}))),el:t}))).concat(y.slice(1).map((([t,e])=>{const n=t.map((t=>t.ids)).flat();return e.classList.add("notesBodyType"),{ids:n,el:e,linear:"no"}}))).map((({ids:t,titles:e,el:n,linear:r})=>{const o=(a=n.outerHTML,`<?xml version="1.0" encoding="utf-8"?>\n<html xmlns="http://www.w3.org/1999/xhtml">\n    <head><link href="${p}" rel="stylesheet" type="text/css"/></head>\n    <body>${a}</body>\n</html>`);var a;const l=new Blob([o],{type:s}),c=URL.createObjectURL(l);return x.push(c),{ids:t,title:i(n.querySelector(".title, .subtitle, p")?.textContent??(n.classList.contains("title")?n.textContent:"")),titles:e,load:()=>c,createDocument:()=>(new DOMParser).parseFromString(o,s),size:l.size-Array.from(n.querySelectorAll("[src]"),(t=>t.getAttribute("src")?.length??0)).reduce(((t,e)=>t+e),0),linear:r}})),k=new Map;return e.sections=v.map(((t,e)=>{const{ids:n,load:i,createDocument:r,size:o,linear:a}=t;for(const t of n)t&&k.set(t,e);return{id:e,load:i,createDocument:r,size:o,linear:a}})),e.toc=v.map((({title:t,titles:e},n)=>{const i=n.toString();return{label:t,href:i,subitems:e?.length?e.map((({title:t,index:e})=>({label:t,href:`${i}#${e}`}))):null}})).filter((t=>t)),e.resolveHref=t=>{const[e,n]=t.split("#");return e?{index:Number(e),anchor:t=>t.querySelector(`[${g}="${n}"]`)}:{index:k.get(n),anchor:t=>t.getElementById(n)}},e.splitTOCHref=t=>t?.split("#")?.map((t=>Number(t)))??[],e.getTOCFragment=(t,e)=>t.querySelector(`[${g}="${e}"]`),e.destroy=()=>{for(const t of x)URL.revokeObjectURL(t)},e}},467:(t,e,n)=>{n.d(e,{makeComicBook:()=>i});const i=({entries:t,loadBlob:e,getSize:n},i)=>{const r=new Map,o=new Map,a=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg",".jxl",".avif"],s=t.map((t=>t.filename)).filter((t=>a.some((e=>t.endsWith(e))))).sort();if(!s.length)throw new Error("No supported image files in archive");const l={getCover:()=>e(s[0])};return l.metadata={title:i.name},l.sections=s.map((t=>({id:t,load:()=>(async t=>{if(r.has(t))return r.get(t);const n=URL.createObjectURL(await e(t)),i=URL.createObjectURL(new Blob([`<img src="${n}">`],{type:"text/html"}));return o.set(t,[n,i]),r.set(t,i),i})(t),unload:()=>(t=>{o.get(t)?.forEach?.((t=>URL.revokeObjectURL(t))),o.delete(t),r.delete(t)})(t),size:n(t)}))),l.toc=s.map((t=>({label:t,href:t}))),l.rendition={layout:"pre-paginated"},l.resolveHref=t=>({index:l.sections.findIndex((e=>e.id===t))}),l.splitTOCHref=t=>[t,null],l.getTOCFragment=t=>t.documentElement,l.destroy=()=>{for(const t of o.values())for(const e of t)URL.revokeObjectURL(e)},l}},531:(t,e,n)=>{n.a(t,(async(t,e)=>{try{var i=n(619),r=n(261),o=n(339),a=n(986),s=t([i]);i=(s.then?(await s)():s)[0],console.log("book.js"),console.log("AnxUA",navigator.userAgent);const{configure:g,ZipReader:m,BlobReader:w,TextWriter:b,BlobWriter:y}=await Promise.resolve().then(n.bind(n,260)),{EPUB:x}=await Promise.resolve().then(n.bind(n,800));var l=!1;const v=t=>{const e=t=>{const{x:e,y:n}=t;return e>=0&&n>=0&&e<=window.innerWidth&&n<=window.innerHeight},n=(t,e,n=1,i=1)=>({left:n*e.left+t.left,right:n*e.right+t.left,top:i*e.top+t.top,bottom:i*e.bottom+t.top}),i=t.getRootNode?.()??t?.endContainer?.getRootNode?.(),r=i?.defaultView?.frameElement;let o=1,a=1;if(r){const t=getComputedStyle(r).transform.match(/matrix\((.+)\)/);t&&([o,,,a]=t[1].split(/\s*,\s*/).map(Number))}const s=r?.getBoundingClientRect()??{top:0,left:0},l=Array.from(t.getClientRects()),c=n(s,l[0],o,a),d=n(s,l[l.length-1],o,a),h=window.innerWidth,u=window.innerHeight,f={point:{x:(c.left+c.right)/2/h,y:c.top/u},dir:"up"},p={point:{x:(d.left+d.right)/2/h,y:d.bottom/u},dir:"down"},g=e(f.point),m=e(p.point);return g||m?g?m?f.point.y*u>u-p.point.y*u?f:p:f:p:{point:{x:0,y:0}}},k=t=>{if(!t?.rangeCount)return null;const e=t.getRangeAt(0);return e.collapsed?null:e},S=(t,e,n)=>{const i=e.getSelection(),r=k(i);if(!r)return;const o=v(r),a=t.getCFI(n,r);let s=i.toString();if(!s){const t=r.startContainer.ownerDocument.getSelection();t.removeAllRanges(),t.addRange(r),s=t.toString()}Y({index:n,range:r,lang:"en-US",cfi:a,pos:o,text:s})},_=(t,e,n)=>{navigator.platform.includes("Win")||navigator.platform.includes("Mac")||navigator.platform.includes("iPhone")||navigator.platform.includes("iPad")?e.addEventListener("pointerup",(()=>S(t,e,n))):e.addEventListener("contextmenu",(()=>S(t,e,n))),t.isFixedLayout||(e.addEventListener("selectstart",(()=>{const e=t.shadowRoot.querySelector("foliate-paginator").shadowRoot.querySelector("#container");e&&(globalThis.originalScrollLeft=e.scrollLeft)})),e.addEventListener("selectionchange",(()=>{if("paginated"!==t.renderer.getAttribute("flow"))return;const{lastLocation:n}=t;if(!n)return;const i=k(e.getSelection());if(!i)return;globalThis.pageDebounceTimer&&(clearTimeout(globalThis.pageDebounceTimer),globalThis.pageDebounceTimer=null);const r=t.shadowRoot.querySelector("foliate-paginator").shadowRoot.querySelector("#container");if(i.compareBoundaryPoints(Range.END_TO_END,n.range)>=0)return void(globalThis.pageDebounceTimer=setTimeout((async()=>{await t.next(),globalThis.originalScrollLeft=r.scrollLeft,globalThis.pageDebounceTimer=null}),1e3));const o=()=>{const n=k(e.getSelection());n&&t.lastLocation&&t.lastLocation.range&&t.lastLocation.range.startContainer===n.endContainer&&(r.scrollLeft=globalThis.originalScrollLeft)};r.addEventListener("scroll",o),e.addEventListener("pointerup",(()=>{r.removeEventListener("scroll",o)}),{once:!0})})))},A=async t=>{const e=new Uint8Array(await t.slice(0,4).arrayBuffer());return 80===e[0]&&75===e[1]&&3===e[2]&&4===e[3]},T=async t=>{const e=new Uint8Array(await t.slice(0,5).arrayBuffer());return 37===e[0]&&80===e[1]&&68===e[2]&&70===e[3]&&45===e[4]},L=async t=>{g({useWebWorkers:!1});const e=new m(new w(t)),n=await e.getEntries(),i=new Map(n.map((t=>[t.filename,t]))),r=t=>(e,...n)=>i.has(e)?t(i.get(e),...n):null;return{entries:n,loadText:r((t=>t.getData(new b))),loadBlob:r(((t,e)=>t.getData(new y(e)))),getSize:t=>i.get(t)?.uncompressedSize??0}},E=async t=>t.isFile?t:(await Promise.all(Array.from(await new Promise(((e,n)=>t.createReader().readEntries((t=>e(t)),(t=>n(t))))),E))).flat(),C=async t=>{const e=await E(t),n=await Promise.all(e.map((t=>new Promise(((e,n)=>t.file((n=>e([n,t.fullPath])),(t=>n(t)))))))),i=new Map(n.map((([e,n])=>[n.replace(t.fullPath+"/",""),e]))),r=new TextDecoder;return{loadText:async t=>{return e=await(t=>i.get(t)?.arrayBuffer()??null)(t),e?r.decode(e):null;var e},loadBlob:t=>i.get(t),getSize:t=>i.get(t)?.size??0}},I=({name:t,type:e})=>"application/vnd.comicbook+zip"===e||t.endsWith(".cbz"),R=({name:t,type:e})=>"application/x-fictionbook+xml"===e||t.endsWith(".fb2"),M=({name:t,type:e})=>"application/x-zip-compressed-fb2"===e||t.endsWith(".fb2.zip")||t.endsWith(".fbz"),z=async t=>{let e;if(t.isDirectory){const i=await C(t),{EPUB:r}=await Promise.resolve().then(n.bind(n,800));e=await new r(i).init()}else{if(!t.size)throw new Error("File not found");if(await A(t)){const i=await L(t);if(I(t)){const{makeComicBook:r}=await Promise.resolve().then(n.bind(n,467));e=r(i,t)}else if(M(t)){const{makeFB2:t}=await Promise.resolve().then(n.bind(n,406)),{entries:r}=i,o=r.find((t=>t.filename.endsWith(".fb2"))),a=await i.loadBlob((o??r[0]).filename);e=await t(a)}else e=await new x(i).init()}else if(await T(t)){l=!0;const{makePDF:i}=await Promise.resolve().then(n.bind(n,354));e=await i(t)}else{const{isMOBI:i,MOBI:r}=await Promise.resolve().then(n.bind(n,759));if(await i(t)){const i=await Promise.resolve().then(n.bind(n,535));e=await new r({unzlib:i.unzlibSync}).open(t)}else if(R(t)){const{makeFB2:i}=await Promise.resolve().then(n.bind(n,406));e=await i(t)}}}if(!e)throw new Error("File type not supported");const i=document.createElement("foliate-view");return document.body.append(i),await i.open(e),i},O=({fontSize:t,fontName:e,fontPath:n,fontWeight:i,letterSpacing:r,spacing:o,textIndent:a,paragraphSpacing:s,fontColor:l,backgroundColor:c,justify:d,hyphenate:h,writingMode:u,backgroundImage:f,flow:p})=>`\n    @namespace epub "http://www.idpf.org/2007/ops";\n    @font-face {\n      font-family: ${e};\n      src: url('${n}');\n      font-display: swap;\n    }\n\n    html {\n        ${"auto"===u?"":`writing-mode: ${u} !important;`}\n        color: ${l} !important;\n        ${!f||p||"none"===f?"background: none !important;":`background-image: url('${f}') !important;\n    background-size: 100% 100% !important;\n    background-repeat: repeat !important;\n    background-attachment: scroll !important; \n    background-position: center center !important;\n    background-clip: content-box !important;`}\n        background-color: transparent !important;\n        letter-spacing: ${r}px;\n        font-size: ${t}em;\n    }\n\n    body {\n        background: none !important;\n        background-color: transparent;\n    }\n\n    img {\n        max-width: 100% !important;\n        object-fit: contain !important;\n        break-inside: avoid !important;\n        box-sizing: border-box !important;\n    }\n\n    a:link {\n        color:rgb(167, 96, 52) !important;\n    }\n\n    * {\n        line-height: ${o}em !important;\n        ${"book"===e?"":"system"===e?"font-family: system-ui !important;":`font-family: ${e} !important;`}\n    }\n\n    p, li, blockquote, dd, div, font {\n        color: ${l} !important;\n        // line-height: ${o} !important;\n        font-weight: ${i} !important;\n        padding-bottom: ${s}em !important;\n        text-align: ${d?"justify":"start"};\n        -webkit-hyphens: ${h?"auto":"manual"};\n        hyphens: ${h?"auto":"manual"};\n        -webkit-hyphenate-limit-before: 3;\n        -webkit-hyphenate-limit-after: 2;\n        -webkit-hyphenate-limit-lines: 2;\n        hanging-punctuation: allow-end last;\n        margin-top: 0 !important;\n        margin-bottom: 0 !important;\n        widows: 2;\n    }\n\n    p, li, blockquote, dd, font {\n        text-indent: ${a}em !important;\n    }\n    \n    p img {\n      margin-left: -${a}em;\n    }\n        \n    /* prevent the above from overriding the align attribute */\n    [align="left"] { text-align: left; }\n    [align="right"] { text-align: right; }\n    [align="center"] { text-align: center; }\n    [align="justify"] { text-align: justify; }\n\n    pre {\n        white-space: pre-wrap !important;\n    }\n    aside[epub|type~="endnote"],\n    aside[epub|type~="footnote"],\n    aside[epub|type~="note"],\n    aside[epub|type~="rearnote"] {\n        display: none;\n    }\n`,B=(t,e)=>{console.log("convertChinese",t);const n="皑蔼碍爱翱袄奥坝罢摆败颁办绊帮绑镑谤剥饱宝报鲍辈贝钡狈备惫绷笔毕毙闭边编贬变辩辫鳖瘪濒滨宾摈饼拨钵铂驳卜补参蚕残惭惨灿苍舱仓沧厕侧册测层诧搀掺蝉馋谗缠铲产阐颤场尝长偿肠厂畅钞车彻尘陈衬撑称惩诚骋痴迟驰耻齿炽冲虫宠畴踌筹绸丑橱厨锄雏础储触处传疮闯创锤纯绰辞词赐聪葱囱从丛凑窜错达带贷担单郸掸胆惮诞弹当挡党荡档捣岛祷导盗灯邓敌涤递缔点垫电淀钓调迭谍叠钉顶锭订东动栋冻斗犊独读赌镀锻断缎兑队对吨顿钝夺鹅额讹恶饿儿尔饵贰发罚阀珐矾钒烦范贩饭访纺飞废费纷坟奋愤粪丰枫锋风疯冯缝讽凤肤辐抚辅赋复负讣妇缚该钙盖干赶秆赣冈刚钢纲岗皋镐搁鸽阁铬个给龚宫巩贡钩沟构购够蛊顾剐关观馆惯贯广规硅归龟闺轨诡柜贵刽辊滚锅国过骇韩汉阂鹤贺横轰鸿红后壶护沪户哗华画划话怀坏欢环还缓换唤痪焕涣黄谎挥辉毁贿秽会烩汇讳诲绘荤浑伙获货祸击机积饥讥鸡绩缉极辑级挤几蓟剂济计记际继纪夹荚颊贾钾价驾歼监坚笺间艰缄茧检碱硷拣捡简俭减荐槛鉴践贱见键舰剑饯渐溅涧浆蒋桨奖讲酱胶浇骄娇搅铰矫侥脚饺缴绞轿较秸阶节茎惊经颈静镜径痉竞净纠厩旧驹举据锯惧剧鹃绢杰洁结诫届紧锦仅谨进晋烬尽劲荆觉决诀绝钧军骏开凯颗壳课垦恳抠库裤夸块侩宽矿旷况亏岿窥馈溃扩阔蜡腊莱来赖蓝栏拦篮阑兰澜谰揽览懒缆烂滥捞劳涝乐镭垒类泪篱离里鲤礼丽厉励砾历沥隶俩联莲连镰怜涟帘敛脸链恋炼练粮凉两辆谅疗辽镣猎临邻鳞凛赁龄铃凌灵岭领馏刘龙聋咙笼垄拢陇楼娄搂篓芦卢颅庐炉掳卤虏鲁赂禄录陆驴吕铝侣屡缕虑滤绿峦挛孪滦乱抡轮伦仑沦纶论萝罗逻锣箩骡骆络妈玛码蚂马骂吗买麦卖迈脉瞒馒蛮满谩猫锚铆贸么霉没镁门闷们锰梦谜弥觅绵缅庙灭悯闽鸣铭谬谋亩钠纳难挠脑恼闹馁腻撵捻酿鸟聂啮镊镍柠狞宁拧泞钮纽脓浓农疟诺欧鸥殴呕沤盘庞国爱赔喷鹏骗飘频贫苹凭评泼颇扑铺朴谱脐齐骑岂启气弃讫牵扦钎铅迁签谦钱钳潜浅谴堑枪呛墙蔷强抢锹桥乔侨翘窍窃钦亲轻氢倾顷请庆琼穷趋区躯驱龋颧权劝却鹊让饶扰绕热韧认纫荣绒软锐闰润洒萨鳃赛伞丧骚扫涩杀纱筛晒闪陕赡缮伤赏烧绍赊摄慑设绅审婶肾渗声绳胜圣师狮湿诗尸时蚀实识驶势释饰视试寿兽枢输书赎属术树竖数帅双谁税顺说硕烁丝饲耸怂颂讼诵擞苏诉肃虽绥岁孙损笋缩琐锁獭挞抬摊贪瘫滩坛谭谈叹汤烫涛绦腾誊锑题体屉条贴铁厅听烃铜统头图涂团颓蜕脱鸵驮驼椭洼袜弯湾顽万网韦违围为潍维苇伟伪纬谓卫温闻纹稳问瓮挝蜗涡窝呜钨乌诬无芜吴坞雾务误锡牺袭习铣戏细虾辖峡侠狭厦锨鲜纤咸贤衔闲显险现献县馅羡宪线厢镶乡详响项萧销晓啸蝎协挟携胁谐写泻谢锌衅兴汹锈绣虚嘘须许绪续轩悬选癣绚学勋询寻驯训讯逊压鸦鸭哑亚讶阉烟盐严颜阎艳厌砚彦谚验鸯杨扬疡阳痒养样瑶摇尧遥窑谣药爷页业叶医铱颐遗仪彝蚁艺亿忆义诣议谊译异绎荫阴银饮樱婴鹰应缨莹萤营荧蝇颖哟拥佣痈踊咏涌优忧邮铀犹游诱舆鱼渔娱与屿语吁御狱誉预驭鸳渊辕园员圆缘远愿约跃钥岳粤悦阅云郧匀陨运蕴酝晕韵杂灾载攒暂赞赃脏凿枣灶责择则泽贼赠扎札轧铡闸诈斋债毡盏斩辗崭栈战绽张涨帐账胀赵蛰辙锗这贞针侦诊镇阵挣睁狰帧郑证织职执纸挚掷帜质钟终种肿众诌轴皱昼骤猪诸诛烛瞩嘱贮铸筑驻专砖转赚桩庄装妆壮状锥赘坠缀谆浊兹资渍踪综总纵邹诅组钻致钟么为只凶准启板里雳余链泄",i="皚藹礙愛翺襖奧壩罷擺敗頒辦絆幫綁鎊謗剝飽寶報鮑輩貝鋇狽備憊繃筆畢斃閉邊編貶變辯辮鼈癟瀕濱賓擯餅撥缽鉑駁蔔補參蠶殘慚慘燦蒼艙倉滄廁側冊測層詫攙摻蟬饞讒纏鏟産闡顫場嘗長償腸廠暢鈔車徹塵陳襯撐稱懲誠騁癡遲馳恥齒熾沖蟲寵疇躊籌綢醜櫥廚鋤雛礎儲觸處傳瘡闖創錘純綽辭詞賜聰蔥囪從叢湊竄錯達帶貸擔單鄲撣膽憚誕彈當擋黨蕩檔搗島禱導盜燈鄧敵滌遞締點墊電澱釣調叠諜疊釘頂錠訂東動棟凍鬥犢獨讀賭鍍鍛斷緞兌隊對噸頓鈍奪鵝額訛惡餓兒爾餌貳發罰閥琺礬釩煩範販飯訪紡飛廢費紛墳奮憤糞豐楓鋒風瘋馮縫諷鳳膚輻撫輔賦複負訃婦縛該鈣蓋幹趕稈贛岡剛鋼綱崗臯鎬擱鴿閣鉻個給龔宮鞏貢鈎溝構購夠蠱顧剮關觀館慣貫廣規矽歸龜閨軌詭櫃貴劊輥滾鍋國過駭韓漢閡鶴賀橫轟鴻紅後壺護滬戶嘩華畫劃話懷壞歡環還緩換喚瘓煥渙黃謊揮輝毀賄穢會燴彙諱誨繪葷渾夥獲貨禍擊機積饑譏雞績緝極輯級擠幾薊劑濟計記際繼紀夾莢頰賈鉀價駕殲監堅箋間艱緘繭檢堿鹼揀撿簡儉減薦檻鑒踐賤見鍵艦劍餞漸濺澗漿蔣槳獎講醬膠澆驕嬌攪鉸矯僥腳餃繳絞轎較稭階節莖驚經頸靜鏡徑痙競淨糾廄舊駒舉據鋸懼劇鵑絹傑潔結誡屆緊錦僅謹進晉燼盡勁荊覺決訣絕鈞軍駿開凱顆殼課墾懇摳庫褲誇塊儈寬礦曠況虧巋窺饋潰擴闊蠟臘萊來賴藍欄攔籃闌蘭瀾讕攬覽懶纜爛濫撈勞澇樂鐳壘類淚籬離裏鯉禮麗厲勵礫曆瀝隸倆聯蓮連鐮憐漣簾斂臉鏈戀煉練糧涼兩輛諒療遼鐐獵臨鄰鱗凜賃齡鈴淩靈嶺領餾劉龍聾嚨籠壟攏隴樓婁摟簍蘆盧顱廬爐擄鹵虜魯賂祿錄陸驢呂鋁侶屢縷慮濾綠巒攣孿灤亂掄輪倫侖淪綸論蘿羅邏鑼籮騾駱絡媽瑪碼螞馬罵嗎買麥賣邁脈瞞饅蠻滿謾貓錨鉚貿麽黴沒鎂門悶們錳夢謎彌覓綿緬廟滅憫閩鳴銘謬謀畝鈉納難撓腦惱鬧餒膩攆撚釀鳥聶齧鑷鎳檸獰甯擰濘鈕紐膿濃農瘧諾歐鷗毆嘔漚盤龐國愛賠噴鵬騙飄頻貧蘋憑評潑頗撲鋪樸譜臍齊騎豈啓氣棄訖牽扡釺鉛遷簽謙錢鉗潛淺譴塹槍嗆牆薔強搶鍬橋喬僑翹竅竊欽親輕氫傾頃請慶瓊窮趨區軀驅齲顴權勸卻鵲讓饒擾繞熱韌認紉榮絨軟銳閏潤灑薩鰓賽傘喪騷掃澀殺紗篩曬閃陝贍繕傷賞燒紹賒攝懾設紳審嬸腎滲聲繩勝聖師獅濕詩屍時蝕實識駛勢釋飾視試壽獸樞輸書贖屬術樹豎數帥雙誰稅順說碩爍絲飼聳慫頌訟誦擻蘇訴肅雖綏歲孫損筍縮瑣鎖獺撻擡攤貪癱灘壇譚談歎湯燙濤縧騰謄銻題體屜條貼鐵廳聽烴銅統頭圖塗團頹蛻脫鴕馱駝橢窪襪彎灣頑萬網韋違圍爲濰維葦偉僞緯謂衛溫聞紋穩問甕撾蝸渦窩嗚鎢烏誣無蕪吳塢霧務誤錫犧襲習銑戲細蝦轄峽俠狹廈鍁鮮纖鹹賢銜閑顯險現獻縣餡羨憲線廂鑲鄉詳響項蕭銷曉嘯蠍協挾攜脅諧寫瀉謝鋅釁興洶鏽繡虛噓須許緒續軒懸選癬絢學勳詢尋馴訓訊遜壓鴉鴨啞亞訝閹煙鹽嚴顔閻豔厭硯彥諺驗鴦楊揚瘍陽癢養樣瑤搖堯遙窯謠藥爺頁業葉醫銥頤遺儀彜蟻藝億憶義詣議誼譯異繹蔭陰銀飲櫻嬰鷹應纓瑩螢營熒蠅穎喲擁傭癰踴詠湧優憂郵鈾猶遊誘輿魚漁娛與嶼語籲禦獄譽預馭鴛淵轅園員圓緣遠願約躍鑰嶽粵悅閱雲鄖勻隕運蘊醞暈韻雜災載攢暫贊贓髒鑿棗竈責擇則澤賊贈紮劄軋鍘閘詐齋債氈盞斬輾嶄棧戰綻張漲帳賬脹趙蟄轍鍺這貞針偵診鎮陣掙睜猙幀鄭證織職執紙摯擲幟質鍾終種腫衆謅軸皺晝驟豬諸誅燭矚囑貯鑄築駐專磚轉賺樁莊裝妝壯狀錐贅墜綴諄濁茲資漬蹤綜總縱鄒詛組鑽緻鐘麼為隻兇準啟闆裡靂餘鍊洩",r="s2t"===t?n:i,o="s2t"===t?i:n,a=(t,e,n)=>{t.nodeType===Node.TEXT_NODE?t.textContent=t.textContent.replace(/[\u4e00-\u9fa5]/g,(t=>n[e.indexOf(t)]??t)):t.childNodes.forEach((t=>a(t,e,n)))};e.body.childNodes.forEach((t=>{a(t,r,o)}))},F=t=>{},P=t=>{"none"!==p.convertChineseMode&&B(p.convertChineseMode,t),p.bionicReadingMode&&F(t)},N=document.getElementById("footnote-dialog");N.style.display="none",N.addEventListener("click",(()=>{N.style.display="none",W("onFootnoteClose")}));const U=t=>{clearSelection(),N.querySelector("main").replaceChildren(t),t.addEventListener("load",(e=>{const{doc:n,index:i}=e.detail;globalThis.footnoteSelection=()=>S(t,n,i),_(t,n,i),P(n),setTimeout((()=>{const t=document.getElementById("footnote-dialog");document.querySelector("#footnote-dialog > main > foliate-view").shadowRoot.querySelector("foliate-paginator").shadowRoot.querySelector("#container > div > iframe"),t.style.display="block"}),0)}));const{renderer:e}=t;e.setAttribute("flow","scrolled"),e.setAttribute("gap","5%"),e.setAttribute("top-margin","0px"),e.setAttribute("bottom-margin","0px");const n={fontSize:f.fontSize,fontName:f.fontName,fontPath:f.fontPath,letterSpacing:f.letterSpacing,spacing:f.spacing,textIndent:f.textIndent,fontColor:f.fontColor,backgroundColor:"transparent",justify:!0,hyphenate:!0};e.setStyles(O(n)),N.style.backgroundColor=f.backgroundColor.slice(0,7)+"33"};N.addEventListener("click",(t=>t.target===N?N.close():null));class D{annotations=new Map;annotationsByValue=new Map;#b=new r.F;#y;#r;#x;#v=!1;#k=!1;#S={exists:!1,cfi:null,id:null};constructor(){this.#b.addEventListener("before-render",(t=>{const{view:e}=t.detail;this.setView(e),U(e)})),this.#b.addEventListener("render",(t=>{const{view:e}=t.detail;N.showModal()})),this.#x=null}async open(t,e){this.view=await z(t,e),d||(this.view.addEventListener("load",this.#_.bind(this)),this.view.addEventListener("relocate",this.#A.bind(this)),this.view.addEventListener("click-view",this.#T.bind(this)),this.view.addEventListener("doctouchstart",this.#L.bind(this)),this.view.addEventListener("doctouchmove",this.#E.bind(this)),this.view.addEventListener("doctouchend",this.#C.bind(this)),document.documentElement.style.backgroundColor="grey",j(),e||this.view.renderer.next(),this.setView(this.view),await this.view.init({lastLocation:e}))}setView(t){t.addEventListener("create-overlay",(t=>{const{index:e}=t.detail,n=this.annotations.get(e);if(n)for(const t of n)this.view.addAnnotation(t)})),t.addEventListener("draw-annotation",(t=>{const{draw:e,annotation:n}=t.detail,{color:i,type:r}=n;"highlight"===r?e(o.u.highlight,{color:i}):"underline"===r&&e(o.u.underline,{color:i})})),t.addEventListener("show-annotation",(t=>{const e=this.annotationsByValue.get(t.detail.value),n=v(t.detail.range);q({annotation:e,pos:n})})),t.addEventListener("external-link",(t=>{t.preventDefault(),X(t.detail)})),t.addEventListener("link",(t=>this.#b.handle(this.view.book,t)?.catch((e=>{console.warn(e),this.view.goTo(t.detail.href)})))),t.history.addEventListener("pushstate",(e=>{W("onPushState",{canGoBack:t.history.canGoBack,canGoForward:t.history.canGoForward})})),t.addEventListener("click-image",(async t=>{console.log("click-image",t.detail.img.src);const e=t.detail.img.src,n=await fetch(e).then((t=>t.blob())),i=await new Promise(((t,e)=>{const i=new FileReader;i.onloadend=()=>t(i.result),i.onerror=e,i.readAsDataURL(n)}));W("onImageClick",i)}))}renderAnnotation(t){const e=t??allAnnotations??[];for(const t of e){const{value:e,type:n,color:i,note:r}=t,o={id:t.id,value:e,type:n,color:i,note:r};this.addAnnotation(o)}}showContextMenu(){return S(this.view,this.#y,this.#r)}addAnnotation(t){const{value:e}=t,n=(e.split("/")[2].split("!")[0]-2)/2,i=this.annotations.get(n);i?i.push(t):this.annotations.set(n,[t]),this.annotationsByValue.set(e,t),"bookmark"===t.type?this.#I(t)&&(this.#R(60),this.#S={exists:!0,cfi:t.value,id:t.id}):this.view.addAnnotation(t)}#M(){const t=this.#r,e=this.annotations.get(t);let n=!1,i=null;if(e)for(const t of e)if("bookmark"===t.type&&(n=!!this.#I(t)||n,n)){i=t,this.#R(60);break}this.#S={exists:n,cfi:n?i.value:null,id:n?i.id:null},n||this.#z()}#I(t){const e=this.view.lastLocation?.cfi,n=(0,a.ap)(e),i=(0,a.ap)(e,!0),r=t.value,o=(0,a.ap)(r);if((0,a.UD)(n,o)<=0&&(0,a.UD)(i,o)>0)return!0}removeAnnotation(t){const e=this.annotationsByValue.get(t);if(!e)return;const{value:n}=e,i=(n.split("/")[2].split("!")[0]-2)/2,r=this.annotations.get(i);if(r){const t=r.findIndex((t=>t.id===e.id));-1!==t&&r.splice(t,1)}this.annotationsByValue.delete(n),this.view.addAnnotation(e,!0),"bookmark"===e.type&&this.#I(e)&&(this.#z(),this.handleBookmark(!0),this.#S={exists:!1,cfi:null,id:null})}#_({detail:{doc:t,index:e}}){this.#y=t,this.#r=e,_(this.view,t,e),this.#O(),this.readingFeatures(p)}#A({detail:t}){const{cfi:e,fraction:n,location:i,tocItem:r,pageItem:o,chapterLocation:a}=t,s=o?`Page ${o.label}`:`Loc ${i.current}`;this.#M(),H({cfi:e,fraction:n,loc:s,tocItem:r,pageItem:o,location:i,chapterLocation:a,bookmark:this.#S})}#T({detail:{x:t,y:e}}){const n=t/window.innerWidth,i=e/window.innerHeight;V(n,i)}get index(){return this.#r}#O=()=>{this.#x=[];const t=document.createTreeWalker(this.#y.body,NodeFilter.SHOW_TEXT,null,!1);for(;t.nextNode();)this.#x.push(t.currentNode.textContent)};#B=()=>{const t=document.createTreeWalker(this.#y.body,NodeFilter.SHOW_TEXT,null,!1);let e,n=0;for(;e=t.nextNode();)e.textContent=this.#x[n++]};readingFeatures=()=>{this.#B(),P(this.#y)};getChapterContent=()=>this.#y.body.textContent;getPreviousContent=(t=2e3)=>{let e=this.view.lastLocation?.range?.endContainer?.parentElement;if(!e)return"";let n="";for(;n.length<t&&e;)n=e.textContent+n,e=e.previousSibling;return n};getSelection=()=>{const t=this.#y.getSelection();return k(t)};#F=()=>"scrollTop"===this.view.renderer.scrollProp;#L=({detail:t})=>{this.#F()||(this.#v=!!document.getElementById("bookmark-icon"),this.#k=!1)};#E=({detail:t})=>{if(this.#F())return;const e=this.view.shadowRoot.children[0];if("vertical"===t.touchState.direction){const n=t.touchState.delta.y;n>0?(e.style.transform=`translateY(${Math.sqrt(50*n)}px)`,this.#R(n)):n<-60&&(this.#k||(this.#k=!0,window.pullUp()))}};#C=({detail:t})=>{if(this.#F())return;const e=this.view.shadowRoot.children[0];if("vertical"===t.touchState.direction){const n=t.touchState.delta.y;n<-60||(n>60?this.#v?(this.#z(),this.handleBookmark(!0)):(this.#R(n),this.handleBookmark(!1)):this.#z()),e.style.transition="transform 0.3s ease-out",e.style.transform="translateY(0px)",setTimeout((()=>{e.style.transition=""}),300)}};#R=t=>{let e=document.getElementById("bookmark-icon");e||(e=document.createElement("div"),e.id="bookmark-icon",e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 8 24"><g data-name="Layer 2"><g data-name="bookmark"><rect width="8" height="24" opacity="0"/><path d="M2 21a1 1 0 0 1-.49-.13A1 1 0 0 1 1 20V5.33A2.28 2.28 0 0 1 3.2 3h1.6A2.28 2.28 0 0 1 7 5.33V20a1 1 0 0 1-.5.86 1 1 0 0 1-1 0L4 19.07l-1.5 1.79A1 1 0 0 1 2 21z" fill="#215a8f"/></g></g></svg>',e.style.cssText="\n        height: 80px;\n        width: 26px;\n        position: fixed;\n        top: -16px;\n        right: 20px;\n        font-size: 24px;\n        opacity: 0;\n        transition: opacity 0.2s ease;\n        z-index: 1000;\n        pointer-events: none;\n      ",document.body.appendChild(e));const n=Math.min(t/60,1);e.style.opacity=n};#z=()=>{const t=document.getElementById("bookmark-icon");t&&(t.style.transition="opacity 0.3s ease-out",t.style.opacity="0",setTimeout((()=>{t&&t.parentNode&&t.parentNode.removeChild(t)}),300))};handleBookmark=t=>{const e=t?this.#S.cfi:this.view.lastLocation?.cfi;let n=this.view.lastLocation.range.startContainer.data??this.view.lastLocation.range.startContainer.innerText;n=n.trim(),n.length>200&&(n=n.slice(0,200)+"...");const i=this.view.lastLocation.fraction;W("handleBookmark",{remove:t,detail:{cfi:e,content:n,percentage:i}})}}const $=async(t,e)=>{const n=new D;globalThis.reader=n,await n.open(t,e),d?K():(W("onLoadEnd"),G(),W("renderAnnotations"))},W=(t,e)=>{window.flutter_inappwebview.callHandler(t,e)},j=()=>{const t={scroll:!1,animated:!0};switch(f.pageTurnStyle){case"slide":t.scroll=!1,t.animated=!0;break;case"scroll":t.scroll=!0,t.animated=!0;break;case"noAnimation":t.scroll=!1,t.animated=!1}reader.view.renderer.setAttribute("flow",t.scroll?"scrolled":"paginated"),reader.view.renderer.setAttribute("top-margin",`${f.topMargin}px`),reader.view.renderer.setAttribute("bottom-margin",`${f.bottomMargin}px`),reader.view.renderer.setAttribute("gap",`${f.sideMargin}%`),reader.view.renderer.setAttribute("background-color",f.backgroundColor),reader.view.renderer.setAttribute("max-column-count",f.maxColumnCount),reader.view.renderer.setAttribute("bgimg-url",f.backgroundImage),t.animated?reader.view.renderer.setAttribute("animated","true"):reader.view.renderer.removeAttribute("animated");const e={fontSize:f.fontSize,fontName:f.fontName,fontPath:f.fontPath,fontWeight:f.fontWeight,letterSpacing:f.letterSpacing,spacing:f.spacing,paragraphSpacing:f.paragraphSpacing,textIndent:f.textIndent,fontColor:f.fontColor,backgroundColor:f.backgroundColor,justify:f.justify,hyphenate:f.hyphenate,writingMode:f.writingMode,backgroundImage:f.backgroundImage,flow:t.scroll};reader.view.renderer.setStyles?.(O(e))},H=t=>{const e=t.tocItem?.label,n=t.tocItem?.href,i=t.chapterLocation.total,r=t.chapterLocation.current,o=t.location.total,a=t.location.current,s=t.cfi,l=t.fraction;W("onRelocated",{chapterTitle:e,chapterHref:n,chapterTotalPages:i,chapterCurrentPage:r,bookTotalPages:o,bookCurrentPage:a,cfi:s,percentage:l,bookmark:t.bookmark})},q=t=>W("onAnnotationClick",t),V=(t,e)=>W("onClick",{x:t,y:e}),X=t=>console.log(t),G=()=>W("onSetToc",reader.view.book.toc),K=async()=>{const t=await reader.view.book.getCover();if(t){const e=new FileReader;e.readAsDataURL(t),e.onloadend=()=>{W("onMetadata",{...reader.view.book.metadata,cover:e.result})}}else W("onMetadata",{...reader.view.book.metadata,cover:null})};window.changeStyle=t=>{f={...f,...t},console.log("changeStyle",JSON.stringify(f)),j()},window.goToHref=t=>reader.view.goTo(t),window.goToCfi=t=>reader.view.goTo(t),window.goToPercent=t=>reader.view.goToFraction(t),window.nextPage=()=>reader.view.next(),window.prevPage=()=>reader.view.prev(),window.setScroll=()=>{f.scroll=!0,f.animated=!0,j()},window.setPaginated=()=>{f.scroll=!1,f.animated=!0,j()},window.setNoAnimation=()=>{f.scroll=!1,f.animated=!1,j()};const Y=t=>{N.open||l?W("onSelectionEnd",{...t,footnote:!0}):W("onSelectionEnd",{...t,footnote:!1})};window.showContextMenu=()=>{N.open?footnoteSelection():reader.showContextMenu()},window.getSelection=()=>reader.getSelection(),window.clearSelection=()=>reader.view.deselect(),window.addAnnotation=t=>reader.addAnnotation(t),window.addBookmarkHere=()=>reader.handleBookmark(!1),window.removeAnnotation=t=>reader.removeAnnotation(t),window.prevSection=()=>reader.view.renderer.prevSection(),window.nextSection=()=>reader.view.renderer.nextSection(),window.initTts=()=>reader.view.initTTS(),window.ttsStop=()=>reader.view.initTTS(!0),window.ttsHere=()=>(initTts(),reader.view.tts.from(reader.view.lastLocation.range)),window.ttsNextSection=async()=>(await nextSection(),initTts(),ttsNext()),window.ttsPrevSection=async t=>(await prevSection(),initTts(),t?reader.view.tts.end():ttsNext()),window.ttsNext=async()=>reader.view.tts.next(!0)||await ttsNextSection(),window.ttsPrev=()=>reader.view.tts.prev(!0)||ttsPrevSection(!0),window.ttsPrepare=()=>reader.view.tts.prepare(),window.clearSearch=()=>reader.view.clearSearch(),window.search=async(t,e)=>{null==e&&(e={scope:"book",matchCase:!1,matchDiacritics:!1,matchWholeWords:!1});const n=t.trim();if(!n)return;const i="section"===e.scope?reader.index:null;for await(const t of reader.view.search({...e,query:n,index:i}))W("onSearch","done"===t?{process:1}:"progress"in t?{process:t.progress}:t)},window.back=()=>reader.view.history.back(),window.forward=()=>reader.view.history.forward(),window.renderAnnotations=t=>reader.renderAnnotation(t),window.theChapterContent=()=>reader.getChapterContent(),window.previousContent=(t=2e3)=>reader.getPreviousContent(t),window.isFootNoteOpen=()=>N.getAttribute("style").includes("display: block"),window.closeFootNote=()=>{N.style.display="none",W("onFootnoteClose")},window.readingFeatures=t=>{p={...p,...t},reader.readingFeatures()},window.pullUp=()=>{W("onPullUp")};var c=new URLSearchParams(window.location.search),d=JSON.parse(c.get("importing")),h=JSON.parse(c.get("url")),u=JSON.parse(c.get("initialCfi")),f=JSON.parse(c.get("style")),p=JSON.parse(c.get("readingRules"));fetch(h).then((t=>t.blob())).then((t=>$(new File([t],new URL(h,window.location.origin).pathname),u))).catch((t=>console.error(t))),e()}catch(t){e(t)}}),1)},535:(t,e,n)=>{n.r(e),n.d(e,{unzlibSync:()=>C});var i=Uint8Array,r=Uint16Array,o=Uint32Array,a=new i([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),s=new i([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),l=new i([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),c=function(t,e){for(var n=new r(31),i=0;i<31;++i)n[i]=e+=1<<t[i-1];var a=new o(n[30]);for(i=1;i<30;++i)for(var s=n[i];s<n[i+1];++s)a[s]=s-n[i]<<5|i;return[n,a]},d=c(a,2),h=d[0],u=d[1];h[28]=258,u[258]=28;for(var f=c(s,0)[0],p=new r(32768),g=0;g<32768;++g){var m=(43690&g)>>>1|(21845&g)<<1;m=(61680&(m=(52428&m)>>>2|(13107&m)<<2))>>>4|(3855&m)<<4,p[g]=((65280&m)>>>8|(255&m)<<8)>>>1}var w=function(t,e,n){for(var i=t.length,o=0,a=new r(e);o<i;++o)t[o]&&++a[t[o]-1];var s,l=new r(e);for(o=0;o<e;++o)l[o]=l[o-1]+a[o-1]<<1;if(n){s=new r(1<<e);var c=15-e;for(o=0;o<i;++o)if(t[o])for(var d=o<<4|t[o],h=e-t[o],u=l[t[o]-1]++<<h,f=u|(1<<h)-1;u<=f;++u)s[p[u]>>>c]=d}else for(s=new r(i),o=0;o<i;++o)t[o]&&(s[o]=p[l[t[o]-1]++]>>>15-t[o]);return s},b=new i(288);for(g=0;g<144;++g)b[g]=8;for(g=144;g<256;++g)b[g]=9;for(g=256;g<280;++g)b[g]=7;for(g=280;g<288;++g)b[g]=8;var y=new i(32);for(g=0;g<32;++g)y[g]=5;var x=w(b,9,1),v=w(y,5,1),k=function(t){for(var e=t[0],n=1;n<t.length;++n)t[n]>e&&(e=t[n]);return e},S=function(t,e,n){var i=e/8|0;return(t[i]|t[i+1]<<8)>>(7&e)&n},_=function(t,e){var n=e/8|0;return(t[n]|t[n+1]<<8|t[n+2]<<16)>>(7&e)},A=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(t,e,n){var i=new Error(e||A[t]);if(i.code=t,Error.captureStackTrace&&Error.captureStackTrace(i,T),!n)throw i;return i},L=function(t,e,n){var c=t.length;if(!c||n&&n.f&&!n.l)return e||new i(0);var d=!e||n,u=!n||n.i;n||(n={}),e||(e=new i(3*c));var p=function(t){var n=e.length;if(t>n){var r=new i(Math.max(2*n,t));r.set(e),e=r}},g=n.f||0,m=n.p||0,b=n.b||0,y=n.l,A=n.d,L=n.m,E=n.n,C=8*c;do{if(!y){g=S(t,m,1);var I=S(t,m+1,3);if(m+=3,!I){var R=t[(W=4+((m+7)/8|0))-4]|t[W-3]<<8,M=W+R;if(M>c){u&&T(0);break}d&&p(b+R),e.set(t.subarray(W,M),b),n.b=b+=R,n.p=m=8*M,n.f=g;continue}if(1==I)y=x,A=v,L=9,E=5;else if(2==I){var z=S(t,m,31)+257,O=S(t,m+10,15)+4,B=z+S(t,m+5,31)+1;m+=14;for(var F=new i(B),P=new i(19),N=0;N<O;++N)P[l[N]]=S(t,m+3*N,7);m+=3*O;var U=k(P),D=(1<<U)-1,$=w(P,U,1);for(N=0;N<B;){var W,j=$[S(t,m,D)];if(m+=15&j,(W=j>>>4)<16)F[N++]=W;else{var H=0,q=0;for(16==W?(q=3+S(t,m,3),m+=2,H=F[N-1]):17==W?(q=3+S(t,m,7),m+=3):18==W&&(q=11+S(t,m,127),m+=7);q--;)F[N++]=H}}var V=F.subarray(0,z),X=F.subarray(z);L=k(V),E=k(X),y=w(V,L,1),A=w(X,E,1)}else T(1);if(m>C){u&&T(0);break}}d&&p(b+131072);for(var G=(1<<L)-1,K=(1<<E)-1,Y=m;;Y=m){var J=(H=y[_(t,m)&G])>>>4;if((m+=15&H)>C){u&&T(0);break}if(H||T(2),J<256)e[b++]=J;else{if(256==J){Y=m,y=null;break}var Z=J-254;if(J>264){var Q=a[N=J-257];Z=S(t,m,(1<<Q)-1)+h[N],m+=Q}var tt=A[_(t,m)&K],et=tt>>>4;if(tt||T(3),m+=15&tt,X=f[et],et>3&&(Q=s[et],X+=_(t,m)&(1<<Q)-1,m+=Q),m>C){u&&T(0);break}d&&p(b+131072);for(var nt=b+Z;b<nt;b+=4)e[b]=e[b-X],e[b+1]=e[b+1-X],e[b+2]=e[b+2-X],e[b+3]=e[b+3-X];b=nt}}n.l=y,n.p=Y,n.b=b,n.f=g,y&&(g=1,n.m=L,n.d=A,n.n=E)}while(!g);return b==e.length?e:function(t,e,n){(null==e||e<0)&&(e=0),(null==n||n>t.length)&&(n=t.length);var a=new(2==t.BYTES_PER_ELEMENT?r:4==t.BYTES_PER_ELEMENT?o:i)(n-e);return a.set(t.subarray(e,n)),a}(e,0,b)},E=new i(0);function C(t,e){return L(((8!=(15&(n=t)[0])||n[0]>>>4>7||(n[0]<<8|n[1])%31)&&T(6,"invalid zlib data"),32&n[1]&&T(6,"invalid zlib data: preset dictionaries not supported"),t.subarray(2,-4)),e);var n}var I="undefined"!=typeof TextDecoder&&new TextDecoder;try{I.decode(E,{stream:!0})}catch(i){}},587:(t,e,n)=>{n.r(e),n.d(e,{Paginator:()=>b});const i=t=>new Promise((e=>setTimeout(e,t))),r=(t,e,n,i=n)=>{const r=t.createRange();return r.setStart(e,n),r.setEnd(e,i),r},o=(t,e,n,i=0,a=e.nodeValue.length)=>{if(a-i==1)return n(r(t,e,i),r(t,e,a))<0?i:a;const s=Math.floor(i+(a-i)/2),l=n(r(t,e,i,s),r(t,e,s,a));return l<0?o(t,e,n,i,s):l>0?o(t,e,n,s,a):s},{SHOW_ELEMENT:a,SHOW_TEXT:s,SHOW_CDATA_SECTION:l,FILTER_ACCEPT:c,FILTER_REJECT:d,FILTER_SKIP:h}=NodeFilter,u=a|s|l,f=(t,e,n,i)=>{if(!t)return;const r=t.createTreeWalker(t.body,u,{acceptNode:r=>{const o=r.localName?.toLowerCase();if("script"===o||"style"===o)return d;if(1===r.nodeType){const{left:t,right:o}=i(r.getBoundingClientRect());if(o<e||t>n)return d;if(t>=e&&o<=n)return c}else{if(!r.nodeValue?.trim())return d;const o=t.createRange();o.selectNodeContents(r);const{left:a,right:s}=i(o.getBoundingClientRect());if(s>=e&&a<=n)return c}return h}}),a=[];for(let t=r.nextNode();t;t=r.nextNode())a.push(t);const s=a[0]??t.body,l=a[a.length-1]??s,f=1===s.nodeType?0:o(t,s,((t,n)=>{const r=i(t.getBoundingClientRect()),o=i(n.getBoundingClientRect());return r.right<e&&o.left>e?0:o.left>e?-1:1})),p=1===l.nodeType?0:o(t,l,((t,e)=>{const r=i(t.getBoundingClientRect()),o=i(e.getBoundingClientRect());return r.right<n&&o.left>n?0:o.left>n?-1:1})),g=t.createRange();return g.setStart(s,f),g.setEnd(l,p),g},p=t=>{let e;return e="none"===t?"none":`url(${t}) repeat scroll 50% 50% / 100% 100%`,e},g=(t,e)=>Array.from({length:t},(()=>{const t=document.createElement("div"),n=document.createElement("div");return t.append(n),n.setAttribute("part",e),t})),m=(t,e)=>{const{style:n}=t;for(const[t,i]of Object.entries(e))n.setProperty(t,i,"important")};class w{#e=new ResizeObserver((()=>this.expand()));#P=document.createElement("div");#N=document.createElement("iframe");#U=document.createRange();#D;#$=!1;#W=!1;#j=!0;#H;#q={};constructor({container:t,onExpand:e}){this.container=t,this.onExpand=e,this.#N.setAttribute("part","filter"),this.#P.append(this.#N),Object.assign(this.#P.style,{boxSizing:"content-box",position:"relative",overflow:"hidden",flex:"0 0 auto",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),Object.assign(this.#N.style,{overflow:"hidden",border:"0",display:"none",width:"100%",height:"100%"}),this.#N.setAttribute("sandbox","allow-same-origin allow-scripts"),this.#N.setAttribute("scrolling","no")}get element(){return this.#P}get document(){return this.#N.contentDocument}async load(t,e,n){if("string"!=typeof t)throw new Error(`${t} is not string`);return new Promise((i=>{this.#N.addEventListener("load",(()=>{const t=this.document;e?.(t),this.#N.style.display="block";const{vertical:r,rtl:o}=(t=>{const{defaultView:e}=t,{writingMode:n,direction:i}=e.getComputedStyle(t.body);return{vertical:"vertical-rl"===n||"vertical-lr"===n,rtl:"rtl"===t.body.dir||"rtl"===i||"rtl"===t.documentElement.dir}})(t);this.#N.style.display="none",this.#$=r,this.#W=o,this.#U.selectNodeContents(t.body);const a=n?.({vertical:r,rtl:o});this.#N.style.display="block",this.render(a),this.#e.observe(t.body),t.fonts.ready.then((()=>this.expand())),i()}),{once:!0}),this.#N.src=t}))}render(t){t&&(this.#j="scrolled"!==t.flow,this.#q=t,this.#j?this.columnize(t):this.scrolled(t))}scrolled({gap:t,columnWidth:e}){const n=this.#$,i=this.document;i&&(m(i.documentElement,{"box-sizing":"border-box",padding:n?`${t}px 0`:`0 ${t}px`,"column-width":"auto",height:"auto",width:"auto"}),m(i.body,{[n?"max-height":"max-width"]:`${e}px`,margin:"auto"}),this.setImageSize(),this.expand())}columnize({width:t,height:e,gap:n,columnWidth:i,topMargin:r,bottomMargin:o}){const a=this.#$;this.#H=a?e:t;const s=this.document,l=`${n/2}px ${r}px ${n/2}px ${o}px`,c=`${r}px ${n/2}px ${o}px ${n/2}px`;m(s.documentElement,{"box-sizing":"border-box","column-width":`${Math.trunc(i)}px`,"column-gap":`${n}px`,"column-fill":"auto",...a?{width:`${t}px`}:{height:`${e}px`},padding:a?l:c,overflow:"hidden","overflow-wrap":"break-word",position:"static",border:"0",margin:"0","max-height":"none","max-width":"none","min-height":"none","min-width":"none","-webkit-line-box-contain":"block glyphs replaced"}),m(s.body,{"max-height":"none","max-width":"none",margin:"0"}),this.setImageSize(),this.expand()}setImageSize(){const{width:t,height:e,margin:n}=this.#q,i=this.#$,r=this.document;for(const o of r.body.querySelectorAll("img, svg, video")){const{maxHeight:a,maxWidth:s}=r.defaultView.getComputedStyle(o);m(o,{"max-height":i?"none"!==a&&"0px"!==a?a:"100%":e-2*n+"px","max-width":i?t-2*n+"px":"none"!==s&&"0px"!==s?s:"100%","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"})}}expand(){const{documentElement:t}=this.document;if(this.#j){const e=this.#$?"height":"width",n=this.#$?"width":"height";this.#U.selectNodeContents(this.document.body);const i=this.#U.getBoundingClientRect(),r=t.getBoundingClientRect(),o=(this.#$?0:this.#W?r.right-i.right:i.left-r.left)+i[e],a=Math.ceil(o/this.#H)*this.#H;this.#P.style.padding="0",this.#N.style[e]=`${a}px`,this.#P.style[e]=`${a+2*this.#H}px`,this.#N.style[n]="100%",this.#P.style[n]="100%",t.style[e]=`${this.#H}px`,this.#D&&(this.#D.element.style.margin="0",this.#D.element.style.left=this.#$?"0":`${this.#H}px`,this.#D.element.style.top=this.#$?`${this.#H}px`:"0",this.#D.element.style[e]=`${a}px`,this.#D.redraw())}else{const e=this.#$?"width":"height",n=this.#$?"height":"width",i=t.getBoundingClientRect()[e],{margin:r}=this.#q,o=this.#$?`0 ${r}px`:`${r}px 0`;this.#P.style.padding=o,this.#N.style[e]=`${i}px`,this.#P.style[e]=`${i}px`,this.#N.style[n]="100%",this.#P.style[n]="100%",this.#D&&(this.#D.element.style.margin=o,this.#D.element.style.left="0",this.#D.element.style.top="0",this.#D.element.style[e]=`${i}px`,this.#D.redraw())}this.onExpand()}set overlayer(t){this.#D=t,this.#P.append(t.element)}get overlayer(){return this.#D}destroy(){this.document&&this.#e.unobserve(this.document.body)}}class b extends HTMLElement{static observedAttributes=["flow","gap","top-margin","bottom-margin","background-color","max-inline-size","max-block-size","max-column-count"];#t=this.attachShadow({mode:"open"});#e=new ResizeObserver((()=>this.render()));#V;#X;#G;#K;#$=!1;#W=!1;#Y=0;#r=-1;#J=0;#Z=!1;#Q=!1;#tt;#et=new WeakMap;#nt=matchMedia("(prefers-color-scheme: dark)");#it;#rt;#ot;#at;constructor(){super(),this.#t.innerHTML='<style>\n        :host {\n            display: block;\n            container-type: size;\n        }\n        :host, #top {\n            box-sizing: border-box;\n            position: relative;\n            overflow: hidden;\n            width: 100%;\n            height: 100%;\n        }\n        #top {\n            height: 100%;\n            // --_gap: 7%;\n            background-color: var(--_background-color);\n            --_max-inline-size: 720px;\n            --_max-block-size: 1440px;\n            --_max-column-count: 2;\n            --_max-column-count-portrait: 1;\n            --_max-column-count-spread: var(--_max-column-count);\n            --_half-gap: calc(var(--_gap) / 2);\n            --_max-width: calc(var(--_max-inline-size) * var(--_max-column-count-spread));\n            --_max-height: var(--_max-block-size);\n            display: grid;\n            grid-template-columns:\n                minmax(var(--_half-gap), 1fr)\n                var(--_half-gap)\n                minmax(0, calc(var(--_max-width) - var(--_gap)))\n                var(--_half-gap)\n                minmax(var(--_half-gap), 1fr);\n            grid-template-rows:\n                var(--_top-margin)\n                1fr\n                var(--_bottom-margin);\n            &.vertical {\n                --_max-column-count-spread: var(--_max-column-count-portrait);\n                --_max-width: var(--_max-block-size);\n                --_max-height: calc(var(--_max-inline-size) * var(--_max-column-count-spread));\n            }\n            @container (orientation: portrait) {\n                & {\n                    --_max-column-count-spread: var(--_max-column-count-portrait);\n                }\n                &.vertical {\n                    --_max-column-count-spread: var(--_max-column-count);\n                }\n            }\n        }\n        #background {\n            grid-column: 1 / -1;\n            grid-row: 1 / -1;\n        }\n        #container {\n            grid-column: 1 / -1;\n            grid-row: 1 / -1;\n            overflow: hidden;\n            -ms-overflow-style: none;  /* Internet Explorer 10+ */\n            scrollbar-width: none;  /* Firefox */\n        }\n        #container::-webkit-scrollbar { \n            display: none;  /* Safari and Chrome */\n        }\n        :host([flow="scrolled"]) #container {\n            grid-column: 1 / -1;\n            grid-row: 2;\n            overflow: auto;\n        }\n        #header {\n            grid-column: 3 / 4;\n            grid-row: 1;\n        }\n        #footer {\n            grid-column: 3 / 4;\n            grid-row: 3;\n            align-self: end;\n        }\n        #header, #footer {\n            display: grid;\n            height: var(--_margin);\n        }\n        :is(#header, #footer) > * {\n            display: flex;\n            align-items: center;\n            min-width: 0;\n        }\n        :is(#header, #footer) > * > * {\n            width: 100%;\n            overflow: hidden;\n            white-space: nowrap;\n            text-overflow: ellipsis;\n            text-align: center;\n            font-size: .75em;\n            opacity: .6;\n        }\n        </style>\n        <div id="top">\n            <div id="background" part="filter"></div>\n            <div id="container"></div>\n        </div>\n        ',this.#V=this.#t.getElementById("top"),this.#X=this.#t.getElementById("background"),this.#G=this.#t.getElementById("container"),this.#e.observe(this.#G),this.#G.addEventListener("scroll",(t=>{let e;return(...n)=>{e&&clearTimeout(e),e=setTimeout((()=>{e=null,t(...n)}),50)}})((()=>{this.scrolled&&(this.#Z?this.#Z=!1:this.#st("scroll"))})));const t={passive:!1};this.addEventListener("touchstart",this.#L.bind(this),t),this.addEventListener("touchmove",this.#E.bind(this),t),this.addEventListener("touchend",this.#C.bind(this),t),this.addEventListener("load",(({detail:{doc:e}})=>{e.addEventListener("touchstart",this.#L.bind(this),t),e.addEventListener("touchmove",this.#E.bind(this),t),e.addEventListener("touchend",this.#C.bind(this),t)})),this.#it=()=>{this.#K&&(this.#X.style.background=p(this.getAttribute("bgimg-url")))},this.#nt.addEventListener("change",this.#it)}attributeChangedCallback(t,e,n){switch(t){case"flow":this.render();break;case"top-margin":case"max-block-size":case"background-color":this.#V.style.setProperty("--_"+t,n);break;case"bottom-margin":case"gap":case"max-column-count":case"max-inline-size":this.#V.style.setProperty("--_"+t,n),this.render()}}open(t){this.bookDir=t.dir,this.sections=t.sections}#lt(){return this.#K&&(this.#K.destroy(),this.#G.removeChild(this.#K.element)),this.#K=new w({container:this,onExpand:()=>this.scrollToAnchor(this.#J)}),this.#G.append(this.#K.element),this.#K}#ct({vertical:t,rtl:e}){this.#$=t,this.#W=e,this.#V.classList.toggle("vertical",t),this.#X.style.background=p(this.getAttribute("bgimg-url"));const{width:n,height:i}=this.#G.getBoundingClientRect(),r=t?i:n,o=getComputedStyle(this.#V),a=parseFloat(o.getPropertyValue("--_max-inline-size")),s=parseInt(o.getPropertyValue("--_max-column-count")),l=parseFloat(o.getPropertyValue("--_top-margin"));this.#Y=l;const c=parseFloat(o.getPropertyValue("--_gap"))/100,d=-c/(c-1)*r,h=parseFloat(o.getPropertyValue("--_top-margin")),u=parseFloat(o.getPropertyValue("--_bottom-margin")),f=this.getAttribute("flow");if("scrolled"===f){this.setAttribute("dir",t?"rtl":"ltr"),this.#V.style.padding="0";const e=a;return this.heads=null,this.feet=null,{flow:f,margin:l,gap:d,columnWidth:e,topMargin:h,bottomMargin:u}}const m=0==s?Math.min(2,Math.ceil(r/a)):s,w=r/m-d;this.setAttribute("dir",e?"rtl":"ltr");const b=t?Math.min(2,Math.ceil(n/a)):m,y=(this.bookDir,g(b,"head")),x=g(b,"foot");return this.heads=y.map((t=>t.children[0])),this.feet=x.map((t=>t.children[0])),{height:i,width:n,margin:l,gap:d,columnWidth:w,topMargin:h,bottomMargin:u}}render(){this.#K&&(this.#K.render(this.#ct({vertical:this.#$,rtl:this.#W})),this.scrollToAnchor(this.#J))}get scrolled(){return"scrolled"===this.getAttribute("flow")}get scrollProp(){const{scrolled:t}=this;return this.#$?t?"scrollLeft":"scrollTop":t?"scrollTop":"scrollLeft"}get sideProp(){const{scrolled:t}=this;return this.#$?t?"width":"height":t?"height":"width"}get vertical(){return this.#$}get size(){return this.#G.getBoundingClientRect()[this.sideProp]}get viewSize(){return this.#K.element.getBoundingClientRect()[this.sideProp]}get start(){return Math.abs(this.#G[this.scrollProp])}get end(){return this.start+this.size}get page(){return Math.floor((this.start+this.end)/2/this.size)}get pages(){return Math.round(this.viewSize/this.size)}scrollBy(t,e){const n=this.#$?e:t,i=this.#G,{scrollProp:r}=this,[o,a,s]=this.#rt,l=this.#W,c=l?o-s:o-a,d=l?o+a:o+s;i[r]=Math.max(c,Math.min(d,i[r]+n))}snap(t,e){const n=this.#$?e:t,[i,r,o]=this.#rt,{start:a,end:s,pages:l,size:c}=this,d=Math.abs(i)-r,h=Math.abs(i)+o,u=n*(this.#W?-c:c),f=Math.floor(Math.max(d,Math.min(h,(a+s)/2+(isNaN(u)?0:u)))/c);this.#dt(f,"snap").then((()=>{const t=f<=0?-1:f>=l-1?1:null;if(t)return this.#ht({index:this.#ut(t),anchor:t<0?()=>1:()=>0})}))}#L(t){const e=t.changedTouches[0];this.#ot={x:e?.screenX,y:e?.screenY,t:t.timeStamp,vx:0,xy:0,direction:"none",startTouch:{x:t.touches[0].screenX,y:t.touches[0].screenY},delta:{x:0,deltaY:0}},this.dispatchEvent(new CustomEvent("doctouchstart",{detail:{touch:t.changedTouches[0],touchState:this.#ot},bubbles:!0,composed:!0}))}#E(t){if(window.getSelection()?.toString())return;const e=t.changedTouches[0].screenX-this.#ot.startTouch.x,n=t.changedTouches[0].screenY-this.#ot.startTouch.y,i=Math.abs(e),r=Math.abs(n);this.#ot.delta.x=e,this.#ot.delta.y=n;const o="horizontal"===this.#ot.direction&&r>i,a="vertical"===this.#ot.direction&&i>r;if(("none"!==this.#ot.direction||o&&a)&&i<5&&r<5)return;(i>5||r>5)&&"none"===this.#ot.direction&&(this.#ot.direction=i>r?"horizontal":"vertical");const s="horizontal"===this.#ot.direction&&"scrollLeft"===this.scrollProp,l="vertical"===this.#ot.direction&&"scrollTop"===this.scrollProp;if(!s&&!l)return void this.dispatchEvent(new CustomEvent("doctouchmove",{detail:{touch:t.changedTouches[0],touchState:this.#ot},preventDefault:()=>t.preventDefault(),bubbles:!0,composed:!0}));const c=this.#ot;c&&(c.pinched||(c.pinched=globalThis.visualViewport.scale>1,this.scrolled||c.pinched||(t.touches.length>1?this.#at&&t.preventDefault():(t.preventDefault(),c.animationFrameId||(c.animationFrameId=requestAnimationFrame((()=>{const e=t.changedTouches[0],n=e.screenX,i=e.screenY,r=c.x-n,o=c.y-i,a=t.timeStamp-c.t||16.7,s=.85*r,l=.85*o;c.x=n,c.y=i,c.t=t.timeStamp,c.vx=r/a,c.vy=o/a,this.#at=!0,this.scrollBy(s,l),c.animationFrameId=null})))))))}#C(t){this.dispatchEvent(new CustomEvent("doctouchend",{detail:{touch:t.changedTouches[0],touchState:this.#ot},bubbles:!0,composed:!0})),this.#at=!1,this.scrolled||requestAnimationFrame((()=>{1===globalThis.visualViewport.scale&&this.snap(this.#ot.vx,this.#ot.vy)}))}#ft(){if(this.scrolled){const t=this.viewSize,e=this.#Y;return this.#$?({left:n,right:i})=>({left:t-i-e,right:t-n-e}):({top:t,bottom:n})=>({left:t+e,right:n+e})}const t=this.pages*this.size;return this.#W?({left:e,right:n})=>({left:t-n,right:t-e}):this.#$?({top:t,bottom:e})=>({left:t,right:e}):t=>t}async#pt(t,e){if(this.scrolled){const n=this.#ft()(t).left-this.#Y;return this.#gt(n,e)}const n=this.#ft()(t).left+this.#Y/2;return this.#dt(Math.floor(n/this.size)+(this.#W?-1:1),e)}async#gt(t,e,n){const r=this.#G,{scrollProp:o,size:a}=this;if(Math.abs(r[o]-t)<1)return this.#rt=[t,this.atStart?0:a,this.atEnd?0:a],void this.#st(e);if(this.scrolled&&this.#$&&(t=-t),("snap"===e||n)&&this.hasAttribute("animated")){const n=Math.abs(r[o]-t),u=300,f=Math.min(500,Math.max(200,u*(n/a))),p=t=>1-Math.pow(1-t,3);return this.#Z=!0,(s=r[o],l=t,c=f,d=p,h=t=>r[o]=t,new Promise((t=>{let e;const n=i=>{e??=i;const r=Math.min(1,(i-e)/c);var o,a;h((o=s,a=l,d(r)*(a-o)+o)),r<1?requestAnimationFrame(n):t()};requestAnimationFrame(n)}))).then((()=>(r[o]=t,this.#rt=[t,this.atStart?0:a,this.atEnd?0:a],i(10).then((()=>{this.#st(e)})))))}var s,l,c,d,h;r[o]=t,this.#rt=[t,this.atStart?0:a,this.atEnd?0:a],this.#st(e)}async#dt(t,e,n){const i=this.size*(this.#W?-t:t);return this.#gt(i,e,n)}async scrollToAnchor(t,e){this.#J=t;const n=(t=>{if(!t?.collapsed)return t;const{endOffset:e,endContainer:n}=t;if(1===n.nodeType)return n;if(e+1<n.length)t.setEnd(n,e+1);else{if(!(e>1))return n.parentNode;t.setStart(n,e-1)}return t})(t)?.getClientRects?.();if(n){const t=Array.from(n).find((t=>t.width>0&&t.height>0))||n[0];if(!t)return;return await this.#pt(t,"anchor"),void(e&&this.#mt())}if(this.scrolled)return void await this.#gt(t*this.viewSize,"anchor");const{pages:i}=this;if(!i)return;const r=i-2,o=Math.round(t*(r-1));await this.#dt(o+1,"anchor")}#mt(){const{defaultView:t}=this.#K.document;if(this.#J.startContainer){const e=t.getSelection();e.removeAllRanges(),e.addRange(this.#J)}}#wt(){if(this.scrolled)return f(this.#K.document,this.start+this.#Y,this.end-this.#Y,this.#ft());const t=this.#W?-this.size:this.size;return f(this.#K.document,this.start-t,this.end-t,this.#ft())}#st(t){const e=this.#wt();"anchor"!==t?this.#J=e:this.#Z=!0;const n={reason:t,range:e,index:this.#r};if(this.scrolled)n.fraction=this.start/this.viewSize;else if(this.pages>0){const{page:t,pages:e}=this;n.fraction=(t-1)/(e-2),n.size=1/(e-2)}this.dispatchEvent(new CustomEvent("relocate",{detail:n}))}async#bt(t){const{index:e,src:n,anchor:i,onLoad:r,select:o}=await t;if(this.#r=e,n){const t=this.#lt(),i=t=>{if(t.head){const e=t.createElement("style");t.head.prepend(e);const n=t.createElement("style");t.head.append(n),this.#et.set(t,[e,n])}r?.({doc:t,index:e})},o=this.#ct.bind(this);await t.load(n,i,o),this.dispatchEvent(new CustomEvent("create-overlayer",{detail:{doc:t.document,index:e,attach:e=>t.overlayer=e}})),this.#K=t}await this.scrollToAnchor(("function"==typeof i?i(this.#K.document):i)??0,o)}#yt(t){return t>=0&&t<=this.sections.length-1}async#ht({index:t,anchor:e,select:n}){if(t===this.#r)await this.#bt({index:t,anchor:e,select:n});else{const i=this.#r,r=t=>{this.sections[i]?.unload?.(),this.setStyles(this.#tt),this.dispatchEvent(new CustomEvent("load",{detail:t}))};await this.#bt(Promise.resolve(this.sections[t].load()).then((i=>({index:t,src:i,anchor:e,onLoad:r,select:n}))).catch((e=>(console.warn(e),console.warn(new Error(`Failed to load section ${t}`)),{}))))}}async goTo(t){if(this.#Q)return;const e=await t;return this.#yt(e.index)?this.#ht(e):void 0}#xt(t){if(!this.#K)return!0;if(this.scrolled)return!(this.start>0)||this.#gt(Math.max(0,this.start-(t??this.size)),null,!0);if(this.atStart)return;const e=this.page-1;return this.#dt(e,"page",!0).then((()=>e<=0))}#vt(t){if(!this.#K)return!0;if(this.scrolled)return!(this.viewSize-this.end>2)||this.#gt(Math.min(this.viewSize,t?this.start+t:this.end),null,!0);if(this.atEnd)return;const e=this.page+1,n=this.pages;return this.#dt(e,"page",!0).then((()=>e>=n-1))}get atStart(){return null==this.#ut(-1)&&this.page<=1}get atEnd(){return null==this.#ut(1)&&this.page>=this.pages-2}#ut(t){for(let e=this.#r+t;this.#yt(e);e+=t)if("no"!==this.sections[e]?.linear)return e}async#kt(t,e){this.#Q=!0;const n=-1===t,r=await(n?this.#xt(e):this.#vt(e));r&&await this.#ht({index:this.#ut(t),anchor:n?()=>1:()=>0}),!r&&this.hasAttribute("animated")||await i(100),this.#Q=!1}prev(t){return this.#kt(-1,t)}next(t){return this.#kt(1,t)}prevSection(){return this.goTo({index:this.#ut(-1)})}nextSection(){return this.goTo({index:this.#ut(1)})}firstSection(){const t=this.sections.findIndex((t=>"no"!==t.linear));return this.goTo({index:t})}lastSection(){const t=this.sections.findLastIndex((t=>"no"!==t.linear));return this.goTo({index:t})}getContents(){return this.#K?[{index:this.#r,overlayer:this.#K.overlayer,doc:this.#K.document}]:[]}setStyles(t){this.#tt=t;const e=this.#et.get(this.#K?.document);if(!e)return;const[n,i]=e;if(Array.isArray(t)){const[e,r]=t;n.textContent=e,i.textContent=r}else i.textContent=t;this.#X.style.background=p(this.getAttribute("bgimg-url")),this.#K?.document?.fonts?.ready?.then((()=>this.#K.expand()))}destroy(){this.#e.unobserve(this),this.#K.destroy(),this.#K=null,this.sections[this.#r]?.unload?.(),this.#nt.removeEventListener("change",this.#it)}}customElements.define("foliate-paginator",b)},619:(t,e,n)=>{n.a(t,(async(t,e)=>{try{var i=n(986),r=n(949),o=n(339),a=n(196);const{TTS:t}=await Promise.resolve().then(n.bind(n,977)),s="foliate-search:";class l extends EventTarget{#St=[];#r=-1;pushState(t){const e=this.#St[this.#r];e===t||e?.fraction&&e.fraction===t.fraction||(this.#St[++this.#r]=t,this.#St.length=this.#r+1,this.dispatchEvent(new Event("index-change")),this.dispatchEvent(new CustomEvent("pushstate",{detail:t})))}replaceState(t){const e=this.#r;this.#St[e]=t}back(){const t=this.#r;if(t<=0)return;const e={state:this.#St[t-1]};this.#r=t-1,this.dispatchEvent(new CustomEvent("popstate",{detail:e})),this.dispatchEvent(new Event("index-change"))}forward(){const t=this.#r;if(t>=this.#St.length-1)return;const e={state:this.#St[t+1]};this.#r=t+1,this.dispatchEvent(new CustomEvent("popstate",{detail:e})),this.dispatchEvent(new Event("index-change"))}get canGoBack(){return this.#r>0}get canGoForward(){return this.#r<this.#St.length-1}clear(){this.#St=[],this.#r=-1}}const c=t=>{if(!t)return{};try{const e=Intl.getCanonicalLocales(t)[0]??"en",n=new Intl.Locale(e),i=["zh","ja","kr"].includes(n.language),r=(n.getTextInfo?.()??n.textInfo)?.direction;return{canonical:e,locale:n,isCJK:i,direction:r}}catch(t){return console.warn(t),{}}};class d extends HTMLElement{#t=this.attachShadow({mode:"open"});#_t;#At;#Tt;#Lt=new Map;#r;isFixedLayout=!1;lastLocation;history=new l;#Et=null;constructor(){super(),this.history.addEventListener("popstate",(({detail:t})=>{const e=this.resolveNavigation(t.state);this.renderer.goTo(e)}))}async open(t){if(this.book=t,this.language=c(t.metadata?.language),t.splitTOCHref&&t.getTOCFragment){const e=t.sections.map((t=>t.id));this.#_t=new r.r(t.sections,1500,1600);const n=t.splitTOCHref.bind(t),i=t.getTOCFragment.bind(t);this.#At=new r.k,await this.#At.init({toc:t.toc??[],ids:e,splitHref:n,getFragment:i}),this.#Tt=new r.k,await this.#Tt.init({toc:t.pageList??[],ids:e,splitHref:n,getFragment:i})}if(this.isFixedLayout="pre-paginated"===this.book.rendition?.layout,this.isFixedLayout?(await Promise.resolve().then(n.bind(n,113)),this.renderer=document.createElement("foliate-fxl")):(await Promise.resolve().then(n.bind(n,587)),this.renderer=document.createElement("foliate-paginator")),this.renderer.setAttribute("exportparts","head,foot,filter"),this.renderer.addEventListener("load",(t=>this.#_(t.detail))),this.renderer.addEventListener("relocate",(t=>this.#A(t.detail))),this.renderer.addEventListener("create-overlayer",(t=>t.detail.attach(this.#Ct(t.detail)))),this.renderer.open(t),this.#t.append(this.renderer),t.sections.some((t=>t.mediaOverlay))){t.media.activeClass||="-epub-media-overlay-active";const e=t.media.activeClass;let n;this.mediaOverlay=t.getMediaOverlay(),this.mediaOverlay.addEventListener("highlight",(t=>{const i=this.resolveNavigation(t.detail.text);this.renderer.goTo(i).then((()=>{const{doc:t}=this.renderer.getContents().find((t=>t.index=i.index)),r=i.anchor(t);r.classList.add(e),n=new WeakRef(r)}))})),this.mediaOverlay.addEventListener("unhighlight",(()=>{n?.deref()?.classList?.remove(e)}))}}close(){this.renderer?.destroy(),this.renderer?.remove(),this.#_t=null,this.#At=null,this.#Tt=null,this.#Lt=new Map,this.lastLocation=null,this.history.clear(),this.tts=null,this.mediaOverlay=null}goToTextStart(){return this.goTo(this.book.landmarks?.find((t=>t.type.includes("bodymatter")||t.type.includes("text")))?.href??this.book.sections.findIndex((t=>"no"!==t.linear)))}async init({lastLocation:t,showTextStart:e}){const n=t?this.resolveNavigation(t):null;n?(await this.renderer.goTo(n),this.history.pushState(t)):e?await this.goToTextStart():(this.history.pushState(0),await this.next())}#It(t,e,n){return this.dispatchEvent(new CustomEvent(t,{detail:e,cancelable:n}))}#A({reason:t,range:e,index:n,fraction:i,size:r}){this.#r=n;const o=this.#_t?.getProgress(n,i,r)??{},a=this.#At?.getProgress(n,e),s=this.#Tt?.getProgress(n,e),l=this.getCFI(n,e),c=this.renderer.pages?this.renderer.pages-2:o.section.total,d={current:this.renderer.page??o.section.current,total:c};this.lastLocation={...o,tocItem:a,pageItem:s,cfi:l,range:e,chapterLocation:d},"snap"!==t&&"page"!==t&&"scroll"!==t||this.history.replaceState(l),!l||this.#Et&&l===this.#Et||(this.#Et=l,this.#It("relocate",this.lastLocation))}#_({doc:t,index:e}){t.documentElement.lang||=this.language.canonical??"",this.language.isCJK||(t.documentElement.dir||=this.language.direction??""),this.#Rt(t,e),this.#Mt(t),this.#zt(t),this.#It("load",{doc:t,index:e})}#Rt(t,e){const{book:n}=this,i=n.sections[e];for(const e of t.querySelectorAll("a[href]"))e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation();const r=e.getAttribute("href"),o=i?.resolveHref?.(r)??r;n?.isExternal?.(o)?Promise.resolve(this.#It("external-link",{a:e,href:o},!0)).then((t=>t?globalThis.open(o,"_blank"):null)).catch((t=>console.error(t))):Promise.resolve(this.#It("link",{a:e,href:o},!0)).then((t=>t?this.goTo(o):null)).catch((t=>console.error(t)))}))}#zt(t){for(const e of t.querySelectorAll("img"))e.closest("a[href]")||e.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.#It("click-image",{img:e})}))}#Mt(t){t.addEventListener("click",(e=>{if(window.isFootNoteOpen())return void window.closeFootNote();if("Range"===t.getSelection().type)return;const n=t.position,i=t.scale;let{clientX:r,clientY:o}=e;if(n){r*=i,o*=i;const e=t.documentElement.getBoundingClientRect().width*i;return"right"===n&&2.2*e<window.innerWidth&&(r+=.5*window.innerWidth),void this.#It("click-view",{x:r,y:o})}this.renderer.vertical?"scrollLeft"==this.renderer.scrollProp?r=this.renderer.size-(this.renderer.viewSize-this.renderer.start-r):o-=this.renderer.start-this.renderer.size:"scrollLeft"==this.renderer.scrollProp?r-=this.renderer.start-this.renderer.size:o-=this.renderer.start,this.#It("click-view",{x:r,y:o})})),this.renderer.addEventListener("click",(t=>{const{clientX:e,clientY:n}=t;for(;e>window.innerWidth;)e-=window.innerWidth;this.#It("click-view",{x:e,y:n})}))}async addAnnotation(t,e){const{value:n}=t;if(n.startsWith(s)){const t=n.replace(s,""),{index:i,anchor:r}=await this.resolveNavigation(t),a=this.#Ot(i);if(a){const{overlayer:t,doc:i}=a;if(e)return void t.remove(n);const s=i?r(i):r;t.add(n,s,o.u.outline,{color:"#39c5bbaa"})}return}const{index:i,anchor:r}=await this.resolveNavigation(n),a=this.#Ot(i);if(a){const{overlayer:i,doc:o}=a;if(i.remove(n),!e){const e=o?r(o):r,a=(t,r)=>i.add(n,e,t,r);this.#It("draw-annotation",{draw:a,annotation:t,doc:o,range:e})}}return{index:i,label:this.#At.getProgress(i)?.label??""}}deleteAnnotation(t){return this.addAnnotation(t,!0)}#Ot(t){return this.renderer.getContents().find((e=>e.index===t&&e.overlayer))}#Ct({doc:t,index:e}){const n=new o.u;t.addEventListener("click",(t=>{const[i,r]=n.hitTest(t);i&&!i.startsWith(s)&&(t.preventDefault(),t.stopPropagation(),this.#It("show-annotation",{value:i,index:e,range:r}))}),!0);const i=this.#Lt.get(e);if(i)for(const t of i)this.addAnnotation(t);return this.#It("create-overlay",{index:e}),n}async showAnnotation(t){const{value:e}=t,n=await this.goTo(e);if(n){const{index:t,anchor:i}=n,{doc:r}=this.#Ot(t),o=i(r);this.#It("show-annotation",{value:e,index:t,range:o})}}getCFI(t,e){const n=this.book.sections[t].cfi??i.EL.fromIndex(t);return e?i.RK(n,i.yT(e)):n}resolveCFI(t){if(this.book.resolveCFI)return this.book.resolveCFI(t);{const e=i.qg(t);return{index:i.EL.toIndex((e.parent??e).shift()),anchor:t=>i.Xp(t,e)}}}resolveNavigation(t){try{if("number"==typeof t)return{index:t};if("number"==typeof t.fraction){const[e,n]=this.#_t.getSection(t.fraction);return{index:e,anchor:n}}return i.Lu.test(t)?this.resolveCFI(t):this.book.resolveHref(t)}catch(e){console.error(e),console.error(`Could not resolve target ${t}`)}}async goTo(t){const e=this.resolveNavigation(t);try{return await this.renderer.goTo(e),this.history.pushState(t),e}catch(e){console.error(e),console.error(`Could not go to ${t}`)}}async goToFraction(t){const[e,n]=this.#_t.getSection(t);await this.renderer.goTo({index:e,anchor:n}),this.history.pushState({fraction:t})}async select(t){try{const e=await this.resolveNavigation(t);await this.renderer.goTo({...e,select:!0}),this.history.pushState(t)}catch(e){console.error(e),console.error(`Could not go to ${t}`)}}deselect(){for(const{doc:t}of this.renderer.getContents())t.defaultView.getSelection().removeAllRanges()}getSectionFractions(){return(this.#_t?.sectionFractions??[]).map((t=>t+Number.EPSILON))}getProgressOf(t,e){const n=this.#At?.getProgress(t,e),i=this.#Tt?.getProgress(t,e);return{tocItem:n,pageItem:i}}async getTOCItemOf(t){try{const{index:e,anchor:n}=await this.resolveNavigation(t),i=await this.book.sections[e].createDocument(),r=n(i),o=r instanceof Range,a=o?r:i.createRange();return o||a.selectNodeContents(r),this.#At.getProgress(e,a)}catch(e){console.error(e),console.error(`Could not get ${t}`)}}async prev(t){await this.renderer.prev(t)}async next(t){await this.renderer.next(t)}goLeft(){return"rtl"===this.book.dir?this.next():this.prev()}goRight(){return"rtl"===this.book.dir?this.prev():this.next()}async*#Bt(t,e,n){const i=await this.book.sections[n].createDocument();for(const{range:r,excerpt:o}of t(i,e))yield{cfi:this.getCFI(n,r),excerpt:o}}async*#Ft(t,e){const{sections:n}=this.book;for(const[i,{createDocument:r}]of n.entries()){if(!r)continue;const o=await r(),a=Array.from(t(o,e),(({range:t,excerpt:e})=>({cfi:this.getCFI(i,t),excerpt:e}))),s=(i+1)/n.length;yield{progress:s},a.length&&(yield{index:i,subitems:a})}}async*search(t){console.log("search",t),this.clearSearch();const{searchMatcher:e}=await Promise.resolve().then(n.bind(n,262)),{query:i,index:r}=t,o=e(a.u,{defaultLocale:this.language,...t}),l=null!=r?this.#Bt(o,i,r):this.#Ft(o,i),c=[];this.#Lt.set(r,c);for await(const t of l)if(t.subitems){const e=t.subitems.map((({cfi:t})=>({value:s+t})));this.#Lt.set(t.index,e);for(const t of e)this.addAnnotation(t);yield{label:this.#At.getProgress(t.index)?.label??"",subitems:t.subitems}}else{if(t.cfi){const e={value:s+t.cfi};c.push(e),this.addAnnotation(e)}yield t}yield"done"}clearSearch(){for(const t of this.#Lt.values())for(const e of t)this.deleteAnnotation(e);this.#Lt.clear()}oldValue=null;initTTS(e){if(e)return this.#Ot(this.#r)?.overlayer.remove(this.oldValue);const n=this.renderer.getContents()[0].doc;this.tts&&this.tts.doc===n||(this.tts=new t(n,a.u,(t=>{const e=this.#Ot(this.#r);if(e){const{overlayer:n}=e;this.oldValue&&n.remove(this.oldValue);const i=this.getCFI(this.#r,t);n.add(i,t,o.u.squiggly,{color:"#39c5bb"}),this.oldValue=i}this.renderer.scrollToAnchor(t)})))}startMediaOverlay(){const{index:t}=this.renderer.getContents()[0];return this.mediaOverlay.start(t)}}customElements.define("foliate-view",d),e()}catch(t){e(t)}}),1)},759:(t,e,n)=>{n.d(e,{MOBI:()=>B,isMOBI:()=>z});const i=t=>{if(!t)return"";const e=document.createElement("textarea");return e.innerHTML=t,e.value},r={XML:"application/xml",XHTML:"application/xhtml+xml",HTML:"text/html",CSS:"text/css",SVG:"image/svg+xml"},o={name:[0,32,"string"],type:[60,4,"string"],creator:[64,4,"string"],numRecords:[76,2,"uint"]},a={compression:[0,2,"uint"],numTextRecords:[8,2,"uint"],recordSize:[10,2,"uint"],encryption:[12,2,"uint"]},s={magic:[16,4,"string"],length:[20,4,"uint"],type:[24,4,"uint"],encoding:[28,4,"uint"],uid:[32,4,"uint"],version:[36,4,"uint"],titleOffset:[84,4,"uint"],titleLength:[88,4,"uint"],localeRegion:[94,1,"uint"],localeLanguage:[95,1,"uint"],resourceStart:[108,4,"uint"],huffcdic:[112,4,"uint"],numHuffcdic:[116,4,"uint"],exthFlag:[128,4,"uint"],trailingFlags:[240,4,"uint"],indx:[244,4,"uint"]},l={resourceStart:[108,4,"uint"],fdst:[192,4,"uint"],numFdst:[196,4,"uint"],frag:[248,4,"uint"],skel:[252,4,"uint"],guide:[260,4,"uint"]},c={magic:[0,4,"string"],length:[4,4,"uint"],count:[8,4,"uint"]},d={magic:[0,4,"string"],length:[4,4,"uint"],type:[8,4,"uint"],idxt:[20,4,"uint"],numRecords:[24,4,"uint"],encoding:[28,4,"uint"],language:[32,4,"uint"],total:[36,4,"uint"],ordt:[40,4,"uint"],ligt:[44,4,"uint"],numLigt:[48,4,"uint"],numCncx:[52,4,"uint"]},h={magic:[0,4,"string"],length:[4,4,"uint"],numControlBytes:[8,4,"uint"]},u={magic:[0,4,"string"],offset1:[8,4,"uint"],offset2:[12,4,"uint"]},f={magic:[0,4,"string"],length:[4,4,"uint"],numEntries:[8,4,"uint"],codeLength:[12,4,"uint"]},p={magic:[0,4,"string"],numEntries:[8,4,"uint"]},g={flags:[8,4,"uint"],dataStart:[12,4,"uint"],keyLength:[16,4,"uint"],keyStart:[20,4,"uint"]},m={1252:"windows-1252",65001:"utf-8"},w={100:["creator","string",!0],101:["publisher"],103:["description"],104:["isbn"],105:["subject","string",!0],106:["date"],108:["contributor","string",!0],109:["rights"],110:["subjectCode","string",!0],112:["source","string",!0],113:["asin"],121:["boundary","uint"],122:["fixedLayout"],125:["numResources","uint"],126:["originalResolution"],127:["zeroGutter"],128:["zeroMargin"],129:["coverURI"],132:["regionMagnification"],201:["coverOffset","uint"],202:["thumbnailOffset","uint"],503:["title"],524:["language","string",!0],527:["pageProgressionDirection"]},b={1:["ar","ar-SA","ar-IQ","ar-EG","ar-LY","ar-DZ","ar-MA","ar-TN","ar-OM","ar-YE","ar-SY","ar-JO","ar-LB","ar-KW","ar-AE","ar-BH","ar-QA"],2:["bg"],3:["ca"],4:["zh","zh-TW","zh-CN","zh-HK","zh-SG"],5:["cs"],6:["da"],7:["de","de-DE","de-CH","de-AT","de-LU","de-LI"],8:["el"],9:["en","en-US","en-GB","en-AU","en-CA","en-NZ","en-IE","en-ZA","en-JM",null,"en-BZ","en-TT","en-ZW","en-PH"],10:["es","es-ES","es-MX",null,"es-GT","es-CR","es-PA","es-DO","es-VE","es-CO","es-PE","es-AR","es-EC","es-CL","es-UY","es-PY","es-BO","es-SV","es-HN","es-NI","es-PR"],11:["fi"],12:["fr","fr-FR","fr-BE","fr-CA","fr-CH","fr-LU","fr-MC"],13:["he"],14:["hu"],15:["is"],16:["it","it-IT","it-CH"],17:["ja"],18:["ko"],19:["nl","nl-NL","nl-BE"],20:["no","nb","nn"],21:["pl"],22:["pt","pt-BR","pt-PT"],23:["rm"],24:["ro"],25:["ru"],26:["hr",null,"sr"],27:["sk"],28:["sq"],29:["sv","sv-SE","sv-FI"],30:["th"],31:["tr"],32:["ur"],33:["id"],34:["uk"],35:["be"],36:["sl"],37:["et"],38:["lv"],39:["lt"],41:["fa"],42:["vi"],43:["hy"],44:["az"],45:["eu"],46:["hsb"],47:["mk"],48:["st"],49:["ts"],50:["tn"],52:["xh"],53:["zu"],54:["af"],55:["ka"],56:["fo"],57:["hi"],58:["mt"],59:["se"],62:["ms"],63:["kk"],65:["sw"],67:["uz",null,"uz-UZ"],68:["tt"],69:["bn"],70:["pa"],71:["gu"],72:["or"],73:["ta"],74:["te"],75:["kn"],76:["ml"],77:["as"],78:["mr"],79:["sa"],82:["cy","cy-GB"],83:["gl","gl-ES"],87:["kok"],97:["ne"],98:["fy"]},y=(t,e)=>{const n=new t.constructor(t.length+e.length);return n.set(t),n.set(e,t.length),n},x=(t,e,n)=>{const i=new t.constructor(t.length+e.length+n.length);return i.set(t),i.set(e,t.length),i.set(n,t.length+e.length),i},v=new TextDecoder,k=t=>v.decode(t),S=t=>{if(!t)return;const e=t.byteLength,n=4===e?"getUint32":2===e?"getUint16":"getUint8";return new DataView(t)[n](0)},_=(t,e)=>Object.fromEntries(Array.from(Object.entries(t)).map((([t,[n,i,r]])=>[t,("string"===r?k:S)(e.slice(n,n+i))]))),A=t=>new TextDecoder(m[t]),T=(t,e=0)=>{let n=0,i=0;for(const r of t.subarray(e,e+4))if(n=n<<7|(127&r)>>>0,i++,128&r)break;return{value:n,length:i}},L=t=>{let e=0;for(const n of t.subarray(-4))128&n&&(e=0),e=e<<7|127&n;return e},E=t=>{let e=0;for(;t>0;t>>=1)1&~t||e++;return e},C=t=>{let e=0;for(;!(1&t);)t>>=1,e++;return e},I=t=>{let e=[];for(let n=0;n<t.length;n++){const i=t[n];if(0===i)e.push(0);else if(i<=8)for(const r of t.subarray(n+1,(n+=i)+1))e.push(r);else if(i<=127)e.push(i);else if(i<=191){const r=i<<8|t[1+n++],o=(16383&r)>>>3,a=3+(7&r);for(let t=0;t<a;t++)e.push(e[e.length-o])}else e.push(32,128^i)}return Uint8Array.from(e)},R=(t,e)=>{const n=e+32,i=n>>3;let r=0n;for(let n=e>>3;n<=i;n++)r=r<<8n|BigInt(t[n]??0);return r>>8n-BigInt(7&n)&0xffffffffn},M=async(t,e)=>{const n=await e(t),i=_(d,n);if("INDX"!==i.magic)throw new Error("Invalid INDX record");const r=A(i.encoding),o=n.slice(i.length),a=_(h,o);if("TAGX"!==a.magic)throw new Error("Invalid TAGX section");const s=(a.length-12)/4,l=Array.from({length:s},((t,e)=>new Uint8Array(o.slice(12+4*e,12+4*e+4)))),c={};let u=0;for(let n=0;n<i.numCncx;n++){const o=await e(t+i.numRecords+n+1),a=new Uint8Array(o);for(let t=0;t<a.byteLength;){const e=t,{value:n,length:i}=T(a,t);t+=i;const s=o.slice(t,t+n);t+=n,c[u+e]=r.decode(s)}u+=65536}const f=[];for(let n=0;n<i.numRecords;n++){const i=await e(t+1+n),r=new Uint8Array(i),o=_(d,i);if("INDX"!==o.magic)throw new Error("Invalid INDX record");for(let t=0;t<o.numRecords;t++){const e=o.idxt+4+2*t,n=S(i.slice(e,e+2)),s=S(i.slice(n,n+1)),c=k(i.slice(n+1,n+1+s)),d=[],h=n+1+s;let u=0,p=h+a.numControlBytes;for(const[t,e,n,o]of l){if(1&o){u++;continue}const a=h+u,s=S(i.slice(a,a+1))&n;if(s===n)if(E(n)>1){const{value:n,length:i}=T(r,p);d.push([t,null,n,e]),p+=i}else d.push([t,1,null,e]);else d.push([t,s>>C(n),null,e])}const g={};for(const[t,e,n,i]of d){const o=[];if(null!=e)for(let t=0;t<e*i;t++){const{value:t,length:e}=T(r,p);o.push(t),p+=e}else{let t=0;for(;t<n;){const{value:e,length:n}=T(r,p);o.push(e),p+=n,t+=n}}g[t]=o}f.push({name:c,tagMap:g})}}return{table:f,cncx:c}},z=async t=>"BOOKMOBI"===k(await t.slice(60,68).arrayBuffer());class O{#Pt;#Nt;pdb;async open(t){this.#Pt=t;const e=_(o,await t.slice(0,78).arrayBuffer());this.pdb=e;const n=await t.slice(78,78+8*e.numRecords).arrayBuffer();this.#Nt=Array.from({length:e.numRecords},((t,e)=>S(n.slice(8*e,8*e+4)))).map(((t,e,n)=>[t,n[e+1]]))}loadRecord(t){const e=this.#Nt[t];if(!e)throw new RangeError("Record index out of bounds");return this.#Pt.slice(...e).arrayBuffer()}async loadMagic(t){const e=this.#Nt[t][0];return k(await this.#Pt.slice(e,e+4).arrayBuffer())}}class B extends O{#Ut=0;#Dt;#$t;#Wt;#jt;#Ht;constructor({unzlib:t}){super(),this.unzlib=t}async open(t){await super.open(t),this.headers=this.#qt(await super.loadRecord(0)),this.#Dt=this.headers.mobi.resourceStart;let e=this.headers.mobi.version>=8;if(!e){const t=this.headers.exth?.boundary;if(t<4294967295)try{this.headers=this.#qt(await super.loadRecord(t)),this.#Ut=t,e=!0}catch(t){console.warn(t),console.warn("Failed to open KF8; falling back to MOBI")}}return await this.#Vt(),e?new q(this).init():new N(this).init()}#qt(t){const e=_(a,t),n=_(s,t);if("MOBI"!==n.magic)throw new Error("Missing MOBI header");const{titleOffset:i,titleLength:r,localeLanguage:o,localeRegion:d}=n;n.title=t.slice(i,i+r);const h=b[o];n.language=h?.[d>>2]??h?.[0];const u=64&n.exthFlag?((t,e)=>{const{magic:n,count:i}=_(c,t);if("EXTH"!==n)throw new Error("Invalid EXTH header");const r=A(e),o={};let a=12;for(let e=0;e<i;e++){const e=S(t.slice(a,a+4)),n=S(t.slice(a+4,a+8));if(e in w){const[i,s,l]=w[e],c=t.slice(a+8,a+n),d="uint"===s?S(c):r.decode(c);l?(o[i]??=[],o[i].push(d)):o[i]=d}a+=n}return o})(t.slice(n.length+16),n.encoding):null;return{palmdoc:e,mobi:n,exth:u,kf8:n.version>=8?_(l,t):null}}async#Vt(){const{palmdoc:t,mobi:e}=this.headers;this.#$t=A(e.encoding),this.#Wt=new TextEncoder;const{compression:n}=t;if(this.#jt=1===n?t=>t:2===n?I:17480===n?await(async(t,e)=>{const n=await e(t.huffcdic),{magic:i,offset1:r,offset2:o}=_(u,n);if("HUFF"!==i)throw new Error("Invalid HUFF record");const a=Array.from({length:256},((t,e)=>r+4*e)).map((t=>S(n.slice(t,t+4)))).map((t=>[128&t,31&t,t>>>8])),s=[null].concat(Array.from({length:32},((t,e)=>o+8*e)).map((t=>[S(n.slice(t,t+4)),S(n.slice(t+4,t+8))]))),l=[];for(let n=1;n<t.numHuffcdic;n++){const i=await e(t.huffcdic+n),r=_(f,i);if("CDIC"!==r.magic)throw new Error("Invalid CDIC record");const o=Math.min(1<<r.codeLength,r.numEntries-l.length),a=i.slice(r.length);for(let t=0;t<o;t++){const e=S(a.slice(2*t,2*t+2)),n=S(a.slice(e,e+2)),i=32767&n,r=32768&n,o=new Uint8Array(a.slice(e+2,e+2+i));l.push([o,r])}}const c=t=>{let e=new Uint8Array;const n=8*t.byteLength;for(let i=0;i<n;){const r=Number(R(t,i));let[o,d,h]=a[r>>>24];if(!o){for(;r>>>32-d<s[d][0];)d+=1;h=s[d][1]}if((i+=d)>n)break;const u=h-(r>>>32-d);let[f,p]=l[u];p||(f=c(f),l[u]=[f,!0]),e=y(e,f)}return e};return c})(e,this.loadRecord.bind(this)):null,!this.#jt)throw new Error("Unknown compression type");const{trailingFlags:i}=e,r=1&i,o=E(i>>>1);this.#Ht=t=>{for(let e=0;e<o;e++){const e=L(t);t=t.subarray(0,-e)}if(r){const e=1+(3&t[t.length-1]);t=t.subarray(0,-e)}return t}}decode(...t){return this.#$t.decode(...t)}encode(...t){return this.#Wt.encode(...t)}loadRecord(t){return super.loadRecord(this.#Ut+t)}loadMagic(t){return super.loadMagic(this.#Ut+t)}loadText(t){return this.loadRecord(t+1).then((t=>new Uint8Array(t))).then(this.#Ht).then(this.#jt)}async loadResource(t){const e=await super.loadRecord(this.#Dt+t),n=k(e.slice(0,4));return"FONT"===n?(async(t,e)=>{const{flags:n,dataStart:i,keyLength:r,keyStart:o}=_(g,t),a=new Uint8Array(t.slice(i));if(2&n){const e=16===r?1024:1040,n=new Uint8Array(t.slice(o,o+r)),i=Math.min(e,a.length);for(var s=0;s<i;s++)a[s]=a[s]^n[s%n.length]}if(1&n)try{return await e(a)}catch(t){console.warn(t),console.warn("Failed to decompress font")}return a})(e,this.unzlib):"VIDE"===n||"AUDI"===n?e.slice(12):e}getNCX(){const t=this.headers.mobi.indx;if(t<4294967295)return(async(t,e)=>{const{table:n,cncx:i}=await M(t,e),r=n.map((({tagMap:t},e)=>({index:e,offset:t[1]?.[0],size:t[2]?.[0],label:i[t[3]]??"",headingLevel:t[4]?.[0],pos:t[6],parent:t[21]?.[0],firstChild:t[22]?.[0],lastChild:t[23]?.[0]}))),o=t=>(null==t.firstChild||(t.children=r.filter((e=>e.parent===t.index)).map(o)),t);return r.filter((t=>0===t.headingLevel)).map(o)})(t,this.loadRecord.bind(this))}getMetadata(){const{mobi:t,exth:e}=this.headers;return{identifier:t.uid.toString(),title:i(e?.title||this.decode(t.title)),author:e?.creator?.map(i),publisher:i(e?.publisher),language:e?.language??t.language,published:e?.date,description:i(e?.description),subject:e?.subject?.map(i),rights:i(e?.rights),contributor:e?.contributor}}async getCover(){const{exth:t}=this.headers,e=t?.coverOffset<4294967295?t?.coverOffset:t?.thumbnailOffset<4294967295?t?.thumbnailOffset:null;if(null!=e){const t=await this.loadResource(e);return new Blob([t])}}}const F=/<\s*(?:mbp:)?pagebreak[^>]*>/gi,P=/<[^<>]+filepos=['"]{0,1}(\d+)[^<>]*>/gi;class N{parser=new DOMParser;serializer=new XMLSerializer;#Xt=new Map;#Gt=new Map;#Kt=new Map;#Yt;#Jt=[];#Zt=r.HTML;constructor(t){this.mobi=t}async init(){let t=new Uint8Array;for(let e=0;e<this.mobi.headers.palmdoc.numTextRecords;e++)t=y(t,await this.mobi.loadText(e));const e=Array.from(new Uint8Array(t),(t=>String.fromCharCode(t))).join("");this.#Yt=[0].concat(Array.from(e.matchAll(F),(t=>t.index))).map(((t,n,i)=>e.slice(t,i[n+1]))).map((t=>Uint8Array.from(t,(t=>t.charCodeAt(0))))).map((t=>({book:this,raw:t}))).reduce(((t,e)=>{const n=t[t.length-1];return e.start=n?.end??0,e.end=e.start+e.raw.byteLength,t.concat(e)}),[]),this.sections=this.#Yt.map(((t,e)=>({id:e,load:()=>this.loadSection(t),createDocument:()=>this.createDocument(t),size:t.end-t.start})));try{this.landmarks=await this.getGuide();const t=this.landmarks.find((({type:t})=>t?.includes("toc")))?.href;if(t){const{index:e}=this.resolveHref(t),n=await this.sections[e].createDocument();let i,r=0,o=0;const a=new Map,s=new Map;this.toc=Array.from(n.querySelectorAll("a[filepos]")).reduce(((t,e)=>{const n=(t=>{let e=0;for(;t;){const n=t.parentElement;if(n){const t=n.tagName.toLowerCase();"p"===t?e+=1.5:"blockquote"===t&&(e+=2)}t=n}return e})(e),l={label:e.innerText?.trim()??"",href:`filepos:${e.getAttribute("filepos")}`},c=n>o?r+1:n===o?r:a.get(n)??Math.max(0,r-1);if(c>r)i?(i.subitems??=[],i.subitems.push(l),s.set(c,i)):t.push(l);else{const e=s.get(c);e?e.subitems.push(l):t.push(l)}return i=l,r=c,o=n,a.set(n,c),t}),[])}}catch(t){console.warn(t)}return this.#Jt=[...new Set(Array.from(e.matchAll(P),(t=>t[1])))].map((t=>({filepos:t,number:Number(t)}))).sort(((t,e)=>t.number-e.number)),this.metadata=this.mobi.getMetadata(),this.getCover=this.mobi.getCover.bind(this.mobi),this}async getGuide(){const t=await this.createDocument(this.#Yt[0]);return Array.from(t.getElementsByTagName("reference"),(t=>({label:t.getAttribute("title"),type:t.getAttribute("type")?.split(/\s/),href:`filepos:${t.getAttribute("filepos")}`})))}async loadResource(t){if(this.#Xt.has(t))return this.#Xt.get(t);const e=await this.mobi.loadResource(t),n=URL.createObjectURL(new Blob([e]));return this.#Xt.set(t,n),n}async loadRecindex(t){return this.loadResource(Number(t)-1)}async replaceResources(t){for(const e of t.querySelectorAll("img[recindex]")){const t=e.getAttribute("recindex");try{e.src=await this.loadRecindex(t)}catch{console.warn(`Failed to load image ${t}`)}}for(const e of t.querySelectorAll("[mediarecindex]")){const t=e.getAttribute("mediarecindex"),n=e.getAttribute("recindex");try{e.src=await this.loadRecindex(t),n&&(e.poster=await this.loadRecindex(n))}catch{console.warn(`Failed to load media ${t}`)}}for(const e of t.querySelectorAll("[filepos]")){const t=e.getAttribute("filepos");e.href=`filepos:${t}`}}async loadText(t){if(this.#Gt.has(t))return this.#Gt.get(t);const{raw:e}=t,n=this.#Jt.filter((({number:e})=>e>=t.start&&e<t.end)).map((e=>({...e,offset:e.number-t.start})));let i=e;n.length&&(i=e.subarray(0,n[0].offset),n.forEach((({filepos:t,offset:r},o)=>{const a=n[o+1],s=this.mobi.encode(`<a id="filepos${t}"></a>`);i=x(i,s,e.subarray(r,a?.offset))})));const r=this.mobi.decode(i).replaceAll(F,"");return this.#Gt.set(t,r),r}async createDocument(t){const e=await this.loadText(t);return this.parser.parseFromString(e,this.#Zt)}async loadSection(t){if(this.#Kt.has(t))return this.#Kt.get(t);const e=await this.createDocument(t),n=e.createElement("style");e.head.append(n),n.append(e.createTextNode("blockquote {\n            margin-block-start: 0;\n            margin-block-end: 0;\n            margin-inline-start: 1em;\n            margin-inline-end: 0;\n        }")),await this.replaceResources(e);const i=this.serializer.serializeToString(e),r=URL.createObjectURL(new Blob([i],{type:this.#Zt}));return this.#Kt.set(t,r),r}resolveHref(t){const e=t.match(/filepos:(.*)/)[1],n=Number(e);return{index:this.#Yt.findIndex((t=>t.end>n)),anchor:t=>t.getElementById(`filepos${e}`)}}splitTOCHref(t){const e=t.match(/filepos:(.*)/)[1],n=Number(e);return[this.#Yt.findIndex((t=>t.end>n)),`filepos${e}`]}getTOCFragment(t,e){return t.getElementById(e)}isExternal(t){return/^(?!blob|filepos)\w+:/i.test(t)}destroy(){for(const t of this.#Xt.values())URL.revokeObjectURL(t);for(const t of this.#Kt.values())URL.revokeObjectURL(t)}}const U=/kindle:(flow|embed):(\w+)(?:\?mime=(\w+\/[-+.\w]+))?/,D=/kindle:pos:fid:(\w+):off:(\w+)/,$=t=>{const[e,n]=t.match(D).slice(1);return{fid:parseInt(e,32),off:parseInt(n,32)}},W=(t=0,e=0)=>`kindle:pos:fid:${t.toString(32).toUpperCase().padStart(4,"0")}:off:${e.toString(32).toUpperCase().padStart(10,"0")}`,j=t=>{const e=t.match(/\s(id|name|aid)\s*=\s*['"]([^'"]*)['"]/i);if(!e)return;const[,n,i]=e;return`[${n}="${CSS.escape(i)}"]`},H=t=>{for(const e of t){if("page-spread-left"===e||"rendition:page-spread-left"===e)return"left";if("page-spread-right"===e||"rendition:page-spread-right"===e)return"right";if("rendition:page-spread-center"===e)return"center"}};class q{parser=new DOMParser;serializer=new XMLSerializer;#Kt=new Map;#Qt=new Map;#te=new Map;#ee={};#Yt;#ne;#ie=new Uint8Array;#re=new Uint8Array;#oe=-1;#ae=-1;#Zt=r.XHTML;#se=new Map;constructor(t){this.mobi=t}async init(){const t=this.mobi.loadRecord.bind(this.mobi),{kf8:e}=this.mobi.headers;try{const n=await t(e.fdst),i=_(p,n);if("FDST"!==i.magic)throw new Error("Missing FDST record");const r=Array.from({length:i.numEntries},((t,e)=>12+8*e)).map((t=>[S(n.slice(t,t+4)),S(n.slice(t+4,t+8))]));this.#ee.fdstTable=r,this.#ne=r[r.length-1][1]}catch{}const n=(await M(e.skel,t)).table.map((({name:t,tagMap:e},n)=>({index:n,name:t,numFrag:e[1][0],offset:e[6][0],length:e[6][1]}))),o=await M(e.frag,t),a=o.table.map((({name:t,tagMap:e})=>({insertOffset:parseInt(t),selector:o.cncx[e[2][0]],index:e[4][0],offset:e[6][0],length:e[6][1]})));this.#ee.skelTable=n,this.#ee.fragTable=a,this.#Yt=n.reduce(((t,e)=>{const n=t[t.length-1],i=n?.fragEnd??0,r=i+e.numFrag,o=a.slice(i,r),s=e.length+o.map((t=>t.length)).reduce(((t,e)=>t+e)),l=(n?.totalLength??0)+s;return t.concat({skel:e,frags:o,fragEnd:r,length:s,totalLength:l})}),[]);const s=await this.getResourcesByMagic(["RESC","PAGE"]),l=new Map;if(s.RESC){const t=await this.mobi.loadRecord(s.RESC),e=this.mobi.decode(t.slice(16)).replace(/\0/g,""),n=e.search(/\?>/),i=`<package>${e.slice(n)}</package>`,o=this.parser.parseFromString(i,r.XML);for(const t of o.querySelectorAll("spine > itemref")){const e=parseInt(t.getAttribute("skelid"));l.set(e,H(t.getAttribute("properties")?.split(" ")??[]))}}this.sections=this.#Yt.map(((t,e)=>t.frags.length?{id:e,load:()=>this.loadSection(t),createDocument:()=>this.createDocument(t),size:t.length,pageSpread:l.get(e)}:{linear:"no"}));try{const t=await this.mobi.getNCX(),e=({label:t,pos:n,children:r})=>{const[o,a]=n,s=W(o,a),l=this.#Qt.get(o);return l?l.push(a):this.#Qt.set(o,[a]),{label:i(t),href:s,subitems:r?.map(e)}};this.toc=t?.map(e),this.landmarks=await this.getGuide()}catch(t){console.warn(t)}const{exth:c}=this.mobi.headers;return this.dir=c.pageProgressionDirection,this.rendition={layout:"true"===c.fixedLayout?"pre-paginated":"reflowable",viewport:Object.fromEntries(c.originalResolution?.split("x")?.slice(0,2)?.map(((t,e)=>[e?"height":"width",t]))??[])},this.metadata=this.mobi.getMetadata(),this.getCover=this.mobi.getCover.bind(this.mobi),this}async getResourcesByMagic(t){const e={},n=this.mobi.headers.kf8.resourceStart,i=this.mobi.pdb.numRecords;for(let r=n;r<i;r++)try{const n=await this.mobi.loadMagic(r),i=t.find((t=>t===n));i&&(e[i]=r)}catch{}return e}async getGuide(){const t=this.mobi.headers.kf8.guide;if(t<4294967295){const e=this.mobi.loadRecord.bind(this.mobi),{table:n,cncx:i}=await M(t,e);return n.map((({name:t,tagMap:e})=>({label:i[e[1][0]]??"",type:t?.split(/\s/),href:W(e[6]?.[0]??e[3]?.[0])})))}}async loadResourceBlob(t){const{resourceType:e,id:n,type:i}=(t=>{const[e,n,i]=t.match(U).slice(1);return{resourceType:e,id:parseInt(n,32),type:i}})(t),o="flow"===e?await this.loadFlow(n):await this.mobi.loadResource(n-1),a=[r.XHTML,r.HTML,r.CSS,r.SVG].includes(i)?await this.replaceResources(this.mobi.decode(o)):o,s=i===r.SVG?this.parser.parseFromString(a,i):null;return[new Blob([a],{type:i}),s?.getElementsByTagNameNS("http://www.w3.org/2000/svg","image")?.length?s.documentElement:null]}async loadResource(t){if(this.#Kt.has(t))return this.#Kt.get(t);const[e,n]=await this.loadResourceBlob(t),i=n?t:URL.createObjectURL(e);return n&&this.#se.set(i,n),this.#Kt.set(t,i),i}replaceResources(t){return(async(t,e,n)=>{const i=[];t.replace(e,((...t)=>(i.push(t),null)));const r=[];for(const t of i)r.push(await n(...t));return t.replace(e,(()=>r.shift()))})(t,new RegExp(U,"g"),this.loadResource.bind(this))}async loadRaw(t,e){const n=e-this.#ie.length,i=null==this.#ne?1/0:this.#ne-this.#re.length-t;if(n<0||n<i){for(;this.#ie.length<e;){const t=++this.#oe,e=await this.mobi.loadText(t);this.#ie=y(this.#ie,e)}return this.#ie.slice(t,e)}for(;this.#ne-this.#re.length>t;){const t=this.mobi.headers.palmdoc.numTextRecords-1-++this.#ae,e=await this.mobi.loadText(t);this.#re=y(e,this.#re)}const r=this.#ne-this.#re.length;return this.#re.slice(t-r,e-r)}loadFlow(t){if(t<4294967295)return this.loadRaw(...this.#ee.fdstTable[t])}async loadText(t){const{skel:e,frags:n,length:i}=t,r=await this.loadRaw(e.offset,e.offset+i);let o=r.slice(0,e.length);for(const t of n){const n=t.insertOffset-e.offset,i=e.length+t.offset,a=r.slice(i,i+t.length);o=x(o.slice(0,n),a,o.slice(n));const s=this.#Qt.get(t.index);if(s)for(const e of s){const n=this.mobi.decode(a).slice(e),i=j(n);this.#le(t.index,e,i)}}return this.mobi.decode(o)}async createDocument(t){const e=await this.loadText(t);return this.parser.parseFromString(e,this.#Zt)}async loadSection(t){if(this.#Kt.has(t))return this.#Kt.get(t);const e=await this.loadText(t),n=await this.replaceResources(e);let i=this.parser.parseFromString(n,this.#Zt);!i.querySelector("parsererror")&&i.documentElement?.namespaceURI||(this.#Zt=r.HTML,i=this.parser.parseFromString(n,this.#Zt));for(const[t,e]of this.#se)for(const n of i.querySelectorAll(`img[src="${t}"]`))n.replaceWith(e);const o=URL.createObjectURL(new Blob([this.serializer.serializeToString(i)],{type:this.#Zt}));return this.#Kt.set(t,o),o}getIndexByFID(t){return this.#Yt.findIndex((e=>e.frags.some((e=>e.index===t))))}#le(t,e,n){const i=this.#te.get(t);if(i)i.set(e,n);else{const i=new Map;this.#te.set(t,i),i.set(e,n)}}async resolveHref(t){const{fid:e,off:n}=$(t),i=this.getIndexByFID(e);if(i<0)return;const r=this.#te.get(e)?.get(n);if(r)return{index:i,anchor:t=>t.querySelector(r)};const{skel:o,frags:a}=this.#Yt[i],s=a.find((t=>t.index===e)),l=o.offset+o.length+s.offset,c=await this.loadRaw(l,l+s.length),d=this.mobi.decode(c).slice(n),h=j(d);return this.#le(e,n,h),{index:i,anchor:t=>t.querySelector(h)}}splitTOCHref(t){const e=$(t);return[this.getIndexByFID(e.fid),e]}getTOCFragment(t,{fid:e,off:n}){const i=this.#te.get(e)?.get(n);return t.querySelector(i)}isExternal(t){return/^(?!blob|kindle)\w+:/i.test(t)}destroy(){for(const t of this.#Kt.values())URL.revokeObjectURL(t)}}},800:(t,e,n)=>{n.d(e,{EPUB:()=>B});var i=n(986);const r="http://www.idpf.org/2007/opf",o="http://www.idpf.org/2007/ops",a="http://purl.org/dc/elements/1.1/",s="http://www.w3.org/2001/04/xmlenc#",l="http://www.w3.org/1999/xlink",c={XML:"application/xml",NCX:"application/x-dtbncx+xml",XHTML:"application/xhtml+xml",HTML:"text/html",CSS:"text/css",SVG:"image/svg+xml",JS:/\/(x-)?(javascript|ecmascript)/},d=t=>t.toLowerCase().replace(/[-:](.)/g,((t,e)=>e.toUpperCase())),h=(t,e,n)=>n?n=>n.getAttribute(t)?.split(/\s/)?.includes(e):"function"==typeof e?n=>e(n.getAttribute(t)):n=>n.getAttribute(t)===e,u=(...t)=>e=>e?Object.fromEntries(t.map((t=>[d(t),e.getAttribute(t)]))):null,f=t=>{return e=t?.textContent,e?e.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"";var e},p=(t,e)=>{const n=t.lookupNamespaceURI(null)===e||t.lookupPrefix(e),i=n?(t,n)=>t=>t.namespaceURI===e&&t.localName===n:(t,e)=>t=>t.localName===e;return{$:(t,e)=>[...t.children].find(i(t,e)),$$:(t,e)=>[...t.children].filter(i(t,e)),$$$:n?(t,n)=>[...t.getElementsByTagNameNS(e,n)]:(t,e)=>[...t.getElementsByTagName(e)]}},g=(t,e)=>{try{if(e.includes(":"))return new URL(t,e);const n="https://invalid.invalid/",i=new URL(t,n+e);return i.search="",decodeURI(i.href.replace(n,""))}catch(e){return console.warn(e),t}},m=t=>/^(?!blob)\w+:/i.test(t),w=async(t,e,n)=>{const i=[];t.replace(e,((...t)=>(i.push(t),null)));const r=[];for(const t of i)r.push(await n(...t));return t.replace(e,(()=>r.shift()))},b=t=>t.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),y={attrs:["dir","xml:lang"]},x={name:"alternate-script",many:!0,...y,props:["file-as"]},v={many:!0,...y,props:[{name:"role",many:!0,attrs:["scheme"]},"file-as",x],setLegacyAttrs:(t,e)=>{if(!t.role?.length){const n=e.getAttributeNS(r,"role");n&&(t.role=[{value:n}])}t.fileAs??=e.getAttributeNS(r,"file-as")}},k=[{name:"title",many:!0,...y,props:["title-type","display-seq","file-as",x]},{name:"identifier",many:!0,props:[{name:"identifier-type",attrs:["scheme"]}],setLegacyAttrs:(t,e)=>{if(!t.identifierType){const n=e.getAttributeNS(r,"scheme");n&&(t.identifierType={value:n})}}},{name:"language",many:!0},{name:"creator",...v},{name:"contributor",...v},{name:"publisher",...y,props:["file-as",x]},{name:"description",...y,props:[x]},{name:"rights",...y,props:[x]},{name:"date"},{name:"dcterms:modified",type:"meta"},{name:"subject",many:!0,...y,props:["term","authority",x],setLegacyAttrs:(t,e)=>{t.term??=e.getAttributeNS(r,"term"),t.authority??=e.getAttributeNS(r,"authority")}},{name:"source",many:!0},{name:"belongs-to-collection",type:"meta",many:!0,...y,props:["collection-type","group-position","dcterms:identifier","file-as",x,{name:"belongs-to-collection",recursive:!0}]}],S=(t,e=t=>t)=>{const{$:n,$$:i,$$$:r}=p(t,"http://www.w3.org/1999/xhtml"),a=(t,r)=>t?i(t,"li").map((t=>i=>{const r=n(i,"a")??n(i,"span"),s=n(i,"ol"),l=(t=>t?decodeURI(e(t)):null)(r?.getAttribute("href")),c={label:f(r)||r?.getAttribute("title"),href:l,subitems:a(s)};return t&&(c.type=r?.getAttributeNS(o,"type")?.split(/\s/)),c})(r)):null,s=(t,e)=>a(n(t,"ol"),e),l=r(t,"nav");let c=null,d=null,h=null,u=[];for(const t of l){const e=t.getAttributeNS(o,"type")?.split(/\s/)??[];e.includes("toc")?c??=s(t):e.includes("page-list")?d??=s(t):e.includes("landmarks")?h??=s(t,!0):u.push({label:f(t.firstElementChild),type:e,list:s(t)})}return{toc:c,pageList:d,landmarks:h,others:u}},_=t=>{if(!t)return;const e=t.split(":").map((t=>parseFloat(t)));if(3===e.length){const[t,n,i]=e;return 60*t*60+60*n+i}if(2===e.length){const[t,n]=e;return 60*t+n}const[n,i]=t.split(/(?=[^\d.])/);return parseFloat(n)*("h"===i?3600:"min"===i?60:"ms"===i?.001:1)};class A extends EventTarget{#ce;#de;#he;#ue;#fe;#pe;#ge=1;#me=1;constructor(t,e){super(),this.book=t,this.loadXML=e}async#we(t){if(this.#de===t)return;const e=await this.loadXML(t.href),n=e=>e?g(e,t.href):null,{$:i,$$$:r}=p(e,"http://www.w3.org/ns/SMIL");this.#ue=-1,this.#fe=-1,this.#ce=r(e,"par").reduce(((t,e)=>{const r=n(i(e,"text")?.getAttribute("src")),o=i(e,"audio");if(!r||!o)return t;const a=n(o.getAttribute("src")),s=_(o.getAttribute("clipBegin")),l=_(o.getAttribute("clipEnd")),c=t.at(-1);return c?.src===a?c.items.push({text:r,begin:s,end:l}):t.push({src:a,items:[{text:r,begin:s,end:l}]}),t}),[]),this.#de=t}get#be(){return this.#ce[this.#ue]}get#ye(){return this.#be?.items?.[this.#fe]}#xe(t){console.error(t),this.dispatchEvent(new CustomEvent("error",{detail:t}))}#ve(){this.dispatchEvent(new CustomEvent("highlight",{detail:this.#ye}))}#ke(){this.dispatchEvent(new CustomEvent("unhighlight",{detail:this.#ye}))}async#Se(t,e){this.#pe&&(this.#pe.pause(),URL.revokeObjectURL(this.#pe.src),this.#pe=null),this.#ue=t,this.#fe=e;const n=this.#be?.src;if(!n||!this.#ye)return this.start(this.#he+1);const i=URL.createObjectURL(await this.book.loadBlob(n)),r=new Audio(i);this.#pe=r,r.addEventListener("timeupdate",(()=>{if(r.paused)return;const t=r.currentTime,{items:e}=this.#be;if(t>this.#ye?.end&&(this.#ke(),this.#fe===e.length-1))return void this.#Se(this.#ue+1,0).catch((t=>this.#xe(t)));const n=this.#fe;for(;e[this.#fe+1]?.begin<=t;)this.#fe++;this.#fe!==n&&this.#ve()})),r.addEventListener("error",(()=>this.#xe(new Error(`Failed to load ${n}`)))),r.addEventListener("playing",(()=>this.#ve())),r.addEventListener("pause",(()=>this.#ke())),r.addEventListener("ended",(()=>{this.#ke(),URL.revokeObjectURL(i),this.#pe=null,this.#Se(t+1,0).catch((t=>this.#xe(t)))})),r.addEventListener("canplaythrough",(()=>{r.currentTime=this.#ye.begin??0,r.volume=this.#ge,r.playbackRate=this.#me,r.play().catch((t=>this.#xe(t)))}))}async start(t,e=()=>!0){this.#pe?.pause();const n=this.book.sections[t],i=n?.id;if(!i)return;const{mediaOverlay:r}=n;if(!r)return this.start(t+1);this.#he=t,await this.#we(r);for(let t=0;t<this.#ce.length;t++){const{items:n}=this.#ce[t];for(let r=0;r<n.length;r++)if(n[r].text.split("#")[0]===i&&e(n[r],r,n))return this.#Se(t,r).catch((t=>this.#xe(t)))}}pause(){this.#pe?.pause()}resume(){this.#pe?.play().catch((t=>this.#xe(t)))}prev(){this.#fe>0?this.#Se(this.#ue,this.#fe-1):this.#ue>0?this.#Se(this.#ue-1,this.#ce[this.#ue-1].items.length-1):this.#he>0&&this.start(this.#he-1,((t,e,n)=>e===n.length-1))}next(){this.#Se(this.#ue,this.#fe+1)}setVolume(t){this.#ge=t,this.#pe&&(this.#pe.volume=t)}setRate(t){this.#me=t,this.#pe&&(this.#pe.playbackRate=t)}}const T=/([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/,L=t=>f(t.getElementById(t.documentElement.getAttribute("unique-identifier"))??t.getElementsByTagNameNS(a,"identifier")[0]),E=async(t,e,n)=>{const i=new Uint8Array(await n.slice(0,e).arrayBuffer());e=Math.min(e,i.length);for(var r=0;r<e;r++)i[r]=i[r]^t[r%t.length];return new Blob([i,n.slice(e)],{type:n.type})},C=async t=>{const e=(new TextEncoder).encode(t),n=await globalThis.crypto.subtle.digest("SHA-1",e);return new Uint8Array(n)},I=(t=C)=>({"http://www.idpf.org/2008/embedding":{key:e=>t(L(e).replaceAll(/[\u0020\u0009\u000d\u000a]/g,"")),decode:(t,e)=>E(t,1040,e)},"http://ns.adobe.com/pdf/enc#RC":{key:t=>{const e=(t=>{for(const e of t.getElementsByTagNameNS(a,"identifier")){const[t]=f(e).split(":").slice(-1);if(T.test(t))return t}return""})(t).replaceAll("-","");return Uint8Array.from({length:16},((t,n)=>parseInt(e.slice(2*n,2*n+2),16)))},decode:(t,e)=>E(t,1024,e)}});class R{#_e=new Map;#Ae=new Map;#Te;constructor(t){this.#Te=t}async init(t,e){if(!t)return;const n=Array.from(t.getElementsByTagNameNS(s,"EncryptedData"),(t=>({algorithm:t.getElementsByTagNameNS(s,"EncryptionMethod")[0]?.getAttribute("Algorithm"),uri:t.getElementsByTagNameNS(s,"CipherReference")[0]?.getAttribute("URI")})));for(const{algorithm:t,uri:i}of n){if(!this.#Ae.has(t)){const n=this.#Te[t];if(!n){console.warn("Unknown encryption algorithm");continue}const i=await n.key(e);this.#Ae.set(t,(t=>n.decode(i,t)))}this.#_e.set(i,t)}}getDecoder(t){return this.#Ae.get(this.#_e.get(t))??(t=>t)}}class M{constructor({opf:t,resolveHref:e}){this.opf=t;const{$:n,$$:o,$$$:a}=p(t,r),s=n(t.documentElement,"manifest"),l=n(t.documentElement,"spine"),d=o(l,"itemref");this.manifest=o(s,"item").map(u("href","id","media-type","properties","media-overlay")).map((t=>(t.href=e(t.href),t.properties=t.properties?.split(/\s/),t))),this.spine=d.map(u("idref","id","linear","properties")).map((t=>(t.properties=t.properties?.split(/\s/),t))),this.pageProgressionDirection=l.getAttribute("page-progression-direction"),this.navPath=this.getItemByProperty("nav")?.href,this.ncxPath=(this.getItemByID(l.getAttribute("toc"))??this.manifest.find((t=>t.mediaType===c.NCX)))?.href;const f=n(t.documentElement,"guide");f&&(this.guide=o(f,"reference").map(u("type","title","href")).map((({type:t,title:n,href:i})=>({label:n,type:t.split(/\s/),href:e(i)})))),this.cover=this.getItemByProperty("cover-image")??this.getItemByID(a(t,"meta").find(h("name","cover"))?.getAttribute("content"))??this.getItemByHref(this.guide?.find((t=>t.type.includes("cover")))?.href),this.cfis=i.ob(d)}getItemByID(t){return this.manifest.find((e=>e.id===t))}getItemByHref(t){return this.manifest.find((e=>e.href===t))}getItemByProperty(t){return this.manifest.find((e=>e.properties?.includes(t)))}resolveCFI(t){const e=i.qg(t),n=(e.parent??e).shift();let r=i.wT(this.opf,n);r&&"idref"!==r.nodeName&&(n[n.length-1].id=null,r=i.wT(this.opf,n));const o=r?.getAttribute("idref");return{index:this.spine.findIndex((t=>t.idref===o)),anchor:t=>i.Xp(t,e)}}}class z{#Kt=new Map;#Le=new Map;#Ee=new Map;allowScript=!1;constructor({loadText:t,loadBlob:e,resources:n}){this.loadText=t,this.loadBlob=e,this.manifest=n.manifest,this.assets=n.manifest}createURL(t,e,n,i){if(!e)return"";const r=URL.createObjectURL(new Blob([e],{type:n}));if(this.#Kt.set(t,r),this.#Ee.set(t,1),i){const e=this.#Le.get(i);e?e.push(t):this.#Le.set(i,[t])}return r}ref(t,e){const n=this.#Le.get(e);return n?.includes(t)||(this.#Ee.set(t,this.#Ee.get(t)+1),n?n.push(t):this.#Le.set(e,[t])),this.#Kt.get(t)}unref(t){if(!this.#Ee.has(t))return;const e=this.#Ee.get(t)-1;if(e<1){URL.revokeObjectURL(this.#Kt.get(t)),this.#Kt.delete(t),this.#Ee.delete(t);const e=this.#Le.get(t);if(e)for(;e.length;)this.unref(e.pop());this.#Le.delete(t)}else this.#Ee.set(t,e)}async loadItem(t,e=[]){if(!t)return null;const{href:n,mediaType:i}=t,r=c.JS.test(t.mediaType);if(r&&!this.allowScript)return null;const o=e[e.length-1];return this.#Kt.has(n)?this.ref(n,o):(r||[c.XHTML,c.HTML,c.CSS,c.SVG].includes(i))&&e.every((t=>t!==n))?this.loadReplaced(t,e):this.createURL(n,await this.loadBlob(n),i,o)}async loadHref(t,e,n=[]){if(m(t))return t;const i=g(t,e),r=this.manifest.find((t=>t.href===i));return r?this.loadItem(r,n.concat(e)):t}async loadReplaced(t,e=[]){const{href:n,mediaType:i}=t,r=e[e.length-1],o=await this.loadText(n);if(!o)return null;if([c.XHTML,c.HTML,c.SVG].includes(i)){let a=(new DOMParser).parseFromString(o,i);if(i!==c.XHTML||!a.querySelector("parsererror")&&a.documentElement?.namespaceURI||(console.warn(a.querySelector("parsererror")?.innerText??"Invalid XHTML"),t.mediaType=c.HTML,a=(new DOMParser).parseFromString(o,t.mediaType)),[c.XHTML,c.SVG].includes(t.mediaType)){let t=a.firstChild;for(;t instanceof ProcessingInstruction;){if(t.data){const i=await w(t.data,/(?:^|\s*)(href\s*=\s*['"])([^'"]*)(['"])/i,((t,i,r,o)=>this.loadHref(r,n,e).then((t=>`${i}${t}${o}`))));t.replaceWith(a.createProcessingInstruction(t.target,i))}t=t.nextSibling}}const s=async(t,i)=>t.setAttribute(i,await this.loadHref(t.getAttribute(i),n,e));for(const t of a.querySelectorAll("link[href]"))await s(t,"href");for(const t of a.querySelectorAll("[src]"))await s(t,"src");for(const t of a.querySelectorAll("[poster]"))await s(t,"poster");for(const t of a.querySelectorAll("object[data]"))await s(t,"data");for(const t of a.querySelectorAll("[*|href]:not([href])"))t.setAttributeNS(l,"href",await this.loadHref(t.getAttributeNS(l,"href"),n,e));for(const t of a.querySelectorAll("style"))t.textContent&&(t.textContent=await this.replaceCSS(t.textContent,n,e));for(const t of a.querySelectorAll("[style]"))t.setAttribute("style",await this.replaceCSS(t.getAttribute("style"),n,e));const d=(new XMLSerializer).serializeToString(a);return this.createURL(n,d,t.mediaType,r)}const a=i===c.CSS?await this.replaceCSS(o,n,e):await this.replaceString(o,n,e);return this.createURL(n,a,i,r)}async replaceCSS(t,e,n=[]){const i=await w(t,/url\(\s*["']?([^'"\n]*?)\s*["']?\s*\)/gi,((t,i)=>this.loadHref(i,e,n).then((t=>`url("${t}")`)))),r=await w(i,/@import\s*["']([^"'\n]*?)["']/gi,((t,i)=>this.loadHref(i,e,n).then((t=>`@import "${t}"`)))),o=window?.innerWidth??800,a=window?.innerHeight??600;return r.replace(/([{\s;])-epub-/gi,"$1").replace(/(\d*\.?\d+)vw/gi,((t,e)=>parseFloat(e)*o/100+"px")).replace(/(\d*\.?\d+)vh/gi,((t,e)=>parseFloat(e)*a/100+"px")).replace(/page-break-(after|before|inside)\s*:/gi,((t,e)=>`-webkit-column-break-${e}:`)).replace(/break-(after|before|inside)\s*:\s*(avoid-)?page/gi,((t,e,n)=>`break-${e}: ${n??""}column`)).replace(/(\d*\.?\d+)px/gi,((t,e)=>parseFloat(e)/16+"em"))}replaceString(t,e,n=[]){const i=new Map,r=this.assets.map((t=>{if(t.href===e)return;const n=((t,e)=>{if(!t)return e;const n=t.replace(/\/$/,"").split("/"),i=e.replace(/\/$/,"").split("/"),r=(n.length>i.length?n:i).findIndex(((t,e)=>n[e]!==i[e]));return r<0?"":Array(n.length-r).fill("..").concat(i.slice(r)).join("/")})((t=>t.slice(0,t.lastIndexOf("/")+1))(e),t.href),r=encodeURI(n),o="/"+t.href,a=encodeURI(o),s=new Set([n,r,o,a]);for(const e of s)i.set(e,t);return Array.from(s)})).flat().filter((t=>t));if(!r.length)return t;const o=new RegExp(r.map(b).join("|"),"g");return w(t,o,(async t=>this.loadItem(i.get(t.replace(/^\//,"")),n.concat(e))))}unloadItem(t){this.unref(t?.href)}destroy(){for(const t of this.#Kt.values())URL.revokeObjectURL(t)}}const O=t=>{for(const e of t){if("page-spread-left"===e||"rendition:page-spread-left"===e)return"left";if("page-spread-right"===e||"rendition:page-spread-right"===e)return"right";if("rendition:page-spread-center"===e)return"center"}};class B{parser=new DOMParser;#Ce;#Ie;constructor({loadText:t,loadBlob:e,getSize:n,sha1:i}){this.loadText=t,this.loadBlob=e,this.getSize=n,this.#Ie=new R(I(i))}async#Re(t){const e=await this.loadText(t);if(!e)return null;const n=this.parser.parseFromString(e,c.XML);if(n.querySelector("parsererror"))throw new Error(`XML parsing error: ${t}\n${n.querySelector("parsererror").innerText}`);return n}async init(){const t=await this.#Re("META-INF/container.xml");if(!t)throw new Error("Failed to load container file");const e=Array.from(t.getElementsByTagNameNS("urn:oasis:names:tc:opendocument:xmlns:container","rootfile"),u("full-path","media-type")).filter((t=>"application/oebps-package+xml"===t.mediaType));if(!e.length)throw new Error("No package document defined in container");const n=e[0].fullPath,i=await this.#Re(n);if(!i)throw new Error("Failed to load package document");const o=await this.#Re("META-INF/encryption.xml");await this.#Ie.init(o,i),this.resources=new M({opf:i,resolveHref:t=>g(t,n)}),this.#Ce=new z({loadText:this.loadText,loadBlob:t=>Promise.resolve(this.loadBlob(t)).then(this.#Ie.getDecoder(t)),resources:this.resources}),this.sections=this.resources.spine.map(((t,e)=>{const{idref:n,linear:i,properties:r=[]}=t,o=this.resources.getItemByID(n);return o?{id:o.href,load:()=>this.#Ce.loadItem(o),unload:()=>this.#Ce.unloadItem(o),createDocument:()=>this.loadDocument(o),size:this.getSize(o.href),cfi:this.resources.cfis[e],linear:i,pageSpread:O(r),resolveHref:t=>g(t,o.href),mediaOverlay:o.mediaOverlay?this.resources.getItemByID(o.mediaOverlay):null}:(console.warn(`Could not find item with ID "${n}" in manifest`),null)})).filter((t=>t));const{navPath:s,ncxPath:l}=this.resources;if(s)try{const t=t=>g(t,s),e=S(await this.#Re(s),t);this.toc=e.toc,this.pageList=e.pageList,this.landmarks=e.landmarks}catch(t){console.warn(t)}if(!this.toc&&l)try{const t=t=>g(t,l),e=((t,e=t=>t)=>{const{$:n,$$:i}=p(t,"http://www.daisy.org/z3986/2005/ncx/"),r=t=>{const o=n(t,"navLabel"),a=n(t,"content"),s=f(o),l=(t=>t?decodeURI(e(t)):null)(a.getAttribute("src"));if("navPoint"===t.localName){const e=i(t,"navPoint");return{label:s,href:l,subitems:e.length?e.map(r):null}}return{label:s,href:l}},o=(t,e)=>i(t,e).map(r),a=(e,i)=>{const r=n(t.documentElement,e);return r?o(r,i):null};return{toc:a("navMap","navPoint"),pageList:a("pageList","pageTarget"),others:i(t.documentElement,"navList").map((t=>({label:f(n(t,"navLabel")),list:o(t,"navTarget")})))}})(await this.#Re(l),t);this.toc=e.toc,this.pageList=e.pageList}catch(t){console.warn(t)}this.landmarks??=this.resources.guide;const{metadata:c,rendition:m,media:w}=(t=>{const{$:e,$$:n}=p(t,r),i=e(t.documentElement,"metadata"),o=Array.from(i.children),s=(t,e)=>{if(!e)return null;const{props:n=[],attrs:i=[]}=t,r=f(e);if(!n.length&&!i.length)return r;const a=e.getAttribute("id"),l=a?o.filter(h("refines","#"+a)):[],c=Object.fromEntries([["value",r]].concat(n.map((e=>{const{many:n,recursive:i}=e,r="string"==typeof e?e:e.name,o=h("property",r),a=i?t:e;return[d(r),n?l.filter(o).map((t=>s(a,t))):s(a,l.find(o))]}))).concat(i.map((t=>[d(t),e.getAttribute(t)]))));return t.setLegacyAttrs?.(c,e),c},l=o.filter(h("refines",null)),c=Object.fromEntries(k.map((t=>{const{type:e,name:n,many:i}=t,o="meta"===e?t=>t.namespaceURI===r&&t.getAttribute("property")===n:t=>t.namespaceURI===a&&t.localName===n;return[d(n),i?l.filter(o).map((e=>s(t,e))):s(t,l.find(o))]}))),u=n(i,"meta"),g=t=>u.filter(h("property",(e=>e?.startsWith(t)))).map((e=>[e.getAttribute("property").replace(t,""),e])),m=Object.fromEntries(g("rendition:").map((([t,e])=>[t,f(e)]))),w={narrator:[],duration:{}};for(const[t,e]of g("media:")){const n=f(e);"duration"===t?w.duration[e.getAttribute("refines")?.split("#")?.[1]??""]=_(n):"active-class"===t?w.activeClass=n:"narrator"===t?w.narrator.push(n):"playback-active-class"===t&&(w.playbackActiveClass=n)}return{metadata:c,rendition:m,media:w}})(i);this.rendition=m,this.media=w,this.dir=this.resources.pageProgressionDirection;const b=(y=await this.#Re("META-INF/com.apple.ibooks.display-options.xml")??await this.#Re("META-INF/com.kobobooks.display-options.xml"))?{fixedLayout:f(y.querySelector('option[name="fixed-layout"]')),openToSpread:f(y.querySelector('option[name="open-to-spread"]'))}:null;var y;b&&("true"===b.fixedLayout&&(this.rendition.layout??="pre-paginated"),"false"===b.openToSpread&&(this.sections.find((t=>"no"!==t.linear)).pageSpread??="rtl"===this.dir?"left":"right")),this.parsedMetadata=c;const x=c?.title?.[0];this.metadata={title:x?.value,subtitle:c?.title?.find((t=>"subtitle"===t.titleType))?.value,sortAs:x?.fileAs,language:c?.language,identifier:L(i),description:c?.description?.value,publisher:c?.publisher?.value,published:c?.date,modified:c?.dctermsModified,subject:c?.subject?.filter((({value:t,term:e})=>t||e))?.map((({value:t,term:e,authority:n})=>({name:t,code:e,scheme:n}))),rights:c?.rights?.value};const v={art:"artist",aut:"author",bkp:"producer",clr:"colorist",edt:"editor",ill:"illustrator",nrt:"narrator",trl:"translator",pbl:"publisher"},A=t=>e=>{const n=[...new Set(e.role?.map((({value:e,scheme:n})=>(n&&"marc:relators"!==n?null:v[e])??t)))],i={name:e.value,sortAs:e.fileAs};return[n?.length?n:[t],i]};return c?.creator?.map(A("author"))?.concat(c?.contributor?.map?.(A("contributor")))?.forEach((([t,e])=>t.forEach((t=>{this.metadata[t]?this.metadata[t].push(e):this.metadata[t]=[e]})))),this}async loadDocument(t){const e=await this.loadText(t.href);return this.parser.parseFromString(e,t.mediaType)}getMediaOverlay(){return new A(this,this.#Re.bind(this))}resolveCFI(t){return this.resources.resolveCFI(t)}resolveHref(t){const[e,n]=t.split("#"),i=this.resources.getItemByHref(decodeURI(e));return i?{index:this.resources.spine.findIndex((({idref:t})=>t===i.id)),anchor:n?t=>((t,e)=>t.getElementById(e)??t.querySelector(`[name="${CSS.escape(e)}"]`))(t,n):()=>0}:null}splitTOCHref(t){return t?.split("#")??[]}getTOCFragment(t,e){return t.getElementById(e)??t.querySelector(`[name="${CSS.escape(e)}"]`)}isExternal(t){return m(t)}async getCover(){const t=this.resources?.cover;return t?.href?new Blob([await this.loadBlob(t.href)],{type:t.mediaType}):null}async getCalibreBookmarks(){const t=await this.loadText("META-INF/calibre_bookmarks.txt");if(t?.startsWith("encoding=json+base64:")){const e=atob(t.slice(21));return JSON.parse(e)}}destroy(){this.#Ce?.destroy()}}},949:(t,e,n)=>{n.d(e,{k:()=>r,r:()=>o});const i=t=>t.map((t=>t.subitems?.length?[t,i(t.subitems)].flat():t)).flat();class r{async init({toc:t,ids:e,splitHref:n,getFragment:r}){(t=>{let e=0;const n=t=>{if(t.id=e++,t.subitems)for(const e of t.subitems)n(e)};for(const e of t)n(e)})(t);const o=i(t),a=new Map;for(const[t,e]of o.entries()){const[i,r]=await n(e?.href)??[],s={fragment:r,item:e};a.has(i)?a.get(i).items.push(s):a.set(i,{prev:o[t-1],items:[s]})}const s=new Map;for(const[t,n]of e.entries())a.has(n)?s.set(n,a.get(n)):s.set(n,s.get(e[t-1]));this.ids=e,this.map=s,this.getFragment=r}getProgress(t,e){if(!this.ids)return;const n=this.ids[t],i=this.map.get(n);if(!i)return null;const{prev:r,items:o}=i;if(!o)return r;if(!e||1===o.length&&!o[0].fragment)return o[0].item;const a=e.startContainer.getRootNode();for(const[t,{fragment:n}]of o.entries()){const i=this.getFragment(a,n);if(i&&e.comparePoint(i,0)>0)return o[t-1]?.item??r}return o[o.length-1].item}}class o{constructor(t,e,n){this.sizes=t.map((t=>"no"!=t.linear&&t.size>0?t.size:0)),this.sizePerLoc=e,this.sizePerTimeUnit=n,this.sizeTotal=this.sizes.reduce(((t,e)=>t+e),0),this.sectionFractions=this.#Me()}#Me(){const{sizeTotal:t}=this,e=[0];let n=0;for(const i of this.sizes)e.push((n+=i)/t);return e}getProgress(t,e,n=0){const{sizes:i,sizePerLoc:r,sizePerTimeUnit:o,sizeTotal:a}=this,s=i[t]??0,l=i.slice(0,t).reduce(((t,e)=>t+e),0)+e*s,c=l+n*s,d=a-l,h=(1-e)*s;return{fraction:c/a,section:{current:t,total:i.length},location:{current:Math.floor(l/r),next:Math.floor(c/r),total:Math.ceil(a/r)},time:{section:h/o,total:d/o}}}getSection(t){if(t<=0)return[0,0];if(t>=1)return[this.sizes.length-1,1];t+=Number.EPSILON;const{sizeTotal:e}=this;let n=this.sectionFractions.findIndex((e=>e>t))-1;if(n<0)return[0,0];for(;!this.sizes[n];)n++;return[n,(t-this.sectionFractions[n])/(this.sizes[n]/e)]}}},977:(t,e,n)=>{function i(t){return t.collapsed||""===t.toString().trim()}n.d(e,{TTS:()=>o}),new Set(["article","aside","audio","blockquote","caption","details","dialog","div","dl","dt","dd","figure","footer","form","figcaption","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","math","nav","ol","p","pre","section","tr"]);class r{#St=[];#ze;#r=-1;#Oe;constructor(t,e=t=>t){this.#ze=t,this.#Oe=e}current(){if(this.#St[this.#r])return this.#Oe(this.#St[this.#r])}first(){if(this.#St[0])return this.#r=0,this.#Oe(this.#St[0])}last(){for(const t of this.#ze)this.#St.push(t);const t=this.#St.length-1;if(this.#St[t])return this.#r=t,this.#Oe(this.#St[t])}prev(){const t=this.#r-1;if(this.#St[t])return this.#r=t,this.#Oe(this.#St[t])}next(){const t=this.#r+1;if(this.#St[t])return this.#r=t,this.#Oe(this.#St[t]);for(;;){const{done:e,value:n}=this.#ze.next();if(e)break;if(this.#St.push(n),this.#St[t])return this.#r=t,this.#Oe(this.#St[t])}}prepare(){const t=this.#r+1;if(this.#St[t])return this.#Oe(this.#St[t]);for(;;){const{done:e,value:n}=this.#ze.next();if(e)break;if(this.#St.push(n),this.#St[t])return this.#Oe(this.#St[t])}}find(t){const e=this.#St.findIndex((e=>t(e)));if(e>-1)return this.#r=e,this.#Oe(this.#St[e]);for(;;){const{done:e,value:n}=this.#ze.next();if(e)break;if(this.#St.push(n),t(n))return this.#r=this.#St.length-1,this.#Oe(n)}}}class o{#Be;#Fe;constructor(t,e,n){this.doc=t,this.highlight=n,this.#Be=new r(function*(t){const e=t.createTreeWalker(t.body,NodeFilter.SHOW_TEXT);let n=null;for(let r=e.nextNode();r;r=e.nextNode()){let e;const o=/[.!?。！？]["'“”‘’]?/g;for(;null!==(e=o.exec(r.textContent));)t.createRange(),n&&(n.setEnd(r,e.index+e[0].length),i(n)||(yield n)),n=t.createRange(),n.setStart(r,e.index+e[0].length);n&&(n.setEnd(r,r.textContent.length),i(n)||(yield n)),n=t.createRange(),n.setStart(r,r.textContent.length)}}(t),(t=>[t.toString(),t]))}#Pe(t,e){if(!t)return"";if(!e)return t;const n=document.createElement("div");n.innerHTML=t;let i=e(n)?.previousSibling;for(;i;){const t=i.previousSibling??i.parentNode?.previousSibling;i.parentNode.removeChild(i),i=t}return n.textContent}start(){this.#Fe=null;const[t,e]=this.#Be.first()??[];return t?(this.highlight(e.cloneRange()),this.#Pe(t)):this.next()}end(){this.#Fe=null;const[t,e]=this.#Be.last()??[];return t?(this.highlight(e.cloneRange()),this.#Pe(t)):this.next()}resume(){const[t]=this.#Be.current()??[];return t?this.#Pe(t):this.next()}prev(t){this.#Fe=null;const[e,n]=this.#Be.prev()??[];return t&&n&&this.highlight(n.cloneRange()),this.#Pe(e)}next(t){this.#Fe=null;const[e,n]=this.#Be.next()??[];return t&&n&&this.highlight(n.cloneRange()),this.#Pe(e)}prepare(){const[t]=this.#Be.prepare()??[];return this.#Pe(t)}from(t){this.#Fe=null;const[e,n]=this.#Be.find((e=>t.compareBoundaryPoints(Range.END_TO_START,e)<=0));return n&&this.highlight(n.cloneRange()),this.#Pe(e)}}},986:(t,e,n)=>{n.d(e,{EL:()=>C,Lu:()=>o,RK:()=>l,UD:()=>b,Xp:()=>T,ap:()=>w,ob:()=>L,qg:()=>f,wT:()=>E,yT:()=>A});const i=(t,e)=>[-1,...e,t.length].reduce((({xs:e,a:n},i)=>({xs:e?.concat([t.slice(n+1,i)])??[],a:i})),{}).xs,r=/\d/,o=/^epubcfi\((.*)\)$/,a=t=>t.replace(/[\^[\](),;=]/g,"^$&"),s=t=>o.test(t)?t:`epubcfi(${t})`,l=(c=(...t)=>t.join("!"),(...t)=>`epubcfi(${c(...t.map((t=>t.match(o)?.[1]??t)))})`);var c;const d=(t,e)=>((t,e)=>t.map(((t,n,i)=>e(t)?n:null)).filter((t=>null!=t)))(t,(([t])=>t===e)),h=t=>{const e=[];let n;for(const[i,r]of t){if("/"===i)e.push({index:r});else{const t=e[e.length-1];if(":"===i)t.offset=r;else if("~"===i)t.temporal=r;else if("@"===i)t.spatial=(t.spatial??[]).concat(r);else if(";s"===i)t.side=r;else if("["===i){if("/"!==n||!r){t.text=(t.text??[]).concat(r);continue}t.id=r}}n=i}return e},u=t=>i(t,d(t,"!")).map(h),f=t=>{const e=(t=>{const e=[];let n,i,o="";const a=t=>(e.push(t),n=null,o=""),s=t=>(o+=t,i=!1);for(const e of Array.from(t.trim()).concat(""))if("^"!==e||i){if("!"===n)a(["!"]);else if(","===n)a([","]);else if("/"===n||":"===n){if(r.test(e)){s(e);continue}a([n,parseInt(o)])}else if("~"===n){if(r.test(e)||"."===e){s(e);continue}a(["~",parseFloat(o)])}else if("@"===n){if(":"===e){a(["@",parseFloat(o)]),n="@";continue}if(r.test(e)||"."===e){s(e);continue}a(["@",parseFloat(o)])}else{if("["===n){";"!==e||i?","!==e||i?"]"!==e||i?s(e):a(["[",o]):(a(["[",o]),n="["):(a(["[",o]),n=";");continue}if(n?.startsWith(";")){"="!==e||i?";"!==e||i?"]"!==e||i?s(e):a([n,o]):(a([n,o]),n=";"):(n=`;${o}`,o="");continue}}"/"!==e&&":"!==e&&"~"!==e&&"@"!==e&&"["!==e&&"!"!==e&&","!==e||(n=e)}else i=!0;return e})((n=t,n.match(o)?.[1]??n));var n;const a=d(e,",");if(!a.length)return u(e);const[s,l,c]=i(e,a).map(u);return{parent:s,start:l,end:c}},p=({index:t,id:e,offset:n,temporal:i,spatial:r,text:o,side:s})=>{const l=s?`;s=${s}`:"";return`/${t}`+(e?`[${a(e)}${l}]`:"")+(null!=n&&t%2?`:${n}`:"")+(i?`~${i}`:"")+(r?`@${r.join(":")}`:"")+(o||!e&&s?"["+(o?.map(a)?.join(",")??"")+l+"]":"")},g=t=>t.parent?[t.parent,t.start,t.end].map(g).join(","):t.map((t=>t.map(p).join(""))).join("!"),m=t=>s(g(t)),w=(t,e)=>{return"string"==typeof t?m(w(f(t),e)):t.parent?(n=t.parent,i=t[e?"end":"start"],n.slice(0,-1).concat([n[n.length-1].concat(i[0])]).concat(i.slice(1))):t;var n,i},b=(t,e)=>{if("string"==typeof t&&(t=f(t)),"string"==typeof e&&(e=f(e)),t.start||e.start)return b(w(t),w(e))||b(w(t,!0),w(e,!0));for(let n=0;n<Math.max(t.length,e.length);n++){const i=t[n],r=e[n],o=Math.max(i.length,r.length)-1;for(let t=0;t<=o;t++){const e=i[t],n=r[t];if(!e)return-1;if(!n)return 1;if(e.index>n.index)return 1;if(e.index<n.index)return-1;if(t===o){if(e.offset>n.offset)return 1;if(e.offset<n.offset)return-1}}}return 0},y=({nodeType:t})=>3===t||4===t,x=({nodeType:t})=>1===t,v=(t,e)=>{const n=Array.from(t.childNodes).filter((t=>y(t)||x(t)));return e?n.map((t=>{const n=e(t);return n===NodeFilter.FILTER_REJECT?null:n===NodeFilter.FILTER_SKIP?v(t,e):t})).flat().filter((t=>t)):n},k=(t,e)=>{const n=v(t,e).reduce(((t,e)=>{let n=t[t.length-1];return n?y(e)?Array.isArray(n)?n.push(e):y(n)?t[t.length-1]=[n,e]:t.push(e):x(n)?t.push(null,e):t.push(e):t.push(e),t}),[]);return x(n[0])&&n.unshift("first"),x(n[n.length-1])&&n.push("last"),n.unshift("before"),n.push("after"),n},S=(t,e,n)=>{const{id:i}=e[e.length-1];if(i){const e=t.ownerDocument.getElementById(i);if(e)return{node:e,offset:0}}for(const{index:i}of e){const e=t?k(t,n)[i]:null;if("first"===e)return{node:t.firstChild??t};if("last"===e)return{node:t.lastChild??t};if("before"===e)return{node:t,before:!0};if("after"===e)return{node:t,after:!0};t=e}const{offset:r}=e[e.length-1];if(!Array.isArray(t))return{node:t,offset:r};let o=0;for(const e of t){const{length:t}=e.nodeValue;if(o+t>=r)return{node:e,offset:r-o};o+=t}},_=(t,e,n)=>{const{parentNode:i,id:r}=t,o=k(i,n),a=o.findIndex((e=>Array.isArray(e)?e.some((e=>e===t)):e===t)),s=o[a];if(Array.isArray(s)){let n=0;for(const i of s){if(i===t){n+=e;break}n+=i.nodeValue.length}e=n}const l={id:r,index:a,offset:e};return(i!==t.ownerDocument.documentElement?_(i,null,n).concat(l):[l]).filter((t=>-1!==t.index))},A=(t,e)=>{const{startContainer:n,startOffset:i,endContainer:r,endOffset:o}=t,a=_(n,i,e);if(t.collapsed)return m([a]);return((t,e)=>{"string"==typeof t&&(t=f(t)),"string"==typeof e&&(e=f(e)),t=w(t),e=w(e,!0);const n=t[t.length-1],i=e[e.length-1],r=[],o=[],a=[];let s=!0;const l=Math.max(n.length,i.length);for(let t=0;t<l;t++){const e=n[t],l=i[t];s&&=e?.index===l?.index&&!e?.offset&&!l?.offset,s?r.push(e):(e&&o.push(e),l&&a.push(l))}const c=t.slice(0,-1).concat([r]);return m({parent:c,start:[o],end:[a]})})([a],[_(r,o,e)])},T=(t,e,n)=>{const i=w(e),r=w(e,!0),o=t.documentElement,a=S(o,i[0],n),s=S(o,r[0],n),l=t.createRange();return a.before?l.setStartBefore(a.node):a.after?l.setStartAfter(a.node):l.setStart(a.node,a.offset),s.before?l.setEndBefore(s.node):s.after?l.setEndAfter(s.node):l.setEnd(s.node,s.offset),l},L=t=>{const e=[],{parentNode:n}=t[0],i=_(n);for(const[r,o]of k(n).entries()){const n=t[e.length];o===n&&e.push(m([i.concat({id:n.id,index:r})]))}return e},E=(t,e)=>S(t.documentElement,w(e)).node,C={fromIndex:t=>s("/6/"+2*(t+1)),toIndex:t=>t?.at(-1).index/2-1}}},o={};function a(t){var e=o[t];if(void 0!==e)return e.exports;var n=o[t]={exports:{}};return r[t](n,n.exports,a),n.exports}t="function"==typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",e="function"==typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",n="function"==typeof Symbol?Symbol("webpack error"):"__webpack_error__",i=t=>{t&&t.d<1&&(t.d=1,t.forEach((t=>t.r--)),t.forEach((t=>t.r--?t.r++:t())))},a.a=(r,o,a)=>{var s;a&&((s=[]).d=-1);var l,c,d,h=new Set,u=r.exports,f=new Promise(((t,e)=>{d=e,c=t}));f[e]=u,f[t]=t=>(s&&t(s),h.forEach(t),f.catch((t=>{}))),r.exports=f,o((r=>{var o;l=(r=>r.map((r=>{if(null!==r&&"object"==typeof r){if(r[t])return r;if(r.then){var o=[];o.d=0,r.then((t=>{a[e]=t,i(o)}),(t=>{a[n]=t,i(o)}));var a={};return a[t]=t=>t(o),a}}var s={};return s[t]=t=>{},s[e]=r,s})))(r);var a=()=>l.map((t=>{if(t[n])throw t[n];return t[e]})),c=new Promise((e=>{(o=()=>e(a)).r=0;var n=t=>t!==s&&!h.has(t)&&(h.add(t),t&&!t.d&&(o.r++,t.push(o)));l.map((e=>e[t](n)))}));return o.r?c:a()}),(t=>(t?d(f[n]=t):c(u),i(s)))),s&&s.d<0&&(s.d=0)},a.d=(t,e)=>{for(var n in e)a.o(e,n)&&!a.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),a.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a(531)})();