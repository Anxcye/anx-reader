name: Stale Issue Management

on:
  schedule:
    # Run daily at 1:00 AM UTC
    - cron: '0 1 * * *'
  workflow_dispatch: # Allow manual trigger

jobs:
  stale:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      - uses: actions/stale@v9
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          
          # General issues (60 days to stale, 14 days to close)
          days-before-stale: 60
          days-before-close: 14
          days-before-pr-stale: 60
          days-before-pr-close: 14
          
          # Stale label and messages
          stale-issue-label: 'stale'
          stale-pr-label: 'stale'
          stale-issue-message: |
            ğŸ‘‹ This issue has been automatically marked as stale because it has not had recent activity. 
            
            è¿™ä¸ª issue å› ä¸ºé•¿æ—¶é—´æ²¡æœ‰æ´»åŠ¨è€Œè¢«è‡ªåŠ¨æ ‡è®°ä¸º staleã€‚
            
            It will be closed in 14 days if no further activity occurs. To keep it open:
            - Add a comment with updates or clarifications
            - Remove the stale label
            
            å¦‚æœæ²¡æœ‰è¿›ä¸€æ­¥çš„æ´»åŠ¨ï¼Œå®ƒå°†åœ¨ 14 å¤©åè¢«å…³é—­ã€‚è¦ä¿æŒå¼€æ”¾çŠ¶æ€ï¼š
            - æ·»åŠ åŒ…å«æ›´æ–°æˆ–æ¾„æ¸…çš„è¯„è®º
            - ç§»é™¤ stale æ ‡ç­¾
            
            Thank you for your contributions! æ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼
            
          stale-pr-message: |
            ğŸ‘‹ This pull request has been automatically marked as stale because it has not had recent activity.
            
            è¿™ä¸ª pull request å› ä¸ºé•¿æ—¶é—´æ²¡æœ‰æ´»åŠ¨è€Œè¢«è‡ªåŠ¨æ ‡è®°ä¸º staleã€‚
            
            It will be closed in 14 days if no further activity occurs. To keep it open:
            - Push new commits
            - Add a comment with updates
            - Remove the stale label
            
            å¦‚æœæ²¡æœ‰è¿›ä¸€æ­¥çš„æ´»åŠ¨ï¼Œå®ƒå°†åœ¨ 14 å¤©åè¢«å…³é—­ã€‚è¦ä¿æŒå¼€æ”¾çŠ¶æ€ï¼š
            - æ¨é€æ–°çš„æäº¤
            - æ·»åŠ åŒ…å«æ›´æ–°çš„è¯„è®º  
            - ç§»é™¤ stale æ ‡ç­¾
            
            Thank you for your contributions! æ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼
          
          # Close messages
          close-issue-message: |
            ğŸ”’ This issue has been automatically closed due to inactivity.
            
            è¿™ä¸ª issue å› ä¸ºä¸æ´»è·ƒè€Œè¢«è‡ªåŠ¨å…³é—­ã€‚
            
            If this issue is still relevant, please:
            - Reopen the issue
            - Provide additional context or updates
            - Reference it in a new issue if the problem persists
            
            å¦‚æœè¿™ä¸ªé—®é¢˜ä»ç„¶ç›¸å…³ï¼Œè¯·ï¼š
            - é‡æ–°æ‰“å¼€ issue
            - æä¾›é¢å¤–çš„ä¸Šä¸‹æ–‡æˆ–æ›´æ–°
            - å¦‚æœé—®é¢˜ä»ç„¶å­˜åœ¨ï¼Œåœ¨æ–°çš„ issue ä¸­å¼•ç”¨å®ƒ
            
            Thank you for your understanding! æ„Ÿè°¢æ‚¨çš„ç†è§£ï¼
            
          close-pr-message: |
            ğŸ”’ This pull request has been automatically closed due to inactivity.
            
            è¿™ä¸ª pull request å› ä¸ºä¸æ´»è·ƒè€Œè¢«è‡ªåŠ¨å…³é—­ã€‚
            
            If you would like to continue this work:
            - Reopen the pull request
            - Create a new pull request with updated changes
            - Contact maintainers if you need assistance
            
            å¦‚æœæ‚¨æƒ³ç»§ç»­è¿™é¡¹å·¥ä½œï¼š
            - é‡æ–°æ‰“å¼€ pull request
            - åˆ›å»ºåŒ…å«æ›´æ–°æ›´æ”¹çš„æ–° pull request
            - å¦‚æœéœ€è¦å¸®åŠ©ï¼Œè¯·è”ç³»ç»´æŠ¤è€…
            
            Thank you for your contributions! æ„Ÿè°¢æ‚¨çš„è´¡çŒ®ï¼
          
          # Exempt labels (these issues will never go stale)
          exempt-issue-labels: 'P0,P1,P2,P3,good first issue,pinned'
          exempt-pr-labels: 'P0,P1,P2,P3,good first issue,pinned'

          # Remove stale label when issues/PRs are updated
          remove-stale-when-updated: true
          
          # Limit operations per run to avoid hitting API limits
          operations-per-run: 100
          
          # Don't mark issues as stale if they have assignees
          exempt-all-assignees: true

  stale-questions:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      - uses: actions/stale@v9
        with:
          repo-token: ${{ secrets.GITHUB_TOKEN }}
          
          # Question issues (30 days to stale, 7 days to close)
          days-before-stale: 30
          days-before-close: 7
          days-before-pr-stale: -1  # Disable for PRs in this job
          days-before-pr-close: -1  # Disable for PRs in this job
          
          # Only target issues with 'question' label
          only-labels: 'question'
          
          # Stale label and messages for questions
          stale-issue-label: 'stale'
          stale-issue-message: |
            â“ This question has been automatically marked as stale because it has not had recent activity.
            
            è¿™ä¸ªé—®é¢˜å› ä¸ºé•¿æ—¶é—´æ²¡æœ‰æ´»åŠ¨è€Œè¢«è‡ªåŠ¨æ ‡è®°ä¸º staleã€‚
            
            It will be closed in 7 days if no further activity occurs. To keep it open:
            - Provide the requested information or test files
            - Add a comment with updates or clarifications
            - Remove the stale label
            
            å¦‚æœæ²¡æœ‰è¿›ä¸€æ­¥çš„æ´»åŠ¨ï¼Œå®ƒå°†åœ¨ 7 å¤©åè¢«å…³é—­ã€‚è¦ä¿æŒå¼€æ”¾çŠ¶æ€ï¼š
            - æä¾›è¯·æ±‚çš„ä¿¡æ¯æˆ–æµ‹è¯•æ–‡ä»¶
            - æ·»åŠ åŒ…å«æ›´æ–°æˆ–æ¾„æ¸…çš„è¯„è®º
            - ç§»é™¤ stale æ ‡ç­¾
            
            Thank you for your understanding! æ„Ÿè°¢æ‚¨çš„ç†è§£ï¼
            
          # Close message for questions
          close-issue-message: |
            ğŸ”’ This question has been automatically closed due to lack of response.
            
            è¿™ä¸ªé—®é¢˜å› ä¸ºç¼ºä¹å›åº”è€Œè¢«è‡ªåŠ¨å…³é—­ã€‚
            
            If you still need help:
            - Provide the missing information and reopen this issue
            - Create a new issue with complete details
            - Make sure to include all requested information
            
            å¦‚æœæ‚¨ä»éœ€è¦å¸®åŠ©ï¼š
            - æä¾›ç¼ºå¤±çš„ä¿¡æ¯å¹¶é‡æ–°æ‰“å¼€æ­¤ issue
            - åˆ›å»ºåŒ…å«å®Œæ•´è¯¦æƒ…çš„æ–° issue
            - ç¡®ä¿åŒ…å«æ‰€æœ‰è¯·æ±‚çš„ä¿¡æ¯
            
            Thank you! è°¢è°¢ï¼
          
          # Don't exempt any labels for questions (they should all be processed)
          exempt-issue-labels: 'p0,p1,p2,p3,good first issue,pinned'
          
          # Remove stale label when updated
          remove-stale-when-updated: true
          
          # Limit operations
          operations-per-run: 50

  lock-closed-issues:
    runs-on: ubuntu-latest
    permissions:
      issues: write
      pull-requests: write
    steps:
      - uses: dessant/lock-threads@v5
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          issue-inactive-days: 30  # Lock issues 30 days after they're closed
          pr-inactive-days: 30     # Lock PRs 30 days after they're closed
          issue-lock-reason: 'resolved'
          pr-lock-reason: 'resolved'
          issue-comment: |
            ğŸ”’ This issue has been locked because it has been closed for 30 days.
            
            æ­¤ issue å·²è¢«é”å®šï¼Œå› ä¸ºå®ƒå·²å…³é—­ 30 å¤©ã€‚
            
            If you believe this issue should be reopened, please create a new issue and reference this one.
            
            å¦‚æœæ‚¨è®¤ä¸ºæ­¤ issue åº”è¯¥é‡æ–°æ‰“å¼€ï¼Œè¯·åˆ›å»ºæ–°çš„ issue å¹¶å¼•ç”¨æ­¤é—®é¢˜ã€‚
          pr-comment: |
            ğŸ”’ This pull request has been locked because it has been closed for 30 days.
            
            æ­¤ pull request å·²è¢«é”å®šï¼Œå› ä¸ºå®ƒå·²å…³é—­ 30 å¤©ã€‚
            
            If you believe this should be reopened, please create a new pull request.
            
            å¦‚æœæ‚¨è®¤ä¸ºæ­¤é—®é¢˜åº”è¯¥é‡æ–°æ‰“å¼€ï¼Œè¯·åˆ›å»ºæ–°çš„ pull requestã€‚