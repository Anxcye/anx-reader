name: Label Trigger Actions

on:
  issues:
    types: [labeled]

jobs:
  handle-special-labels:
    runs-on: ubuntu-latest
    
    steps:
      - name: Validate Bug Report
        if: github.event.label.name == 'bug'
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.issue;
            const issueBody = context.payload.issue.body || '';
            
            // Check if platform information is complete
            const platformSection = issueBody.match(/- Platform:.*?\n.*?- OS:.*?\n.*?- AnxReader Version:.*?\n.*?- Device:.*?\n/s);
            
            if (!platformSection) {
              console.log('Platform section not found');
              return;
            }
            
            const platformText = platformSection[0];
            
            // Check for incomplete/default values
            const incompletePatterns = [
              /\[e\.g\.\s+Android\]/,
              /\[e\.g\.\s+Android13\(MIUI14\)\]/,
              /\[e\.g\.\s+1\.2\.0\+2033\]/,
              /\[e\.g\.\s+Xiaomi\s+13\]/,
              /- Platform:\s*\|\s*å¹³å°ï¼š\s*$/m,
              /- OS:\s*\|\s*æ“ä½œç³»ç»Ÿï¼š\s*$/m,
              /- AnxReader Version:\s*\|\s*å®‰è¯»ç‰ˆæœ¬ï¼š\s*$/m,
              /- Device:\s*\|\s*è®¾å¤‡ï¼š\s*$/m
            ];
            
            const isIncomplete = incompletePatterns.some(pattern => pattern.test(platformText));
            
            if (isIncomplete) {
              // Add question label
              await github.rest.issues.addLabels({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                labels: ['question']
              });
              
              // Add comment
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: issue.number,
                body: `ğŸ‘‹ æ„Ÿè°¢æ‚¨æäº¤bugæŠ¥å‘Šï¼

æˆ‘æ³¨æ„åˆ°æ‚¨çš„å¹³å°ä¿¡æ¯å¯èƒ½ä¸å¤Ÿå®Œæ•´ã€‚ä¸ºäº†æ›´å¥½åœ°å¸®åŠ©æ‚¨è§£å†³é—®é¢˜ï¼Œè¯·æä¾›ä»¥ä¸‹å®Œæ•´ä¿¡æ¯ï¼š

- **Platform | å¹³å°**ï¼š(å¦‚: Android, iOS, Windows, macOS, Linux)
- **OS | æ“ä½œç³»ç»Ÿ**ï¼š(å¦‚: Android 13 (MIUI 14), iOS 17.1, Windows 11)  
- **AnxReader Version | å®‰è¯»ç‰ˆæœ¬**ï¼š(å¦‚: 1.6.3+2100ï¼Œå¯åœ¨åº”ç”¨è®¾ç½®ä¸­æŸ¥çœ‹)
- **Device | è®¾å¤‡**ï¼š(å¦‚: Xiaomi 13, iPhone 15, ThinkPad X1)

è¯·ç¼–è¾‘æ‚¨çš„issueå¹¶å¡«å†™å®Œæ•´çš„å¹³å°ä¿¡æ¯ï¼Œè¿™å°†å¸®åŠ©æˆ‘ä»¬æ›´å¿«åœ°å®šä½å’Œè§£å†³é—®é¢˜ã€‚

---

Thank you for submitting this bug report!

I noticed that your platform information might be incomplete. To better help you solve the issue, please provide complete information for:

- **Platform**: (e.g., Android, iOS, Windows, macOS, Linux)
- **OS**: (e.g., Android 13 (MIUI 14), iOS 17.1, Windows 11)
- **AnxReader Version**: (e.g., 1.6.3+2100, check in app settings)
- **Device**: (e.g., Xiaomi 13, iPhone 15, ThinkPad X1)

Please edit your issue and fill in the complete platform information to help us locate and resolve the issue faster.`
              });
            }
      - name: Handle need-test-file Label
        if: github.event.label.name == 'need-test-file'
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.issue;
            
            // Add question label
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              labels: ['question']
            });
            
            // Add comment requesting test file
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: `ğŸ“ **éœ€è¦æµ‹è¯•æ–‡ä»¶ | Test File Required**

ä¸ºäº†æ›´å¥½åœ°é‡ç°å’Œè§£å†³æ‚¨é‡åˆ°çš„é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ‚¨æä¾›ç›¸å…³çš„æµ‹è¯•æ–‡ä»¶ã€‚

è¯·æä¾›ï¼š
- å‡ºç°é—®é¢˜çš„ä¹¦ç±æ–‡ä»¶ï¼ˆepubã€pdfã€txtç­‰ï¼‰
- æˆ–è€…èƒ½å¤Ÿé‡ç°é—®é¢˜çš„æœ€å°ç¤ºä¾‹æ–‡ä»¶
- å¦‚æœæ¶‰åŠç‰¹å®šæ ¼å¼ï¼Œè¯·è¯´æ˜æ–‡ä»¶çš„å…·ä½“æ ¼å¼å’Œæ¥æº

æ‚¨å¯ä»¥ï¼š
1. ç›´æ¥æ‹–æ‹½æ–‡ä»¶åˆ°æ­¤è¯„è®ºåŒºä¸Šä¼ 
2. æä¾›æ–‡ä»¶çš„ä¸‹è½½é“¾æ¥
3. å¦‚æœæ–‡ä»¶è¾ƒå¤§ï¼Œå¯ä»¥ä½¿ç”¨ç½‘ç›˜åˆ†äº«

**æ³¨æ„**ï¼šå¦‚æœæ¶‰åŠç‰ˆæƒå†…å®¹ï¼Œè¯·æä¾›å…¬å¼€æˆ–è‡ªåˆ›çš„æµ‹è¯•æ–‡ä»¶ã€‚

---

To better reproduce and resolve the issue you encountered, we need you to provide relevant test files.

Please provide:
- The book file where the problem occurs (epub, pdf, txt, etc.)
- Or a minimal example file that can reproduce the issue  
- If it involves a specific format, please specify the file format and source

You can:
1. Drag and drop files directly to this comment area to upload
2. Provide download links for the files
3. Use cloud storage sharing if the files are large

**Note**: If copyrighted content is involved, please provide public or self-created test files.`
            });
            
      - name: Handle need-more-info Label  
        if: github.event.label.name == 'need-more-info'
        uses: actions/github-script@v7
        with:
          script: |
            const issue = context.issue;
            
            // Add question label
            await github.rest.issues.addLabels({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              labels: ['question']
            });
            
            // Add comment requesting more information
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: issue.number,
              body: `â„¹ï¸ **éœ€è¦æ›´å¤šä¿¡æ¯ | More Information Required**

ä¸ºäº†æ›´å¥½åœ°å¸®åŠ©æ‚¨è§£å†³é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚

è¯·æä¾›ï¼š
- è¯¦ç»†çš„æ“ä½œæ­¥éª¤
- é”™è¯¯ä¿¡æ¯çš„å®Œæ•´æˆªå›¾æˆ–æ—¥å¿—
- é—®é¢˜å‡ºç°çš„å…·ä½“åœºæ™¯
- æ‚¨çš„è®¾å¤‡å’Œè½¯ä»¶ç‰ˆæœ¬ä¿¡æ¯
- ä»»ä½•å¯èƒ½ç›¸å…³çš„å…¶ä»–ä¿¡æ¯

è¯·ç¼–è¾‘æ‚¨çš„åŸå§‹issueæˆ–åœ¨è¯„è®ºä¸­è¡¥å……è¿™äº›ä¿¡æ¯ã€‚

---

To better help you solve the issue, we need more detailed information.

Please provide:
- Detailed steps to reproduce
- Complete screenshots or logs of error messages
- Specific scenarios where the issue occurs
- Your device and software version information  
- Any other potentially relevant information

Please edit your original issue or add this information in the comments.`
            });